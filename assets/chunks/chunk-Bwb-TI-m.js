const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/chunk-Tf_KtQ4i.js","assets/chunks/chunk-pSdIku02.js","assets/entries/pages_error.CXjL97O7.js","assets/chunks/chunk-CkW1dBBz.js","assets/static/style-6130e495.BcWtY8Ol.css","assets/static/layouts_tailwind-00e65532.CoPtGTqa.css","assets/static/layouts_style-b34a8e57.B4AnpLPI.css","assets/entries/pages_auth_callback.D6Bhgm1h.js","assets/entries/pages_days.CM8Pzhdv.js","assets/chunks/chunk-BT0HdEIe.js","assets/chunks/chunk-BWj-pErp.js","assets/chunks/chunk-l61yfe1d.js","assets/chunks/chunk-Dn35YjOq.js","assets/chunks/chunk-CIGAIrCQ.js","assets/chunks/chunk-pm1Kw1LK.js","assets/chunks/chunk-CGX-a3s_.js","assets/entries/pages_defaults.DwFSgICJ.js","assets/chunks/chunk-BMh89R92.js","assets/chunks/chunk-DhEZ9Pnn.js","assets/entries/pages_index.sXFcBpKY.js","assets/entries/pages_login.Dk1k-TJs.js","assets/entries/pages_packing-list.BMGbXf1d.js","assets/entries/pages_people.DcPyxW9f.js","assets/entries/pages_people_manage.59LBf681.js","assets/entries/pages_profile.C8__wvAu.js","assets/entries/pages_settings.5Zl8cYt1.js","assets/chunks/chunk-FfNSx1qK.js","assets/entries/pages_trips.D7tMdOaE.js","assets/entries/pages_trips_-tripId.C0uGqSbS.js","assets/entries/pages_trips_-tripId_settings.A2U0xfej.js","assets/entries/pages_trips_-tripId_wizard.DoSPr6pa.js","assets/entries/pages_trips_new.j5TCN3SF.js","assets/entries/pages_version.Ct7F9gy3.js"])))=>i.map(i=>d[i]);
import{b as ca,r as B,c as Bc,g as zc,a as Hc}from"./chunk-pSdIku02.js";function xs(t){return Array.from(new Set(t))}function ae(t,e){const r=Wc();return r[t]=r[t]||e}function Wc(){const t="_vike";return globalThis[t]=globalThis[t]||{}}const T=new Proxy({},{get:(t,e)=>r=>e==="code"?`\`${r}\``:e==="string"?`'${r}'`:r}),ua="0.4.231";let Ht;Ht??(Ht=da());function da(){return ae("utils/assertSingleInstance.ts",{instances:[],alreadyLogged:new Set})}function Qr(){return Ht??(Ht=da()),Ht}const Vc="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",fa="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function ha(){const t=Qr();{const e=xs(t.instances);Ur(e.length<=1,`vike@${T.bold(e[0])} and vike@${T.bold(e[1])} loaded which is highly discouraged, see ${T.underline("https://vike.dev/warning/version-mismatch")}`,{onlyOnce:!0,showStackTrace:!1})}t.checkSingleInstance&&t.instances.length>1&&Ur(!1,fa,{onlyOnce:!0,showStackTrace:!0})}function F_(t){const e=Qr();Ur(e.isClientRouting!==!1,Vc,{onlyOnce:!0,showStackTrace:!0}),Ur(e.isClientRouting===void 0,fa,{onlyOnce:!0,showStackTrace:!0}),e.isClientRouting=!0,e.checkSingleInstance=!0,ha()}function Yc(){Qr().instances.push(ua),ha()}function Ur(t,e,{onlyOnce:r,showStackTrace:n}){const s=Qr();if(t)return;const i=`[Vike][Warning] ${e}`;{const{alreadyLogged:o}=s,a=i;if(o.has(a))return;o.add(a)}console.warn(n?new Error(i):i)}function qc(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function Zr(t,e){const r=new Error(t);return qc()&&(r.stack=Gc(r.stack,e)),r}function Gc(t,e){if(!t)return t;const r=Jc(t);let n=0;return r.filter(i=>i.includes(" (internal/")||i.includes(" (node:internal")?!1:n<e&&Kc(i)?(n++,!1):!0).join(`
`)}function Kc(t){return t.startsWith("    at ")}function Jc(t){return t.split(/\r?\n/)}function q(t){return typeof t=="object"&&t!==null}const se=ae("utils/assert.ts",{alreadyLogged:new Set,logger(t,e){e==="info"?console.log(t):console.warn(t)},showStackTraceList:new WeakSet});Yc();const Qc="[vike]",Zc=`[vike@${ua}]`,Xc="Bug",Xr=2;function g(t,e){if(t)return;const r=(()=>{if(!e)return null;const o=typeof e=="string"?e:JSON.stringify(e);return T.dim(`Debug info (for Vike maintainers; you can ignore this): ${o}`)})();let s=[`You stumbled upon a Vike bug. Go to ${T.underline("https://github.com/vikejs/vike/issues/new?template=bug.yml")} and copy-paste this error. A maintainer will fix the bug (usually within 24 hours).`,r].filter(Boolean).join(" ");s=ar(s),s=en(s,Xc),s=lr(s,!0);const i=Zr(s,Xr);throw se.onBeforeLog?.(),i}function R(t,e,{showStackTrace:r,exitOnError:n}={}){if(t)return;r=r||se.alwaysShowStackTrace,e=ar(e),e=en(e,"Wrong Usage"),e=lr(e);const s=Zr(e,Xr);if(r&&se.showStackTraceList.add(s),se.onBeforeLog?.(),n)console.error(r?s:e),process.exit(1);else throw s}function pa(t){return t=ar(t),t=en(t,"Error"),t=lr(t),Zr(t,Xr)}function V(t,e,{onlyOnce:r,showStackTrace:n}){if(!t){if(n=n||se.alwaysShowStackTrace,e=ar(e),e=en(e,"Warning"),e=lr(e),r){const{alreadyLogged:s}=se,i=r===!0?e:r;if(s.has(i))return;s.add(i)}if(se.onBeforeLog?.(),n){const s=Zr(e,Xr);se.showStackTraceList.add(s),se.logger(s,"warn")}else se.logger(e,"warn")}}function eu(t,e,{onlyOnce:r}){e=ar(e),e=lr(e);{const{alreadyLogged:n}=se,s=e;if(n.has(s))return;n.add(s)}se.onBeforeLog?.(),se.logger(e,"info")}function en(t,e){let r=`[${e}]`;const n=e==="Warning"?"yellow":"red";return r=T.bold(T[n](r)),`${r}${t}`}function ar(t){return t.startsWith("[")?t:` ${t}`}function lr(t,e=!1){return`${e?Zc:Qc}${t}`}function mi(t){const e=t/1e3;if(e<120){const r=Si(e);return`${r} second${wi(r)}`}{const r=e/60,n=Si(r);return`${n} minute${wi(n)}`}}function Si(t){let e=t.toFixed(1);return e.endsWith(".0")&&(e=e.slice(0,-2)),e}function wi(t){return t==="1"?"":"s"}function Ue(t,e,r){return typeof t=="string"?vi(t.split(""),e,r).join(""):vi(t,e,r)}function vi(t,e,r){const n=[];let s=e>=0?e:t.length+e;g(s>=0&&s<=t.length);let i=r>=0?r:t.length+r;for(g(i>=0&&i<=t.length);!(s===i||(s===t.length&&(s=0),s===i));){const o=t[s];g(o!==void 0),n.push(o),s++}return n}function tn(t,e){g(wa(t),t),g(e.startsWith("/"));const{hashString:r,withoutHash:n}=tu(t);g(r===null||r.startsWith("#"));const s=r===null?"":ga(r.slice(1)),{searchString:i,withoutSearch:o}=_i(n);g(i===null||i.startsWith("?"));let a="";if(i!==null)a=i;else if(t.startsWith("#")){const m=ya();a=m&&_i(m).searchString||""}const l={},c={};Array.from(new URLSearchParams(a)).forEach(([m,w])=>{l[m]=w,c[m]=[...c.hasOwnProperty(m)?c[m]:[],w]});let{protocol:u,origin:d,pathnameAbsoluteWithBase:f}=nu(o,e);const h=o.slice((d||"").length);au(t,d,h,i,r);let{pathname:y,isBaseMissing:E}=ou(f,e);const _=Sa(d,y,i,r),I=d?d.slice(u.length):null,{hostname:b,port:p}=su(I,t);return y=ru(y),g(y.startsWith("/")),{href:_,protocol:u,hostname:b,port:p,origin:d,pathname:y,pathnameOriginal:h,isBaseMissing:E,search:l,searchAll:c,searchOriginal:i,hash:s,hashOriginal:r}}function tu(t){const[e,...r]=t.split("#");return{hashString:["",...r].join("#")||null,withoutHash:e}}function _i(t){const[e,...r]=t.split("?");return{searchString:["",...r].join("?")||null,withoutSearch:e}}function ga(t){try{return decodeURIComponent(t)}catch{}try{return decodeURI(t)}catch{}return t}function ru(t){return t=t.replace(/\s+$/,""),t=t.split("/").map(e=>ga(e).split("/").join("%2F")).join("/"),t}function nu(t,e){g(!t.includes("?")&&!t.includes("#"));{const{protocol:r,origin:n,pathname:s}=Ei(t);if(n)return{protocol:r,origin:n,pathnameAbsoluteWithBase:s};g(s===t)}if(t.startsWith("/"))return{protocol:null,origin:null,pathnameAbsoluteWithBase:t};{const r=ya();let n;return r?n=Ei(r.split("?")[0].split("#")[0]).pathname:n=e,{protocol:null,origin:null,pathnameAbsoluteWithBase:iu(t,n)}}}function ya(){return typeof window<"u"?window?.document?.baseURI:void 0}function Ei(t){if(Ls(t)){const{protocol:e,uriWithoutProtocol:r}=$s(t);g(e);const[n,...s]=r.split("/"),i=e+n;return{pathname:"/"+s.join("/"),origin:i,protocol:e}}else return{pathname:t,origin:null,protocol:null}}function su(t,e){const r={hostname:null,port:null};if(!t)return r;const n=t.split(":");if(n.length>1){const s=parseInt(n.pop(),10);g(s||s===0,e),r.port=s}return r.hostname=n.join(":"),r}function $s(t){const e=":",[r,...n]=t.split(e);if(n.length===0||!/^[a-z][a-z0-9\+\-]*$/i.test(r))return{protocol:null,uriWithoutProtocol:t};let s=r+e,i=n.join(e);const o="//";return i.startsWith(o)&&(s=s+o,i=i.slice(o.length)),{protocol:s,uriWithoutProtocol:i}}function ma(t){return["ipfs://","ipns://"].includes(t)?!1:t.endsWith("://")}function iu(t,e){const r=e.split("/"),n=t.split("/");let s=e.endsWith("/");t.startsWith(".")&&r.pop();for(const o in n){const a=n[o];a==""&&o==="0"||a!="."&&(a==".."?r.pop():(s=!1,r.push(a)))}let i=r.join("/");return s&&!i.endsWith("/")&&(i+="/"),i.startsWith("/")||(i="/"+i),i}function ou(t,e){g(t.startsWith("/")),g(Us(e));let r=t;if(g(r.startsWith("/")),g(e.startsWith("/")),e==="/")return{pathname:t,isBaseMissing:!1};let n=e;return e.endsWith("/")&&r===Ue(e,0,-1)&&(n=Ue(e,0,-1),g(r===n)),r.startsWith(n)?(g(r.startsWith("/")||r.startsWith("http")),g(r.startsWith(n)),r=r.slice(n.length),r.startsWith("/")||(r="/"+r),g(r.startsWith("/")),{pathname:r,isBaseMissing:!1}):{pathname:t,isBaseMissing:!0}}function Us(t){return t.startsWith("/")}function au(t,e,r,n,s){const i=Sa(e,r,n,s);g(t===i)}function Sa(t,e,r,n){return`${t||""}${e}${r||""}${n||""}`}function wa(t){return Ls(t)||t.startsWith("/")||va(t)}function lu(t){return t.startsWith("/")||uu(t)||Ls(t)}function va(t){return[".","?","#"].some(e=>t.startsWith(e))||t===""}function cu(t){return!t.startsWith("/")&&!va(t)}function Ls(t){const{protocol:e}=$s(t);return!!e&&ma(e)}function uu(t){const{protocol:e}=$s(t);return!!e&&!ma(t)}function du(t,e){fu(t,e)}function fu(t,e,{isRedirectTarget:r}={}){if(t.startsWith("/"))return;let n=`${e} is ${T.string(t)} but it should start with ${T.string("/")}`;if(r){if(lu(t))return;if(n+=` or a protocol (${T.string("http://")}, ${T.string("mailto:")}, ...)`,r==="unresolved"){if(t==="*")return;n+=`, or be ${T.string("*")}`}}R(!1,n)}function D(t,e,r){e&&(r||g(!e._isOriginalObject),Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)))}function ze(t){return t instanceof Function||typeof t=="function"}function Rr(t){return(e,r)=>{const n=t(e),s=t(r);return n===s?0:n>s?-1:1}}function hu(t){return(e,r)=>{const n=t(e),s=t(r);return n===s?0:n<s?-1:1}}function Ge(t){return(e,r)=>{const n=t(e),s=t(r);if(g([!0,!1,null].includes(n)),g([!0,!1,null].includes(s)),n===s)return 0;if(n===!0||s===!1)return-1;if(s===!0||n===!1)return 1;g(!1)}}function pu(t){return Ge(e=>{const r=t(e);return r===null?null:!r})}function Pe(){return typeof window<"u"&&typeof window.scrollY=="number"}function Te(t){return Array.isArray(t)}function gu(t){return Te(t)&&t.every(e=>typeof e=="string")}function yu(t){return q(t)&&Object.values(t).every(e=>typeof e=="string")}function O(t,e,r){if(!q(t))return!1;if(!(e in t))return r==="undefined";if(r===void 0)return!0;const n=t[e];return r==="undefined"?n===void 0:r==="array"?Te(n):r==="object"?q(n):r==="string[]"?gu(n):r==="string{}"?yu(n):r==="function"?ze(n):Te(r)?typeof n=="string"&&r.includes(n):r==="null"?n===null:r==="true"?n===!0:r==="false"?n===!1:typeof n===r}function er(t){return typeof t!="object"||t===null?!1:Object.getPrototypeOf(t)===null?!0:t.constructor.name==="Object"}function mu(t,e){return t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0}function Su(t){return t==null}function wu(t){return!Su(t)}function bi(t){return"["+t.map(e=>"'"+e+"'").join(", ")+"]"}function vu(t,e){const r=Object.getOwnPropertyDescriptor(t,e);return!!r&&!("value"in r)&&!!r.get}function _u(t){return typeof t=="object"&&t!==null&&"then"in t&&ze(t.then)}function Eu(t){return[null,void 0].includes(t)?String(t):["boolean","number","string"].includes(typeof t)?JSON.stringify(t):null}function bu(t){return t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}function wt(t,e,r){const n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(t,e,{...n,enumerable:r})}function Pr(t,e,{get:r,...n}){Object.defineProperty(t,e,{...n,get:r})}const Iu=["js","cjs","mjs"],Tu=["ts","cts","mts"],Cu=[...Iu,...Tu],Ru=["jsx","cjsx","mjsx"],Pu=["tsx","ctsx","mtsx"],Au=[...Ru,...Pu],_a=["vue","svelte","marko","md","mdx"],ku=[...Cu,...Au,..._a];function Ea(t){return ku.some(e=>t.endsWith("."+e))}function Du(t){return _a.some(e=>t.endsWith("."+e))}function Ou(t){return typeof t=="string"&&xu(t)?`.${t}`:`[${JSON.stringify(t)}]`}function xu(t){return/^[a-z0-9\$_]+$/i.test(t)}function ba(t,e){const r=e.find(n=>n.pageId===t);return g(e.length>0),g(r),r}function Ia(t){if(!t||Te(t)||t.definedBy)return null;const{filePathToShowToUser:e}=t;return g(e),e}function Ta(t){const e=Ia(t);return g(e),e}function $u(t,e){if(!t)return null;let[r,...n]=t;if(!r||n.length===0&&["*","default",e].includes(r))return null;g(r!=="*");let s="",i="";return r==="default"?s="export default":(s="export",n=[r,...n]),n.forEach(a=>{s=`${s} { ${a}`,i=` }${i}`}),s+i}function Uu(t,e,r){return`${Gn(t,e)} at ${tr(r,e)}`}function Ca(t,e,r){return r?`${Gn(t,e)} at ${tr(r,e)}`:`${Gn(t,e)} internally`}function Gn(t,e){return`${t} ${T.cyan(e)} defined`}function tr(t,e){let r;return Te(t)?r=t:r=[t],g(r.length>=1),r.map(s=>{if(s.definedBy)return Lu(s,e);const{filePathToShowToUser:i,fileExportPathToShowToUser:o}=s;let a=i;const l=$u(o,e);return l&&(a=`${a} > ${T.cyan(l)}`),a}).join(" / ")}function Lu(t,e){if(t.definedBy==="api")return`API call ${T.cyan(`${t.operation}({ vikeConfig: { ${e} } })`)}`;const{definedBy:r}=t;if(r==="cli")return`CLI option ${T.cyan(`--${e}`)}`;if(r==="env")return`environment variable ${T.cyan(`VIKE_CONFIG="{${e}}"`)}`;g(!1)}function Nu(t,e,r){const{value:n,definedAtData:s}=t;return r&&ju(n,r,e,s),t}function ju(t,e,r,n){g(t!==null);const s=typeof t;if(s===e)return;const i=Eu(t),o=i!==null?`value ${T.cyan(i)}`:`type ${T.cyan(s)}`,l=`${Ca("Config",r,n)} has an invalid ${o}: it should be a ${T.cyan(e)} instead`;R(!1,l)}function Tt(t,e,r){const n=t.configValues[e];return n?Nu(n,e,r):null}const Fu=ae("hooks/getHook.ts",{});function Kn(t,e){if(!(e in t.exports))return null;const{hooksTimeout:r}=t.config,n=Pa(r,e),s=t.exports[e];if(s===null)return null;const i=t.exportsAll[e][0];g(i.exportValue===s);const o=i.filePath;return g(o),rn(s,e,o,n)}function Jn(t,e){const{hooksTimeout:r}=e.config,n=Pa(r,t),s=[];return e.exportsAll[t]?.forEach(i=>{const o=i.exportValue;if(o===null)return;const a=i.filePath;g(a),s.push(rn(o,t,a,n))}),s}function Mu(t,e){const r=t.configValues[e];if(!r?.value)return null;const{hookFn:n,hookFilePath:s}=zu(r),i=Ra(e);return rn(n,e,s,i)}function Bu(t,e){const r=t.configValues[e];if(!r?.value)return[];const n=r.value;return g(Te(n)),n.map((s,i)=>{const o=s,a=Ra(e);g(Te(r.definedAtData));const l=Ta(r.definedAtData[i]);return rn(o,e,l,a)})}function Ra(t){return nn(t)}function rn(t,e,r,n){return g(r),Hu(t,{hookName:e,hookFilePath:r}),{hookFn:t,hookName:e,hookFilePath:r,hookTimeout:n}}function zu(t){const e=t.value;g(e);const r=Ta(t.definedAtData);return{hookFn:e,hookFilePath:r}}function Hu(t,{hookName:e,hookFilePath:r}){g(e&&r),g(!e.endsWith(")")),g(!r.endsWith(" ")),R(ze(t),`Hook ${e}() defined by ${r} should be a function`)}function Pa(t,e){const r=Wu(t);if(r===!1)return{error:!1,warning:!1};const n=r[e],s=nn(e);return n?.error!==void 0&&(s.error=n.error),n?.warning!==void 0&&(s.warning=n.warning),s}function Wu(t){if(t===void 0)return{};if(t===!1)return!1;R(q(t),`Setting ${T.cyan("hooksTimeout")} should be ${T.cyan("false")} or an object`);const e={};return Object.entries(t).forEach(([r,n])=>{if(n===!1){e[r]={error:!1,warning:!1};return}R(q(n),`Setting ${T.cyan(`hooksTimeout.${r}`)} should be ${T.cyan("false")} or an object`);const[s,i]=["error","warning"].map(o=>{const a=n[o];if(a===void 0||a===!1)return a;const l=`Setting ${T.cyan(`hooksTimeout.${r}.${o}`)} should be`;return R(typeof a=="number",`${l} ${T.cyan("false")} or a number`),R(a>0,`${l} a positive number`),a});e[r]={error:s,warning:i}}),e}function nn(t){return t==="onBeforeRoute"?{error:5*1e3,warning:1*1e3}:Fu.isPrerendering?{error:2*60*1e3,warning:30*1e3}:(g(!t.toLowerCase().includes("prerender")),{error:30*1e3,warning:4*1e3})}function Vu(t){Yu(t)}function Yu(t){if(t.is404===void 0||t.is404===null)return;const e=t.pageProps||{};if(!q(e)){V(!1,"pageContext.pageProps should be an object",{showStackTrace:!0,onlyOnce:!0});return}e.is404=e.is404||t.is404,t.pageProps=e}const qu="__VIKE__NOT_SERIALIZABLE__";function Aa(t,e,r,n){return new Proxy(t,{get:Gu(t,e,r,n)})}function Gu(t,e,r,n){return function(s,i){const o=String(i);if(i==="_isProxyObject")return!0;if(r||Ju(o,e),n&&!(i in t))return n(i);const a=t[i];return Ku(o,a,e),a}}function Ku(t,e,r){if(e!==qu)return;const n=Ou(t);g(Pe()),R(!1,`Can't access ${r}${n} on the client side. Because it can't be serialized, see server logs.`)}function Ju(t,e){Pe()||t!=="_configFromHook"&&t.startsWith("_")&&V(!1,`Using internal ${e}.${t} which may break in any minor version update. Reach out on GitHub to request official support for your use case.`,{onlyOnce:!0,showStackTrace:!0})}function ka(t){return g(t._isOriginalObject),Aa(t,"globalContext")}function sn(t){g(!t._isProxyObject),g(!t.globalContext),g(t._isOriginalObject),Vu(t),"_pageId"in t||Object.defineProperty(t,"_pageId",{get(){return V(!1,"pageContext._pageId has been renamed to pageContext.pageId",{showStackTrace:!0,onlyOnce:!0}),t.pageId},enumerable:!1}),Qu(t);const e=ka(t._globalContext);return Aa(t,"pageContext",!0,n=>{if(n==="globalContext")return e;if(n in e)return e[n]})}function Qu(t){let e=Object.getOwnPropertyDescriptors(t);for(const r of Object.keys(t))delete t[r];e=Object.fromEntries(Object.entries(e).sort(([r],[n])=>mu(r,n))),Object.defineProperties(t,e)}function Da(t){["urlPathname","urlParsed","url","pageExports"].forEach(e=>{t.prop&&g(vu(t,e))})}const Qn=ae("utils/execHook.ts",{userHookErrors:new WeakMap,pageContext:null});async function Oa(t,e,r){const n=await Lr([t],e,r);if("err"in n)throw n.err;const{hookReturn:s}=n.hooks[0];R(s===void 0,`The ${t.hookName}() hook defined by ${t.hookFilePath} isn't allowed to return a value`)}async function Zu(t,e,r){const n=await xa(t,e,r);if("err"in n)throw n.err;return n.hooks}async function xa(t,e,r){const n=Jn(t,e);return Lr(n,e,r)}async function Lr(t,e,r){if(!t.length)return{hooks:[]};const n=r(e);let s,i;try{s=await Promise.all(t.map(async o=>{const a=await Ua(()=>o.hookFn(n),o,n);return{...o,hookReturn:a}}))}catch(o){i=o}return s?{hooks:s}:{hooks:t,err:i}}async function $a(t,e,r,n,s){const i=Bu(e,t),o=s(n);await Promise.all(i.map(async a=>{await Ua(()=>a.hookFn(o),a,r)}))}function Ua(t,e,r){const{hookName:n,hookFilePath:s,hookTimeout:{error:i,warning:o}}=e;let a,l;const c=new Promise((h,y)=>{a=E=>{u(),h(E)},l=E=>{u(),y(E)}}),u=()=>{d&&clearTimeout(d),f&&clearTimeout(f)},d=Ii(o)&&setTimeout(()=>{V(!1,`The ${n}() hook defined by ${s} is slow: it's taking more than ${mi(o)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},o),f=Ii(i)&&setTimeout(()=>{const h=pa(`The ${n}() hook defined by ${s} timed out: it didn't finish after ${mi(i)} (https://vike.dev/hooksTimeout)`);l(h)},i);return(async()=>{try{Ns(r);const h=await t();a(h)}catch(h){q(h)&&Qn.userHookErrors.set(h,{hookName:n,hookFilePath:s}),l(h)}})(),c}function La(t,e,r){const n=r(e);return Ns(n),{hookReturn:t.hookFn(n)}}function Ii(t){return!!t&&t!==1/0}function M_(t){Ns(t)}function Ns(t){Qn.pageContext=t,Promise.resolve().then(()=>{Qn.pageContext=null})}const Ct=(t,e,r)=>{switch(e){case"==":return t===r;case"!=":return t!==r;case"<":return typeof t=="number"&&typeof r=="number"?t<r:!1;case">":return typeof t=="number"&&typeof r=="number"?t>r:!1;case"<=":return typeof t=="number"&&typeof r=="number"?t<=r:!1;case">=":return typeof t=="number"&&typeof r=="number"?t>=r:!1;case"in":return Array.isArray(t)&&t.includes(r)||Array.isArray(r)&&r.includes(t);default:return!1}},Xu=(t,e)=>{if(!e)return t;const r=t/e.every;return e.roundUp?Math.ceil(r):Math.floor(r)},Nr=(t,e=!1,r=!1,n,s,i)=>{let o=t;return(e||s===0)&&(o*=s),(r||i===0)&&(o*=Xu(i,n)),o};function B_(t,e){return t.filter(r=>e.every(n=>{if(n.type==="person"){const s=r[n.field];return s==null||typeof s=="object"||n.value===void 0?!1:Ct(s,n.operator,n.value)}return!0})).length}function z_(t,e){return t.filter(r=>e.every(n=>{if(n.type==="day"){const s=r[n.field];return n.value===void 0?!1:Ct(s,n.operator,n.value)}return!0})).length}const ed=(t,e,r)=>{const{baseQuantity:n,perPerson:s,perDay:i,daysPattern:o,extraItems:a}=t.calculation,l=t.conditions;let c=e.length,u=r.length;if(l?.length&&l.length>0){for(const h of l)if(h.type==="person")for(const y of e){if(h.value===void 0){c--;continue}const E=y[h.field];E!=null&&typeof E!="object"&&Ct(E,h.operator,h.value)||c--}else if(h.type==="day")for(const y of r)Ct(y[h.field],h.operator,h.value)||u--}const d=Nr(n,s,i,o,c,u),f=a?Nr(a.quantity,a.perPerson,a.perDay,a.daysPattern,c,u):0;return Math.ceil(d+f)};function td(t){const e=JSON.stringify({name:t.name,calculation:t.calculation,conditions:t.conditions});let r=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);r=(r<<5)-r+s,r=r&r}return r.toString(36)}const H_=6048e5,W_=864e5,Na=6e4,ja=36e5,Ti=Symbol.for("constructDateFrom");function on(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&Ti in t?t[Ti](e):t instanceof Date?new t.constructor(e):new Date(e)}function Rt(t,e){return on(e||t,t)}function rd(t,e,r){const n=Rt(t,r?.in);return isNaN(e)?on(t,NaN):(e&&n.setDate(n.getDate()+e),n)}function js(t,...e){const r=on.bind(null,e.find(n=>typeof n=="object"));return e.map(r)}function Ci(t,e){const r=Rt(t,e?.in);return r.setHours(0,0,0,0),r}function jr(t,e){const r=+Rt(t)-+Rt(e);return r<0?-1:r>0?1:r}function nd(t,e,r){const[n,s]=js(r?.in,t,e);return+Ci(n)==+Ci(s)}function sd(t,e,r){const[n,s]=js(r?.in,t,e);return n.getFullYear()-s.getFullYear()}function id(t,e,r){const[n,s]=js(r?.in,t,e),i=jr(n,s),o=Math.abs(sd(n,s));n.setFullYear(1584),s.setFullYear(1584);const a=jr(n,s)===-i,l=i*(o-+a);return l===0?0:l}function xe(t,e){const r=()=>on(e?.in,NaN),s=cd(t);let i;if(s.date){const c=ud(s.date,2);i=dd(c.restDateString,c.year)}if(!i||isNaN(+i))return r();const o=+i;let a=0,l;if(s.time&&(a=fd(s.time),isNaN(a)))return r();if(s.timezone){if(l=hd(s.timezone),isNaN(l))return r()}else{const c=new Date(o+a),u=Rt(0,e?.in);return u.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),u.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),u}return Rt(o+a+l,e?.in)}const dr={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},od=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,ad=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,ld=/^([+-])(\d{2})(?::?(\d{2}))?$/;function cd(t){const e={},r=t.split(dr.dateTimeDelimiter);let n;if(r.length>2)return e;if(/:/.test(r[0])?n=r[0]:(e.date=r[0],n=r[1],dr.timeZoneDelimiter.test(e.date)&&(e.date=t.split(dr.timeZoneDelimiter)[0],n=t.substr(e.date.length,t.length))),n){const s=dr.timezone.exec(n);s?(e.time=n.replace(s[1],""),e.timezone=s[1]):e.time=n}return e}function ud(t,e){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=t.match(r);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?s:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function dd(t,e){if(e===null)return new Date(NaN);const r=t.match(od);if(!r)return new Date(NaN);const n=!!r[4],s=Ut(r[1]),i=Ut(r[2])-1,o=Ut(r[3]),a=Ut(r[4]),l=Ut(r[5])-1;if(n)return Sd(e,a,l)?pd(e,a,l):new Date(NaN);{const c=new Date(0);return!yd(e,i,o)||!md(e,s)?new Date(NaN):(c.setUTCFullYear(e,i,Math.max(s,o)),c)}}function Ut(t){return t?parseInt(t):1}function fd(t){const e=t.match(ad);if(!e)return NaN;const r=En(e[1]),n=En(e[2]),s=En(e[3]);return wd(r,n,s)?r*ja+n*Na+s*1e3:NaN}function En(t){return t&&parseFloat(t.replace(",","."))||0}function hd(t){if(t==="Z")return 0;const e=t.match(ld);if(!e)return 0;const r=e[1]==="+"?-1:1,n=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return vd(n,s)?r*(n*ja+s*Na):NaN}function pd(t,e,r){const n=new Date(0);n.setUTCFullYear(t,0,4);const s=n.getUTCDay()||7,i=(e-1)*7+r+1-s;return n.setUTCDate(n.getUTCDate()+i),n}const gd=[31,null,31,30,31,30,31,31,30,31,30,31];function Fa(t){return t%400===0||t%4===0&&t%100!==0}function yd(t,e,r){return e>=0&&e<=11&&r>=1&&r<=(gd[e]||(Fa(t)?29:28))}function md(t,e){return e>=1&&e<=(Fa(t)?366:365)}function Sd(t,e,r){return e>=1&&e<=53&&r>=0&&r<=6}function wd(t,e,r){return t===24?e===0&&r===0:r>=0&&r<60&&e>=0&&e<60&&t>=0&&t<25}function vd(t,e){return e>=0&&e<=59}const He=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)});function Ce(t,e){if(t===e)return!0;if(t==null||e==null)return t===e;if(typeof t!=typeof e)return!1;if(typeof t!="object")return t===e;if(Array.isArray(t)||Array.isArray(e)){if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!Ce(t[s],e[s]))return!1;return!0}const r=Object.keys(t).sort(),n=Object.keys(e).sort();if(r.length!==n.length)return!1;for(let s=0;s<r.length;s++){if(r[s]!==n[s])return!1;const i=t[r[s]],o=e[n[s]];if(!Ce(i,o))return!1}return!0}function Ma(t,e,r=""){const n=[],s=new Set([...Object.keys(t),...Object.keys(e)]);for(const i of s){const o=r?`${r}.${i}`:i,a=t[i],l=e[i],c=i in t&&a!==void 0,u=i in e&&l!==void 0;if(!c&&u)n.push({path:o,type:"added",localValue:void 0,serverValue:l});else if(c&&!u)n.push({path:o,type:"removed",localValue:a,serverValue:void 0});else if(c&&u&&!Ce(a,l))if(a&&l&&typeof a=="object"&&typeof l=="object"&&!Array.isArray(a)&&!Array.isArray(l)){const d=Ma(a,l,o);n.push(...d)}else n.push({path:o,type:"modified",localValue:a,serverValue:l})}return n}function Q(t){return`Minified Redux error #${t}; visit https://redux.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var _d=typeof Symbol=="function"&&Symbol.observable||"@@observable",Ri=_d,bn=()=>Math.random().toString(36).substring(7).split("").join("."),Ed={INIT:`@@redux/INIT${bn()}`,REPLACE:`@@redux/REPLACE${bn()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${bn()}`},Fr=Ed;function Fs(t){if(typeof t!="object"||t===null)return!1;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e||Object.getPrototypeOf(t)===null}function Ba(t,e,r){if(typeof t!="function")throw new Error(Q(2));if(typeof e=="function"&&typeof r=="function"||typeof r=="function"&&typeof arguments[3]=="function")throw new Error(Q(0));if(typeof e=="function"&&typeof r>"u"&&(r=e,e=void 0),typeof r<"u"){if(typeof r!="function")throw new Error(Q(1));return r(Ba)(t,e)}let n=t,s=e,i=new Map,o=i,a=0,l=!1;function c(){o===i&&(o=new Map,i.forEach((_,I)=>{o.set(I,_)}))}function u(){if(l)throw new Error(Q(3));return s}function d(_){if(typeof _!="function")throw new Error(Q(4));if(l)throw new Error(Q(5));let I=!0;c();const b=a++;return o.set(b,_),function(){if(I){if(l)throw new Error(Q(6));I=!1,c(),o.delete(b),i=null}}}function f(_){if(!Fs(_))throw new Error(Q(7));if(typeof _.type>"u")throw new Error(Q(8));if(typeof _.type!="string")throw new Error(Q(17));if(l)throw new Error(Q(9));try{l=!0,s=n(s,_)}finally{l=!1}return(i=o).forEach(b=>{b()}),_}function h(_){if(typeof _!="function")throw new Error(Q(10));n=_,f({type:Fr.REPLACE})}function y(){const _=d;return{subscribe(I){if(typeof I!="object"||I===null)throw new Error(Q(11));function b(){const m=I;m.next&&m.next(u())}return b(),{unsubscribe:_(b)}},[Ri](){return this}}}return f({type:Fr.INIT}),{dispatch:f,subscribe:d,getState:u,replaceReducer:h,[Ri]:y}}function bd(t){Object.keys(t).forEach(e=>{const r=t[e];if(typeof r(void 0,{type:Fr.INIT})>"u")throw new Error(Q(12));if(typeof r(void 0,{type:Fr.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(Q(13))})}function Id(t){const e=Object.keys(t),r={};for(let i=0;i<e.length;i++){const o=e[i];typeof t[o]=="function"&&(r[o]=t[o])}const n=Object.keys(r);let s;try{bd(r)}catch(i){s=i}return function(o={},a){if(s)throw s;let l=!1;const c={};for(let u=0;u<n.length;u++){const d=n[u],f=r[d],h=o[d],y=f(h,a);if(typeof y>"u")throw a&&a.type,new Error(Q(14));c[d]=y,l=l||y!==h}return l=l||n.length!==Object.keys(o).length,l?c:o}}function Mr(...t){return t.length===0?e=>e:t.length===1?t[0]:t.reduce((e,r)=>(...n)=>e(r(...n)))}function Td(...t){return e=>(r,n)=>{const s=e(r,n);let i=()=>{throw new Error(Q(15))};const o={getState:s.getState,dispatch:(l,...c)=>i(l,...c)},a=t.map(l=>l(o));return i=Mr(...a)(s.dispatch),{...s,dispatch:i}}}function za(t){return Fs(t)&&"type"in t&&typeof t.type=="string"}var Ha=Symbol.for("immer-nothing"),Pi=Symbol.for("immer-draftable"),ie=Symbol.for("immer-state");function fe(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var Pt=Object.getPrototypeOf;function Me(t){return!!t&&!!t[ie]}function pe(t){return t?Wa(t)||Array.isArray(t)||!!t[Pi]||!!t.constructor?.[Pi]||ln(t)||cn(t):!1}var Cd=Object.prototype.constructor.toString();function Wa(t){if(!t||typeof t!="object")return!1;const e=Pt(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Cd}function Br(t,e){an(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,n)=>e(n,r,t))}function an(t){const e=t[ie];return e?e.type_:Array.isArray(t)?1:ln(t)?2:cn(t)?3:0}function Zn(t,e){return an(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Va(t,e,r){const n=an(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function Rd(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function ln(t){return t instanceof Map}function cn(t){return t instanceof Set}function Ke(t){return t.copy_||t.base_}function Xn(t,e){if(ln(t))return new Map(t);if(cn(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=Wa(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[ie];let s=Reflect.ownKeys(n);for(let i=0;i<s.length;i++){const o=s[i],a=n[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(n[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[o]})}return Object.create(Pt(t),n)}else{const n=Pt(t);if(n!==null&&r)return{...t};const s=Object.create(n);return Object.assign(s,t)}}function Ms(t,e=!1){return un(t)||Me(t)||!pe(t)||(an(t)>1&&(t.set=t.add=t.clear=t.delete=Pd),Object.freeze(t),e&&Object.entries(t).forEach(([r,n])=>Ms(n,!0))),t}function Pd(){fe(2)}function un(t){return Object.isFrozen(t)}var Ad={};function it(t){const e=Ad[t];return e||fe(0,t),e}var rr;function Ya(){return rr}function kd(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Ai(t,e){e&&(it("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function es(t){ts(t),t.drafts_.forEach(Dd),t.drafts_=null}function ts(t){t===rr&&(rr=t.parent_)}function ki(t){return rr=kd(rr,t)}function Dd(t){const e=t[ie];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Di(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[ie].modified_&&(es(e),fe(4)),pe(t)&&(t=zr(e,t),e.parent_||Hr(e,t)),e.patches_&&it("Patches").generateReplacementPatches_(r[ie].base_,t,e.patches_,e.inversePatches_)):t=zr(e,r,[]),es(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==Ha?t:void 0}function zr(t,e,r){if(un(e))return e;const n=e[ie];if(!n)return Br(e,(s,i)=>Oi(t,n,e,s,i,r)),e;if(n.scope_!==t)return e;if(!n.modified_)return Hr(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const s=n.copy_;let i=s,o=!1;n.type_===3&&(i=new Set(s),s.clear(),o=!0),Br(i,(a,l)=>Oi(t,n,s,a,l,r,o)),Hr(t,s,!1),r&&t.patches_&&it("Patches").generatePatches_(n,r,t.patches_,t.inversePatches_)}return n.copy_}function Oi(t,e,r,n,s,i,o){if(Me(s)){const a=i&&e&&e.type_!==3&&!Zn(e.assigned_,n)?i.concat(n):void 0,l=zr(t,s,a);if(Va(r,n,l),Me(l))t.canAutoFreeze_=!1;else return}else o&&r.add(s);if(pe(s)&&!un(s)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;zr(t,s),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&Hr(t,s)}}function Hr(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&Ms(e,r)}function Od(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:Ya(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let s=n,i=Bs;r&&(s=[n],i=nr);const{revoke:o,proxy:a}=Proxy.revocable(s,i);return n.draft_=a,n.revoke_=o,a}var Bs={get(t,e){if(e===ie)return t;const r=Ke(t);if(!Zn(r,e))return xd(t,r,e);const n=r[e];return t.finalized_||!pe(n)?n:n===In(t.base_,e)?(Tn(t),t.copy_[e]=ns(n,t)):n},has(t,e){return e in Ke(t)},ownKeys(t){return Reflect.ownKeys(Ke(t))},set(t,e,r){const n=qa(Ke(t),e);if(n?.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const s=In(Ke(t),e),i=s?.[ie];if(i&&i.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(Rd(r,s)&&(r!==void 0||Zn(t.base_,e)))return!0;Tn(t),rs(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return In(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,Tn(t),rs(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=Ke(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){fe(11)},getPrototypeOf(t){return Pt(t.base_)},setPrototypeOf(){fe(12)}},nr={};Br(Bs,(t,e)=>{nr[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});nr.deleteProperty=function(t,e){return nr.set.call(this,t,e,void 0)};nr.set=function(t,e,r){return Bs.set.call(this,t[0],e,r,t[0])};function In(t,e){const r=t[ie];return(r?Ke(r):t)[e]}function xd(t,e,r){const n=qa(e,r);return n?"value"in n?n.value:n.get?.call(t.draft_):void 0}function qa(t,e){if(!(e in t))return;let r=Pt(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=Pt(r)}}function rs(t){t.modified_||(t.modified_=!0,t.parent_&&rs(t.parent_))}function Tn(t){t.copy_||(t.copy_=Xn(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var $d=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const i=r;r=e;const o=this;return function(l=i,...c){return o.produce(l,u=>r.call(this,u,...c))}}typeof r!="function"&&fe(6),n!==void 0&&typeof n!="function"&&fe(7);let s;if(pe(e)){const i=ki(this),o=ns(e,void 0);let a=!0;try{s=r(o),a=!1}finally{a?es(i):ts(i)}return Ai(i,n),Di(s,i)}else if(!e||typeof e!="object"){if(s=r(e),s===void 0&&(s=e),s===Ha&&(s=void 0),this.autoFreeze_&&Ms(s,!0),n){const i=[],o=[];it("Patches").generateReplacementPatches_(e,s,i,o),n(i,o)}return s}else fe(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(o,...a)=>this.produceWithPatches(o,l=>e(l,...a));let n,s;return[this.produce(e,r,(o,a)=>{n=o,s=a}),n,s]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){pe(t)||fe(8),Me(t)&&(t=Ud(t));const e=ki(this),r=ns(t,void 0);return r[ie].isManual_=!0,ts(e),r}finishDraft(t,e){const r=t&&t[ie];(!r||!r.isManual_)&&fe(9);const{scope_:n}=r;return Ai(n,e),Di(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const s=e[r];if(s.path.length===0&&s.op==="replace"){t=s.value;break}}r>-1&&(e=e.slice(r+1));const n=it("Patches").applyPatches_;return Me(t)?n(t,e):this.produce(t,s=>n(s,e))}};function ns(t,e){const r=ln(t)?it("MapSet").proxyMap_(t,e):cn(t)?it("MapSet").proxySet_(t,e):Od(t,e);return(e?e.scope_:Ya()).drafts_.push(r),r}function Ud(t){return Me(t)||fe(10,t),Ga(t)}function Ga(t){if(!pe(t)||un(t))return t;const e=t[ie];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=Xn(t,e.scope_.immer_.useStrictShallowCopy_)}else r=Xn(t,!0);return Br(r,(n,s)=>{Va(r,n,Ga(s))}),e&&(e.finalized_=!1),r}var oe=new $d,dn=oe.produce;oe.produceWithPatches.bind(oe);oe.setAutoFreeze.bind(oe);oe.setUseStrictShallowCopy.bind(oe);oe.applyPatches.bind(oe);oe.createDraft.bind(oe);oe.finishDraft.bind(oe);function Ld(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function Nd(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function jd(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(r=>typeof r=="function")){const r=t.map(n=>typeof n=="function"?`function ${n.name||"unnamed"}()`:typeof n).join(", ");throw new TypeError(`${e}[${r}]`)}}var xi=t=>Array.isArray(t)?t:[t];function Fd(t){const e=Array.isArray(t[0])?t[0]:t;return jd(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function Md(t,e){const r=[],{length:n}=t;for(let s=0;s<n;s++)r.push(t[s].apply(null,e));return r}var Bd=class{constructor(t){this.value=t}deref(){return this.value}},zd=typeof WeakRef<"u"?WeakRef:Bd,Hd=0,$i=1;function fr(){return{s:Hd,v:void 0,o:null,p:null}}function Ka(t,e={}){let r=fr();const{resultEqualityCheck:n}=e;let s,i=0;function o(){let a=r;const{length:l}=arguments;for(let d=0,f=l;d<f;d++){const h=arguments[d];if(typeof h=="function"||typeof h=="object"&&h!==null){let y=a.o;y===null&&(a.o=y=new WeakMap);const E=y.get(h);E===void 0?(a=fr(),y.set(h,a)):a=E}else{let y=a.p;y===null&&(a.p=y=new Map);const E=y.get(h);E===void 0?(a=fr(),y.set(h,a)):a=E}}const c=a;let u;if(a.s===$i)u=a.v;else if(u=t.apply(null,arguments),i++,n){const d=s?.deref?.()??s;d!=null&&n(d,u)&&(u=d,i!==0&&i--),s=typeof u=="object"&&u!==null||typeof u=="function"?new zd(u):u}return c.s=$i,c.v=u,u}return o.clearCache=()=>{r=fr(),o.resetResultsCount()},o.resultsCount=()=>i,o.resetResultsCount=()=>{i=0},o}function Wd(t,...e){const r=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,n=(...s)=>{let i=0,o=0,a,l={},c=s.pop();typeof c=="object"&&(l=c,c=s.pop()),Ld(c,`createSelector expects an output function after the inputs, but received: [${typeof c}]`);const u={...r,...l},{memoize:d,memoizeOptions:f=[],argsMemoize:h=Ka,argsMemoizeOptions:y=[]}=u,E=xi(f),_=xi(y),I=Fd(s),b=d(function(){return i++,c.apply(null,arguments)},...E),p=h(function(){o++;const w=Md(I,arguments);return a=b.apply(null,w),a},..._);return Object.assign(p,{resultFunc:c,memoizedResultFunc:b,dependencies:I,dependencyRecomputations:()=>o,resetDependencyRecomputations:()=>{o=0},lastResult:()=>a,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:d,argsMemoize:h})};return Object.assign(n,{withTypes:()=>n}),n}var U=Wd(Ka),Vd=Object.assign((t,e=U)=>{Nd(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const r=Object.keys(t),n=r.map(i=>t[i]);return e(n,(...i)=>i.reduce((o,a,l)=>(o[r[l]]=a,o),{}))},{withTypes:()=>Vd});function Ja(t){return({dispatch:r,getState:n})=>s=>i=>typeof i=="function"?i(r,n,t):s(i)}var Yd=Ja(),qd=Ja,Gd=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Mr:Mr.apply(null,arguments)},Kd=t=>t&&typeof t.match=="function";function Wt(t,e){function r(...n){if(e){let s=e(...n);if(!s)throw new Error(Ie(0));return{type:t,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:t,payload:n[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=n=>za(n)&&n.type===t,r}var Qa=class Mt extends Array{constructor(...e){super(...e),Object.setPrototypeOf(this,Mt.prototype)}static get[Symbol.species](){return Mt}concat(...e){return super.concat.apply(this,e)}prepend(...e){return e.length===1&&Array.isArray(e[0])?new Mt(...e[0].concat(this)):new Mt(...e.concat(this))}};function Ui(t){return pe(t)?dn(t,()=>{}):t}function hr(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function Jd(t){return typeof t=="boolean"}var Qd=()=>function(e){const{thunk:r=!0,immutableCheck:n=!0,serializableCheck:s=!0,actionCreatorCheck:i=!0}=e??{};let o=new Qa;return r&&(Jd(r)?o.push(Yd):o.push(qd(r.extraArgument))),o},Zd="RTK_autoBatch",Li=t=>e=>{setTimeout(e,t)},Xd=(t={type:"raf"})=>e=>(...r)=>{const n=e(...r);let s=!0,i=!1,o=!1;const a=new Set,l=t.type==="tick"?queueMicrotask:t.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Li(10):t.type==="callback"?t.queueNotification:Li(t.timeout),c=()=>{o=!1,i&&(i=!1,a.forEach(u=>u()))};return Object.assign({},n,{subscribe(u){const d=()=>s&&u(),f=n.subscribe(d);return a.add(u),()=>{f(),a.delete(u)}},dispatch(u){try{return s=!u?.meta?.[Zd],i=!s,i&&(o||(o=!0,l(c))),n.dispatch(u)}finally{s=!0}}})},ef=t=>function(r){const{autoBatch:n=!0}=r??{};let s=new Qa(t);return n&&s.push(Xd(typeof n=="object"?n:void 0)),s};function tf(t){const e=Qd(),{reducer:r=void 0,middleware:n,devTools:s=!0,preloadedState:i=void 0,enhancers:o=void 0}=t||{};let a;if(typeof r=="function")a=r;else if(Fs(r))a=Id(r);else throw new Error(Ie(1));let l;typeof n=="function"?l=n(e):l=e();let c=Mr;s&&(c=Gd({trace:!1,...typeof s=="object"&&s}));const u=Td(...l),d=ef(u);let f=typeof o=="function"?o(d):d();const h=c(...f);return Ba(a,i,h)}function Za(t){const e={},r=[];let n;const s={addCase(i,o){const a=typeof i=="string"?i:i.type;if(!a)throw new Error(Ie(28));if(a in e)throw new Error(Ie(29));return e[a]=o,s},addMatcher(i,o){return r.push({matcher:i,reducer:o}),s},addDefaultCase(i){return n=i,s}};return t(s),[e,r,n]}function rf(t){return typeof t=="function"}function nf(t,e){let[r,n,s]=Za(e),i;if(rf(t))i=()=>Ui(t());else{const a=Ui(t);i=()=>a}function o(a=i(),l){let c=[r[l.type],...n.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[s]),c.reduce((u,d)=>{if(d)if(Me(u)){const h=d(u,l);return h===void 0?u:h}else{if(pe(u))return dn(u,f=>d(f,l));{const f=d(u,l);if(f===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return u},a)}return o.getInitialState=i,o}var sf=(t,e)=>Kd(t)?t.match(e):t(e);function of(...t){return e=>t.some(r=>sf(r,e))}var af="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",lf=(t=21)=>{let e="",r=t;for(;r--;)e+=af[Math.random()*64|0];return e},cf=["name","message","stack","code"],Cn=class{constructor(e,r){this.payload=e,this.meta=r}_type},Ni=class{constructor(e,r){this.payload=e,this.meta=r}_type},uf=t=>{if(typeof t=="object"&&t!==null){const e={};for(const r of cf)typeof t[r]=="string"&&(e[r]=t[r]);return e}return{message:String(t)}},ji="External signal was aborted",zs=(()=>{function t(e,r,n){const s=Wt(e+"/fulfilled",(l,c,u,d)=>({payload:l,meta:{...d||{},arg:u,requestId:c,requestStatus:"fulfilled"}})),i=Wt(e+"/pending",(l,c,u)=>({payload:void 0,meta:{...u||{},arg:c,requestId:l,requestStatus:"pending"}})),o=Wt(e+"/rejected",(l,c,u,d,f)=>({payload:d,error:(n&&n.serializeError||uf)(l||"Rejected"),meta:{...f||{},arg:u,requestId:c,rejectedWithValue:!!d,requestStatus:"rejected",aborted:l?.name==="AbortError",condition:l?.name==="ConditionError"}}));function a(l,{signal:c}={}){return(u,d,f)=>{const h=n?.idGenerator?n.idGenerator(l):lf(),y=new AbortController;let E,_;function I(p){_=p,y.abort()}c&&(c.aborted?I(ji):c.addEventListener("abort",()=>I(ji),{once:!0}));const b=async function(){let p;try{let w=n?.condition?.(l,{getState:d,extra:f});if(ff(w)&&(w=await w),w===!1||y.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const S=new Promise((v,C)=>{E=()=>{C({name:"AbortError",message:_||"Aborted"})},y.signal.addEventListener("abort",E)});u(i(h,l,n?.getPendingMeta?.({requestId:h,arg:l},{getState:d,extra:f}))),p=await Promise.race([S,Promise.resolve(r(l,{dispatch:u,getState:d,extra:f,requestId:h,signal:y.signal,abort:I,rejectWithValue:(v,C)=>new Cn(v,C),fulfillWithValue:(v,C)=>new Ni(v,C)})).then(v=>{if(v instanceof Cn)throw v;return v instanceof Ni?s(v.payload,h,l,v.meta):s(v,h,l)})])}catch(w){p=w instanceof Cn?o(null,h,l,w.payload,w.meta):o(w,h,l)}finally{E&&y.signal.removeEventListener("abort",E)}return n&&!n.dispatchConditionRejection&&o.match(p)&&p.meta.condition||u(p),p}();return Object.assign(b,{abort:I,requestId:h,arg:l,unwrap(){return b.then(df)}})}}return Object.assign(a,{pending:i,rejected:o,fulfilled:s,settled:of(o,s),typePrefix:e})}return t.withTypes=()=>t,t})();function df(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function ff(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var hf=Symbol.for("rtk-slice-createasyncthunk");function pf(t,e){return`${t}/${e}`}function gf({creators:t}={}){const e=t?.asyncThunk?.[hf];return function(n){const{name:s,reducerPath:i=s}=n;if(!s)throw new Error(Ie(11));const o=(typeof n.reducers=="function"?n.reducers(Sf()):n.reducers)||{},a=Object.keys(o),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(p,m){const w=typeof p=="string"?p:p.type;if(!w)throw new Error(Ie(12));if(w in l.sliceCaseReducersByType)throw new Error(Ie(13));return l.sliceCaseReducersByType[w]=m,c},addMatcher(p,m){return l.sliceMatchers.push({matcher:p,reducer:m}),c},exposeAction(p,m){return l.actionCreators[p]=m,c},exposeCaseReducer(p,m){return l.sliceCaseReducersByName[p]=m,c}};a.forEach(p=>{const m=o[p],w={reducerName:p,type:pf(s,p),createNotation:typeof n.reducers=="function"};vf(m)?Ef(w,m,c,e):wf(w,m,c)});function u(){const[p={},m=[],w=void 0]=typeof n.extraReducers=="function"?Za(n.extraReducers):[n.extraReducers],S={...p,...l.sliceCaseReducersByType};return nf(n.initialState,v=>{for(let C in S)v.addCase(C,S[C]);for(let C of l.sliceMatchers)v.addMatcher(C.matcher,C.reducer);for(let C of m)v.addMatcher(C.matcher,C.reducer);w&&v.addDefaultCase(w)})}const d=p=>p,f=new Map,h=new WeakMap;let y;function E(p,m){return y||(y=u()),y(p,m)}function _(){return y||(y=u()),y.getInitialState()}function I(p,m=!1){function w(v){let C=v[p];return typeof C>"u"&&m&&(C=hr(h,w,_)),C}function S(v=d){const C=hr(f,m,()=>new WeakMap);return hr(C,v,()=>{const x={};for(const[P,F]of Object.entries(n.selectors??{}))x[P]=yf(F,v,()=>hr(h,v,_),m);return x})}return{reducerPath:p,getSelectors:S,get selectors(){return S(w)},selectSlice:w}}const b={name:s,reducer:E,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:_,...I(i),injectInto(p,{reducerPath:m,...w}={}){const S=m??i;return p.inject({reducerPath:S,reducer:E},w),{...b,...I(S,!0)}}};return b}}function yf(t,e,r,n){function s(i,...o){let a=e(i);return typeof a>"u"&&n&&(a=r()),t(a,...o)}return s.unwrapped=t,s}var mf=gf();function Sf(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function wf({type:t,reducerName:e,createNotation:r},n,s){let i,o;if("reducer"in n){if(r&&!_f(n))throw new Error(Ie(17));i=n.reducer,o=n.prepare}else i=n;s.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,o?Wt(t,o):Wt(t))}function vf(t){return t._reducerDefinitionType==="asyncThunk"}function _f(t){return t._reducerDefinitionType==="reducerWithPrepare"}function Ef({type:t,reducerName:e},r,n,s){if(!s)throw new Error(Ie(18));const{payloadCreator:i,fulfilled:o,pending:a,rejected:l,settled:c,options:u}=r,d=s(t,i,u);n.exposeAction(e,d),o&&n.addCase(d.fulfilled,o),a&&n.addCase(d.pending,a),l&&n.addCase(d.rejected,l),c&&n.addMatcher(d.settled,c),n.exposeCaseReducer(e,{fulfilled:o||pr,pending:a||pr,rejected:l||pr,settled:c||pr})}function pr(){}function Ie(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var bf=t=>t&&typeof t.match=="function";function Vt(t,e){function r(...n){if(e){let s=e(...n);if(!s)throw new Error(Le(0));return{type:t,payload:s.payload,..."meta"in s&&{meta:s.meta},..."error"in s&&{error:s.error}}}return{type:t,payload:n[0]}}return r.toString=()=>`${t}`,r.type=t,r.match=n=>za(n)&&n.type===t,r}function Fi(t){return pe(t)?dn(t,()=>{}):t}function gr(t,e,r){return t.has(e)?t.get(e):t.set(e,r(e)).get(e)}function Xa(t){const e={},r=[];let n;const s={addCase(i,o){const a=typeof i=="string"?i:i.type;if(!a)throw new Error(Le(28));if(a in e)throw new Error(Le(29));return e[a]=o,s},addMatcher(i,o){return r.push({matcher:i,reducer:o}),s},addDefaultCase(i){return n=i,s}};return t(s),[e,r,n]}function If(t){return typeof t=="function"}function Tf(t,e){let[r,n,s]=Xa(e),i;if(If(t))i=()=>Fi(t());else{const a=Fi(t);i=()=>a}function o(a=i(),l){let c=[r[l.type],...n.filter(({matcher:u})=>u(l)).map(({reducer:u})=>u)];return c.filter(u=>!!u).length===0&&(c=[s]),c.reduce((u,d)=>{if(d)if(Me(u)){const h=d(u,l);return h===void 0?u:h}else{if(pe(u))return dn(u,f=>d(f,l));{const f=d(u,l);if(f===void 0){if(u===null)return u;throw Error("A case reducer on a non-draftable value must not return undefined")}return f}}return u},a)}return o.getInitialState=i,o}var Cf=(t,e)=>bf(t)?t.match(e):t(e);function Rf(...t){return e=>t.some(r=>Cf(r,e))}var Pf="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",Af=(t=21)=>{let e="",r=t;for(;r--;)e+=Pf[Math.random()*64|0];return e},kf=["name","message","stack","code"],Rn=class{constructor(t,e){this.payload=t,this.meta=e}_type},Mi=class{constructor(t,e){this.payload=t,this.meta=e}_type},Df=t=>{if(typeof t=="object"&&t!==null){const e={};for(const r of kf)typeof t[r]=="string"&&(e[r]=t[r]);return e}return{message:String(t)}},Bi="External signal was aborted",ge=(()=>{function t(e,r,n){const s=Vt(e+"/fulfilled",(l,c,u,d)=>({payload:l,meta:{...d||{},arg:u,requestId:c,requestStatus:"fulfilled"}})),i=Vt(e+"/pending",(l,c,u)=>({payload:void 0,meta:{...u||{},arg:c,requestId:l,requestStatus:"pending"}})),o=Vt(e+"/rejected",(l,c,u,d,f)=>({payload:d,error:(n&&n.serializeError||Df)(l||"Rejected"),meta:{...f||{},arg:u,requestId:c,rejectedWithValue:!!d,requestStatus:"rejected",aborted:l?.name==="AbortError",condition:l?.name==="ConditionError"}}));function a(l,{signal:c}={}){return(u,d,f)=>{const h=n?.idGenerator?n.idGenerator(l):Af(),y=new AbortController;let E,_;function I(p){_=p,y.abort()}c&&(c.aborted?I(Bi):c.addEventListener("abort",()=>I(Bi),{once:!0}));const b=async function(){let p;try{let w=n?.condition?.(l,{getState:d,extra:f});if(xf(w)&&(w=await w),w===!1||y.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const S=new Promise((v,C)=>{E=()=>{C({name:"AbortError",message:_||"Aborted"})},y.signal.addEventListener("abort",E)});u(i(h,l,n?.getPendingMeta?.({requestId:h,arg:l},{getState:d,extra:f}))),p=await Promise.race([S,Promise.resolve(r(l,{dispatch:u,getState:d,extra:f,requestId:h,signal:y.signal,abort:I,rejectWithValue:(v,C)=>new Rn(v,C),fulfillWithValue:(v,C)=>new Mi(v,C)})).then(v=>{if(v instanceof Rn)throw v;return v instanceof Mi?s(v.payload,h,l,v.meta):s(v,h,l)})])}catch(w){p=w instanceof Rn?o(null,h,l,w.payload,w.meta):o(w,h,l)}finally{E&&y.signal.removeEventListener("abort",E)}return n&&!n.dispatchConditionRejection&&o.match(p)&&p.meta.condition||u(p),p}();return Object.assign(b,{abort:I,requestId:h,arg:l,unwrap(){return b.then(Of)}})}}return Object.assign(a,{pending:i,rejected:o,fulfilled:s,settled:Rf(o,s),typePrefix:e})}return t.withTypes=()=>t,t})();function Of(t){if(t.meta&&t.meta.rejectedWithValue)throw t.payload;if(t.error)throw t.error;return t.payload}function xf(t){return t!==null&&typeof t=="object"&&typeof t.then=="function"}var $f=Symbol.for("rtk-slice-createasyncthunk");function Uf(t,e){return`${t}/${e}`}function Lf({creators:t}={}){const e=t?.asyncThunk?.[$f];return function(n){const{name:s,reducerPath:i=s}=n;if(!s)throw new Error(Le(11));const o=(typeof n.reducers=="function"?n.reducers(Ff()):n.reducers)||{},a=Object.keys(o),l={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},c={addCase(p,m){const w=typeof p=="string"?p:p.type;if(!w)throw new Error(Le(12));if(w in l.sliceCaseReducersByType)throw new Error(Le(13));return l.sliceCaseReducersByType[w]=m,c},addMatcher(p,m){return l.sliceMatchers.push({matcher:p,reducer:m}),c},exposeAction(p,m){return l.actionCreators[p]=m,c},exposeCaseReducer(p,m){return l.sliceCaseReducersByName[p]=m,c}};a.forEach(p=>{const m=o[p],w={reducerName:p,type:Uf(s,p),createNotation:typeof n.reducers=="function"};Bf(m)?Hf(w,m,c,e):Mf(w,m,c)});function u(){const[p={},m=[],w=void 0]=typeof n.extraReducers=="function"?Xa(n.extraReducers):[n.extraReducers],S={...p,...l.sliceCaseReducersByType};return Tf(n.initialState,v=>{for(let C in S)v.addCase(C,S[C]);for(let C of l.sliceMatchers)v.addMatcher(C.matcher,C.reducer);for(let C of m)v.addMatcher(C.matcher,C.reducer);w&&v.addDefaultCase(w)})}const d=p=>p,f=new Map,h=new WeakMap;let y;function E(p,m){return y||(y=u()),y(p,m)}function _(){return y||(y=u()),y.getInitialState()}function I(p,m=!1){function w(v){let C=v[p];return typeof C>"u"&&m&&(C=gr(h,w,_)),C}function S(v=d){const C=gr(f,m,()=>new WeakMap);return gr(C,v,()=>{const x={};for(const[P,F]of Object.entries(n.selectors??{}))x[P]=Nf(F,v,()=>gr(h,v,_),m);return x})}return{reducerPath:p,getSelectors:S,get selectors(){return S(w)},selectSlice:w}}const b={name:s,reducer:E,actions:l.actionCreators,caseReducers:l.sliceCaseReducersByName,getInitialState:_,...I(i),injectInto(p,{reducerPath:m,...w}={}){const S=m??i;return p.inject({reducerPath:S,reducer:E},w),{...b,...I(S,!0)}}};return b}}function Nf(t,e,r,n){function s(i,...o){let a=e(i);return typeof a>"u"&&n&&(a=r()),t(a,...o)}return s.unwrapped=t,s}var jf=Lf();function Ff(){function t(e,r){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...r}}return t.withTypes=()=>t,{reducer(e){return Object.assign({[e.name](...r){return e(...r)}}[e.name],{_reducerDefinitionType:"reducer"})},preparedReducer(e,r){return{_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:r}},asyncThunk:t}}function Mf({type:t,reducerName:e,createNotation:r},n,s){let i,o;if("reducer"in n){if(r&&!zf(n))throw new Error(Le(17));i=n.reducer,o=n.prepare}else i=n;s.addCase(t,i).exposeCaseReducer(e,i).exposeAction(e,o?Vt(t,o):Vt(t))}function Bf(t){return t._reducerDefinitionType==="asyncThunk"}function zf(t){return t._reducerDefinitionType==="reducerWithPrepare"}function Hf({type:t,reducerName:e},r,n,s){if(!s)throw new Error(Le(18));const{payloadCreator:i,fulfilled:o,pending:a,rejected:l,settled:c,options:u}=r,d=s(t,i,u);n.exposeAction(e,d),o&&n.addCase(d.fulfilled,o),a&&n.addCase(d.pending,a),l&&n.addCase(d.rejected,l),c&&n.addMatcher(d.settled,c),n.exposeCaseReducer(e,{fulfilled:o||yr,pending:a||yr,rejected:l||yr,settled:c||yr})}function yr(){}function Le(t){return`Minified Redux Toolkit error #${t}; visit https://redux-toolkit.js.org/Errors?code=${t} for the full message or use the non-minified dev environment for full errors. `}var Pn={exports:{}},An={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zi;function Wf(){if(zi)return An;zi=1;var t=ca();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,n=t.useSyncExternalStore,s=t.useRef,i=t.useEffect,o=t.useMemo,a=t.useDebugValue;return An.useSyncExternalStoreWithSelector=function(l,c,u,d,f){var h=s(null);if(h.current===null){var y={hasValue:!1,value:null};h.current=y}else y=h.current;h=o(function(){function _(w){if(!I){if(I=!0,b=w,w=d(w),f!==void 0&&y.hasValue){var S=y.value;if(f(S,w))return p=S}return p=w}if(S=p,r(b,w))return S;var v=d(w);return f!==void 0&&f(S,v)?(b=w,S):(b=w,p=v)}var I=!1,b,p,m=u===void 0?null:u;return[function(){return _(c())},m===null?void 0:function(){return _(m())}]},[c,u,d,f]);var E=n(l,h[0],h[1]);return i(function(){y.hasValue=!0,y.value=E},[E]),a(E),E},An}var Hi;function Vf(){return Hi||(Hi=1,Pn.exports=Wf()),Pn.exports}var Yf=Vf(),qf=Symbol.for("react-redux-context"),Gf=typeof globalThis<"u"?globalThis:{};function Kf(){if(!B.createContext)return{};const t=Gf[qf]??=new Map;let e=t.get(B.createContext);return e||(e=B.createContext(null),t.set(B.createContext,e)),e}var ot=Kf();function Hs(t=ot){return function(){return B.useContext(t)}}var el=Hs();function tl(t=ot){const e=t===ot?el:Hs(t),r=()=>{const{store:n}=e();return n};return Object.assign(r,{withTypes:()=>r}),r}var Jf=tl();function Qf(t=ot){const e=t===ot?Jf:tl(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var Zf=Qf(),Xf=(t,e)=>t===e;function eh(t=ot){const e=t===ot?el:Hs(t),r=(n,s={})=>{const{equalityFn:i=Xf}=typeof s=="function"?{equalityFn:s}:s,o=e(),{store:a,subscription:l,getServerState:c}=o;B.useRef(!0);const u=B.useCallback({[n.name](f){return n(f)}}[n.name],[n]),d=Yf.useSyncExternalStoreWithSelector(l.addNestedSub,a.getState,c||a.getState,u,i);return B.useDebugValue(d),d};return Object.assign(r,{withTypes:()=>r}),r}var th=eh();const rh="modulepreload",nh=function(t){return"/packing-list/"+t},Wi={},z=function(e,r,n){let s=Promise.resolve();if(r&&r.length>0){let o=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");s=o(r.map(c=>{if(c=nh(c),c in Wi)return;Wi[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":rh,u||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),u)return new Promise((h,y)=>{f.addEventListener("load",h),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},sh=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>z(async()=>{const{default:n}=await Promise.resolve().then(()=>Ot);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)};class Ws extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class ih extends Ws{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class oh extends Ws{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ah extends Ws{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ss;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(ss||(ss={}));var lh=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class ch{constructor(e,{headers:r={},customFetch:n,region:s=ss.Any}={}){this.url=e,this.headers=r,this.region=s,this.fetch=sh(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,r={}){var n;return lh(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=r;let a={},{region:l}=r;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):typeof o=="string"?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:c}).catch(y=>{throw new ih(y)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new oh(u);if(!u.ok)throw new ah(u);let f=((n=u.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),h;return f==="application/json"?h=yield u.json():f==="application/octet-stream"?h=yield u.blob():f==="text/event-stream"?h=u:f==="multipart/form-data"?h=yield u.formData():h=yield u.text(),{data:h,error:null}}catch(s){return{data:null,error:s}}})}}var G={},lt={},ct={},ut={},dt={},ft={},uh=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},At=uh();const dh=At.fetch,rl=At.fetch.bind(At),nl=At.Headers,fh=At.Request,hh=At.Response,Ot=Object.freeze(Object.defineProperty({__proto__:null,Headers:nl,Request:fh,Response:hh,default:rl,fetch:dh},Symbol.toStringTag,{value:"Module"})),ph=Bc(Ot);var mr={},Vi;function sl(){if(Vi)return mr;Vi=1,Object.defineProperty(mr,"__esModule",{value:!0});class t extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return mr.default=t,mr}var Yi;function il(){if(Yi)return ft;Yi=1;var t=ft&&ft.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ft,"__esModule",{value:!0});const e=t(ph),r=t(sl());class n{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=Object.assign({},this.headers),this.headers[i]=o,this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,d,f;let h=null,y=null,E=null,_=c.status,I=c.statusText;if(c.ok){if(this.method!=="HEAD"){const w=await c.text();w===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?y=w:y=JSON.parse(w))}const p=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),m=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");p&&m&&m.length>1&&(E=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(y)&&(y.length>1?(h={code:"PGRST116",details:`Results contain ${y.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},y=null,E=null,_=406,I="Not Acceptable"):y.length===1?y=y[0]:y=null)}else{const p=await c.text();try{h=JSON.parse(p),Array.isArray(h)&&c.status===404&&(y=[],h=null,_=200,I="OK")}catch{c.status===404&&p===""?(_=204,I="No Content"):h={message:p}}if(h&&this.isMaybeSingle&&(!((f=h?.details)===null||f===void 0)&&f.includes("0 rows"))&&(h=null,_=200,I="OK"),h&&this.shouldThrowOnError)throw new r.default(h)}return{error:h,data:y,count:E,status:_,statusText:I}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,d,f;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(d=c?.stack)!==null&&d!==void 0?d:""}`,hint:"",code:`${(f=c?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(i,o)}returns(){return this}overrideTypes(){return this}}return ft.default=n,ft}var qi;function ol(){if(qi)return dt;qi=1;var t=dt&&dt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(dt,"__esModule",{value:!0});const e=t(il());class r extends e.default{select(s){let i=!1;const o=(s??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",o),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(s,{ascending:i=!0,nullsFirst:o,foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:o=i}={}){const a=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(a,`${s}`),this}range(s,i,{foreignTable:o,referencedTable:a=o}={}){const l=typeof a>"u"?"offset":`${a}.offset`,c=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this.url.searchParams.set(c,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:s=!1,verbose:i=!1,settings:o=!1,buffers:a=!1,wal:l=!1,format:c="text"}={}){var u;const d=[s?"analyze":null,i?"verbose":null,o?"settings":null,a?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${c}; for="${f}"; options=${d};`,c==="json"?this:this}rollback(){var s;return((s=this.headers.Prefer)!==null&&s!==void 0?s:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return dt.default=r,dt}var Gi;function Vs(){if(Gi)return ut;Gi=1;var t=ut&&ut.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ut,"__esModule",{value:!0});const e=t(ol());class r extends e.default{eq(s,i){return this.url.searchParams.append(s,`eq.${i}`),this}neq(s,i){return this.url.searchParams.append(s,`neq.${i}`),this}gt(s,i){return this.url.searchParams.append(s,`gt.${i}`),this}gte(s,i){return this.url.searchParams.append(s,`gte.${i}`),this}lt(s,i){return this.url.searchParams.append(s,`lt.${i}`),this}lte(s,i){return this.url.searchParams.append(s,`lte.${i}`),this}like(s,i){return this.url.searchParams.append(s,`like.${i}`),this}likeAllOf(s,i){return this.url.searchParams.append(s,`like(all).{${i.join(",")}}`),this}likeAnyOf(s,i){return this.url.searchParams.append(s,`like(any).{${i.join(",")}}`),this}ilike(s,i){return this.url.searchParams.append(s,`ilike.${i}`),this}ilikeAllOf(s,i){return this.url.searchParams.append(s,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(s,i){return this.url.searchParams.append(s,`ilike(any).{${i.join(",")}}`),this}is(s,i){return this.url.searchParams.append(s,`is.${i}`),this}in(s,i){const o=Array.from(new Set(i)).map(a=>typeof a=="string"&&new RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(s,`in.(${o})`),this}contains(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cs.{${i.join(",")}}`):this.url.searchParams.append(s,`cs.${JSON.stringify(i)}`),this}containedBy(s,i){return typeof i=="string"?this.url.searchParams.append(s,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(s,`cd.{${i.join(",")}}`):this.url.searchParams.append(s,`cd.${JSON.stringify(i)}`),this}rangeGt(s,i){return this.url.searchParams.append(s,`sr.${i}`),this}rangeGte(s,i){return this.url.searchParams.append(s,`nxl.${i}`),this}rangeLt(s,i){return this.url.searchParams.append(s,`sl.${i}`),this}rangeLte(s,i){return this.url.searchParams.append(s,`nxr.${i}`),this}rangeAdjacent(s,i){return this.url.searchParams.append(s,`adj.${i}`),this}overlaps(s,i){return typeof i=="string"?this.url.searchParams.append(s,`ov.${i}`):this.url.searchParams.append(s,`ov.{${i.join(",")}}`),this}textSearch(s,i,{config:o,type:a}={}){let l="";a==="plain"?l="pl":a==="phrase"?l="ph":a==="websearch"&&(l="w");const c=o===void 0?"":`(${o})`;return this.url.searchParams.append(s,`${l}fts${c}.${i}`),this}match(s){return Object.entries(s).forEach(([i,o])=>{this.url.searchParams.append(i,`eq.${o}`)}),this}not(s,i,o){return this.url.searchParams.append(s,`not.${i}.${o}`),this}or(s,{foreignTable:i,referencedTable:o=i}={}){const a=o?`${o}.or`:"or";return this.url.searchParams.append(a,`(${s})`),this}filter(s,i,o){return this.url.searchParams.append(s,`${i}.${o}`),this}}return ut.default=r,ut}var Ki;function al(){if(Ki)return ct;Ki=1;var t=ct&&ct.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ct,"__esModule",{value:!0});const e=t(Vs());class r{constructor(s,{headers:i={},schema:o,fetch:a}){this.url=s,this.headers=i,this.schema=o,this.fetch=a}select(s,{head:i=!1,count:o}={}){const a=i?"HEAD":"GET";let l=!1;const c=(s??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),o&&(this.headers.Prefer=`count=${o}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(s,{count:i,defaultToNull:o=!0}={}){const a="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),i&&l.push(`count=${i}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(s)){const c=s.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}upsert(s,{onConflict:i,ignoreDuplicates:o=!1,count:a,defaultToNull:l=!0}={}){const c="POST",u=[`resolution=${o?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),a&&u.push(`count=${a}`),l||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(s)){const d=s.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(d.length>0){const f=[...new Set(d)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}update(s,{count:i}={}){const o="PATCH",a=[];return this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),this.headers.Prefer=a.join(","),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:this.fetch,allowEmpty:!1})}delete({count:s}={}){const i="DELETE",o=[];return s&&o.push(`count=${s}`),this.headers.Prefer&&o.unshift(this.headers.Prefer),this.headers.Prefer=o.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return ct.default=r,ct}var Lt={},Nt={},Ji;function gh(){return Ji||(Ji=1,Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.version=void 0,Nt.version="0.0.0-automated"),Nt}var Qi;function yh(){if(Qi)return Lt;Qi=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.DEFAULT_HEADERS=void 0;const t=gh();return Lt.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${t.version}`},Lt}var Zi;function mh(){if(Zi)return lt;Zi=1;var t=lt&&lt.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(lt,"__esModule",{value:!0});const e=t(al()),r=t(Vs()),n=yh();class s{constructor(o,{headers:a={},schema:l,fetch:c}={}){this.url=o,this.headers=Object.assign(Object.assign({},n.DEFAULT_HEADERS),a),this.schemaName=l,this.fetch=c}from(o){const a=new URL(`${this.url}/${o}`);return new e.default(a,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(o){return new s(this.url,{headers:this.headers,schema:o,fetch:this.fetch})}rpc(o,a={},{head:l=!1,get:c=!1,count:u}={}){let d;const f=new URL(`${this.url}/rpc/${o}`);let h;l||c?(d=l?"HEAD":"GET",Object.entries(a).filter(([E,_])=>_!==void 0).map(([E,_])=>[E,Array.isArray(_)?`{${_.join(",")}}`:`${_}`]).forEach(([E,_])=>{f.searchParams.append(E,_)})):(d="POST",h=a);const y=Object.assign({},this.headers);return u&&(y.Prefer=`count=${u}`),new r.default({method:d,url:f,headers:y,schema:this.schemaName,body:h,fetch:this.fetch,allowEmpty:!1})}}return lt.default=s,lt}var Xi;function Sh(){if(Xi)return G;Xi=1;var t=G&&G.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(G,"__esModule",{value:!0}),G.PostgrestError=G.PostgrestBuilder=G.PostgrestTransformBuilder=G.PostgrestFilterBuilder=G.PostgrestQueryBuilder=G.PostgrestClient=void 0;const e=t(mh());G.PostgrestClient=e.default;const r=t(al());G.PostgrestQueryBuilder=r.default;const n=t(Vs());G.PostgrestFilterBuilder=n.default;const s=t(ol());G.PostgrestTransformBuilder=s.default;const i=t(il());G.PostgrestBuilder=i.default;const o=t(sl());return G.PostgrestError=o.default,G.default={PostgrestClient:e.default,PostgrestQueryBuilder:r.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:s.default,PostgrestBuilder:i.default,PostgrestError:o.default},G}var wh=Sh();const vh=zc(wh),{PostgrestClient:_h,PostgrestQueryBuilder:q_,PostgrestFilterBuilder:G_,PostgrestTransformBuilder:K_,PostgrestBuilder:J_,PostgrestError:Q_}=vh;let is;typeof window>"u"?is=require("ws"):is=window.WebSocket;const Eh="2.11.10",bh={"X-Client-Info":`realtime-js/${Eh}`},Ih="1.0.0",ll=1e4,Th=1e3;var _t;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(_t||(_t={}));var X;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(X||(X={}));var de;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(de||(de={}));var os;(function(t){t.websocket="websocket"})(os||(os={}));var Ze;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ze||(Ze={}));class Ch{constructor(){this.HEADER_LENGTH=1}decode(e,r){return e.constructor===ArrayBuffer?r(this._binaryDecode(e)):r(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const r=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,r,n)}_decodeBroadcast(e,r,n){const s=r.getUint8(1),i=r.getUint8(2);let o=this.HEADER_LENGTH+2;const a=n.decode(e.slice(o,o+s));o=o+s;const l=n.decode(e.slice(o,o+i));o=o+i;const c=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class cl{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var j;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(j||(j={}));const eo=(t,e,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((i,o)=>(i[o]=Rh(o,t,e,s),i),{})},Rh=(t,e,r,n)=>{const s=e.find(a=>a.name===t),i=s?.type,o=r[t];return i&&!n.includes(i)?ul(i,o):as(o)},ul=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return Dh(e,r)}switch(t){case j.bool:return Ph(e);case j.float4:case j.float8:case j.int2:case j.int4:case j.int8:case j.numeric:case j.oid:return Ah(e);case j.json:case j.jsonb:return kh(e);case j.timestamp:return Oh(e);case j.abstime:case j.date:case j.daterange:case j.int4range:case j.int8range:case j.money:case j.reltime:case j.text:case j.time:case j.timestamptz:case j.timetz:case j.tsrange:case j.tstzrange:return as(e);default:return as(e)}},as=t=>t,Ph=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Ah=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},kh=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Dh=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let i;const o=t.slice(1,r);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>ul(e,a))}return t},Oh=t=>typeof t=="string"?t.replace(" ","T"):t,dl=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class kn{constructor(e,r,n={},s=ll){this.channel=e,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var to;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(to||(to={}));class Yt{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=r?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Yt.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=Yt.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Yt.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,s){const i=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(i,(c,u)=>{o[c]||(l[c]=u)}),this.map(o,(c,u)=>{const d=i[c];if(d){const f=u.map(_=>_.presence_ref),h=d.map(_=>_.presence_ref),y=u.filter(_=>h.indexOf(_.presence_ref)<0),E=d.filter(_=>f.indexOf(_.presence_ref)<0);y.length>0&&(a[c]=y),E.length>0&&(l[c]=E)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,r,n,s){const{joins:i,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(h=>h.presence_ref),f=u.filter(h=>d.indexOf(h.presence_ref)<0);e[a].unshift(...f)}n(a,u,l)}),this.map(o,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,s(a,c,l),c.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const s=e[n];return"metas"in s?r[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[n]=s,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ro;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(ro||(ro={}));var no;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(no||(no={}));var _e;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(_e||(_e={}));class Ys{constructor(e,r={config:{}},n){this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=X.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new kn(this,de.join,this.params,this.timeout),this.rejoinTimer=new cl(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=X.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=X.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=X.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=X.errored,this.rejoinTimer.scheduleTimeout())}),this._on(de.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Yt(this),this.broadcastEndpointURL=dl(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,r=this.timeout){var n,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(u=>e?.(_e.CHANNEL_ERROR,u)),this._onClose(()=>e?.(_e.CLOSED));const l={},c={broadcast:i,presence:o,postgres_changes:(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(u=>u.filter))!==null&&s!==void 0?s:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){e?.(_e.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,h=(d=f?.length)!==null&&d!==void 0?d:0,y=[];for(let E=0;E<h;E++){const _=f[E],{filter:{event:I,schema:b,table:p,filter:m}}=_,w=u&&u[E];if(w&&w.event===I&&w.schema===b&&w.table===p&&w.filter===m)y.push(Object.assign(Object.assign({},_),{id:w.id}));else{this.unsubscribe(),this.state=X.errored,e?.(_e.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(_e.SUBSCRIBED);return}}).receive("error",u=>{this.state=X.errored,e?.(_e.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e?.(_e.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this._on(e,r,n)}async send(e,r={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=c.body)===null||s===void 0?void 0:s.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const c=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=X.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(de.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise(n=>{const s=new kn(this,de.leave,{},e);s.receive("ok",()=>{r(),n("ok")}).receive("timeout",()=>{r(),n("timed out")}).receive("error",()=>{n("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,r,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(i),o}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new kn(this,e,r,n);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=de;if(n&&[a,l,c,u].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,r,n);if(r&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(h=>{var y,E,_;return((y=h.filter)===null||y===void 0?void 0:y.event)==="*"||((_=(E=h.filter)===null||E===void 0?void 0:E.event)===null||_===void 0?void 0:_.toLocaleLowerCase())===o}).map(h=>h.callback(f,n)):(i=this.bindings[o])===null||i===void 0||i.filter(h=>{var y,E,_,I,b,p;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in h){const m=h.id,w=(y=h.filter)===null||y===void 0?void 0:y.event;return m&&((E=r.ids)===null||E===void 0?void 0:E.includes(m))&&(w==="*"||w?.toLocaleLowerCase()===((_=r.data)===null||_===void 0?void 0:_.type.toLocaleLowerCase()))}else{const m=(b=(I=h?.filter)===null||I===void 0?void 0:I.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return m==="*"||m===((p=r?.event)===null||p===void 0?void 0:p.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===o}).map(h=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:E,table:_,commit_timestamp:I,type:b,errors:p}=y;f=Object.assign(Object.assign({},{schema:E,table:_,commit_timestamp:I,eventType:b,new:{},old:{},errors:p}),this._getPayloadRecords(y))}h.callback(f,n)})}_isClosed(){return this.state===X.closed}_isJoined(){return this.state===X.joined}_isJoining(){return this.state===X.joining}_isLeaving(){return this.state===X.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const s=e.toLocaleLowerCase(),i={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&Ys.isEqual(s.filter,r))}),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(de.close,{},e)}_onError(e){this._on(de.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=X.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=eo(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=eo(e.columns,e.old_record)),r}}const so=()=>{},xh=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $h{constructor(e,r){var n;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=bh,this.params={},this.timeout=ll,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=so,this.ref=0,this.logger=so,this.conn=null,this.sendBuffer=[],this.serializer=new Ch,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...a)=>z(async()=>{const{default:l}=await Promise.resolve().then(()=>Ot);return{default:l}},void 0).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${os.websocket}`,this.httpEndpoint=dl(e),r?.transport?this.transport=r.transport:this.transport=null,r?.params&&(this.params=r.params),r?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),r.headers)),r?.timeout&&(this.timeout=r.timeout),r?.logger&&(this.logger=r.logger),(r?.logLevel||r?.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const s=(n=r?.params)===null||n===void 0?void 0:n.apikey;if(s&&(this.accessTokenValue=s,this.apiKey=s),this.reconnectAfterMs=r?.reconnectAfterMs?r.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=r?.encode?r.encode:(i,o)=>o(JSON.stringify(i)),this.decode=r?.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new cl(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r?.fetch),r?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=r?.worker||!1,this.workerUrl=r?.workerUrl}this.accessToken=r?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=is),this.transport){typeof window<"u"&&this.transport===window.WebSocket?this.conn=new this.transport(this.endpointURL()):this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection();return}this.conn=new Uh(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ih}))}disconnect(e,r){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(n=>n.teardown()))}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels=this.channels.filter(n=>n._joinRef!==e._joinRef),this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case _t.connecting:return Ze.Connecting;case _t.open:return Ze.Open;case _t.closing:return Ze.Closing;default:return Ze.Closed}}isConnected(){return this.connectionState()===Ze.Open}channel(e,r={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new Ys(`realtime:${e}`,r,this);return this.channels.push(i),i}}push(e){const{topic:r,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let r=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{r&&n.updateJoinPayload({access_token:r,version:this.headers&&this.headers["X-Client-Info"]}),n.joinedOnce&&n._isJoined()&&n._push(de.access_token,{access_token:r})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Th,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,r=>{let{topic:n,event:s,payload:i,ref:o}=r;n==="phoenix"&&s==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${n} ${s} ${o&&"("+o+")"||""}`,i),Array.from(this.channels).filter(a=>a._isMember(n)).forEach(a=>a._trigger(s,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(r))})}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(de.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${e}${n}${s}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([xh],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}}class Uh{constructor(e,r,n){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=_t.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=n.close}}class qs extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function K(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class Lh extends qs{constructor(e,r){super(e),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ls extends qs{constructor(e,r){super(e),this.name="StorageUnknownError",this.originalError=r}}var Nh=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const fl=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>z(async()=>{const{default:n}=await Promise.resolve().then(()=>Ot);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},jh=()=>Nh(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield z(()=>Promise.resolve().then(()=>Ot),void 0)).Response:Response}),cs=t=>{if(Array.isArray(t))return t.map(r=>cs(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=cs(n)}),e};var at=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Dn=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Fh=(t,e,r)=>at(void 0,void 0,void 0,function*(){const n=yield jh();t instanceof n&&!r?.noResolveJson?t.json().then(s=>{e(new Lh(Dn(s),t.status||500))}).catch(s=>{e(new ls(Dn(s),s))}):e(new ls(Dn(t),t))}),Mh=(t,e,r,n)=>{const s={method:t,headers:e?.headers||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n&&(s.body=JSON.stringify(n)),Object.assign(Object.assign({},s),r))};function cr(t,e,r,n,s,i){return at(this,void 0,void 0,function*(){return new Promise((o,a)=>{t(r,Mh(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Fh(l,a,n))})})}function Wr(t,e,r,n){return at(this,void 0,void 0,function*(){return cr(t,"GET",e,r,n)})}function Oe(t,e,r,n,s){return at(this,void 0,void 0,function*(){return cr(t,"POST",e,n,s,r)})}function Bh(t,e,r,n,s){return at(this,void 0,void 0,function*(){return cr(t,"PUT",e,n,s,r)})}function zh(t,e,r,n){return at(this,void 0,void 0,function*(){return cr(t,"HEAD",e,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function hl(t,e,r,n,s){return at(this,void 0,void 0,function*(){return cr(t,"DELETE",e,n,s,r)})}var te=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const Hh={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},io={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Wh{constructor(e,r={},n,s){this.url=e,this.headers=r,this.bucketId=n,this.fetch=fl(s)}uploadOrUpdate(e,r,n,s){return te(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},io),s);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=n,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),s?.headers&&(a=Object.assign(Object.assign({},a),s.headers));const c=this._removeEmptyFolders(r),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:a},o?.duplex?{duplex:o.duplex}:{})),f=yield d.json();return d.ok?{data:{path:c,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(i){if(K(i))return{data:null,error:i};throw i}})}upload(e,r,n){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,r,n)})}uploadToSignedUrl(e,r,n,s){return te(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",r);try{let l;const c=Object.assign({upsert:io.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.append("cacheControl",c.cacheControl)):(l=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),f=yield d.json();return d.ok?{data:{path:i,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if(K(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,r){return te(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);r?.upsert&&(s["x-upsert"]="true");const i=yield Oe(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new qs("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(n){if(K(n))return{data:null,error:n};throw n}})}update(e,r,n){return te(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,r,n)})}move(e,r,n){return te(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}})}copy(e,r,n){return te(this,void 0,void 0,function*(){try{return{data:{path:(yield Oe(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:r,destinationBucket:n?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}})}createSignedUrl(e,r,n){return te(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Oe(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:r},n?.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}})}createSignedUrls(e,r,n){return te(this,void 0,void 0,function*(){try{const s=yield Oe(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:e},{headers:this.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}})}download(e,r){return te(this,void 0,void 0,function*(){const s=typeof r?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(r?.transform||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield Wr(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(K(a))return{data:null,error:a};throw a}})}info(e){return te(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{const n=yield Wr(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:cs(n),error:null}}catch(n){if(K(n))return{data:null,error:n};throw n}})}exists(e){return te(this,void 0,void 0,function*(){const r=this._getFinalPath(e);try{return yield zh(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(K(n)&&n instanceof ls){const s=n.originalError;if([400,404].includes(s?.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,r){const n=this._getFinalPath(e),s=[],i=r?.download?`download=${r.download===!0?"":r.download}`:"";i!==""&&s.push(i);const a=typeof r?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(r?.transform||{});l!==""&&s.push(l);let c=s.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${n}${c}`)}}}remove(e){return te(this,void 0,void 0,function*(){try{return{data:yield hl(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(r){if(K(r))return{data:null,error:r};throw r}})}list(e,r,n){return te(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Hh),r),{prefix:e||""});return{data:yield Oe(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(K(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const r=[];return e.width&&r.push(`width=${e.width}`),e.height&&r.push(`height=${e.height}`),e.resize&&r.push(`resize=${e.resize}`),e.format&&r.push(`format=${e.format}`),e.quality&&r.push(`quality=${e.quality}`),r.join("&")}}const Vh="2.7.1",Yh={"X-Client-Info":`storage-js/${Vh}`};var ht=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class qh{constructor(e,r={},n){this.url=e,this.headers=Object.assign(Object.assign({},Yh),r),this.fetch=fl(n)}listBuckets(){return ht(this,void 0,void 0,function*(){try{return{data:yield Wr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(K(e))return{data:null,error:e};throw e}})}getBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield Wr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(r){if(K(r))return{data:null,error:r};throw r}})}createBucket(e,r={public:!1}){return ht(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(K(n))return{data:null,error:n};throw n}})}updateBucket(e,r){return ht(this,void 0,void 0,function*(){try{return{data:yield Bh(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(K(n))return{data:null,error:n};throw n}})}emptyBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(K(r))return{data:null,error:r};throw r}})}deleteBucket(e){return ht(this,void 0,void 0,function*(){try{return{data:yield hl(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(r){if(K(r))return{data:null,error:r};throw r}})}}class Gh extends qh{constructor(e,r={},n){super(e,r,n)}from(e){return new Wh(this.url,this.headers,e,this.fetch)}}const Kh="2.50.0";let Bt="";typeof Deno<"u"?Bt="deno":typeof document<"u"?Bt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Bt="react-native":Bt="node";const Jh={"X-Client-Info":`supabase-js-${Bt}/${Kh}`},Qh={headers:Jh},Zh={schema:"public"},Xh={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ep={};var tp=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};const rp=t=>{let e;return t?e=t:typeof fetch>"u"?e=rl:e=fetch,(...r)=>e(...r)},np=()=>typeof Headers>"u"?nl:Headers,sp=(t,e,r)=>{const n=rp(r),s=np();return(i,o)=>tp(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:t;let c=new s(o?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),n(i,Object.assign(Object.assign({},o),{headers:c}))})};var ip=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};function op(t){return t.endsWith("/")?t:t+"/"}function ap(t,e){var r,n;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),s),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(r=d?.headers)!==null&&r!==void 0?r:{}),(n=a?.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>ip(this,void 0,void 0,function*(){return""})};return t.accessToken?f.accessToken=t.accessToken:delete f.accessToken,f}const pl="2.70.0",St=30*1e3,us=3,On=us*St,lp="http://localhost:9999",cp="supabase.auth.token",up={"X-Client-Info":`gotrue-js/${pl}`},ds="X-Supabase-Api-Version",gl={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},dp=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,fp=6e5;class fn extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function $(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class hp extends fn{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function pp(t){return $(t)&&t.name==="AuthApiError"}class yl extends fn{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class We extends fn{constructor(e,r,n,s){super(e,n,s),this.name=r,this.status=n}}class De extends We{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function gp(t){return $(t)&&t.name==="AuthSessionMissingError"}class Sr extends We{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class wr extends We{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vr extends We{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function yp(t){return $(t)&&t.name==="AuthImplicitGrantRedirectError"}class oo extends We{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class fs extends We{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function xn(t){return $(t)&&t.name==="AuthRetryableFetchError"}class ao extends We{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class qt extends We{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Vr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),lo=` 	
\r=`.split(""),mp=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<lo.length;e+=1)t[lo[e].charCodeAt(0)]=-2;for(let e=0;e<Vr.length;e+=1)t[Vr[e].charCodeAt(0)]=e;return t})();function co(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Vr[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(Vr[n]),e.queuedBits-=6}}function ml(t,e,r){const n=mp[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function uo(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{vp(o,n,r)};for(let o=0;o<t.length;o+=1)ml(t.charCodeAt(o),s,i);return e.join("")}function Sp(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function wp(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}Sp(n,e)}}function vp(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function _p(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)ml(t.charCodeAt(s),r,n);return new Uint8Array(e)}function Ep(t){const e=[];return wp(t,r=>e.push(r)),new Uint8Array(e)}function bp(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};return t.forEach(s=>co(s,r,n)),co(null,r,n),e.join("")}function Ip(t){return Math.round(Date.now()/1e3)+t}function Tp(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const ue=()=>typeof window<"u"&&typeof document<"u",qe={tested:!1,writable:!1},Gt=()=>{if(!ue())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(qe.tested)return qe.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),qe.tested=!0,qe.writable=!0}catch{qe.tested=!0,qe.writable=!1}return qe.writable};function Cp(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return r.searchParams.forEach((n,s)=>{e[s]=n}),e}const Sl=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...r)=>z(async()=>{const{default:n}=await Promise.resolve().then(()=>Ot);return{default:n}},void 0).then(({default:n})=>n(...r)):e=fetch,(...r)=>e(...r)},Rp=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",wl=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},_r=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Er=async(t,e)=>{await t.removeItem(e)};class hn{constructor(){this.promise=new hn.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}hn.promiseConstructor=Promise;function $n(t){const e=t.split(".");if(e.length!==3)throw new qt("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!dp.test(e[n]))throw new qt("JWT not in base64url format");return{header:JSON.parse(uo(e[0])),payload:JSON.parse(uo(e[1])),signature:_p(e[2]),raw:{header:e[0],payload:e[1]}}}async function Pp(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Ap(t,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function kp(t){return("0"+t.toString(16)).substr(-2)}function Dp(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let i=0;i<56;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,kp).join("")}async function Op(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function xp(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await Op(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function pt(t,e,r=!1){const n=Dp();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await wl(t,`${e}-code-verifier`,s);const i=await xp(n);return[i,n===i?"plain":"s256"]}const $p=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Up(t){const e=t.headers.get(ds);if(!e||!e.match($p))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Lp(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function Np(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const jp=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function gt(t){if(!jp.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Fp=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r};const Je=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Mp=[502,503,504];async function fo(t){var e;if(!Rp(t))throw new fs(Je(t),0);if(Mp.includes(t.status))throw new fs(Je(t),t.status);let r;try{r=await t.json()}catch(i){throw new yl(Je(i),i)}let n;const s=Up(t);if(s&&s.getTime()>=gl["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new ao(Je(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new De}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new ao(Je(r),t.status,r.weak_password.reasons);throw new hp(Je(r),t.status||500,n)}const Bp=(t,e,r,n)=>{const s={method:t,headers:e?.headers||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function L(t,e,r,n){var s;const i=Object.assign({},n?.headers);i[ds]||(i[ds]=gl["2024-01-01"].name),n?.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n?.query)!==null&&s!==void 0?s:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await zp(t,e,r+a,{headers:i,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(l):{data:Object.assign({},l),error:null}}async function zp(t,e,r,n,s,i){const o=Bp(e,n,s,i);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new fs(Je(l),0)}if(a.ok||await fo(a),n?.noResolveJson)return a;try{return await a.json()}catch(l){await fo(l)}}function ve(t){var e;let r=null;Yp(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=Ip(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function ho(t){const e=ve(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function $e(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function Hp(t){return{data:t,error:null}}function Wp(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=t,o=Fp(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Vp(t){return t}function Yp(t){return t.access_token&&t.refresh_token&&t.expires_in}const Un=["global","local","others"];var qp=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r};class Gp{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=Sl(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,r=Un[0]){if(Un.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Un.join(", ")}`);try{return await L(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if($(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await L(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:$e})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=qp(e,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n?.newEmail,delete s.newEmail),await L(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Wp,redirectTo:r?.redirectTo})}catch(r){if($(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await L(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:$e})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,s,i,o,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await L(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e?.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e?.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Vp});if(u.error)throw u.error;const d=await u.json(),f=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,h=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(y=>{const E=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),_=JSON.parse(y.split(";")[1].split("=")[1]);c[`${_}Page`]=E}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if($(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){gt(e);try{return await L(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:$e})}catch(r){if($(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){gt(e);try{return await L(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:$e})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){gt(e);try{return await L(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:$e})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){gt(e.userId);try{const{data:r,error:n}=await L(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if($(r))return{data:null,error:r};throw r}}async _deleteFactor(e){gt(e.userId),gt(e.id);try{return{data:await L(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}}const Kp={getItem:t=>Gt()?globalThis.localStorage.getItem(t):null,setItem:(t,e)=>{Gt()&&globalThis.localStorage.setItem(t,e)},removeItem:t=>{Gt()&&globalThis.localStorage.removeItem(t)}};function po(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}function Jp(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const yt={debug:!!(globalThis&&Gt()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vl extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Qp extends vl{}async function Zp(t,e,r){yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),yt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await r()}finally{yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw yt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Qp(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(yt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}Jp();const Xp={url:lp,storageKey:cp,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:up,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function go(t,e,r){return await r()}class sr{constructor(e){var r,n;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=sr.nextInstanceID,sr.nextInstanceID+=1,this.instanceID>0&&ue()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Xp),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Gp({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Sl(s.fetch),this.lock=s.lock||go,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ue()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=Zp:this.lock=go,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:Gt()?this.storage=Kp:(this.memoryStorage={},this.storage=po(this.memoryStorage)):(this.memoryStorage={},this.storage=po(this.memoryStorage)),ue()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${pl}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const r=Cp(window.location.href);let n="none";if(this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce"),ue()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(r,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),yp(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return $(r)?{error:r}:{error:new yl("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,s;try{const i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e?.options)===null||s===void 0?void 0:s.captchaToken}},xform:ve}),{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var r,n,s;try{let i;if("email"in e){const{email:u,password:d,options:f}=e;let h=null,y=null;this.flowType==="pkce"&&([h,y]=await pt(this.storage,this.storageKey)),i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:d,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:h,code_challenge_method:y},xform:ve})}else if("phone"in e){const{phone:u,password:d,options:f}=e;i=await L(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(s=f?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:ve})}else throw new wr("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,c=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if($(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let r;if("email"in e){const{email:i,password:o,options:a}=e;r=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:ho})}else if("phone"in e){const{phone:i,password:o,options:a}=e;r=await L(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:ho})}else throw new wr("You must provide either an email or phone number and a password");const{data:n,error:s}=r;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Sr}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if($(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;if(r==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(e){var r,n,s,i,o,a,l,c,u,d,f,h;let y,E;if("message"in e)y=e.message,E=e.signature;else{const{chain:_,wallet:I,statement:b,options:p}=e;let m;if(ue())if(typeof I=="object")m=I;else{const S=window;if("solana"in S&&typeof S.solana=="object"&&("signIn"in S.solana&&typeof S.solana.signIn=="function"||"signMessage"in S.solana&&typeof S.solana.signMessage=="function"))m=S.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof I!="object"||!p?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=I}const w=new URL((r=p?.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in m&&m.signIn){const S=await m.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},p?.signInWithSolana),{version:"1",domain:w.host,uri:w.href}),b?{statement:b}:null));let v;if(Array.isArray(S)&&S[0]&&typeof S[0]=="object")v=S[0];else if(S&&typeof S=="object"&&"signedMessage"in S&&"signature"in S)v=S;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in v&&"signature"in v&&(typeof v.signedMessage=="string"||v.signedMessage instanceof Uint8Array)&&v.signature instanceof Uint8Array)y=typeof v.signedMessage=="string"?v.signedMessage:new TextDecoder().decode(v.signedMessage),E=v.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in m)||typeof m.signMessage!="function"||!("publicKey"in m)||typeof m!="object"||!m.publicKey||!("toBase58"in m.publicKey)||typeof m.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${w.host} wants you to sign in with your Solana account:`,m.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${w.href}`,`Issued At: ${(s=(n=p?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=p?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${p.signInWithSolana.notBefore}`]:[],...!((o=p?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${p.signInWithSolana.expirationTime}`]:[],...!((a=p?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${p.signInWithSolana.chainId}`]:[],...!((l=p?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${p.signInWithSolana.nonce}`]:[],...!((c=p?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${p.signInWithSolana.requestId}`]:[],...!((d=(u=p?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...p.signInWithSolana.resources.map(v=>`- ${v}`)]:[]].join(`
`);const S=await m.signMessage(new TextEncoder().encode(y),"utf8");if(!S||!(S instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");E=S}}try{const{data:_,error:I}=await L(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:bp(E)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:ve});if(I)throw I;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new Sr}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:I})}catch(_){if($(_))return{data:{user:null,session:null},error:_};throw _}}async _exchangeCodeForSession(e){const r=await _r(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{const{data:i,error:o}=await L(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ve});if(await Er(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Sr}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if($(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:r,provider:n,token:s,access_token:i,nonce:o}=e,a=await L(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:ve}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Sr}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(r){if($(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await pt(this.storage,this.storageKey));const{error:d}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l?.data)!==null&&r!==void 0?r:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await L(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(i=l?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new wr("You must provide either an email or phone number.")}catch(a){if($(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var r,n;try{let s,i;"options"in e&&(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await L(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:ve});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,c=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if($(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var r,n,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await pt(this.storage,this.storageKey)),await L(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Hp})}catch(i){if($(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new De;const{error:s}=await L(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if($(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await L(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await L(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new wr("You must provide either an email or phone number and a type")}catch(r){if($(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await _r(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<On:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!o&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:$e}):await this._useSession(async r=>{var n,s,i;const{data:o,error:a}=r;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new De}:await L(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:$e})})}catch(r){if($(r))return gp(r)&&(await this._removeSession(),await Er(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new De;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await pt(this.storage,this.storageKey));const{data:c,error:u}=await L(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:$e});if(u)throw u;return o.user=c.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if($(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new De;const r=Date.now()/1e3;let n=r,s=!0,i=null;const{payload:o}=$n(e.access_token);if(o.exp&&(n=o.exp,s=n<=r),s){const{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(r){if($(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new De;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if($(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!ue())throw new vr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new oo("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new vr("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new oo("No code detected.");const{data:b,error:p}=await this._exchangeCodeForSession(e.code);if(p)throw p;const m=new URL(window.location.href);return m.searchParams.delete("code"),window.history.replaceState(window.history.state,"",m.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:c}=e;if(!i||!a||!o||!c)throw new vr("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const h=f-u;h*1e3<=St&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const y=f-d;u-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,u):u-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,u);const{data:E,error:_}=await this._getUser(i);if(_)throw _;const I={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:o,token_type:c,user:E.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:I,redirectType:e.type},error:null}}catch(n){if($(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await _r(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return{error:i};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(pp(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await Er(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const r=Tp(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,s;try{const{data:{session:i},error:o}=r;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await pt(this.storage,this.storageKey,!0));try{return await L(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if($(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if($(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,c,u;const{data:d,error:f}=i;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await L(this.fetch,"GET",h,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return ue()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n?.url),{data:{provider:e.provider,url:n?.url},error:null}}catch(n){if($(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)throw o;return await L(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Ap(async s=>(s>0&&await Pp(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await L(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ve})),(s,i)=>{const o=200*Math.pow(2,s);return i&&xn(i)&&Date.now()+o-n<St})}catch(n){if(this._debug(r,"error",n),$(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),ue()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await _r(this.storage,this.storageKey);if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const s=((e=n.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<On;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${On}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:i}=await this._callRefreshToken(n.refresh_token);i&&(console.error(i),xn(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new De;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new hn;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new De;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={session:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),$(i)){const o={session:null,error:i};return xn(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,r,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await wl(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Er(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ue()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),St);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/St);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${St}ms, refresh threshold is ${us} ticks`),s<=us&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vl)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ue()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await pt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n?.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n?.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?{data:null,error:i}:await L(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await L(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((s=l?.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(r){if($(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return{data:null,error:i};const{data:o,error:a}=await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(r){if($(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?{data:null,error:i}:await L(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if($(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){const{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};const n=e?.factors||[],s=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,n;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=$n(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((n=(r=s.user.factors)===null||r===void 0?void 0:r.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(o=>o.kid===e);if(n||(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+fp>Date.now()))return n;const{data:s,error:i}=await L(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;if(!s.keys||s.keys.length===0)throw new qt("JWKS is empty");if(this.jwks=s,this.jwks_cached_at=Date.now(),n=s.keys.find(o=>o.kid===e),!n)throw new qt("No matching signing key found in JWKS");return n}async getClaims(e,r={keys:[]}){try{let n=e;if(!n){const{data:h,error:y}=await this.getSession();if(y||!h.session)return{data:null,error:y};n=h.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=$n(n);if(Lp(i.exp),!s.kid||s.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:h}=await this.getUser(n);if(h)throw h;return{data:{claims:i,header:s,signature:o},error:null}}const c=Np(s.alg),u=await this.fetchJwk(s.kid,r),d=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,o,Ep(`${a}.${l}`)))throw new qt("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if($(n))return{data:null,error:n};throw n}}}sr.nextInstanceID=0;const eg=sr;class tg extends eg{constructor(e){super(e)}}var rg=function(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(u){try{c(n.next(u))}catch(d){o(d)}}function l(u){try{c(n.throw(u))}catch(d){o(d)}}function c(u){u.done?i(u.value):s(u.value).then(a,l)}c((n=n.apply(t,e||[])).next())})};class ng{constructor(e,r,n){var s,i,o;if(this.supabaseUrl=e,this.supabaseKey=r,!e)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const a=op(e),l=new URL(a);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:Zh,realtime:ep,auth:Object.assign(Object.assign({},Xh),{storageKey:c}),global:Qh},d=ap(n??{},u);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=sp(r,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new _h(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),d.accessToken||this._listenForAuthEvents()}get functions(){return new ch(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Gh(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,r={},n={}){return this.rest.rpc(e,r,n)}channel(e,r={config:{}}){return this.realtime.channel(e,r)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,r;return rg(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(r=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:s,storageKey:i,flowType:o,lock:a,debug:l},c,u){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new tg({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:e,persistSession:r,detectSessionInUrl:n,storage:s,flowType:o,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new $h(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n?.access_token)})}_handleTokenChanged(e,r,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const sg=(t,e,r)=>new ng(t,e,r);var yo={};let br=null;function _l(){const t=typeof process<"u"&&yo.PUBLIC_ENV__SUPABASE_URL||typeof import.meta<"u"&&"https://ndarieqqqwucilxwweqk.supabase.co",e=typeof process<"u"&&yo.PUBLIC_ENV__SUPABASE_ANON_KEY||typeof import.meta<"u"&&"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kYXJpZXFxcXd1Y2lseHd3ZXFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNjkyMTIsImV4cCI6MjA2NDY0NTIxMn0.wvZAJ70ZB9ALk9XEQx1fGDR6FV3QRPVTpEWHSlC9pt0";return{supabaseUrl:t,supabaseAnonKey:e}}function Qe(){if(br)return br;const{supabaseUrl:t,supabaseAnonKey:e}=_l();if(!t||!e)throw new Error("Missing Supabase environment variables. Please set PUBLIC_ENV__SUPABASE_URL and PUBLIC_ENV__SUPABASE_ANON_KEY");return br=sg(t,e),br}function pn(){const{supabaseUrl:t,supabaseAnonKey:e}=_l();return!!(t&&e)}const J=new Proxy({},{get(t,e){return Qe()[e]}}),ig="packing_list_offline_auth",og=1,ye="users",ke="session";class Gs{listeners=[];currentState={user:null,session:null,loading:!0,error:null};db=null;initPromise;constructor(){this.initPromise=this.initializeDB().then(()=>this.initializeAuth())}async initializeDB(){if(!(typeof window>"u"))return new Promise((e,r)=>{const n=indexedDB.open(ig,og);n.onerror=()=>r(n.error),n.onsuccess=()=>{this.db=n.result,e()},n.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(ye)||i.createObjectStore(ye,{keyPath:"id"}).createIndex("email","email",{unique:!0}),i.objectStoreNames.contains(ke)||i.createObjectStore(ke,{keyPath:"id"})}})}async initializeAuth(){try{const e=await this.getStoredSession();e&&new Date(e.expires_at)>new Date?this.updateState({user:e.user,session:e,loading:!1,error:null}):(await this.clearSession(),this.updateState({user:null,session:null,loading:!1,error:null}))}catch(e){console.error("Local auth initialization error:",e),this.updateState({user:null,session:null,loading:!1,error:e instanceof Error?e.message:"Unknown error"})}}async getStoredUsers(){return this.db?new Promise((e,r)=>{if(!this.db){r(new Error("Database not initialized"));return}const i=this.db.transaction([ye],"readonly").objectStore(ye).getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>r(i.error)}):[]}async saveUser(e){if(this.db)return new Promise((r,n)=>{if(!this.db){n(new Error("Database not initialized"));return}const o=this.db.transaction([ye],"readwrite").objectStore(ye).put(e);o.onsuccess=()=>r(),o.onerror=()=>n(o.error)})}async deleteUser(e){if(this.db)return new Promise((r,n)=>{if(!this.db){n(new Error("Database not initialized"));return}const o=this.db.transaction([ye],"readwrite").objectStore(ye).delete(e);o.onsuccess=()=>r(),o.onerror=()=>n(o.error)})}async getUserByEmail(e){return this.db?new Promise((r,n)=>{if(!this.db){n(new Error("Database not initialized"));return}const a=this.db.transaction([ye],"readonly").objectStore(ye).index("email").get(e);a.onsuccess=()=>r(a.result||null),a.onerror=()=>n(a.error)}):null}async getStoredSession(){return this.db?new Promise((e,r)=>{if(!this.db){r(new Error("Database not initialized"));return}const i=this.db.transaction([ke],"readonly").objectStore(ke).get("current");i.onsuccess=()=>e(i.result||null),i.onerror=()=>r(i.error)}):null}async saveSession(e){if(this.db)return new Promise((r,n)=>{if(!this.db){n(new Error("Database not initialized"));return}const o=this.db.transaction([ke],"readwrite").objectStore(ke).put({id:"current",...e});o.onsuccess=()=>r(),o.onerror=()=>n(o.error)})}async clearSession(){if(this.db)return new Promise((e,r)=>{if(!this.db){r(new Error("Database not initialized"));return}const i=this.db.transaction([ke],"readwrite").objectStore(ke).delete("current");i.onsuccess=()=>e(),i.onerror=()=>r(i.error)})}generateId(){return"local-"+Math.random().toString(36).substr(2,9)+Date.now().toString(36)}async hashPassword(e){const n=new TextEncoder().encode(e+"packing_list_salt"),s=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(s)).map(i=>i.toString(16).padStart(2,"0")).join("")}async verifyPassword(e,r){return await this.hashPassword(e)===r}async createSession(e){const r={user:e,expires_at:new Date(Date.now()+2592e6).toISOString()};return await this.saveSession(r),r}updateState(e){this.currentState={...this.currentState,...e},this.listeners.forEach(r=>r(this.currentState))}subscribe(e){return this.listeners.push(e),e(this.currentState),()=>{const r=this.listeners.indexOf(e);r>-1&&this.listeners.splice(r,1)}}getState(){return this.currentState}async signUp(e,r,n){await this.initPromise;try{if(await this.getUserByEmail(e)){const l="A user with this email already exists";return this.updateState({error:l}),{error:l}}const i=await this.hashPassword(r),o={id:n?.id||this.generateId(),email:e,name:n?.name,password_hash:i,created_at:new Date().toISOString()};await this.saveUser(o);const a=await this.createSession(o);return this.updateState({user:o,session:a,loading:!1,error:null}),{user:o}}catch(s){const i=s instanceof Error?s.message:"Sign up failed";return this.updateState({error:i}),{error:i}}}async signIn(e,r){await this.initPromise;try{const n=await this.getUserByEmail(e);if(!n){const o="No account found with this email";return this.updateState({error:o}),{error:o}}if(!await this.verifyPassword(r,n.password_hash)){const o="Invalid password";return this.updateState({error:o}),{error:o}}const i=await this.createSession(n);return this.updateState({user:n,session:i,loading:!1,error:null}),{user:n}}catch(n){const s=n instanceof Error?n.message:"Sign in failed";return this.updateState({error:s}),{error:s}}}async signOut(){await this.initPromise;try{return await this.clearSession(),this.updateState({user:null,session:null,loading:!1,error:null}),{}}catch(e){const r=e instanceof Error?e.message:"Sign out failed";return this.updateState({error:r}),{error:r}}}async updatePassword(e,r){try{const{user:n}=this.currentState;if(!n){const u="No user signed in";return this.updateState({error:u}),{error:u}}if(!await this.verifyPassword(e,n.password_hash)){const u="Current password is incorrect";return this.updateState({error:u}),{error:u}}const i=await this.getStoredUsers(),o=i.findIndex(u=>u.id===n.id);if(o===-1){const u="User not found";return this.updateState({error:u}),{error:u}}const a=await this.hashPassword(r);i[o].password_hash=a,await this.saveUser(i[o]);const l={...n,password_hash:a},c=await this.createSession(l);return this.updateState({user:l,session:c,error:null}),{}}catch(n){const s=n instanceof Error?n.message:"Password update failed";return this.updateState({error:s}),{error:s}}}async deleteAccount(){try{const{user:e}=this.currentState;if(!e){const r="No user signed in";return this.updateState({error:r}),{error:r}}return await this.deleteUser(e.id),await this.clearSession(),this.updateState({user:null,session:null,loading:!1,error:null}),{}}catch(e){const r=e instanceof Error?e.message:"Account deletion failed";return this.updateState({error:r}),{error:r}}}async updateProfile(e){try{const{user:r}=this.currentState;if(!r){const a="No user signed in";return this.updateState({error:a}),{error:a}}if((await this.getStoredUsers()).findIndex(a=>a.id===r.id)===-1){const a="User not found";return this.updateState({error:a}),{error:a}}const i={...r,...e};await this.saveUser(i);const o=await this.createSession(i);return this.updateState({user:i,session:o,error:null}),{}}catch(r){const n=r instanceof Error?r.message:"Profile update failed";return this.updateState({error:n}),{error:n}}}async getLocalUsers(){return await this.getStoredUsers()}async hasPasscode(e){try{return!e&&this.currentState.user&&(e=this.currentState.user.id),e?!!(await this.getStoredUsers()).find(s=>s.id===e)?.passcode_hash:!1}catch{return!1}}async setPasscode(e,r,n){try{if(!n&&this.currentState.user&&(n=this.currentState.user.id),!n)return{error:"No user specified for passcode"};const i=(await this.getStoredUsers()).find(l=>l.id===n);if(!i)return{error:"User not found"};if(e&&i.password_hash&&!await this.verifyPassword(e,i.password_hash))return{error:"Current password is incorrect"};const o=await this.hashPassword(r),a={...i,passcode_hash:o};return await this.saveUser(a),this.currentState.user?.id===n&&this.updateState({user:a}),{}}catch(s){return{error:s instanceof Error?s.message:"Failed to set passcode"}}}async removePasscode(e,r){try{if(!r&&this.currentState.user&&(r=this.currentState.user.id),!r)return{error:"No user specified for passcode removal"};const s=(await this.getStoredUsers()).find(a=>a.id===r);if(!s||!s.passcode_hash)return{error:"No passcode is set for this user"};if(!await this.verifyPassword(e,s.passcode_hash))return{error:"Current passcode is incorrect"};const o={...s};return delete o.passcode_hash,await this.saveUser(o),this.currentState.user?.id===r&&this.updateState({user:o}),{}}catch(n){return{error:n instanceof Error?n.message:"Failed to remove passcode"}}}async signInWithoutPassword(e,r=!1){try{let n=await this.getUserByEmail(e);if(n||(n=(await this.getStoredUsers()).find(o=>o.id===e)||null),!n)return{error:"User not found"};if(n.passcode_hash&&!r)return{error:"Passcode is required for this account"};const s=await this.createSession(n);return this.updateState({user:n,session:s,loading:!1,error:null}),{user:n}}catch(n){const s=n instanceof Error?n.message:"Sign in failed";return this.updateState({error:s}),{error:s}}}async createOfflineAccountForOnlineUser(e){try{const r=await this.getUserByEmail(e.email);if(r)return{user:r};const n={id:e.id,email:e.email,name:e.name,avatar_url:e.avatar_url,password_hash:"",created_at:new Date().toISOString()};return await this.saveUser(n),{user:n}}catch(r){return{error:r instanceof Error?r.message:"Failed to create offline account"}}}destroy(){this.listeners=[],this.db&&(this.db.close(),this.db=null)}}function zt(){return"local-shared-user"}function Ln(t){return console.trace("getPersonalLocalUserId",t),`local-${t}`}function jt(){return{id:zt(),email:"shared@local.device",name:"Shared Account",type:"local",isShared:!0,created_at:new Date().toISOString()}}function Nn(t,e=!1){return{id:t.id,email:t.email,name:t.name,avatar_url:t.avatar_url,created_at:t.created_at,type:"local",isShared:e}}function ag(){return"https://craigory.dev/packing-list"}class lg{listeners=[];currentState={user:jt(),session:null,loading:!0,error:null,isRemoteAuthenticated:!1};supabaseAvailable;initializationPromise;localAuthService;lastRemoteUser=null;constructor(){this.supabaseAvailable=pn(),this.localAuthService=new Gs,this.initializationPromise=this.initializeAuth()}async initializeAuth(){if(await new Promise(e=>{const r=this.localAuthService.subscribe(n=>{if(!n.loading){if(n.user){const s=n.user.id===zt()||n.user.email==="shared@local.device";this.updateState({user:Nn(n.user,s)})}else this.ensureSharedLocalUser();r(),e()}})}),!this.supabaseAvailable){this.updateState({loading:!1,error:null});return}try{const e=Qe(),{data:{session:r},error:n}=await e.auth.getSession();if(n){this.updateState({loading:!1,error:n.message});return}if(r?.user){console.log("🔧 [AUTH SERVICE] Found cached session, validating with server...");try{const{error:s}=await e.auth.getUser();if(s){console.log("🔧 [AUTH SERVICE] Cached session is invalid:",s.message),console.log("🔧 [AUTH SERVICE] Clearing invalid session and switching to shared account..."),await e.auth.signOut(),await this.switchToSharedLocalAccount();return}console.log("🔧 [AUTH SERVICE] Session validated successfully"),await this.handleRemoteUserSignIn(r.user,r)}catch(s){console.log("🔧 [AUTH SERVICE] Session validation failed:",s),console.log("🔧 [AUTH SERVICE] Clearing session due to validation failure...");try{await e.auth.signOut()}catch(i){console.log("🔧 [AUTH SERVICE] Sign out failed during cleanup:",i)}await this.switchToSharedLocalAccount();return}}else this.updateState({loading:!1,error:null});e.auth.onAuthStateChange(async(s,i)=>{i&&typeof i=="object"&&"user"in i&&i?.user&&typeof i.user=="object"&&"id"in i.user?await this.handleRemoteUserSignIn(i.user,i):await this.handleRemoteUserSignOut()})}catch(e){console.error("Auth initialization error:",e),this.updateState({loading:!1,error:e instanceof Error?e.message:"Unknown error"})}}async ensureSharedLocalUser(){console.log("🔧 [AUTH SERVICE] Ensuring shared local user exists...");try{if(typeof window>"u"||!1){console.log("🔧 [AUTH SERVICE] Build/SSR environment detected, using in-memory shared user");const i=jt(),o=this.localAuthService.getState();if(!o.user||o.user.email!=="shared@local.device"){const a={id:i.id,email:i.email,name:i.name||"Shared Account",created_at:i.created_at||new Date().toISOString(),password_hash:"",passcode_hash:void 0,avatar_url:void 0};this.localAuthService.updateState?.({user:a,session:{user:a,expires_at:new Date(Date.now()+24*60*60*1e3).toISOString()},loading:!1,error:null})}return}const n=(await this.localAuthService.getLocalUsers()).find(i=>i.id===zt()||i.email==="shared@local.device");if(n)console.log("🔧 [AUTH SERVICE] Shared user already exists:",n.email);else{console.log("🔧 [AUTH SERVICE] Creating new shared local user...");const i=jt(),o=await this.localAuthService.signUp(i.email,"local-shared-password",{name:i.name,id:i.id});if(o.error){if(console.warn("🔧 [AUTH SERVICE] Failed to create shared user via signup:",o.error),!(await this.localAuthService.getLocalUsers()).find(c=>c.id===zt()||c.email==="shared@local.device"))throw new Error(`Failed to create shared user: ${o.error}`);console.log("🔧 [AUTH SERVICE] Shared user was created despite error")}else console.log("🔧 [AUTH SERVICE] Successfully created shared user")}console.log("🔧 [AUTH SERVICE] Signing in as shared user...");const s=await this.localAuthService.signInWithoutPassword("shared@local.device",!0);if(s.error){console.warn("🔧 [AUTH SERVICE] Failed to sign in as shared user:",s.error);const o=(await this.localAuthService.getLocalUsers()).find(a=>a.id===zt());if(o){console.log("🔧 [AUTH SERVICE] Found shared user by ID, trying alternative sign-in...");const a=await this.localAuthService.signInWithoutPassword(o.id,!0);if(a.error)throw new Error(`Failed to sign in as shared user: ${a.error}`)}else throw new Error(`Failed to sign in as shared user: ${s.error}`)}console.log("🔧 [AUTH SERVICE] Successfully signed in as shared user")}catch(e){throw console.error("🔧 [AUTH SERVICE] Failed to ensure shared local user:",e),e}}async handleRemoteUserSignIn(e,r){const n=Ln(e.id);this.lastRemoteUser=e;try{let i=(await this.localAuthService.getLocalUsers()).find(c=>c.id===n);const o=e.user_metadata?.avatar_url||e.user_metadata?.picture||e.identities?.[0]?.identity_data?.picture;let a;if(o&&(a=await this.downloadAndConvertToBase64(o)),i)a&&i.avatar_url!==a&&(await this.localAuthService.updateProfile({avatar_url:a}),i.avatar_url=a);else{const c=await this.localAuthService.createOfflineAccountForOnlineUser({id:n,email:e.email||"",name:e.user_metadata?.full_name||e.user_metadata?.name||e.user_metadata?.display_name||"Local User",avatar_url:a});c.user&&(i=c.user)}const l={id:e.id,email:e.email||"",name:e.user_metadata?.full_name||e.user_metadata?.name||e.user_metadata?.display_name||"Remote User",avatar_url:a,created_at:e.created_at,type:"remote",isShared:!1};this.updateState({user:l,session:r,loading:!1,error:null,isRemoteAuthenticated:!0}),console.log("🔧 [AUTH SERVICE] Successfully signed in with remote user:",e.email);return}catch(s){console.error("Failed to handle remote user sign in:",s),this.updateState({loading:!1,error:"Failed to process remote user account"})}}async downloadAndConvertToBase64(e){try{console.log("🔧 [AUTH SERVICE] Downloading avatar from:",e);const r=await fetch(e);if(!r.ok){console.warn("Failed to download avatar:",r.status,r.statusText);return}const n=await r.blob();return new Promise((s,i)=>{const o=new FileReader;o.onload=()=>{const a=o.result;console.log("🔧 [AUTH SERVICE] Avatar converted to base64, size:",a.length),s(a)},o.onerror=()=>{console.error("Failed to convert avatar to base64"),i(o.error)},o.readAsDataURL(n)})}catch(r){console.error("Error downloading and converting avatar:",r);return}}async handleRemoteUserSignOut(){if(this.lastRemoteUser&&this.supabaseAvailable)try{const e=Qe(),{error:r}=await e.auth.getSession();if(r&&(r.message.includes("network")||r.message.includes("fetch"))){await this.switchToPersonalLocalAccount();return}}catch(e){console.log("🔧 [AUTH SERVICE] Network error detected, switching to personal local account:",e),await this.switchToPersonalLocalAccount();return}this.lastRemoteUser=null,await this.switchToSharedLocalAccount()}async switchToPersonalLocalAccount(){if(this.lastRemoteUser){try{const e=Ln(this.lastRemoteUser.id),n=(await this.localAuthService.getLocalUsers()).find(s=>s.id===e);if(n){await this.localAuthService.signInWithoutPassword(n.email,!0),this.updateState({user:Nn(n),session:null,loading:!1,error:null,isRemoteAuthenticated:!1}),console.log("🔧 [AUTH SERVICE] Switched to personal local account due to connectivity loss");return}}catch(e){console.error("Failed to switch to personal local account:",e)}await this.switchToSharedLocalAccount()}}async switchToSharedLocalAccount(){console.log("🔧 [AUTH SERVICE] Starting transition to shared local account...");try{this.updateState({loading:!0,isRemoteAuthenticated:!1,session:null,error:null}),await this.localAuthService.signOut(),console.log("🔧 [AUTH SERVICE] Signed out from local auth service"),await this.ensureSharedLocalUser(),console.log("🔧 [AUTH SERVICE] Ensured shared local user exists"),await new Promise(r=>setTimeout(r,100));const e=this.localAuthService.getState();e.user&&e.user.email==="shared@local.device"?(console.log("🔧 [AUTH SERVICE] Successfully signed in as shared user"),this.updateState({user:Nn(e.user,!0),session:null,loading:!1,error:null,isRemoteAuthenticated:!1})):(console.log("🔧 [AUTH SERVICE] Fallback to in-memory shared user"),this.updateState({user:jt(),session:null,loading:!1,error:null,isRemoteAuthenticated:!1})),console.log("🔧 [AUTH SERVICE] Successfully switched to shared local account")}catch(e){console.error("🔧 [AUTH SERVICE] Error switching to shared local account:",e),this.updateState({user:jt(),session:null,loading:!1,error:`Failed to switch to shared account: ${e instanceof Error?e.message:"Unknown error"}`,isRemoteAuthenticated:!1})}}updateState(e){this.currentState={...this.currentState,...e},this.listeners.forEach(r=>r(this.currentState))}async waitForInitialization(){await this.initializationPromise}subscribe(e){return this.listeners.push(e),this.currentState.loading?this.initializationPromise.then(()=>{e(this.currentState)}):e(this.currentState),()=>{const r=this.listeners.indexOf(e);r>-1&&this.listeners.splice(r,1)}}getState(){return this.currentState}getCurrentUser(){return this.currentState.user}isRemotelyAuthenticated(){return this.currentState.isRemoteAuthenticated}isUsingSharedAccount(){return this.currentState.user.isShared===!0}async hasPersonalLocalAccount(){if(!this.lastRemoteUser)return!1;try{const e=Ln(this.lastRemoteUser.id);return(await this.localAuthService.getLocalUsers()).some(n=>n.id===e)}catch{return!1}}shouldShowSignInOptions(){return this.isUsingSharedAccount()||!this.isRemotelyAuthenticated()}getLocalAuthService(){return this.localAuthService}async signInWithGooglePopup(){if(!this.supabaseAvailable)return{error:"Remote authentication not available"};try{console.log("🔧 [AUTH SERVICE] Starting Google popup OAuth request");const e=ag(),r=`${e}/auth/callback`;console.log("🔧 [AUTH SERVICE] Base URL:",e),console.log("🔧 [AUTH SERVICE] Redirect URL:",r);const n=Qe(),{error:s,data:i}=await n.auth.signInWithOAuth({provider:"google",options:{redirectTo:r,queryParams:{access_type:"offline",prompt:"consent"},skipBrowserRedirect:!0}});if(s)return console.error("🔧 [AUTH SERVICE] OAuth request error:",s),{error:s.message};if(i.url){console.log("�� [AUTH SERVICE] Got OAuth URL:",i.url),console.log("🔧 [AUTH SERVICE] Opening popup window...");const o=window.open(i.url,"google-auth","width=500,height=600,scrollbars=yes,resizable=yes");return o?(console.log("🔧 [AUTH SERVICE] Popup opened successfully, starting polling..."),new Promise(a=>{const l=setInterval(()=>{o.closed&&(console.log("🔧 [AUTH SERVICE] Popup closed, checking session..."),clearInterval(l),setTimeout(async()=>{const{data:c,error:u}=await n.auth.getSession();console.log("🔧 [AUTH SERVICE] Session check result:",{sessionData:!!c?.session,sessionError:u}),c?.session&&!u?(console.log("🔧 [AUTH SERVICE] Authentication successful!"),a({})):(console.error("🔧 [AUTH SERVICE] Authentication failed or cancelled"),a({error:"Authentication was cancelled or failed"}))},500))},500);setTimeout(()=>{o.closed||(console.error("🔧 [AUTH SERVICE] Authentication timed out, closing popup"),o.close(),clearInterval(l),a({error:"Authentication timed out"}))},3e5)})):(console.error("🔧 [AUTH SERVICE] Failed to open popup window"),{error:"Failed to open popup window. Please allow popups for this site."})}return console.log("🔧 [AUTH SERVICE] No URL in OAuth response"),{}}catch(e){return console.error("🔧 [AUTH SERVICE] Exception in signInWithGooglePopup:",e),{error:e instanceof Error?e.message:"Unknown error"}}}async signOut(){if(!this.supabaseAvailable||!this.currentState.isRemoteAuthenticated)return{};try{this.lastRemoteUser=null;const e=Qe(),{error:r}=await e.auth.signOut();return r?{error:r.message}:{}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}}destroy(){this.listeners=[],this.localAuthService.destroy()}async signUpWithEmail(e,r,n){if(!this.supabaseAvailable)return{error:"Remote authentication not available"};try{console.log("🔧 [AUTH SERVICE] Starting email signup for:",e);const s=Qe(),{error:i,data:o}=await s.auth.signUp({email:e,password:r,options:{data:n?{name:n.name,full_name:n.name}:void 0}});return i?(console.error("🔧 [AUTH SERVICE] Email signup error:",i),{error:i.message}):o.user&&!o.user.email_confirmed_at?(console.log("🔧 [AUTH SERVICE] Email confirmation required"),{error:"Please check your email and click the confirmation link to complete signup."}):(console.log("🔧 [AUTH SERVICE] Email signup successful!"),{})}catch(s){return console.error("🔧 [AUTH SERVICE] Exception in signUpWithEmail:",s),{error:s instanceof Error?s.message:"Unknown error"}}}async signInWithEmail(e,r){if(!this.supabaseAvailable)return{error:"Remote authentication not available"};try{console.log("🔧 [AUTH SERVICE] Starting email signin for:",e);const n=Qe(),{error:s,data:i}=await n.auth.signInWithPassword({email:e,password:r});return s?(console.error("🔧 [AUTH SERVICE] Email signin error:",s),{error:s.message}):i.user?(console.log("🔧 [AUTH SERVICE] Email signin successful!"),{}):{error:"No user returned from signin"}}catch(n){return console.error("🔧 [AUTH SERVICE] Exception in signInWithEmail:",n),{error:n instanceof Error?n.message:"Unknown error"}}}}const W=new lg,mo=new Map;function El(t){const e=t,r=mo.get(e);if(r)return r;const n=new cg(t);return mo.set(e,n),n}class cg{listeners=[];currentState={isOnline:typeof navigator<"u"?navigator.onLine:!0,isConnected:typeof navigator<"u"?navigator.onLine:!0};checkInterval=null;lastCheckTime=0;minCheckInterval=6e4;periodicCheckInterval=3e5;constructor(e){console.log("🚀 [CONNECTIVITY SERVICE] Initializing connectivity service -",e),this.initializeConnectivity()}initializeConnectivity(){typeof window<"u"&&(window.addEventListener("online",this.handleOnlineStatusChange),window.addEventListener("offline",this.handleOnlineStatusChange)),this.startPeriodicCheck(),this.checkConnectivity()}handleOnlineStatusChange=()=>{this.updateOnlineStatus(navigator.onLine),this.checkConnectivity()};updateOnlineStatus(e){this.currentState.isOnline!==e&&(this.currentState={...this.currentState,isOnline:e},this.notifyListeners())}updateConnectedStatus(e){this.currentState.isConnected!==e&&(this.currentState={...this.currentState,isConnected:e},this.notifyListeners())}async checkConnectivityWithThrottling(){const e=Date.now();e-this.lastCheckTime<this.minCheckInterval||(this.lastCheckTime=e,await this.checkConnectivity())}async checkConnectivity(){if(typeof window>"u"||typeof navigator>"u"){this.updateConnectedStatus(!0);return}if(!navigator.onLine){console.log("🔍 [CONNECTIVITY] Browser reports offline"),this.updateConnectedStatus(!1);return}try{const e=new AbortController,r=setTimeout(()=>e.abort(),3e3),n=await fetch(Hc("/packing-list","/api/version.json"),{method:"HEAD",signal:e.signal,cache:"no-cache"});clearTimeout(r),n.ok||n.status<500?(console.log("🔍 [CONNECTIVITY] Connectivity test successful"),this.updateConnectedStatus(!0)):(console.log(`🔍 [CONNECTIVITY] Server error (${n.status}) - treating as offline`),this.updateConnectedStatus(!1))}catch(e){const r=e instanceof Error?e.message:String(e);e instanceof Error&&(e.name==="AbortError"||e.message.includes("fetch")||e.message.includes("network")||e.message.includes("Failed to fetch"))?(console.log("🔍 [CONNECTIVITY] Network error detected - marking as offline:",r),this.updateConnectedStatus(!1)):(console.log("🔍 [CONNECTIVITY] Connectivity test failed (non-network error):",r),this.updateConnectedStatus(navigator.onLine))}}startPeriodicCheck(){typeof window>"u"||(this.checkInterval=window.setInterval(()=>{this.checkConnectivityWithThrottling()},this.periodicCheckInterval))}notifyListeners(){this.listeners.forEach(e=>e(this.currentState))}subscribe(e){return this.listeners.push(e),e(this.currentState),()=>{const r=this.listeners.indexOf(e);r>-1&&this.listeners.splice(r,1)}}getState(){return this.currentState}async checkNow(){return this.updateOnlineStatus(navigator.onLine),await this.checkConnectivity(),this.currentState}destroy(){typeof window<"u"&&(window.removeEventListener("online",this.handleOnlineStatusChange),window.removeEventListener("offline",this.handleOnlineStatusChange),this.checkInterval&&(window.clearInterval(this.checkInterval),this.checkInterval=null)),this.listeners=[]}}const N=new Gs,bl=El("https://ndarieqqqwucilxwweqk.supabase.co"),Ar={user:null,session:null,loading:!0,error:null,lastError:null,isAuthenticating:!1,isInitialized:!1,isOfflineMode:!1,forceOfflineMode:!1,connectivityState:{isOnline:!0,isConnected:!0},offlineAccounts:[],hasOfflinePasscode:!1};function kt(t){const e=t.id==="local-shared-user"||t.email==="shared@local.device";return{id:t.id,email:t.email,name:t.name,avatar_url:t.avatar_url,created_at:t.created_at,type:"local",isShared:e}}async function Ne(t,e=!1){console.log("🔄 [AUTH SLICE] Handling post-login effects for user:",t?.email);const r=await N.getLocalUsers();if(e&&t&&t.type==="remote")return console.log("🔄 [AUTH SLICE] Remote auth completed, auth service handled offline account creation"),{user:t,session:W.getState().session,loading:!1,error:null,offlineAccounts:r};if(t?.type==="local"){const n=N.getState();return{user:t,session:n.session,loading:!1,error:null,offlineAccounts:r}}return{user:t,session:t?W.getState().session:null,loading:!1,error:null,offlineAccounts:r}}const kr=ge("auth/initializeAuth",async(t,{getState:e})=>{console.log("🔧 [AUTH SLICE] Starting auth initialization...");let r;try{const o=bl.checkNow(),a=new Promise((l,c)=>setTimeout(()=>c(new Error("Connectivity check timeout")),2e3));r=await Promise.race([o,a]),console.log("🔧 [AUTH SLICE] Connectivity check completed:",r)}catch(o){console.log("🔧 [AUTH SLICE] Connectivity check failed, assuming online:",o),r={isOnline:!0,isConnected:!0}}const s=e().auth.forceOfflineMode||!r.isConnected||!r.isOnline,i=await N.getLocalUsers();if(s){const o=W.getState();if(o.user.isShared)await W.getLocalAuthService().signOut(),await W.getLocalAuthService().signInWithoutPassword("shared@local.device",!0);else if(o.user&&o.isRemoteAuthenticated){const c=`local-${o.user.id}`;let u=i.find(d=>d.id===c);u||(u=i.find(d=>d.email===o.user.email&&d.id!=="local-shared-user"&&d.email!=="shared@local.device")),u?(console.log("🔧 [AUTH SLICE] Switching to personal local account for offline mode:",u.email,"ID:",u.id),await N.signInWithoutPassword(u.email,!0)):(console.log("🔧 [AUTH SLICE] No personal local account found for user:",o.user.email,"Available accounts:",i.map(d=>({id:d.id,email:d.email}))),await W.getLocalAuthService().signOut(),await W.getLocalAuthService().signInWithoutPassword("shared@local.device",!0))}const a=N.getState(),l={user:a.user?kt(a.user):null,session:a.session,loading:!1,error:a.error,isOfflineMode:!0,connectivityState:r,offlineAccounts:i,hasOfflinePasscode:a.user?!!a.user.passcode_hash:!1};return console.log("✅ [AUTH SLICE] Auth initialization completed (offline mode):",{hasUser:!!l.user,userEmail:l.user?.email,loading:l.loading,isOfflineMode:l.isOfflineMode}),l}else{console.log("🔧 [AUTH SLICE] Waiting for auth service initialization..."),await W.waitForInitialization();const o=W.getState();let a=!1;o.user&&!o.user.isShared&&(a=await N.hasPasscode(o.user.id));const l={user:o.user,session:o.session,loading:o.loading,error:o.error,isOfflineMode:!1,connectivityState:r,offlineAccounts:i,hasOfflinePasscode:a};return console.log("✅ [AUTH SLICE] Auth initialization completed (online mode):",{hasUser:!!l.user,userEmail:l.user?.email,userType:l.user?.type,isShared:l.user?.isShared,isRemoteAuthenticated:o.isRemoteAuthenticated,loading:l.loading,isOfflineMode:l.isOfflineMode}),l}}),hs=ge("auth/checkConnectivity",async()=>await bl.checkNow()),ps=ge("auth/switchToOnlineMode",async(t,{getState:e})=>{console.log("🌐 [AUTH SLICE] Switching back to online mode...");const r=e();if(r.auth.forceOfflineMode)return console.log("🌐 [AUTH SLICE] Force offline mode enabled, not switching to online"),{...r.auth,isOfflineMode:!0};try{const n=W.getState();console.log("🌐 [AUTH SLICE] Remote auth state:",{hasUser:!!n.user,email:n.user?.email,isRemoteAuthenticated:n.isRemoteAuthenticated});const s=await N.getLocalUsers();let i=!1;return n.user&&(i=await N.hasPasscode(n.user.id)),{user:n.user,session:n.session,loading:n.loading,error:n.error,isOfflineMode:!1,connectivityState:r.auth.connectivityState,offlineAccounts:s,hasOfflinePasscode:i}}catch(n){return console.error("🌐 [AUTH SLICE] Error switching to online mode:",n),{...r.auth,isOfflineMode:!0,error:"Failed to switch to online mode"}}}),Kt=ge("auth/signInWithGooglePopup",async(t,{getState:e,rejectWithValue:r})=>{if(e().auth.isOfflineMode)return r("Google sign-in not available in offline mode");console.log("🔄 [AUTH SLICE] Starting Google popup sign-in");const s=await W.signInWithGooglePopup();if(s.error)return r(s.error);let i=0;const o=10;for(;i<o;){await new Promise(c=>setTimeout(c,500)),i++;const l=W.getState();if(l.user&&l.isRemoteAuthenticated)return console.log("🔄 [AUTH SLICE] Google sign-in completed, auth service ready"),await Ne(l.user,!0)}const a=W.getState();return console.log("🔄 [AUTH SLICE] Google sign-in timeout, proceeding with current state"),await Ne(a.user,!0)}),Dr=ge("auth/signInWithPassword",async({email:t,password:e},{getState:r,rejectWithValue:n})=>{if(r().auth.isOfflineMode){console.log("🔄 [AUTH SLICE] Offline mode: using local auth for email signin");const c=await N.signIn(t,e);if(c.error)return n(c.error);const u=N.getState(),d=u.user?kt(u.user):null;return await Ne(d,!1)}console.log("🔄 [AUTH SLICE] Online mode: using remote auth for email signin");const i=await W.signInWithEmail(t,e);if(i.error)return n(i.error);let o=0;const a=10;for(;o<a;){await new Promise(u=>setTimeout(u,500)),o++;const c=W.getState();if(c.user&&c.isRemoteAuthenticated)return console.log("🔄 [AUTH SLICE] Email sign-in completed, auth service ready"),await Ne(c.user,!0)}const l=W.getState();return console.log("🔄 [AUTH SLICE] Email sign-in timeout, proceeding with current state"),await Ne(l.user,!0)}),Or=ge("auth/signInOfflineWithoutPassword",async({email:t},{rejectWithValue:e})=>{console.log("🔄 [AUTH SLICE] Local account signin for:",t);const r=await N.signInWithoutPassword(t);if(r.error)return e(r.error);const n=N.getState(),s=n.user?kt(n.user):null;return await Ne(s,!1)}),xr=ge("auth/signUp",async({email:t,password:e,metadata:r},{getState:n,rejectWithValue:s})=>{if(n().auth.isOfflineMode){console.log("🔄 [AUTH SLICE] Offline mode: using local auth for signup");const l=await N.signUp(t,e,r);if(l.error)return s(l.error);const c=N.getState(),u=c.user?kt(c.user):null;return await Ne(u,!1)}console.log("🔄 [AUTH SLICE] Online mode: using remote auth for signup");const o=await W.signUpWithEmail(t,e,r);if(o.error)return s(o.error);const a=W.getState();return await Ne(a.user,!!a.user)}),Jt=ge("auth/signOut",async(t,{getState:e,rejectWithValue:r})=>{if(e().auth.isOfflineMode){await N.signOut();const s=await N.signInWithoutPassword("shared@local.device",!0);if(s.error)return r(s.error);const i=N.getState();return{user:i.user?kt(i.user):null,session:null,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}else{console.log("🔄 [AUTH SLICE] Starting remote sign-out");const s=await W.signOut();if(s.error){console.log("🔄 [AUTH SLICE] Sign-out error:",s.error);const l=typeof s.error=="string"?s.error:s.error&&typeof s.error=="object"&&"message"in s.error?s.error.message:String(s.error);if(l.includes("session")||l.includes("Session")||l.includes("Auth session missing")||l.includes("403")||l.includes("Forbidden")){console.log("🔄 [AUTH SLICE] Session error detected, forcing local sign-out and switching to shared account");try{await N.signOut();const u=await N.signInWithoutPassword("shared@local.device",!0);if(u.error)return console.error("🔄 [AUTH SLICE] Failed to switch to shared account after session error:",u.error),{user:null,session:null,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()};const d=N.getState();return{user:d.user?kt(d.user):null,session:null,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}catch(u){return console.error("🔄 [AUTH SLICE] Fallback sign-out failed:",u),{user:null,session:null,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}}return s.error instanceof fn&&console.log("🔄 [AUTH SLICE] Sign-out error is an AuthError"),r(s.error)}let i=0;const o=10;for(;i<o;){await new Promise(c=>setTimeout(c,500)),i++;const l=W.getState();if(!l.isRemoteAuthenticated&&l.user?.isShared)return console.log("🔄 [AUTH SLICE] Sign-out completed, switched to shared account"),{user:l.user,session:l.session,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}const a=W.getState();return console.log("🔄 [AUTH SLICE] Sign-out timeout, proceeding with current state"),{user:a.user,session:a.session,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}}),Yr=ge("auth/setOfflinePasscode",async({currentPassword:t,newPasscode:e,userId:r},{rejectWithValue:n})=>{const s=await N.setPasscode(t,e,r);return s.error?n(s.error):{hasOfflinePasscode:!0,offlineAccounts:await N.getLocalUsers()}}),qr=ge("auth/removeOfflinePasscode",async({currentPasscode:t,userId:e},{rejectWithValue:r})=>{const n=await N.removePasscode(t,e);return n.error?r(n.error):{hasOfflinePasscode:!1,offlineAccounts:await N.getLocalUsers()}}),Gr=ge("auth/deleteAccount",async(t,{getState:e,rejectWithValue:r})=>{if(e().auth.isOfflineMode){const s=await N.deleteAccount();if(s.error)return r(s.error)}else return r("Account deletion only available in offline mode");return{user:null,session:null,loading:!1,error:null,offlineAccounts:await N.getLocalUsers()}}),Il=jf({name:"auth",initialState:Ar,reducers:{updateAuthState:(t,e)=>{Object.assign(t,e.payload)},updateConnectivityState:(t,e)=>{t.connectivityState=e.payload;const r=t.forceOfflineMode||!e.payload.isConnected||!e.payload.isOnline,n=t.isOfflineMode;r!==t.isOfflineMode&&(t.isOfflineMode=r,n&&!r?console.log("🌐 [AUTH SLICE] Connectivity restored: offline → online mode transition"):!n&&r&&console.log("📡 [AUTH SLICE] Connectivity lost: online → offline mode transition"))},setForceOfflineMode:(t,e)=>{t.forceOfflineMode=e.payload,t.isOfflineMode=e.payload||!t.connectivityState.isConnected||!t.connectivityState.isOnline},clearError:t=>{t.error=null,t.lastError=null},resetAuthState:()=>({...Ar,isInitialized:!0})},extraReducers:t=>{t.addCase(kr.pending,e=>{e.loading=!0,e.isInitialized=!1}).addCase(kr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.isInitialized=!0,e.loading=!1,e.error=null}).addCase(kr.rejected,(e,r)=>{e.loading=!1,e.isInitialized=!0,e.error=r.error.message||"Initialization failed",e.lastError=r.error.message||"Initialization failed"}).addCase(hs.fulfilled,(e,r)=>{e.connectivityState=r.payload;const n=e.forceOfflineMode||!r.payload.isConnected||!r.payload.isOnline;n!==e.isOfflineMode&&(e.isOfflineMode=n)}).addCase(Kt.pending,e=>{e.isAuthenticating=!0,e.error=null}).addCase(Kt.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.isAuthenticating=!1,e.error=null}).addCase(Kt.rejected,(e,r)=>{e.isAuthenticating=!1,e.error=r.payload,e.lastError=r.payload}).addCase(Dr.pending,e=>{e.isAuthenticating=!0,e.error=null}).addCase(Dr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.isAuthenticating=!1,e.error=null}).addCase(Dr.rejected,(e,r)=>{e.isAuthenticating=!1,e.error=r.payload,e.lastError=r.payload}).addCase(Or.pending,e=>{e.isAuthenticating=!0,e.error=null}).addCase(Or.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.isAuthenticating=!1,e.error=null}).addCase(Or.rejected,(e,r)=>{e.isAuthenticating=!1,e.error=r.payload,e.lastError=r.payload}).addCase(xr.pending,e=>{e.isAuthenticating=!0,e.error=null}).addCase(xr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.isAuthenticating=!1,e.error=null}).addCase(xr.rejected,(e,r)=>{e.isAuthenticating=!1,e.error=r.payload,e.lastError=r.payload}).addCase(Jt.pending,e=>{e.loading=!0,e.error=null}).addCase(Jt.fulfilled,(e,r)=>{Object.assign(e,{...Ar,user:r.payload.user,session:r.payload.session,loading:r.payload.loading,error:r.payload.error,isInitialized:!0,connectivityState:e.connectivityState,isOfflineMode:e.isOfflineMode,forceOfflineMode:e.forceOfflineMode,offlineAccounts:r.payload.offlineAccounts??e.offlineAccounts,hasOfflinePasscode:e.hasOfflinePasscode})}).addCase(Jt.rejected,(e,r)=>{e.loading=!1,e.error=r.payload,e.lastError=r.payload}).addCase(Yr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.error=null}).addCase(Yr.rejected,(e,r)=>{e.error=r.payload,e.lastError=r.payload}).addCase(qr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.error=null}).addCase(qr.rejected,(e,r)=>{e.error=r.payload,e.lastError=r.payload}).addCase(Gr.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.error=null}).addCase(Gr.rejected,(e,r)=>{e.error=r.payload,e.lastError=r.payload}).addCase(ps.fulfilled,(e,r)=>{Object.assign(e,r.payload),e.error=null}).addCase(ps.rejected,(e,r)=>{e.error=r.payload,e.lastError=r.payload})}}),{updateAuthState:So,updateConnectivityState:ug,setForceOfflineMode:dg,clearError:wo,resetAuthState:Z_}=Il.actions,fg=()=>Zf(),hg=Il.reducer,pg=Ar,Ae=t=>t.auth,ur=U([Ae],t=>t.user),gg=U([Ae],t=>t.session),Tl=U([ur],t=>!!t),Cl=U([Ae],t=>t.loading),yg=U([Ae],t=>t.isAuthenticating),mg=U([Ae],t=>t.error),Sg=U([Ae],t=>t.lastError),gn=U([Ae],t=>t.isOfflineMode),Ks=U([Ae],t=>t.connectivityState),Rl=U([Ks],t=>t.isOnline),Pl=U([Ks],t=>t.isConnected),Al=U([Ae],t=>t.isInitialized),wg=U([ur],t=>t?.email),vg=U([ur],t=>t?.name),_g=U([ur],t=>t?.avatar_url),Eg=U([Tl,Cl,Al,gn],(t,e,r,n)=>({isAuthenticated:t,isLoading:e,isInitialized:r,isOfflineMode:n})),bg=U([Rl,Pl,gn],(t,e,r)=>({isOnline:t,isConnected:e,isOfflineMode:r,canUseRemoteAuth:e&&!r})),Ig=t=>t.auth.offlineAccounts,Tg=t=>t.auth.hasOfflinePasscode,kl=t=>t.auth.forceOfflineMode,Cg=new Gs,Rg=El("https://ndarieqqqwucilxwweqk.supabase.co"),Dl=!1;function H(t,e){try{return th(t)}catch{return e}}function Ol(){try{return fg()}catch{return()=>{}}}function X_(){const t=Ol(),e=H(gn,!1),r=H(kl,!1);B.useEffect(()=>{t(kr(void 0));const n=W.subscribe(o=>{e||t(So(o))}),s=Cg.subscribe(o=>{e&&t(So({user:o.user?{id:o.user.id,email:o.user.email,name:o.user.name,avatar_url:o.user.avatar_url,created_at:o.user.created_at,type:"local",isShared:o.user.id==="local-shared-user"||o.user.email==="shared@local.device"}:null,session:o.session,loading:o.loading,error:o.error}))}),i=Rg.subscribe(o=>{const a=e;t(ug(o));const l=r||!o.isConnected||!o.isOnline;a&&!l&&(console.log("🌐 [AUTH HOOKS] Triggering switch to online mode..."),t(ps(void 0)))});return()=>{n(),s(),i()}},[t,e,r])}function eE(){const t=Ol(),e=H(ur,null),r=H(gg,null),n=H(Tl,!1),s=H(Cl,!0),i=H(yg,!1),o=H(mg,null),a=H(Sg,null),l=H(gn,!1),c=H(kl,!1),u=H(Ks,null),d=H(Rl,!0),f=H(Pl,!1),h=H(Al,!1),y=H(wg,null),E=H(vg,null),_=H(_g,null),I=H(Eg,{isAuthenticated:!1,isLoading:!0,isInitialized:!1,isOfflineMode:!1}),b=H(bg,{isOnline:!0,isConnected:!1,isOfflineMode:!1,canUseRemoteAuth:!1}),p=H(Ig,[]),m=H(Tg,!1),w=B.useMemo(()=>!e||e.id==="local-shared-user"||e.email==="shared@local.device"||e.isShared===!0,[e]),S=B.useMemo(()=>l?!1:e?.type==="remote",[l,e]);return{user:e,session:r,isAuthenticated:n,loading:s,isAuthenticating:i,error:o,lastError:a,isOfflineMode:l,forceOfflineMode:c,connectivityState:u,isOnline:d,isConnected:f,isInitialized:h,userEmail:y,userName:E,userAvatar:_,authStatus:I,connectivityStatus:b,offlineAccounts:p,hasOfflinePasscode:m,shouldShowSignInOptions:w,isRemotelyAuthenticated:S,signInWithGooglePopup:()=>t(Kt(void 0)),signInWithPassword:(Z,ce)=>t(Dr({email:Z,password:ce})),signInOfflineWithoutPassword:Z=>t(Or({email:Z})),signUp:(Z,ce,$t)=>t(xr({email:Z,password:ce,metadata:$t})),signOut:()=>t(Jt(void 0)),setOfflinePasscode:(Z,ce,$t)=>t(Yr({currentPassword:Z,newPasscode:ce,userId:$t})),removeOfflinePasscode:(Z,ce)=>t(qr({currentPasscode:Z,userId:ce})),deleteAccount:()=>t(Gr(void 0)),checkConnectivity:()=>t(hs(void 0)),setForceOfflineMode:Z=>t(dg(Z)),clearError:()=>t(wo()),signInWithGooglePopupAuth:async()=>t(Kt(void 0)),signOutUser:async()=>t(Jt(void 0)),setOfflinePass:async(Z,ce,$t)=>t(Yr({currentPassword:Z,newPasscode:ce,userId:$t})),removeOfflinePass:async(Z,ce)=>t(qr({currentPasscode:Z,userId:ce})),deleteUserAccount:async()=>t(Gr(void 0)),checkConnectivityNow:async()=>t(hs(void 0)),clearErrorAction:()=>{t(wo())}}}function Pg(t,e){const{field:r,operator:n,value:s}=e,i=t[r];return s===void 0||i===void 0?!1:Ct(i,n,s)}function Ag(t,e){const{field:r,operator:n,value:s}=e,i=t[r];return i===void 0?!1:Ct(i,n,s)}function kg(t,e){const r=t.conditions;return!r||r.length===0?e.map(n=>n.id):e.filter(n=>r.every(s=>s.type==="person"?Pg(n,s):!0)).map(n=>n.id)}function Dg(t,e){const r=t.conditions;return!r||r.length===0?e.map((n,s)=>s):e.map((n,s)=>({day:n,index:s})).filter(({day:n})=>r.every(s=>s.type==="day"?Ag(n,s):!0)).map(({index:n})=>n)}function ir(t,e){if(!e||e.every===1)return t.map(s=>[s]);const r=[],n=e.roundUp?Math.ceil(t.length/e.every):Math.floor(t.length/e.every);for(let s=0;s<n;s++){const i=s*e.every,o=Math.min(i+e.every,t.length);i<t.length&&r.push(t.slice(i,o))}return r}function Og(t,e,r,n,s=!1){let i=t;if(s&&(i+=" (Extra)"),e&&(i+=` (${e.name})`),r&&r.length>1){const o=Math.min(...r)+1,a=Math.max(...r)+1;i+=` (Days ${o}-${a})`}else n!==void 0&&(i+=` (Day ${n+1})`);return i}function Ee(t,e,r,n){const{personId:s,personName:i,dayIndex:o,dayGroup:a,isExtra:l=!1,quantity:c=1,isOverridden:u=!1}=n,d=s&&i?{name:i}:void 0,f=Og(t.name,d,a,o,l),h=o??(t.conditions?.some(y=>y.type==="day")&&r.length>0?r[0]:void 0);return{id:He(),name:f,itemName:t.name,ruleId:t.id,ruleHash:e,isPacked:!1,isOverridden:u,dayIndex:a?a[0]:h,dayStart:a?Math.min(...a):void 0,dayEnd:a?Math.max(...a):void 0,personId:s,personName:i,notes:t.notes,isExtra:l,quantity:c,categoryId:t.categoryId,subcategoryId:t.subcategoryId}}function xg(t,e,r,n,s,i){const o=[],a=ir(r,t.calculation.daysPattern);for(const l of e){const c=n.find(u=>u.id===l);for(const u of a)o.push(Ee(t,s,r,{suffix:`${l}-days${u.join("_")}`,personId:l,personName:c?.name,dayIndex:u[0],dayGroup:u,quantity:t.calculation.baseQuantity,isOverridden:i}))}return o}function $g(t,e,r,n,s,i){const o=[];for(const a of e){const l=n.find(c=>c.id===a);o.push(Ee(t,s,r,{personId:a,personName:l?.name,quantity:t.calculation.baseQuantity,isOverridden:i}))}return o}function Ug(t,e,r,n){const s=[],i=ir(e,t.calculation.daysPattern);for(const o of i)s.push(Ee(t,r,e,{suffix:`days${o.join("_")}`,dayIndex:o[0],dayGroup:o,quantity:t.calculation.baseQuantity,isOverridden:n}));return s}function Lg(t,e,r,n,s){const i=[],{daysPattern:o}=t.calculation;if(o){const a=ir(e,o);for(const l of a)i.push(Ee(t,r,e,{suffix:`days${l.join("_")}`,dayIndex:l[0],dayGroup:l,quantity:t.calculation.baseQuantity,isOverridden:s}))}else for(let a=0;a<n;a++)i.push(Ee(t,r,e,{quantity:1,isOverridden:s}));return i}function Ng(t,e,r,n,s,i,o){const a=[],{extraItems:l}=t.calculation;if(!l||i<=0)return a;if(l.perPerson&&l.perDay){const c=ir(r,l.daysPattern);for(const u of e){const d=n.find(f=>f.id===u);for(const f of c)a.push(Ee(t,s,r,{suffix:`extra-${u}-days${f.join("_")}`,personId:u,personName:d?.name,dayGroup:f,quantity:l.quantity,isExtra:!0,isOverridden:o}))}}else if(l.perPerson)for(const c of e){const u=n.find(d=>d.id===c);a.push(Ee(t,s,r,{personId:c,personName:u?.name,quantity:l.quantity,isExtra:!0,isOverridden:o}))}else if(l.perDay){const c=ir(r,l.daysPattern);for(const u of c)a.push(Ee(t,s,r,{suffix:`extra-days${u.join("_")}`,dayGroup:u,quantity:l.quantity,isExtra:!0,isOverridden:o}))}else for(let c=0;c<i;c++)a.push(Ee(t,s,r,{quantity:1,isExtra:!0,isOverridden:o}));return a}function yn(t,e,r,n,s,i,o=!1,a){const{perPerson:l,perDay:c,extraItems:u}=t.calculation,d=a??Nr(t.calculation.baseQuantity,l,c,t.calculation.daysPattern,e.length,r.length),f=!a&&u?Nr(u.quantity,u.perPerson,u.perDay,u.daysPattern,e.length,r.length):0;let h=[];l&&c?h=xg(t,e,r,n,i,o):l?h=$g(t,e,r,n,i,o):c?h=Ug(t,r,i,o):h=Lg(t,r,i,d,o);const y=Ng(t,e,r,n,i,f,o);return[...h,...y]}function jg(t,e,r,n,s,i,o){if(!e.personId||!r.includes(e.personId))return[];const a=s.find(l=>l.id===e.personId);return a?yn(t,[e.personId],n,[a],i,o,!0,e.overrideCount):[]}function Fg(t,e,r,n,s,i,o){return!e.dayIndex||!n.includes(e.dayIndex)?[]:yn(t,r,[e.dayIndex],s,[i[e.dayIndex]],o,!0,e.overrideCount)}function Mg(t,e,r,n,s,i,o){return yn(t,r,n,s,i,o,!0,e.overrideCount)}function Bg(t,e,r,n,s,i,o){return e.personId?jg(t,e,r,n,s,i,o):e.dayIndex!==void 0?Fg(t,e,r,n,s,i,o):Mg(t,e,r,n,s,i,o)}function zg(t,e){return t.map(r=>{let n=e.find(s=>s.ruleId===r.ruleId&&s.ruleHash===r.ruleHash&&s.dayIndex===r.dayIndex&&s.personId===r.personId);return n||(n=e.find(s=>s.ruleId==="imported"&&s.itemName===r.itemName&&s.dayIndex===r.dayIndex&&s.personId===r.personId&&s.quantity===r.quantity),n&&console.log(`🔄 [PRESERVE_PACKED] Matched stored item by name: ${r.itemName} (${n.id} → ${r.id})`)),n?{...r,isPacked:n.isPacked}:r})}const ne=t=>{const e=t.trips.selectedTripId;if(!e||!t.trips.byId[e])return t;const r=t.trips.byId[e],n=[];for(const o of r.trip.defaultItemRules??[]){const a=td(o),l=r.ruleOverrides.find(f=>f.ruleId===o.id);if(l?.isExcluded)continue;const c=kg(o,r.people),u=Dg(o,r.trip.days);let d=[];l?d=Bg(o,l,c,u,r.people,r.trip.days,a):d=yn(o,c,u,r.people,r.trip.days,a),n.push(...d)}const s=r.calculated.packingListItems,i=zg(n,s);return{...t,trips:{...t.trips,byId:{...t.trips.byId,[e]:{...r,calculated:{...r.calculated,packingListItems:i}}}}}},Hg="ADD_PERSON",Wg=t=>{const e=new Date().toISOString();return{type:Hg,payload:{id:He(),name:t.name,age:t.age,gender:t.gender,userPersonId:t.userPersonId,settings:{},createdAt:e,updatedAt:e,version:1,isDeleted:!1,tripId:""}}},Vg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r];if(n.people.find(l=>l.id===e.payload.id))return t;const i={...e.payload,tripId:r},o={...n,people:[...n.people,i]},a={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:o}}};return ne(a)},Yg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r];if(!n.people.find(a=>a.id===e.payload.id))return t;const i={...n,people:n.people.filter(a=>a.id!==e.payload.id)},o={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:i}}};return ne(o)},qg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r],s=n.people.map(a=>a.id===e.payload.id?e.payload:a),i={...n,people:s},o={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:i}}};return ne(o)},Re=t=>{const e=t.trips.selectedTripId;if(!e||!t.trips.byId[e])return t;const r=t.trips.byId[e],n=r.trip.defaultItemRules.map(i=>({name:i.name,quantity:ed(i,r.people,r.trip.days),ruleId:i.id})),s={...r,calculated:{...r.calculated,defaultItems:n}};return{...t,trips:{...t.trips,byId:{...t.trips.byId,[e]:s}}}},Gg=(t,e)=>{const r=t.trips.selectedTripId;if(!r)return t;const n=t.trips.byId[r];return n?{...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:{...n,trip:{...n.trip,days:Js(e.payload.tripEvents??[])}}}}}:t};function Js(t){if(!t||t.length===0)return[];const e=[...t].sort((l,c)=>{const u=xe(l.date),d=xe(c.date);u.setHours(0,0,0,0),d.setHours(0,0,0,0);const f=jr(u,d);return f===0?l.type.includes("leave")&&c.type.includes("arrive")?-1:l.type.includes("arrive")&&c.type.includes("leave")?1:l.type.localeCompare(c.type):f}),r=xe(e[0].date);r.setHours(0,0,0,0);const n=xe(e[e.length-1].date);n.setHours(0,0,0,0);const s=[];let i=r,o="home",a=!1;for(;jr(i,n)<=0;){const l=e.filter(u=>{const d=xe(u.date);return d.setHours(0,0,0,0),nd(i,d)}),c={location:o,expectedClimate:vo(o),items:[],travel:!1,date:i.getTime()};if(l.length>0)for(const u of l)switch(u?.type){case"leave_home":c.location="Home",c.travel=!0,o="Traveling",a=!0;break;case"leave_destination":c.location=o,c.travel=!0,o="Traveling",a=!0;break;case"arrive_destination":o=u.location||"destination",c.location=o,c.travel=a,a=!1;break;case"arrive_home":o="Home",c.location="Home",c.travel=a,a=!1;break}else c.location=o,c.travel=a;c.expectedClimate=vo(c.location),s.push(c),i=rd(i,1)}return s}function vo(t){return{home:"temperate",Traveling:"variable",destination:"temperate"}[t]||"temperate"}const Kg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r],s=Js(e.payload),i={...n.trip,tripEvents:e.payload,days:s},o={...n,trip:i},a={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:o}}};return ne(a)},Jg=t=>({type:"CREATE_ITEM_RULE",payload:{id:He(),...t}}),Qg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r],s={...n,trip:{...n.trip,defaultItemRules:[...n.trip.defaultItemRules??[],e.payload]}},i={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:s}}},o=Re(i);return ne(o)},Zg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r],s=n.trip.defaultItemRules.map(l=>l.id===e.payload.id?e.payload:l),i={...n,trip:{...n.trip,defaultItemRules:s}},o={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:i}}},a=Re(o);return ne(a)},Xg=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const n=t.trips.byId[r],s=n.trip.defaultItemRules?.filter(l=>l.id!==e.payload.id)??[],i={...n,trip:{...n.trip,defaultItemRules:s}},o={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:i}}},a=Re(o);return ne(a)},ey=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return console.warn("Cannot add rule override: no trip selected"),t;const n=t.trips.byId[r],s={...n,ruleOverrides:[...n.ruleOverrides,e.payload]};return{...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:s}}}},ty=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return console.warn("Cannot update packing list view: no trip selected"),t;const n=t.trips.byId[r],s={...n,packingListView:{...n.packingListView,...e.payload}};return{...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:s}}}},ry=(t,e)=>{const r=t.trips.selectedTripId;if(!r||!t.trips.byId[r])return t;const{itemId:n}=e.payload,s=t.trips.byId[r],i=s.calculated.packingListItems.map(l=>l.id===n?{...l,isPacked:!l.isPacked}:l),o=i.find(l=>l.id===n);o&&console.log(`📦 [TOGGLE_ITEM_PACKED] Toggled packed status: ${o.name} (${o.id}) -> ${o.isPacked}`);const a={...s,calculated:{...s.calculated,packingListItems:i}};return{...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:a}}}},_o={id:"system",name:"System"},Eo={created:new Date().toISOString(),modified:new Date().toISOString(),isBuiltIn:!0,isShared:!0,visibility:"public",version:"1.0.0"},bo={usageCount:0,rating:5,reviewCount:0},xl=[{id:"beach-essentials",name:"Beach Essentials",description:"Essential items for a beach vacation",primaryCategoryId:"beach",author:_o,metadata:{...Eo,tags:["beach","summer","vacation"],category:"vacation"},stats:bo,icon:"sun",color:"#FFB74D",rules:[{id:"beach-swimsuit",originalRuleId:"beach-swimsuit",name:"Swimsuit",calculation:{baseQuantity:2,perDay:!1,perPerson:!0},notes:"Pack an extra swimsuit for comfort",categoryId:"clothing",subcategoryId:"swimwear"},{id:"beach-sunscreen",originalRuleId:"beach-sunscreen",name:"Sunscreen",calculation:{baseQuantity:1,perDay:!1,perPerson:!1,daysPattern:{every:7,roundUp:!0}},notes:"One bottle per week of trip",categoryId:"toiletries"},{id:"beach-towel",originalRuleId:"beach-towel",name:"Beach Towel",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"gear"},{id:"beach-sandals",originalRuleId:"beach-sandals",name:"Sandals/Flip-flops",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"clothing",subcategoryId:"footwear"},{id:"beach-hat",originalRuleId:"beach-hat",name:"Sun Hat",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"accessories"},{id:"beach-sunglasses",originalRuleId:"beach-sunglasses",name:"Sunglasses",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"accessories"},{id:"beach-first-aid",originalRuleId:"beach-first-aid",name:"First Aid Kit",calculation:{baseQuantity:1,perDay:!1,perPerson:!1},categoryId:"medical"}]},{id:"business-travel",name:"Business Travel",description:"Essential items for business trips",primaryCategoryId:"business",author:_o,metadata:{...Eo,tags:["business","work","professional"],category:"business"},stats:bo,icon:"briefcase",color:"#78909C",rules:[{id:"business-suit",originalRuleId:"business-suit",name:"Business Suit",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},notes:"One formal suit per person",categoryId:"clothing",subcategoryId:"formal"},{id:"business-laptop",originalRuleId:"business-laptop",name:"Laptop & Charger",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"electronics"},{id:"business-documents",originalRuleId:"business-documents",name:"Business Documents",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"documents"},{id:"business-dress-shirts",originalRuleId:"business-dress-shirts",name:"Dress Shirts",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,daysPattern:{every:2,roundUp:!0}},notes:"One shirt for every two days",categoryId:"clothing",subcategoryId:"tops"},{id:"business-dress-shoes",originalRuleId:"business-dress-shoes",name:"Dress Shoes",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"clothing",subcategoryId:"footwear"},{id:"business-toiletries",originalRuleId:"business-toiletries",name:"Travel Toiletries",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},notes:"Travel-sized toiletries",categoryId:"toiletries"},{id:"business-phone-charger",originalRuleId:"business-phone-charger",name:"Phone & Charger",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},categoryId:"electronics"},{id:"business-medications",originalRuleId:"business-medications",name:"Personal Medications",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},notes:"Remember any prescription medications",categoryId:"medical"}]}],Io=[{id:"demo-event-1",type:"leave_home",date:"2024-07-25",notes:"Flight departs at 8:30 AM"},{id:"demo-event-2",type:"arrive_destination",date:"2024-07-25",location:"Houston, TX",notes:"Stay at Hotel ZaZa Houston Memorial City"},{id:"demo-event-3",type:"leave_destination",date:"2024-07-28",location:"Houston, TX",notes:"Flight to Miami at 2:15 PM"},{id:"demo-event-4",type:"arrive_destination",date:"2024-07-29",location:"Miami, FL",notes:"Stay at Fontainebleau Miami Beach"},{id:"demo-event-5",type:"leave_destination",date:"2024-07-31",location:"Miami, FL",notes:"Flight home at 6:45 PM"},{id:"demo-event-6",type:"arrive_home",date:"2024-08-02",notes:"Expected arrival 11:30 PM"}],ny=[{id:"underwear-rule",originalRuleId:"underwear-rule",name:"Underwear",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,extraItems:{quantity:2,perDay:!1,perPerson:!0}},conditions:[{type:"person",field:"age",operator:">=",value:3}],categoryId:"clothing",subcategoryId:"underwear"},{id:"socks-rule",originalRuleId:"socks-rule",name:"Socks",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,extraItems:{quantity:1,perDay:!1,perPerson:!0}},conditions:[],categoryId:"clothing",subcategoryId:"underwear"},{id:"tshirt-rule",originalRuleId:"tshirt-rule",name:"T-Shirts",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,extraItems:{quantity:1,perDay:!1,perPerson:!0}},conditions:[],categoryId:"clothing",subcategoryId:"tops"},{id:"jeans-rule",originalRuleId:"jeans-rule",name:"Jeans/Pants",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,daysPattern:{every:2,roundUp:!0},extraItems:{quantity:1,perDay:!1,perPerson:!0}},notes:"Most people can wear jeans multiple times. We'll pack one pair for every 2 days plus an extra pair per person.",conditions:[],categoryId:"clothing",subcategoryId:"bottoms"},{id:"pajamas-rule",originalRuleId:"pajamas-rule",name:"Pajamas",calculation:{baseQuantity:1,perDay:!0,perPerson:!0,daysPattern:{every:3,roundUp:!0}},notes:"Pajamas can usually be worn for a few nights before needing a wash.",conditions:[],categoryId:"clothing",subcategoryId:"underwear"},{id:"swimsuit-rule",originalRuleId:"swimsuit-rule",name:"Swimsuit",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},conditions:[{type:"day",field:"expectedClimate",operator:"==",value:"beach",notes:"Only needed for beach destinations or hotels with pools"}],categoryId:"clothing",subcategoryId:"swimwear"},{id:"jacket-rule",originalRuleId:"jacket-rule",name:"Warm Jacket",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},notes:"A single warm jacket per person is usually sufficient for cold weather.",conditions:[{type:"day",field:"expectedClimate",operator:"==",value:"cold",notes:"Pack if any destination has cold weather"}],categoryId:"clothing",subcategoryId:"outerwear"},{id:"toothbrush-rule",originalRuleId:"toothbrush-rule",name:"Toothbrush",calculation:{baseQuantity:1,perDay:!1,perPerson:!0},conditions:[],categoryId:"toiletries"},{id:"toothpaste-rule",originalRuleId:"toothpaste-rule",name:"Toothpaste",calculation:{baseQuantity:1,perDay:!1,perPerson:!1},conditions:[],categoryId:"toiletries"},{id:"shampoo-rule",originalRuleId:"shampoo-rule",name:"Travel Shampoo",calculation:{baseQuantity:1,perDay:!1,perPerson:!1,daysPattern:{every:7,roundUp:!0}},conditions:[],categoryId:"toiletries"},{id:"laundry-rule",originalRuleId:"laundry-rule",name:"Travel Laundry Detergent",calculation:{baseQuantity:1,perDay:!1,perPerson:!1,daysPattern:{every:7,roundUp:!0}},conditions:[],categoryId:"misc"},{id:"diaper-rule",originalRuleId:"diaper-rule",name:"Diapers",calculation:{baseQuantity:6,perDay:!0,perPerson:!0,extraItems:{quantity:4,perDay:!1,perPerson:!0}},notes:"Pack 6 diapers per day plus 4 extra per child for unexpected needs.",conditions:[{type:"person",field:"age",operator:"<=",value:3,notes:"Only needed for toddlers and babies"}],categoryId:"misc"},{id:"charger-rule",originalRuleId:"charger-rule",name:"Phone Charger",calculation:{baseQuantity:1,perDay:!1,perPerson:!0,extraItems:{quantity:2,perDay:!1,perPerson:!0}},conditions:[{type:"person",field:"age",operator:">",value:12}],categoryId:"electronics"}],To=[{id:"demo-person-1",name:"Sarah Johnson",age:42,gender:"female",tripId:"demo-trip",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,settings:{}},{id:"demo-person-2",name:"Mike Johnson",age:45,gender:"male",tripId:"demo-trip",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,settings:{}},{id:"demo-person-3",name:"Emma Johnson",age:12,gender:"female",tripId:"demo-trip",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,settings:{}},{id:"demo-person-4",name:"Alex Johnson",age:3,gender:"male",tripId:"demo-trip",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,settings:{}}],sy={viewMode:"by-person",filters:{packed:!0,unpacked:!0,excluded:!1}},iy=()=>{const t="DEMO_TRIP",e=[{id:"demo-conflict-1",entityType:"person",entityId:"demo-person-1",localVersion:{name:"Sarah Johnson (Local)",age:42,gender:"female",timestamp:Date.now()-1e3},serverVersion:{name:"Sarah J. Johnson",age:42,gender:"female",timestamp:Date.now()},conflictType:"update_conflict",timestamp:Date.now()},{id:"demo-conflict-2",entityType:"item",entityId:"demo-item-123",localVersion:{name:"Beach Towel",category:"beach",isPacked:!0,timestamp:Date.now()-2e3},serverVersion:{name:"Large Beach Towel",category:"beach",isPacked:!1,timestamp:Date.now()-500},conflictType:"update_conflict",timestamp:Date.now()-500}],r={trip:{id:t,days:Js(Io),tripEvents:Io,userId:"demo-user",title:"Demo Trip: Houston & Miami",description:"A sample multi-city trip to demonstrate the packing list functionality",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),settings:{defaultTimeZone:"America/New_York",packingViewMode:"by-day"},version:1,isDeleted:!1,defaultItemRules:ny},people:To,ruleOverrides:[],packingListView:sy,calculated:{defaultItems:[],packingListItems:[]},isLoading:!1},s={trips:{summaries:[{tripId:t,title:"Demo Trip: Houston & Miami",description:"A sample multi-city trip to demonstrate the packing list functionality",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),totalItems:0,packedItems:0,totalPeople:To.length}],selectedTripId:t,byId:{[t]:r}},rulePacks:xl,sync:{syncState:{lastSyncTimestamp:Date.now()-3e5,pendingChanges:[],isOnline:!0,isSyncing:!1,conflicts:e},isInitialized:!0,lastError:null},ui:{rulePackModal:{isOpen:!1,activeTab:"browse",selectedPackId:void 0},loginModal:{isOpen:!1},flow:{current:null,steps:[]},tripWizard:{currentStep:0},confetti:{burstId:0,source:null}}},i=Re(s);return ne(i)},oy=t=>({...iy(),auth:t.auth,userPeople:t.userPeople,userPreferences:t.userPreferences}),gs=(t,e)=>e.some(r=>t instanceof r);let Co,Ro;function ay(){return Co||(Co=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ly(){return Ro||(Ro=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ys=new WeakMap,jn=new WeakMap,mn=new WeakMap;function cy(t){const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{r(tt(t.result)),s()},o=()=>{n(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return mn.set(e,t),e}function uy(t){if(ys.has(t))return;const e=new Promise((r,n)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{r(),s()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});ys.set(t,e)}let ms={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return ys.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return tt(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function $l(t){ms=t(ms)}function dy(t){return ly().includes(t)?function(...e){return t.apply(Ss(this),e),tt(this.request)}:function(...e){return tt(t.apply(Ss(this),e))}}function fy(t){return typeof t=="function"?dy(t):(t instanceof IDBTransaction&&uy(t),gs(t,ay())?new Proxy(t,ms):t)}function tt(t){if(t instanceof IDBRequest)return cy(t);if(jn.has(t))return jn.get(t);const e=fy(t);return e!==t&&(jn.set(t,e),mn.set(e,t)),e}const Ss=t=>mn.get(t);function hy(t,e,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=tt(o);return n&&o.addEventListener("upgradeneeded",l=>{n(tt(o.result),l.oldVersion,l.newVersion,tt(o.transaction),l)}),r&&o.addEventListener("blocked",l=>r(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const py=["get","getKey","getAll","getAllKeys","count"],gy=["put","add","delete","clear"],Fn=new Map;function Po(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Fn.get(e))return Fn.get(e);const r=e.replace(/FromIndex$/,""),n=e!==r,s=gy.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||py.includes(r)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return n&&(c=c.index(a.shift())),(await Promise.all([c[r](...a),s&&l.done]))[0]};return Fn.set(e,i),i}$l(t=>({...t,get:(e,r,n)=>Po(e,r)||t.get(e,r,n),has:(e,r)=>!!Po(e,r)||t.has(e,r)}));const yy=["continue","continuePrimaryKey","advance"],Ao={},ws=new WeakMap,Ul=new WeakMap,my={get(t,e){if(!yy.includes(e))return t[e];let r=Ao[e];return r||(r=Ao[e]=function(...n){ws.set(this,Ul.get(this)[e](...n))}),r}};async function*Sy(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const r=new Proxy(e,my);for(Ul.set(r,e),mn.set(r,Ss(e));e;)yield r,e=await(ws.get(r)||e.continue()),ws.delete(r)}function ko(t,e){return e===Symbol.asyncIterator&&gs(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&gs(t,[IDBIndex,IDBObjectStore])}$l(t=>({...t,get(e,r,n){return ko(e,r)?Sy:t.get(e,r,n)},has(e,r){return ko(e,r)||t.has(e,r)}}));const wy="PackingListOfflineDB",Do=3;let Se=null;async function vy(){return Se||(console.log("[OfflineDB] Opening database"),Se=await hy(wy,Do,{upgrade(t,e){if(console.log(`[OfflineDB] Upgrading database from version ${e} to ${Do}`),t.objectStoreNames.contains("userPreferences")||t.createObjectStore("userPreferences").put({defaultTimeZone:"UTC",theme:"system",defaultTripDuration:7,autoSyncEnabled:!0,serviceWorkerEnabled:!1,lastSelectedTripId:null},"preferences"),!t.objectStoreNames.contains("userPersons")){const r=t.createObjectStore("userPersons",{keyPath:"id"});r.createIndex("userId","userId"),r.createIndex("updatedAt","updatedAt"),console.log("[OfflineDB] Created userPersons object store")}if(e===2&&t.objectStoreNames.contains("trips")&&(console.log("[OfflineDB] Running migration from v2 to v3: moving user profiles from trips to userPersons"),console.log("[OfflineDB] Migration will be handled on first access after upgrade")),!t.objectStoreNames.contains("trips")){const r=t.createObjectStore("trips",{keyPath:"id"});r.createIndex("userId","userId"),r.createIndex("updatedAt","updatedAt"),r.createIndex("activeTrips",["userId","isDeleted"])}if(!t.objectStoreNames.contains("tripPeople")){const r=t.createObjectStore("tripPeople",{keyPath:"id"});r.createIndex("tripId","tripId"),r.createIndex("activeByTrip",["tripId","isDeleted"])}if(!t.objectStoreNames.contains("tripItems")){const r=t.createObjectStore("tripItems",{keyPath:"id"});r.createIndex("tripId","tripId"),r.createIndex("personId","personId"),r.createIndex("dayIndex",["tripId","dayIndex"]),r.createIndex("activeByTrip",["tripId","isDeleted"])}if(!t.objectStoreNames.contains("tripRuleOverrides")){const r=t.createObjectStore("tripRuleOverrides",{keyPath:["tripId","ruleId","personId","dayIndex"]});r.createIndex("tripId","tripId"),r.createIndex("ruleId","ruleId")}if(!t.objectStoreNames.contains("tripDefaultItemRules")){const r=t.createObjectStore("tripDefaultItemRules",{keyPath:"id"});r.createIndex("tripId","tripId"),r.createIndex("ruleId","ruleId"),r.createIndex("activeByTrip",["tripId","isDeleted"])}if(!t.objectStoreNames.contains("defaultItemRules")){const r=t.createObjectStore("defaultItemRules",{keyPath:"id"});r.createIndex("packIds","packIds",{multiEntry:!0}),r.createIndex("categoryId","categoryId")}if(!t.objectStoreNames.contains("rulePacks")){const r=t.createObjectStore("rulePacks",{keyPath:"id"});r.createIndex("metadata.category","metadata.category"),r.createIndex("metadata.tags","metadata.tags",{multiEntry:!0})}if(!t.objectStoreNames.contains("syncChanges")){const r=t.createObjectStore("syncChanges",{keyPath:"id"});r.createIndex("timestamp","timestamp"),r.createIndex("entityType","entityType"),r.createIndex("synced","synced"),r.createIndex("pendingChanges","synced")}if(!t.objectStoreNames.contains("syncConflicts")){const r=t.createObjectStore("syncConflicts",{keyPath:"id"});r.createIndex("entityType","entityType"),r.createIndex("timestamp","timestamp")}if(!t.objectStoreNames.contains("syncMetadata")){const r=t.createObjectStore("syncMetadata");r.put(0,"lastSyncTimestamp"),r.put(_y(),"deviceId")}console.log("[OfflineDB] Database schema initialized successfully")},blocked(){console.warn("[OfflineDB] Database upgrade blocked by another connection")},blocking(){console.warn("[OfflineDB] Database connection is blocking an upgrade"),Se&&(console.log("[OfflineDB] Auto-closing database to resolve blocking upgrade"),Se.close(),Se=null)},terminated(){console.warn("[OfflineDB] Database connection was terminated"),Se=null}}),Se)}async function A(){return Se||await vy()}function _y(){return"device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now()}function Ey(){if(typeof globalThis.window>"u")return!1;try{const e=globalThis.sessionStorage?.getItem("redux-state");if(e&&JSON.parse(e)?.trips?.selectedTripId==="DEMO_TRIP")return!0}catch{}return globalThis.sessionStorage?.getItem("session-demo-choice")==="demo"}function by(t){return t==="DEMO_TRIP"||t.startsWith("demo-")||t.includes("demo")}function Iy(t){return t.startsWith("demo-")||t.startsWith("person-")||t.startsWith("item-")||t.includes("demo")}function be(t,e){return Ey()?(console.log("🎭 [DEMO MODE] Skipping persistence - demo mode active"),!0):t&&by(t)?(console.log(`🎭 [DEMO MODE] Skipping persistence - demo trip: ${t}`),!0):e&&Iy(e)?(console.log(`🎭 [DEMO MODE] Skipping persistence - demo entity: ${e}`),!0):!1}class rt{static async saveTrip(e){if(console.log("💾 [TripStorage] Attempting to save trip:",{id:e.id,userId:e.userId,title:e.title}),be(e.id,e.id)){console.log("🎭 [TripStorage] Skipping persistence due to demo mode for trip:",e.id);return}const n=(await A()).transaction(["trips"],"readwrite");await n.objectStore("trips").put(e),await n.done,console.log(`✅ [TripStorage] Successfully saved trip: ${e.id} - ${e.title} for user: ${e.userId}`)}static async getTrip(e){const n=await(await A()).get("trips",e);if(n&&(n.id.startsWith("user-profile-")||n.type==="user_person")){console.log(`[TripStorage] Skipping user profile entry: ${e}`);return}return console.log(`[TripStorage] Retrieved trip: ${e}`,n?"found":"not found"),n}static async getUserTrips(e){console.log(`🔍 [TripStorage] Getting trips for user: "${e}"`);const s=(await A()).transaction(["trips"],"readonly").objectStore("trips");try{const i=s.index("userId");console.log(`🔍 [TripStorage] Using userId index to query for userId: "${e}"`);const o=await i.getAll(e);console.log("🔍 [TripStorage] Trips from userId index:",o.length,o.map(l=>({id:l.id,userId:l.userId,title:l.title,isDeleted:l.isDeleted})));const a=o.filter(l=>{const c=!l.isDeleted,u=!l.id.startsWith("user-profile-")&&l.type!=="user_person";return c&&u});return console.log("🔍 [TripStorage] Active trips after filtering:",a.length,a.map(l=>({id:l.id,userId:l.userId,title:l.title}))),console.log(`[TripStorage] Retrieved ${a.length} trips for user: ${e}`),a}catch(i){console.warn("⚠️ [TripStorage] Failed to use userId index, falling back to client-side filtering:",i);const o=await s.getAll();console.log("🔍 [TripStorage] All trips from IndexedDB (fallback):",o.length,o.map(l=>({id:l.id,userId:l.userId,title:l.title,isDeleted:l.isDeleted})));const a=o.filter(l=>{const c=l.userId===e,u=!l.isDeleted,d=!l.id.startsWith("user-profile-")&&l.type!=="user_person";return c||console.log(`🔍 [TripStorage] Trip ${l.id} userId mismatch: expected "${e}", got "${l.userId}"`),l.id.startsWith("user-profile-")&&console.log(`🔍 [TripStorage] Skipping user profile entry: ${l.id}`),c&&u&&d});return console.log(`🔍 [TripStorage] Filtered trips for user "${e}":`,a.length,a.map(l=>({id:l.id,userId:l.userId,title:l.title}))),console.log(`[TripStorage] Retrieved ${a.length} trips for user: ${e} (via fallback)`),a}}static async getUserTripSummaries(e){console.log(`🔍 [TripStorage] Getting trip summaries for user: "${e}"`);const r=await this.getUserTrips(e);console.log(`🔍 [TripStorage] Got ${r.length} trips, converting to summaries`);const n=r.map(s=>({tripId:s.id,title:s.title,description:s.description,createdAt:s.createdAt,updatedAt:s.updatedAt,totalItems:0,packedItems:0,totalPeople:0}));return console.log(`🔍 [TripStorage] Returning ${n.length} trip summaries:`,n.map(s=>({tripId:s.tripId,title:s.title}))),n}static async deleteTrip(e){const n=(await A()).transaction(["trips"],"readwrite"),s=n.objectStore("trips"),i=await s.get(e);i&&(i.isDeleted=!0,i.updatedAt=new Date().toISOString(),i.version+=1,await s.put(i),await n.done,console.log(`[TripStorage] Soft deleted trip: ${e}`))}static async hardDeleteTrip(e){const n=(await A()).transaction(["trips","tripPeople","tripItems"],"readwrite");await n.objectStore("trips").delete(e);const i=await n.objectStore("tripPeople").index("tripId").getAll(e);for(const l of i)await n.objectStore("tripPeople").delete(l.id);const a=await n.objectStore("tripItems").index("tripId").getAll(e);for(const l of a)await n.objectStore("tripItems").delete(l.id);await n.done,console.log(`[TripStorage] Hard deleted trip and all related data: ${e}`)}static async updateLastSynced(e){const n=(await A()).transaction(["trips"],"readwrite"),s=n.objectStore("trips"),i=await s.get(e);i&&(i.lastSyncedAt=new Date().toISOString(),await s.put(i),await n.done,console.log(`[TripStorage] Updated last sync timestamp for trip: ${e}`))}static async getTripsNeedingSync(e){return(await this.getUserTrips(e)).filter(n=>n.lastSyncedAt?new Date(n.updatedAt)>new Date(n.lastSyncedAt):!0)}static async debugGetAllTrips(){console.log("🔍 [TripStorage] DEBUG - Getting all trips in database");const s=(await(await A()).transaction(["trips"],"readonly").objectStore("trips").getAll()).map(o=>({id:o.id,userId:o.userId,title:o.title,isDeleted:o.isDeleted}));console.log("🔍 [TripStorage] DEBUG - All trips in database:",s);const i=s.reduce((o,a)=>{const l=a.userId||"undefined";return o[l]||(o[l]=[]),o[l].push(a),o},{});return console.log("🔍 [TripStorage] DEBUG - Trips grouped by userId:",i),s}}class nt{static async savePerson(e){if(be(e.tripId,e.id))return;const n=(await A()).transaction(["tripPeople"],"readwrite");await n.objectStore("tripPeople").put(e),await n.done,console.log(`[PersonStorage] Saved person: ${e.id}`)}static async deletePerson(e){const n=(await A()).transaction(["tripPeople"],"readwrite").objectStore("tripPeople"),s=await n.get(e);s&&(s.isDeleted=!0,s.updatedAt=new Date().toISOString(),s.version+=1,await n.put(s)),console.log(`[PersonStorage] Deleted person: ${e}`)}static async getTripPeople(e){const s=await(await A()).transaction(["tripPeople"],"readonly").objectStore("tripPeople").index("tripId").getAll(e);return console.log(`[PersonStorage] Retrieved ${s.length} people for trip: ${e}`),s.filter(i=>!i.isDeleted)}}class Et{static async saveItem(e){if(be(e.tripId,e.id))return;const n=(await A()).transaction(["tripItems"],"readwrite");await n.objectStore("tripItems").put(e),await n.done,console.log(`[ItemStorage] Saved item: ${e.id}`)}static async deleteItem(e){const n=(await A()).transaction(["tripItems"],"readwrite").objectStore("tripItems"),s=await n.get(e);s&&(s.isDeleted=!0,s.updatedAt=new Date().toISOString(),s.version+=1,await n.put(s)),console.log(`[ItemStorage] Deleted item: ${e}`)}static async getTripItems(e){const s=await(await A()).transaction(["tripItems"],"readonly").objectStore("tripItems").index("tripId").getAll(e);return console.log(`[ItemStorage] Retrieved ${s.length} items for trip: ${e}`),s.filter(i=>!i.isDeleted)}}class je{static async saveDefaultItemRule(e){const n=(await A()).transaction(["defaultItemRules"],"readwrite");await n.objectStore("defaultItemRules").put(e),await n.done,console.log(`[DefaultItemRulesStorage] Saved default item rule: ${e.id}`)}static async deleteDefaultItemRule(e){const n=(await A()).transaction(["defaultItemRules"],"readwrite").objectStore("defaultItemRules"),s=await n.get(e);s&&(s.isDeleted=!0,s.updatedAt=new Date().toISOString(),await n.put(s)),console.log(`[DefaultItemRulesStorage] Deleted default item rule: ${e}`)}static async getAllDefaultItemRules(){const n=await(await A()).transaction(["defaultItemRules"],"readonly").objectStore("defaultItemRules").getAll();return console.log(`[DefaultItemRulesStorage] Retrieved ${n.length} default item rules`),n.filter(s=>!s.isDeleted)}static async getDefaultItemRulesByCategory(e){const s=await(await A()).transaction(["defaultItemRules"],"readonly").objectStore("defaultItemRules").index("categoryId").getAll(e);return console.log(`[DefaultItemRulesStorage] Retrieved ${s.length} default item rules for category: ${e}`),s.filter(i=>!i.isDeleted)}static async getDefaultItemRulesByPackId(e){const s=await(await A()).transaction(["defaultItemRules"],"readonly").objectStore("defaultItemRules").index("packIds").getAll(e);return console.log(`[DefaultItemRulesStorage] Retrieved ${s.length} default item rules for pack: ${e}`),s.filter(i=>!i.isDeleted)}static async getDefaultItemRule(e){const s=await(await A()).transaction(["defaultItemRules"],"readonly").objectStore("defaultItemRules").get(e);return console.log(`[DefaultItemRulesStorage] Retrieved default item rule: ${e}`),s&&!s.isDeleted?s:void 0}}class Mn{static async saveRulePack(e){const n=(await A()).transaction(["rulePacks"],"readwrite");await n.objectStore("rulePacks").put(e),await n.done,console.log(`[RulePacksStorage] Saved rule pack: ${e.id}`)}static async deleteRulePack(e){const n=(await A()).transaction(["rulePacks"],"readwrite").objectStore("rulePacks"),s=await n.get(e);s&&(s.isDeleted=!0,s.updatedAt=new Date().toISOString(),await n.put(s)),console.log(`[RulePacksStorage] Deleted rule pack: ${e}`)}static async getAllRulePacks(){const n=await(await A()).transaction(["rulePacks"],"readonly").objectStore("rulePacks").getAll();return console.log(`[RulePacksStorage] Retrieved ${n.length} rule packs`),n.filter(s=>!s.isDeleted)}static async getRulePacksByCategory(e){const s=await(await A()).transaction(["rulePacks"],"readonly").objectStore("rulePacks").index("metadata.category").getAll(e);return console.log(`[RulePacksStorage] Retrieved ${s.length} rule packs for category: ${e}`),s.filter(i=>!i.isDeleted)}static async getRulePacksByTag(e){const s=await(await A()).transaction(["rulePacks"],"readonly").objectStore("rulePacks").index("metadata.tags").getAll(e);return console.log(`[RulePacksStorage] Retrieved ${s.length} rule packs with tag: ${e}`),s.filter(i=>!i.isDeleted)}static async getRulePack(e){const s=await(await A()).transaction(["rulePacks"],"readonly").objectStore("rulePacks").get(e);return console.log(`[RulePacksStorage] Retrieved rule pack: ${e}`),s&&!s.isDeleted?s:void 0}}class Ty{static async saveConflict(e){if(be(void 0,e.id)||be(void 0,e.entityId)){console.log(`🎭 [ConflictsStorage] Skipping conflict persistence in demo mode: ${e.id}`);return}const n=(await A()).transaction(["syncConflicts"],"readwrite");await n.objectStore("syncConflicts").put(e),await n.done,console.log(`📋 [ConflictsStorage] Saved conflict: ${e.id} (${e.entityType}:${e.entityId})`)}static async getConflict(e){const n=await(await A()).get("syncConflicts",e);return console.log(`📋 [ConflictsStorage] Retrieved conflict: ${e} - ${n?"found":"not found"}`),n}static async getAllConflicts(){const r=await(await A()).getAll("syncConflicts");return console.log(`📋 [ConflictsStorage] Retrieved ${r.length} total conflicts`),r}static async getConflictsByEntityType(e){const s=await(await A()).transaction(["syncConflicts"],"readonly").objectStore("syncConflicts").index("entityType").getAll(e);return console.log(`📋 [ConflictsStorage] Retrieved ${s.length} conflicts for entity type: ${e}`),s}static async deleteConflict(e){const n=(await A()).transaction(["syncConflicts"],"readwrite");await n.objectStore("syncConflicts").delete(e),await n.done,console.log(`📋 [ConflictsStorage] Deleted conflict: ${e}`)}static async clearAllConflicts(){const r=(await A()).transaction(["syncConflicts"],"readwrite");await r.objectStore("syncConflicts").clear(),await r.done,console.log("📋 [ConflictsStorage] Cleared all conflicts")}static async clearDemoConflicts(){const r=(await A()).transaction(["syncConflicts"],"readwrite"),n=r.objectStore("syncConflicts"),i=(await n.getAll()).filter(o=>{const a=o.id.startsWith("demo-conflict-")||o.entityId.startsWith("demo-"),l=/^conflict-\d+$/.test(o.id)||/^(person|item)-\d+$/.test(o.entityId);return a||l});for(const o of i)await n.delete(o.id);return await r.done,console.log(`📋 [ConflictsStorage] Cleared ${i.length} demo conflicts from IndexedDB`),i.length}}class bt{static async getPreferences(){if(be())return console.log("🎭 [USER_PREFERENCES_STORAGE] Skipping persistence in demo mode"),null;try{const r=await(await A()).get("userPreferences","preferences");return console.log("📖 [USER_PREFERENCES_STORAGE] Retrieved preferences:",r),r||null}catch(e){return console.error("❌ [USER_PREFERENCES_STORAGE] Error getting preferences:",e),null}}static async savePreferences(e){if(be()){console.log("🎭 [USER_PREFERENCES_STORAGE] Skipping save in demo mode");return}try{await(await A()).put("userPreferences",e,"preferences"),console.log("💾 [USER_PREFERENCES_STORAGE] Saved preferences:",e)}catch(r){throw console.error("❌ [USER_PREFERENCES_STORAGE] Error saving preferences:",r),r}}static async updateLastSelectedTripId(e){if(be()){console.log("🎭 [USER_PREFERENCES_STORAGE] Skipping trip ID update in demo mode");return}try{const r=await this.getPreferences(),s={...{defaultTimeZone:"UTC",theme:"system",defaultTripDuration:7,autoSyncEnabled:!0,serviceWorkerEnabled:!1,lastSelectedTripId:null},...r,lastSelectedTripId:e};await this.savePreferences(s),console.log("🎯 [USER_PREFERENCES_STORAGE] Updated lastSelectedTripId:",e)}catch(r){throw console.error("❌ [USER_PREFERENCES_STORAGE] Error updating lastSelectedTripId:",r),r}}static async getLastSelectedTripId(){try{const r=(await this.getPreferences())?.lastSelectedTripId||null;return console.log("🎯 [USER_PREFERENCES_STORAGE] Retrieved lastSelectedTripId:",r),r}catch(e){return console.error("❌ [USER_PREFERENCES_STORAGE] Error getting lastSelectedTripId:",e),null}}static async clearPreferences(){if(be()){console.log("🎭 [USER_PREFERENCES_STORAGE] Skipping clear in demo mode");return}try{await(await A()).delete("userPreferences","preferences"),console.log("🧹 [USER_PREFERENCES_STORAGE] Cleared all preferences")}catch(e){throw console.error("❌ [USER_PREFERENCES_STORAGE] Error clearing preferences:",e),e}}}class st{static async saveTripRule(e){const n=(await A()).transaction(["tripDefaultItemRules"],"readwrite");await n.objectStore("tripDefaultItemRules").put(e),await n.done,console.log(`💾 [TripRuleStorage] Saved trip rule association: trip ${e.tripId} -> rule ${e.ruleId}`)}static async getTripRules(e){const a=(await(await A()).transaction(["tripDefaultItemRules"],"readonly").objectStore("tripDefaultItemRules").index("tripId").getAll(e)).filter(l=>!l.isDeleted);return console.log(`🔍 [TripRuleStorage] Retrieved ${a.length} active trip rules for trip: ${e}`),a}static async getTripRulesWithDetails(e){const n=(await A()).transaction(["tripDefaultItemRules","defaultItemRules"],"readonly"),a=(await n.objectStore("tripDefaultItemRules").index("tripId").getAll(e)).filter(u=>!u.isDeleted),l=n.objectStore("defaultItemRules"),c=[];for(const u of a){const d=await l.get(u.ruleId);d&&c.push(d)}return console.log(`🔍 [TripRuleStorage] Retrieved ${c.length} full rules for trip: ${e}`),c}static async deleteTripRule(e,r){const s=(await A()).transaction(["tripDefaultItemRules"],"readwrite"),i=s.objectStore("tripDefaultItemRules"),l=(await i.index("tripId").getAll(e)).find(c=>c.ruleId===r&&!c.isDeleted);l&&(l.isDeleted=!0,l.updatedAt=new Date().toISOString(),l.version+=1,await i.put(l),await s.done,console.log(`🗑️ [TripRuleStorage] Soft deleted trip rule: trip ${e} -> rule ${r}`))}static async hardDeleteTripRules(e){const n=(await A()).transaction(["tripDefaultItemRules"],"readwrite"),s=n.objectStore("tripDefaultItemRules"),o=await s.index("tripId").getAll(e);for(const a of o)await s.delete(a.id);await n.done,console.log(`🗑️ [TripRuleStorage] Hard deleted all trip rules for trip: ${e}`)}}class Fe{static async saveUserPerson(e){await(await A()).put("userPersons",e),console.log(`✅ [UserPersonStorage] Saved user profile: ${e.name} (${e.id}) for user ${e.userId}`)}static async getUserPerson(e){const r=await A();try{const s=await r.transaction("userPersons").store.index("userId").get(e);return s?(console.log(`✅ [UserPersonStorage] Retrieved user profile: ${s.name} (${s.id}) for user ${e}`),s):(console.log(`📋 [UserPersonStorage] No user profile found for user ${e}`),null)}catch(n){return console.error(`❌ [UserPersonStorage] Error retrieving user profile for user ${e}:`,n),null}}static async getAllUserPeople(e){const r=await A();try{const s=await r.transaction("userPersons").store.index("userId").getAll(e);return console.log(`✅ [UserPersonStorage] Retrieved ${s.length} user people for user ${e}`),s.filter(i=>!i.isDeleted)}catch(n){return console.error(`❌ [UserPersonStorage] Error retrieving user people for user ${e}:`,n),[]}}static async getUserPersonById(e){const r=await A();try{const n=await r.get("userPersons",e);return n?(console.log(`✅ [UserPersonStorage] Retrieved user profile: ${n.name} (${n.id})`),n):(console.log(`📋 [UserPersonStorage] No user profile found for ID ${e}`),null)}catch(n){return console.error(`❌ [UserPersonStorage] Error retrieving user profile for ID ${e}:`,n),null}}static async deleteUserPerson(e){const r=await A();try{const n=await this.getUserPerson(e);if(!n){console.log(`📋 [UserPersonStorage] No user profile found to delete for user ${e}`);return}await r.delete("userPersons",n.id),console.log(`✅ [UserPersonStorage] Deleted user profile: ${n.name} (${n.id}) for user ${e}`)}catch(n){throw console.error(`❌ [UserPersonStorage] Error deleting user profile for user ${e}:`,n),n}}static async deleteUserPersonById(e){const r=await A();try{const n=await this.getUserPersonById(e);if(!n){console.log(`📋 [UserPersonStorage] No user person found to delete for ID ${e}`);return}await r.delete("userPersons",e),console.log(`✅ [UserPersonStorage] Deleted user person: ${n.name} (${e}) - ${n.isUserProfile?"profile":"template"}`)}catch(n){throw console.error(`❌ [UserPersonStorage] Error deleting user person for ID ${e}:`,n),n}}static async hasUserPerson(e){return await this.getUserPerson(e)!==null}static async getAllUserPersons(){const e=await A();try{const r=await e.getAll("userPersons");return console.log(`✅ [UserPersonStorage] Retrieved ${r.length} user profiles`),r}catch(r){return console.error("❌ [UserPersonStorage] Error retrieving all user profiles:",r),[]}}}function tE(){}const Cy=t=>{console.log("🧹 [CLEAR DEMO] Starting demo data cleanup...");const e=t.sync.syncState.conflicts.filter(r=>{const n=r.id.startsWith("demo-conflict-")||r.entityId.startsWith("demo-"),s=/^conflict-\d+$/.test(r.id)||/^(person|item)-\d+$/.test(r.entityId);return!n&&!s});return console.log("✅ [CLEAR DEMO] Demo data cleanup completed"),{...t,trips:{...t.trips,summaries:t.trips.summaries.filter(r=>r.tripId!=="DEMO_TRIP"),selectedTripId:t.trips.selectedTripId==="DEMO_TRIP"?null:t.trips.selectedTripId,byId:Object.fromEntries(Object.entries(t.trips.byId).filter(([r])=>r!=="DEMO_TRIP"))},sync:{...t.sync,syncState:{...t.sync.syncState,conflicts:e},isInitialized:!1,lastError:null}}},Ry=()=>async t=>{console.log("🧹 [CLEAR DEMO THUNK] Starting async cleanup...");try{await Ay(),t({type:"CLEAR_DEMO_DATA"}),await Py(),console.log("✅ [CLEAR DEMO THUNK] Async cleanup completed successfully")}catch(e){console.error("❌ [CLEAR DEMO THUNK] Failed to clear demo data:",e)}};async function Py(){try{console.log("🔄 [CLEAR DEMO] Reset sync service to prevent demo mode conflicts")}catch(t){console.warn("⚠️ [CLEAR DEMO] Could not reset sync service:",t)}}async function Ay(){try{if(typeof globalThis.window>"u")return;const t=await Ty.clearDemoConflicts();console.log(`🧹 [CLEAR DEMO] Cleared ${t} demo conflicts from IndexedDB`)}catch(t){console.warn("⚠️ [CLEAR DEMO] Could not clear demo conflicts from IndexedDB:",t)}}const ky=t=>{const e=t.trips.selectedTripId;if(!e||!t.trips.byId[e])return console.warn("Cannot clear trip data: no trip selected"),t;const r=Qs(e);return{...t,trips:{...t.trips,byId:{...t.trips.byId,[e]:r}}}};function Oo(t,e){return{packId:t,ruleId:e}}const Dy=(t,e)=>{const r=t.trips.selectedTripId,n=t.auth.user?.id;if(!r||!t.trips.byId[r]||!n)return console.warn("Cannot toggle rule pack: no trip selected or no user authenticated"),t;const s=t.trips.byId[r],{pack:i,active:o}=e;if(o){const a=[...s.trip.defaultItemRules],l=[];for(const f of i.rules){const h=a.findIndex(y=>y.originalRuleId===f.id||y.id===f.id);if(h>=0){const y=a[h],E=y.packIds||[];if(!E.some(I=>I.packId===i.id&&I.ruleId===f.id)){const I=Oo(i.id,f.id);a[h]={...y,packIds:[...E,I]}}}else{const y=Oo(i.id,f.id),E={...f,id:He(),originalRuleId:f.id,packIds:[y]};a.push(E),l.push(E.id)}}const c=new Date().toISOString();for(const f of l){const h={id:`${r}-${f}`,tripId:r,ruleId:f,createdAt:c,updatedAt:c,version:1,isDeleted:!1};console.log("Trip rule created:",h)}const u={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:{...s,trip:{...s.trip,defaultItemRules:a}}}}},d=Re(u);return ne(d)}else{const a=[],l=s.trip.defaultItemRules.reduce((d,f)=>{if(!f.packIds||f.packIds?.length===0)return d.push(f),d;const h=f.packIds.filter(E=>E.packId!==i.id);if(h.length===0)return a.push(f.id),d;const y={...f,packIds:h};return d.push(y),d},[]);for(const d of a)console.log("Trip rule removed for rule:",d);const c={...t,trips:{...t.trips,byId:{...t.trips.byId,[r]:{...s,trip:{...s.trip,defaultItemRules:l}}}}},u=Re(c);return ne(u)}},Oy=(t,e)=>({...t,rulePacks:[...t.rulePacks,e.payload]}),xy=(t,e)=>({...t,rulePacks:t.rulePacks.map(r=>r.id===e.payload.id?e.payload:r)}),$y=(t,e)=>t.rulePacks.find(n=>n.id===e.payload.id)?{...t,rulePacks:t.rulePacks.filter(n=>n.id!==e.payload.id)}:t,Uy=(t,e)=>({...t,ui:{...t.ui,rulePackModal:{isOpen:!0,activeTab:e.payload?.tab||"browse",selectedPackId:e.payload?.packId}}}),Ly=t=>({...t,ui:{...t.ui,rulePackModal:{isOpen:!1,activeTab:"browse",selectedPackId:void 0}}}),Ny=(t,e)=>({...t,ui:{...t.ui,rulePackModal:{...t.ui.rulePackModal,activeTab:e.payload.tab,selectedPackId:e.payload.packId}}}),jy=t=>({...t,ui:{...t.ui,loginModal:{isOpen:!0}}}),Fy=t=>({...t,ui:{...t.ui,loginModal:{isOpen:!1}}});function My(){return typeof window>"u"?!0:window.matchMedia("(prefers-reduced-motion: reduce)").matches}const By=(t,e)=>My()?t:{...t,ui:{...t.ui,confetti:{burstId:t.ui.confetti.burstId+1,source:e.payload?{x:e.payload.x,y:e.payload.y,w:e.payload.w??0,h:e.payload.h??0}:null}}};function Bn(t){return t==="DEMO_TRIP"||t.startsWith("demo-")||t.includes("demo")}const zy=(t,e)=>{console.log("🔄 [HYDRATE_OFFLINE] Processing hydration with payload:",{tripsCount:Object.keys(e.payload.trips.byId).length,selectedTripId:e.payload.trips.selectedTripId});const r=Object.entries(t.trips.byId).filter(([i])=>Bn(i)),n=t.trips.summaries.filter(i=>Bn(i.tripId));r.length>0&&console.log(`🎭 [HYDRATE_OFFLINE] Preserving ${r.length} demo trips from being cleared by IndexedDB reload:`,r.map(([i,o])=>({id:i,title:o.trip.title})));const s={...t,...e.payload};if(r.length>0){const i=Object.fromEntries(r);s.trips={...s.trips,summaries:[...s.trips.summaries,...n],byId:{...s.trips.byId,...i}},Bn(t.trips.selectedTripId||"")&&!s.trips.selectedTripId&&(s.trips.selectedTripId=t.trips.selectedTripId,console.log(`🎭 [HYDRATE_OFFLINE] Restored demo trip selection: ${t.trips.selectedTripId}`))}return console.log(`✅ [HYDRATE_OFFLINE] Hydration complete with ${Object.keys(s.trips.byId).length} total trips (${r.length} demo trips preserved)`),s},Ll=(t,e)=>{try{const r=xe(t),n=xe(e);return id(n,r)}catch(r){return console.warn("Error calculating age:",r),0}},Hy=t=>Ll(t,new Date().toISOString()),rE=(t,e)=>{if(!t)return;const r=e||new Date().toISOString();return Ll(t,r)},Wy=t=>`${new Date().getFullYear()-t}-01-01`,Vy=t=>t.trim().length>0,Yy=t=>{if(t===void 0)return!0;try{const e=xe(t),r=new Date,n=new Date(r.getFullYear()-150,0,1);return e<=r&&e>=n}catch{return!1}},qy=t=>t===void 0||["male","female","other","prefer-not-to-say"].includes(t),nE=t=>{const e=[];return Vy(t.name)||e.push("Name is required and cannot be empty"),Yy(t.birthDate)||e.push("Birth date must be a valid date in the past and not more than 150 years ago"),qy(t.gender)||e.push("Gender must be one of: male, female, other, prefer-not-to-say"),e},sE=(t,e,r=5)=>{const n=e.toLowerCase().trim();return n?t.filter(s=>s.name.toLowerCase().includes(n)).sort((s,i)=>{if(s.isUserProfile&&!i.isUserProfile)return-1;if(!s.isUserProfile&&i.isUserProfile)return 1;const o=s.name.toLowerCase()===n,a=i.name.toLowerCase()===n;return o&&!a?-1:!o&&a?1:s.name.localeCompare(i.name)}).slice(0,r):[]},Gy=t=>t.filter(e=>e.autoAddToNewTrips&&!e.isDeleted),Ky=t=>({type:"CREATE_PERSON_FROM_PROFILE",payload:t}),vs=(t,e)=>{const{userPersonId:r,userPerson:n,tripId:s}=e.payload,i=t.trips.byId[s];if(!i)return console.warn(`[CREATE_PERSON_FROM_PROFILE] Trip not found: ${s}`),t;const o=i.people.find(d=>d.userPersonId===r);if(o&&!o.isDeleted)return console.log(`[CREATE_PERSON_FROM_PROFILE] Person from profile already exists in trip: ${o.name}`),t;const a=new Date().toISOString(),l={id:He(),tripId:s,name:n.name,age:n.birthDate?Hy(n.birthDate):void 0,gender:n.gender,settings:n.settings||{},userPersonId:r,createdAt:a,updatedAt:a,version:1,isDeleted:!1};if(!l.age)return console.warn(`[CREATE_PERSON_FROM_PROFILE] No age found for user profile: ${n.name}`,n),t;const c={...i,people:[...i.people,l]},u={...t,trips:{...t.trips,byId:{...t.trips.byId,[s]:c}}};return console.log(`✅ [CREATE_PERSON_FROM_PROFILE] Added ${n.name} from profile to trip ${s}`),ne(u)},Jy={people:[],isLoading:!1,error:null,hasTriedToLoad:!1},Nl=mf({name:"userPeople",initialState:Jy,reducers:{setUserPeople:(t,e)=>{t.people=e.payload,t.hasTriedToLoad=!0,t.error=null,t.isLoading=!1},upsertUserPerson:(t,e)=>{const r=t.people.findIndex(n=>n.id===e.payload.id);r>=0?t.people[r]=e.payload:t.people.push(e.payload),t.hasTriedToLoad=!0,t.error=null},createUserPerson:(t,e)=>{t.people.push({...e.payload,id:He(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1}),t.hasTriedToLoad=!0,t.error=null},removeUserPerson:(t,e)=>{t.people=t.people.filter(r=>r.id!==e.payload)},clearUserPeople:t=>{t.people=[],t.error=null,t.isLoading=!1},setLoading:(t,e)=>{t.isLoading=e.payload},setError:(t,e)=>{t.error=e.payload,t.isLoading=!1},clearError:t=>{t.error=null},resetPeopleState:t=>{t.people=[],t.isLoading=!1,t.error=null,t.hasTriedToLoad=!1},markAsTriedToLoad:t=>{t.hasTriedToLoad=!0,t.isLoading=!1}},extraReducers:t=>{t.addCase("HYDRATE_OFFLINE",(e,r)=>{const{userPeople:n}=r.payload;n&&n.people&&(e.people=n.people,e.hasTriedToLoad=!0,e.error=null,e.isLoading=!1)}).addCase("BULK_UPSERT_SYNCED_ENTITIES",(e,r)=>{const{userPeople:n}=r.payload||{};n&&n.length>0&&(console.log(`👥 [USER PEOPLE REDUCER] Updating ${n.length} user people from sync`,n),e.people=n.filter(s=>!s.isDeleted),e.hasTriedToLoad=!0,e.error=null,e.isLoading=!1,console.log(`✅ [USER PEOPLE REDUCER] Updated user people state with ${e.people.length} people`))}).addCase("MERGE_SYNCED_USER_PERSON",(e,r)=>{const n=r.payload;if(n.isDeleted)e.people=e.people.filter(s=>s.id!==n.id);else{const s=e.people.findIndex(i=>i.id===n.id);s>=0?e.people[s]=n:e.people.push(n)}e.hasTriedToLoad=!0,e.error=null,e.isLoading=!1})}}),{setUserPeople:iE,upsertUserPerson:Qy,removeUserPerson:oE,clearUserPeople:aE,setLoading:lE,setError:cE,clearError:uE,resetPeopleState:dE,markAsTriedToLoad:fE,createUserPerson:hE}=Nl.actions,Zy=Nl.reducer,pE=t=>t.userPeople.people,Xy=t=>t.userPeople.people.find(e=>e.isUserProfile)||null,gE=U(t=>t.userPeople.people,t=>t.filter(e=>!e.isUserProfile)),yE=t=>t.userPeople.isLoading,mE=t=>t.userPeople.error,SE=U(t=>t.userPeople.people,t=>t.some(e=>e.isUserProfile)),em=t=>({type:"CREATE_TRIP",payload:{tripId:He(),title:t.title,description:t.description}});function tm(t,e){console.log("🚀 [CREATE_TRIP_HANDLER] Handler called with action:",e);const{tripId:r,title:n,description:s}=e.payload;console.log("🚀 [CREATE_TRIP_HANDLER] Extracted payload:",{tripId:r,title:n,description:s});const i={tripId:r,title:n,description:s||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),totalItems:0,packedItems:0,totalPeople:0},o=Qs(r),a=t.auth.user?.id||"local-user";console.log("🔧 [CREATE_TRIP] Creating trip for user:",a,"Auth user:",t.auth.user);const l={id:r,userId:a,title:n,createdAt:i.createdAt,updatedAt:i.updatedAt};o.trip={...o.trip,title:n,description:s||"",userId:a,createdAt:i.createdAt,updatedAt:i.updatedAt},console.log("🔧 [CREATE_TRIP] Trip model to save:",{id:l.id,userId:l.userId,title:l.title});let c={...t,trips:{...t.trips,summaries:[...t.trips.summaries,i],selectedTripId:r,byId:{...t.trips.byId,[r]:o}},sync:t.trips.selectedTripId==="DEMO_TRIP"?Kr.sync:t.sync};const u=Xy(c);u&&u.isUserProfile?(console.log(`👤 [CREATE_TRIP] Auto-adding user profile to trip: ${u.name}`),c=vs(c,{payload:{userPersonId:u.id,userPerson:u,tripId:r}}),console.log("✅ [CREATE_TRIP] Successfully auto-added user profile to trip")):console.log("📋 [CREATE_TRIP] No user profile found for auto-add. User will need to add manually or create profile.");const d=Gy(c.userPeople.people);if(d.length>0){console.log(`👤 [CREATE_TRIP] Auto-adding ${d.length} people to trip`);for(const f of d)c=vs(c,{payload:{userPersonId:f.id,userPerson:f,tripId:r}})}return c}function rm(t,e){return console.log("🎯 [SELECT_TRIP_HANDLER] Selecting trip:",e.payload.tripId),{...t,trips:{...t.trips,selectedTripId:e.payload.tripId},userPreferences:t.userPreferences?{...t.userPreferences,lastSelectedTripId:e.payload.tripId}:{defaultTimeZone:"UTC",theme:"system",defaultTripDuration:7,autoSyncEnabled:!0,serviceWorkerEnabled:!1,lastSelectedTripId:e.payload.tripId}}}function nm(t,e){const{tripId:r}=e.payload,n=t.trips.summaries.filter(o=>o.tripId!==r),s=Object.fromEntries(Object.entries(t.trips.byId).filter(([o])=>o!==r));let i=t.trips.selectedTripId;return t.trips.selectedTripId===r&&(i=n.length>0?n[0].tripId:null),{...t,trips:{summaries:n,selectedTripId:i,byId:s}}}function sm(t,e){const{tripId:r,title:n,description:s}=e.payload,i=t.trips.summaries.map(o=>o.tripId===r?{...o,title:n,description:s||"",updatedAt:new Date().toISOString()}:o);return{...t,trips:{...t.trips,summaries:i}}}const im=(t,e)=>({...t,ui:{...t.ui,flow:{current:e.payload.current??0,steps:e.payload.steps}}}),om=(t,e)=>({...t,ui:{...t.ui,flow:{current:t.ui.flow.current!==null?(t.ui.flow?.current??0)+e.payload.direction:null,steps:t.ui.flow?.steps??[]}}}),am=t=>({...t,ui:{...t.ui,flow:{current:0,steps:[]}}}),lm=t=>({type:"INIT_FLOW",payload:t}),cm=t=>({type:"ADVANCE_FLOW",payload:{direction:t??1}}),um=t=>({type:"RESET_FLOW",payload:{reason:t}}),dm=(t,e)=>({...t,ui:{...t.ui,tripWizard:{currentStep:e.payload.step}}}),fm=t=>({...t,ui:{...t.ui,tripWizard:{currentStep:1}}}),hm=t=>({type:"SET_WIZARD_STEP",payload:{step:t}}),pm=()=>({type:"RESET_WIZARD"}),xo={syncState:{lastSyncTimestamp:null,pendingChanges:[],isOnline:!0,isSyncing:!1,conflicts:[]},isInitialized:!1,lastError:null};function ee(t=xo,e){switch(e.type){case"SET_SYNC_STATE":return console.log("🔄 [SYNC STATE] Setting sync state:",e.payload),{...t,syncState:{...t.syncState,...e.payload}};case"SET_SYNC_INITIALIZED":return console.log("🚀 [SYNC STATE] Setting initialized:",e.payload),{...t,isInitialized:e.payload};case"ADD_SYNC_CONFLICT":return console.log("⚠️ [SYNC STATE] Adding conflict:",e.payload.id),t.syncState.conflicts.some(n=>n.id===e.payload.id)?t:{...t,syncState:{...t.syncState,conflicts:[...t.syncState.conflicts,e.payload]}};case"REMOVE_SYNC_CONFLICT":return console.log("✅ [SYNC STATE] Removing conflict:",e.payload),{...t,syncState:{...t.syncState,conflicts:t.syncState.conflicts.filter(r=>r.id!==e.payload)}};case"CLEAR_SYNC_CONFLICTS":return console.log("🧹 [SYNC STATE] Clearing all conflicts"),{...t,syncState:{...t.syncState,conflicts:[]}};case"SET_SYNC_CONFLICTS":return console.log("📋 [SYNC STATE] Setting conflicts:",e.payload.length),{...t,syncState:{...t.syncState,conflicts:e.payload}};case"SET_SYNC_ONLINE_STATUS":return console.log("🌐 [SYNC STATE] Setting online status:",e.payload),{...t,syncState:{...t.syncState,isOnline:e.payload}};case"SET_SYNC_SYNCING_STATUS":return console.log("⏳ [SYNC STATE] Setting syncing status:",e.payload),{...t,syncState:{...t.syncState,isSyncing:e.payload}};case"UPDATE_LAST_SYNC_TIMESTAMP":return console.log("🕐 [SYNC STATE] Updating last sync timestamp:",new Date(e.payload)),{...t,syncState:{...t.syncState,lastSyncTimestamp:e.payload}};case"SET_SYNC_PENDING_CHANGES":return console.log("📝 [SYNC STATE] Setting pending changes:",e.payload.length),{...t,syncState:{...t.syncState,pendingChanges:e.payload}};case"SET_SYNC_ERROR":return console.log("❌ [SYNC STATE] Setting error:",e.payload),{...t,lastError:e.payload};case"RESET_SYNC_STATE":return console.log("🔄 [SYNC STATE] Resetting sync state"),xo;default:return t}}const gm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},ym=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},mm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Sm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},wm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},vm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},_m=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Em=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},bm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Im=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Tm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Cm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Rm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Pm=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}},Am=(t,e)=>{const r=ee(t.sync,e);return{...t,sync:r}};function km(t,e){const r=e.get(t.ruleId||""),n=r?r.name:t.name;return{id:t.id,name:t.name,itemName:n,ruleId:t.ruleId||"imported",ruleHash:t.ruleHash||"",isPacked:t.packed,isOverridden:!1,dayIndex:t.dayIndex,personId:t.personId,personName:void 0,notes:t.notes,dayStart:void 0,dayEnd:void 0,isExtra:!1,quantity:t.quantity,categoryId:t.category,subcategoryId:void 0}}let k={trips:[],people:[],items:[],defaultItemRules:[],rulePacks:[],userPeople:[]};const re={trips:new Set,people:new Set,items:new Set,defaultItemRules:new Set,rulePacks:new Set,userPeople:new Set},Dm=t=>{if(!(k.trips.length>0||k.people.length>0||k.items.length>0||k.defaultItemRules.length>0||k.rulePacks.length>0||k.userPeople.length>0)){console.log("📦 [SYNC INTEGRATION] No synced entities to process");return}console.log(`📦 [SYNC INTEGRATION] Processing bulk synced entities: ${k.trips.length} trips, ${k.people.length} people, ${k.items.length} items, ${k.defaultItemRules.length} rules, ${k.rulePacks.length} packs, ${k.userPeople.length} user people`),k.items.length>0&&console.log("📦 [SYNC INTEGRATION] Item IDs being processed:",k.items.map(r=>`${r.name}(${r.id})`).join(", ")),t({type:"BULK_UPSERT_SYNCED_ENTITIES",payload:{trips:k.trips.length>0?[...k.trips]:void 0,people:k.people.length>0?[...k.people]:void 0,items:k.items.length>0?[...k.items]:void 0,defaultItemRules:k.defaultItemRules.length>0?[...k.defaultItemRules]:void 0,rulePacks:k.rulePacks.length>0?[...k.rulePacks]:void 0,userPeople:k.userPeople.length>0?[...k.userPeople]:void 0}}),k.trips=[],k.people=[],k.items=[],k.defaultItemRules=[],k.rulePacks=[],k.userPeople=[],re.trips.clear(),re.people.clear(),re.items.clear(),re.defaultItemRules.clear(),re.rulePacks.clear(),re.userPeople.clear()},le=t=>({onTripUpsert:e=>{if(re.trips.has(e.id)){console.warn(`⚠️ [SYNC INTEGRATION] Duplicate trip detected, skipping: ${e.title} (${e.id}) - queue size: ${k.trips.length}`);return}console.log(`🚀 [SYNC INTEGRATION] Queueing trip: ${e.title} (${e.id}) - queue size: ${k.trips.length+1}`),re.trips.add(e.id),k.trips.push(e)},onPersonUpsert:e=>{if(re.people.has(e.id)){console.warn(`⚠️ [SYNC INTEGRATION] Duplicate person detected, skipping: ${e.name} (${e.id}) - queue size: ${k.people.length}`);return}console.log(`👤 [SYNC INTEGRATION] Queueing person: ${e.name} (${e.id}) - queue size: ${k.people.length+1}`),re.people.add(e.id),k.people.push(e)},onItemUpsert:e=>{if(Et.saveItem(e).catch(r=>{console.error(`🚨 [SYNC INTEGRATION] Failed to save item ${e.id}:`,r)}),re.items.has(e.id)){console.warn(`⚠️ [SYNC INTEGRATION] Duplicate item detected, skipping: ${e.name} (${e.id}) - queue size: ${k.items.length}`);return}console.log(`📦 [SYNC INTEGRATION] Queueing item: ${e.name} (${e.id}) - queue size: ${k.items.length+1}`),re.items.add(e.id),k.items.push(e)},onDefaultItemRuleUpsert:e=>{console.log(`📋 [SYNC INTEGRATION] Queueing default item rule: ${e.rule.name} (${e.rule.id}) for trip ${e.tripId}`),k.defaultItemRules.push(e)},onRulePackUpsert:e=>{console.log(`📦 [SYNC INTEGRATION] Queueing rule pack: ${e.name} (${e.id})`),k.rulePacks.push(e)},onUserPersonUpsert:e=>{if(Fe.saveUserPerson(e).catch(r=>{console.error(`🚨 [SYNC INTEGRATION] Failed to save user person ${e.id}:`,r)}),re.userPeople.has(e.id)){console.warn(`⚠️ [SYNC INTEGRATION] Duplicate user person detected, skipping: ${e.name} (${e.id}) - queue size: ${k.userPeople.length}`);return}console.log(`👤 [SYNC INTEGRATION] Queueing user person: ${e.name} (${e.id}) - queue size: ${k.userPeople.length+1}`),re.userPeople.add(e.id),k.userPeople.push(e)},onTripRuleUpsert:e=>{console.log(`🔗 [SYNC INTEGRATION] Associating rule ${e.ruleId} with trip ${e.tripId}`),st.saveTripRule(e).then(()=>(console.log(`💾 [SYNC INTEGRATION] Saved TripRule association: ${e.id}`),je.getDefaultItemRule(e.ruleId))).then(r=>{r?Om(t,{rule:r,tripId:e.tripId}):console.warn(`[SYNC INTEGRATION] Rule ${e.ruleId} not found for trip association`)}).catch(console.error)}}),Om=(t,e)=>{const{rule:r,tripId:n}=e;console.log(`📋 [SYNC INTEGRATION] Queueing synced rule for trip: ${r.name} (${r.id}) -> ${n}`),k.defaultItemRules.push({rule:r,tripId:n}),console.log("📋 [SYNC INTEGRATION] Rule queued, waiting for batch processing")};function xm(t,e,r){const n=e.map(o=>km(o,r)),s=new Set(n),i=t.map(o=>{let a=n.find(l=>l.ruleId===o.ruleId&&l.ruleHash===o.ruleHash&&l.dayIndex===o.dayIndex&&l.personId===o.personId);return a||(a=n.find(l=>l.itemName===o.itemName&&l.dayIndex===o.dayIndex&&l.personId===o.personId&&l.quantity===o.quantity)),a?(s.delete(a),console.log(`🔄 [SYNC] Preserved packed status for ${o.itemName}: ${a.isPacked}`),{...o,isPacked:a.isPacked}):o});return s.size>0&&console.warn(`🔄 [SYNC] No matching synced item found for ${s.size} items`,...s.values()),i}const jl=(t,e)=>{const{tripId:r,items:n}=e.payload;console.log(`📦 [SYNC REDUCER] Processing ${n.length} synced items for trip ${r}`);const s=t.trips.byId[r];if(!s)return console.warn(`⚠️ [SYNC REDUCER] Trip not found for synced items: ${r}`),t;const i={...t,trips:{...t.trips,selectedTripId:r}},o=Re(i),l=ne(o).trips.byId[r];if(!l)return console.error(`❌ [SYNC REDUCER] Failed to recalculate trip data for ${r}`),t;const c=new Map(s.trip.defaultItemRules.map(d=>[d.id,d])),u=xm(l.calculated.packingListItems,n,c);return console.log(`✅ [SYNC REDUCER] Processed ${n.length} synced items for trip ${r}, preserved ${u.filter(d=>d.isPacked).length} packed items`),{...t,trips:{...t.trips,selectedTripId:t.trips.selectedTripId,byId:{...t.trips.byId,[r]:{...l,calculated:{...l.calculated,packingListItems:u}}}}}},$m=(t,e)=>{const{trips:r,people:n,items:s,defaultItemRules:i,rulePacks:o,userPeople:a}=e.payload;console.log(`📦 [SYNC REDUCER] Bulk upserting entities: ${r?.length||0} trips, ${n?.length||0} people, ${s?.length||0} items, ${i?.length||0} rules, ${o?.length||0} packs, ${a?.length||0} user people`);let l=t;if(r&&r.length>0)for(const c of r){console.log(`🔄 [SYNC REDUCER] Upserting trip: ${c.title} (${c.id})`);const u=l.trips.summaries.findIndex(y=>y.tripId===c.id),d=[...l.trips.summaries];u>=0?(d[u]={...d[u],title:c.title,description:c.description,updatedAt:c.updatedAt},console.log(`📝 [SYNC REDUCER] Updated existing trip summary: ${c.id}`)):(d.push({tripId:c.id,title:c.title,description:c.description,createdAt:c.createdAt,updatedAt:c.updatedAt,totalItems:0,packedItems:0,totalPeople:0}),console.log(`➕ [SYNC REDUCER] Added new trip summary: ${c.id}`));const f=l.trips.byId[c.id];let h;f?(h={...f,trip:{...f.trip,...c,id:c.id},lastSynced:c.lastSyncedAt},console.log(`🔄 [SYNC REDUCER] Merged existing trip data: ${c.id}`)):(h={...Qs(c.id),trip:c,lastSynced:c.lastSyncedAt},console.log(`🆕 [SYNC REDUCER] Created new trip data: ${c.id}`)),l={...l,trips:{...l.trips,summaries:d,byId:{...l.trips.byId,[c.id]:h}}}}if(o&&o.length>0)for(const c of o){const u=l.rulePacks.findIndex(f=>f.id===c.id),d=[...l.rulePacks];u>=0?d[u]=c:d.push(c),l={...l,rulePacks:d}}if(a&&a.length>0)for(const c of a)console.log(`👤 [SYNC REDUCER] Processing user person: ${c.name} (${c.id}) for user ${c.userId}`,c);if(i&&i.length>0){const c=new Map;for(const{rule:u,tripId:d}of i){console.log(`📋 [SYNC REDUCER] Upserting default item rule: ${u.name} (${u.id}) for trip ${d}`);const f=l.trips.byId[d];if(!f){console.warn(`⚠️ [SYNC REDUCER] Trip not found for default item rule: ${d}`);continue}const h=f.trip.defaultItemRules.findIndex(_=>_.id===u.id),y=[...f.trip.defaultItemRules];h>=0?(y[h]=u,console.log(`🔄 [SYNC REDUCER] Updated existing rule in trip ${d}: ${u.id}`)):(y.push(u),console.log(`➕ [SYNC REDUCER] Added new rule to trip ${d}: ${u.id}`)),l={...l,trips:{...l.trips,byId:{...l.trips.byId,[d]:{...f,trip:{...f.trip,defaultItemRules:y}}}}};const E=c.get(d)||[];E.push(u),c.set(d,E)}for(const[u,d]of c){console.log(`🔄 [SYNC REDUCER] Recalculating items for trip ${u} after ${d.length} rule updates`);const f={...l,trips:{...l.trips,selectedTripId:u}},h=Re(f),y=ne(h);l={...l,trips:{...l.trips,selectedTripId:l.trips.selectedTripId,byId:{...l.trips.byId,[u]:y.trips.byId[u]}}}}}if(n&&n.length>0)for(const c of n){console.log(`👤 [SYNC REDUCER] Upserting person: ${c.name} (${c.id})`);const u=l.trips.byId[c.tripId];if(!u){console.warn(`⚠️ [SYNC REDUCER] Trip not found for person: ${c.tripId}`);continue}const d=u.people.findIndex(h=>h.id===c.id),f=[...u.people];d>=0?(f[d]=c,console.log(`🔄 [SYNC REDUCER] Updated existing person: ${c.id}`)):(f.push(c),console.log(`➕ [SYNC REDUCER] Added new person: ${c.id}`)),l={...l,trips:{...l.trips,byId:{...l.trips.byId,[c.tripId]:{...u,people:f}}}}}if(s&&s.length>0){const c=new Map;for(const u of s){c.has(u.tripId)||c.set(u.tripId,[]);const d=c.get(u.tripId);d&&d.push(u)}console.trace(),console.log("itemsByTrip",c.entries());for(const[u,d]of c)l=jl(l,{payload:{tripId:u,items:d}})}return console.log("✅ [SYNC REDUCER] Bulk upsert completed successfully"),l};function Um(t,e){return console.log("📖 [LOAD_USER_PREFERENCES] Loading preferences:",e.payload),{...t,userPreferences:e.payload}}function Lm(t,e){console.log("✏️ [UPDATE_USER_PREFERENCES] Updating preferences:",e.payload);const n={...t.userPreferences||{defaultTimeZone:"UTC",theme:"system",defaultTripDuration:7,autoSyncEnabled:!0,serviceWorkerEnabled:!1,lastSelectedTripId:null},...e.payload};return{...t,userPreferences:n}}function Nm(t,e){const{tripId:r}=e.payload;console.log("🎯 [UPDATE_LAST_SELECTED_TRIP_ID] Updating lastSelectedTripId:",r);const s={...t.userPreferences||{defaultTimeZone:"UTC",theme:"system",defaultTripDuration:7,autoSyncEnabled:!0,serviceWorkerEnabled:!1,lastSelectedTripId:null},lastSelectedTripId:r};return{...t,userPreferences:s}}function jm(t,e){return console.log("🔄 [SYNC_USER_PREFERENCES] Syncing preferences from server:",e.payload),{...t,userPreferences:e.payload}}function xt(t){return t==="local-shared-user"||t==="local-user"||t.startsWith("local")}const _s={trip:[],person:[],item:[],default_item_rule:[],trip_rule:[],rule_pack:[],user_person:[],user_preferences:[]};let It=null;const Fm=1e3,Mm=["user_preferences","user_person","trip","person","item","default_item_rule","trip_rule","rule_pack"];async function Bm(){console.log("📦 [SYNC] Processing all batches in dependency order"),It&&(clearTimeout(It),It=null);for(const t of Mm){const e=_s[t];if(e.length!==0){console.log(`📦 [SYNC] Processing batch of ${e.length} ${t} changes`),_s[t]=[];try{const r=e.filter(i=>i.change.operation==="create"),n=e.filter(i=>i.change.operation==="update"),s=e.filter(i=>i.change.operation==="delete");r.length>0&&await zn(t,"create",r),n.length>0&&await zn(t,"update",n),s.length>0&&await zn(t,"delete",s),e.forEach(i=>i.resolve()),console.log(`✅ [SYNC] Successfully processed batch of ${e.length} ${t} changes`)}catch(r){console.error(`❌ [SYNC] Failed to process batch of ${t} changes:`,r);const n=r instanceof Error?r:new Error(`Batch processing failed for ${t}`);e.forEach(s=>s.reject(n))}}}console.log("✅ [SYNC] All batches processed in correct order")}async function zn(t,e,r){switch(t){case"trip":await Wm(r.map(n=>n.change),e);break;case"person":await Vm(r.map(n=>n.change),e);break;case"item":await Ym(r.map(n=>n.change),e);break;case"default_item_rule":await qm(r.map(n=>n.change),e);break;case"trip_rule":await Gm(r.map(n=>n.change),e);break;case"rule_pack":console.log(`🔄 [SYNC] Skipping rule pack batch sync (local only): ${r.length} changes`);break;case"user_person":await Km(r.map(n=>n.change),e);break;case"user_preferences":await Jm(r.map(n=>n.change),e);break;default:console.warn(`🔄 [SYNC] Unknown entity type for batch: ${t}`)}}function mt(t,e){const r=["updatedAt","updated_at","createdAt","created_at","lastModified","last_modified","timestamp","version"],n={...t},s={...e};r.forEach(o=>{delete n[o],delete s[o]}),"isDeleted"in s&&!s.isDeleted&&(!("isDeleted"in n)||!n.isDeleted)&&(delete s.isDeleted,delete n.isDeleted);const i=Ma(n,s);return i.length===0?(console.log("✅ [SYNC] Timestamp-only conflict detected - auto-resolving with server timestamp",{localUpdatedAt:t.updatedAt,serverUpdatedAt:e.updatedAt,entityType:"id"in t&&t.id?"entity":"unknown",entityId:"id"in t?t.id:void 0}),e):(console.log("❌ [SYNC] Real data conflict detected - requires manual resolution",{entityId:"id"in t?t.id:void 0,localUpdatedAt:t.updatedAt,serverUpdatedAt:e.updatedAt,localFiltered:n,serverFiltered:s},i),"conflictDetails"in e&&(e.conflictDetails={conflicts:i}),null)}const Fl=zs("sync/syncFromServer",async(t,{dispatch:e})=>{if(console.log("🔄 [SYNC] Starting comprehensive sync from server..."),!pn()||xt(t.userId)){console.log("🔄 [SYNC] Skipping sync - offline mode or local user");return}try{e(Es(!0));const{trips:r,people:n,items:s,rules:i,tripRules:o,userPeople:a,userPreferences:l}=await e(zm(t)).unwrap();return e(Hl(Date.now())),console.log("✅ [SYNC] Comprehensive sync completed successfully"),{trips:r,people:n,items:s,rules:i,tripRules:o,userPeople:a,userPreferences:l}}catch(r){throw console.error("❌ [SYNC] Comprehensive sync failed:",r),e(Wl(r instanceof Error?r.message:"Sync failed")),r}finally{e(Es(!1))}}),zm=zs("sync/pullAllData",async(t,{dispatch:e,rejectWithValue:r})=>{if(console.log("🔄 [SYNC] Pulling all data from server in single query..."),!pn()||xt(t.userId))return console.log("🔄 [SYNC] Skipping pull - offline mode or local user"),{trips:[],people:[],items:[],rules:[],tripRules:[],userPeople:[],userPreferences:null,conflicts:[]};const n=t.since||new Date(0).toISOString(),{data:s,error:i}=await J.from("user_profiles").select("preferences, updated_at").eq("id",t.userId).maybeSingle();if(i&&i.code!=="PGRST116")return console.error("❌ [SYNC] Error pulling user preferences:",i),r(i);const{data:o,error:a}=await J.from("user_people").select("*").eq("user_id",t.userId).gt("updated_at",n).eq("is_deleted",!1).order("updated_at",{ascending:!0});if(a)return console.error("❌ [SYNC] Error pulling user profiles:",a),r(a);const{data:l,error:c}=await J.from("trips").select(`
        *,
        trip_people(*),
        trip_items(*),
        trip_default_item_rules(
          *,
          default_item_rules(*)
        )
      `).eq("user_id",t.userId).gt("updated_at",n).eq("is_deleted",!1).eq("trip_people.is_deleted",!1).eq("trip_items.is_deleted",!1).eq("trip_default_item_rules.is_deleted",!1).eq("trip_default_item_rules.default_item_rules.is_deleted",!1).order("updated_at",{ascending:!0});if(c)return console.error("❌ [SYNC] Error pulling comprehensive data:",c),r(c);console.log(`✅ [SYNC] Pulled ${l?.length||0} trips with relations and ${o?.length||0} user profiles from server`);const u=[],d=[],f=[],h=[],y=[],E=[],_=[];let I=null;for(const p of o||[]){let m;"birth_date"in p&&p.birth_date?m=p.birth_date:"age"in p&&typeof p.age=="number"&&(m=Wy(p.age));const w={id:p.id,userId:p.user_id,name:p.name,birthDate:m,gender:p.gender||void 0,settings:p.settings||void 0,isUserProfile:p.is_user_profile??!0,createdAt:p.created_at||new Date().toISOString(),updatedAt:p.updated_at||new Date().toISOString(),version:p.version||1,isDeleted:p.is_deleted||!1,autoAddToNewTrips:p.auto_add_to_new_trips??!1},S=await Fe.getUserPersonById(p.id);if(S&&S.updatedAt!==w.updatedAt){const v=mt(S,w);if(v){await Fe.saveUserPerson(v),_.push(v);const C=le(e);C.onUserPersonUpsert&&C.onUserPersonUpsert(v)}else u.push({id:`user-person-${p.id}-${Date.now()}`,entityType:"user_person",entityId:p.id,localVersion:S,serverVersion:w,conflictType:"update_conflict",timestamp:Date.now()})}else{await Fe.saveUserPerson(w),_.push(w);const v=le(e);v.onUserPersonUpsert&&v.onUserPersonUpsert(w)}}if(s?.preferences){const p=s.preferences;console.log("✅ [SYNC] Processing user preferences from server:",p),await bt.getPreferences()?(console.log("🔄 [SYNC] Server preferences override local (last-write-wins)"),await bt.savePreferences(p),I=p,e({type:"SYNC_USER_PREFERENCES",payload:p})):(console.log("🔄 [SYNC] No local preferences, saving server version"),await bt.savePreferences(p),I=p,e({type:"SYNC_USER_PREFERENCES",payload:p}))}else console.log("📋 [SYNC] No user preferences found on server");const b=new Map;for(const p of l||[]){const m={id:p.id,userId:p.user_id,title:p.title,description:p.description||"",days:p.days||[],tripEvents:p.trip_events||[],createdAt:p.created_at||new Date().toISOString(),updatedAt:p.updated_at||new Date().toISOString(),settings:p.settings||{defaultTimeZone:"UTC",packingViewMode:"by-day"},version:p.version||1,isDeleted:p.is_deleted||!1,defaultItemRules:[]},w=await rt.getTrip(p.id);if(w&&w.updatedAt!==m.updatedAt){const S=mt(w,m);S?(await rt.saveTrip(S),d.push(S),le(e).onTripUpsert(S)):u.push({id:`trip-${p.id}-${Date.now()}`,entityType:"trip",entityId:p.id,localVersion:w,serverVersion:m,conflictType:"update_conflict",timestamp:Date.now()})}else await rt.saveTrip(m),d.push(m),le(e).onTripUpsert(m);if(p.trip_people)for(const S of p.trip_people){const v={id:S.id,tripId:S.trip_id,name:S.name,age:S.age||void 0,gender:S.gender||void 0,settings:S.settings||void 0,userPersonId:S.user_person_id||void 0,createdAt:S.created_at||new Date().toISOString(),updatedAt:S.updated_at||new Date().toISOString(),version:S.version||1,isDeleted:S.is_deleted||!1},x=(await nt.getTripPeople(S.trip_id)).find(P=>P.id===S.id);if(x&&x.updatedAt!==v.updatedAt){const P=mt(x,v);P?(await nt.savePerson(P),f.push(P),le(e).onPersonUpsert(P)):u.push({id:`person-${S.id}-${Date.now()}`,entityType:"person",entityId:S.id,localVersion:x,serverVersion:v,conflictType:"update_conflict",timestamp:Date.now()})}else await nt.savePerson(v),f.push(v),le(e).onPersonUpsert(v)}if(p.trip_items)for(const S of p.trip_items){const v={id:S.id,tripId:S.trip_id,name:S.name,category:S.category||void 0,quantity:S.quantity||1,notes:S.notes||void 0,personId:S.person_id!==null?S.person_id:void 0,dayIndex:S.day_index!==null&&S.day_index!==void 0?S.day_index:void 0,ruleId:S.rule_id||void 0,ruleHash:S.rule_hash||void 0,packed:S.packed||!1,createdAt:S.created_at||new Date().toISOString(),updatedAt:S.updated_at||new Date().toISOString(),version:S.version||1,isDeleted:S.is_deleted||!1},x=(await Et.getTripItems(S.trip_id)).find(P=>P.id===S.id);if(x&&x.updatedAt!==v.updatedAt){const P=mt(x,v);P?(await Et.saveItem(P),h.push(P),le(e).onItemUpsert(P)):u.push({id:`item-${S.id}-${Date.now()}`,entityType:"item",entityId:S.id,localVersion:x,serverVersion:v,conflictType:"update_conflict",timestamp:Date.now()})}else await Et.saveItem(v),h.push(v),le(e).onItemUpsert(v)}if(p.trip_default_item_rules)for(const S of p.trip_default_item_rules){const v={id:`${S.trip_id}-${S.rule_id}`,tripId:S.trip_id,ruleId:S.rule_id,createdAt:S.created_at||new Date().toISOString(),updatedAt:S.updated_at||new Date().toISOString(),version:S.version||1,isDeleted:S.is_deleted||!1},x=(await st.getTripRules(S.trip_id)).find(P=>P.ruleId===S.rule_id);if(x&&x.updatedAt!==v.updatedAt){const P=mt(x,v);P?(await st.saveTripRule(P),E.push(P),le(e).onTripRuleUpsert(P)):u.push({id:`trip-rule-${S.trip_id}-${S.rule_id}-${Date.now()}`,entityType:"trip_rule",entityId:`${S.trip_id}-${S.rule_id}`,localVersion:x,serverVersion:v,conflictType:"update_conflict",timestamp:Date.now()})}else await st.saveTripRule(v),E.push(v),le(e).onTripRuleUpsert(v);if(S.default_item_rules&&!b.has(S.default_item_rules.id)){const P=S.default_item_rules,F={id:P.id,originalRuleId:P.original_rule_id||P.id,name:P.name,calculation:P.calculation,conditions:P.conditions||void 0,notes:P.notes||void 0,categoryId:P.category_id||void 0,subcategoryId:P.subcategory_id||void 0,packIds:P.pack_ids||void 0,updatedAt:P.updated_at||new Date().toISOString(),createdAt:P.created_at||new Date().toISOString(),version:P.version||1,isDeleted:P.is_deleted||!1},we=await je.getDefaultItemRule(P.id);if(we&&we.updatedAt!==F.updatedAt){const Ye=mt(we,F);Ye?(await je.saveDefaultItemRule(Ye),b.set(P.id,Ye),y.push(Ye),le(e).onDefaultItemRuleUpsert({rule:Ye,tripId:S.trip_id})):u.push({id:`rule-${P.id}-${Date.now()}`,entityType:"default_item_rule",entityId:P.id,localVersion:we,serverVersion:F,conflictType:"update_conflict",timestamp:Date.now()})}else await je.saveDefaultItemRule(F),b.set(P.id,F),y.push(F),le(e).onDefaultItemRuleUpsert({rule:F,tripId:S.trip_id})}}}return u.length>0&&e(Bl(u)),console.log(`✅ [SYNC] Processed comprehensive data: ${d.length} trips, ${f.length} people, ${h.length} items, ${y.length} rules, ${E.length} trip rules, ${_.length} user people, ${I?"user preferences":"no user preferences"}`),{trips:d,people:f,items:h,rules:y,tripRules:E,userPeople:_,userPreferences:I,conflicts:u}}),Hm=async t=>{if(!pn()||xt(t.userId)){console.log("🔄 [SYNC] Skipping push - offline mode or local user");return}const{data:{user:e},error:r}=await J.auth.getUser();if(!e||r){console.log("🔄 [SYNC] Skipping server push - no authenticated session:",{hasUser:!!e,authError:r?.message});return}return console.log(`🔄 [SYNC] Batching change: ${t.operation} ${t.entityType}:${t.entityId}`),new Promise((n,s)=>{const i=t.entityType;_s[i].push({change:t,resolve:n,reject:s}),It&&clearTimeout(It),It=setTimeout(()=>{Bm().catch(o=>{console.error("❌ [SYNC] Global batch processing failed:",o)})},Fm)})};async function Wm(t,e){if(t.length!==0)if(console.log(`📦 [SYNC] Pushing ${t.length} trip ${e} changes`),e==="delete"){const r=t.map(s=>s.entityId),{error:n}=await J.from("trips").update({is_deleted:!0,updated_at:new Date().toISOString()}).in("id",r);if(n)throw new Error(`Failed to batch delete trips: ${n.message}`)}else{const r=t.map(s=>{const i=s.data;return{id:i.id,user_id:i.userId,title:i.title,description:i.description,days:i.days,trip_events:i.tripEvents,settings:i.settings,version:i.version,is_deleted:i.isDeleted||!1,created_at:i.createdAt,updated_at:i.updatedAt}}),{error:n}=await J.from("trips").upsert(r);if(n)throw new Error(`Failed to batch upsert trips: ${n.message}`)}}async function Vm(t,e){if(t.length!==0)if(console.log(`📦 [SYNC] Pushing ${t.length} person ${e} changes`),e==="delete"){const r=t.map(s=>s.entityId),{error:n}=await J.from("trip_people").update({is_deleted:!0,updated_at:new Date().toISOString()}).in("id",r);if(n)throw new Error(`Failed to batch delete people: ${n.message}`)}else{const r=t.map(s=>{const i=s.data;return{id:i.id,trip_id:i.tripId,name:i.name,age:i.age,gender:i.gender,settings:i.settings,user_person_id:i.userPersonId||null,version:i.version,is_deleted:i.isDeleted||!1,created_at:i.createdAt,updated_at:i.updatedAt}}),{error:n}=await J.from("trip_people").upsert(r);if(n)throw new Error(`Failed to batch upsert people: ${n.message}`)}}async function Ym(t,e){if(t.length!==0)if(console.log(`📦 [SYNC] Pushing ${t.length} item ${e} changes`),e==="delete"){const r=t.map(s=>s.entityId),{error:n}=await J.from("trip_items").update({is_deleted:!0,updated_at:new Date().toISOString()}).in("id",r);if(n)throw new Error(`Failed to batch delete items: ${n.message}`)}else{const r=t.map(s=>{const i=s.data,o=i.tripId||s.tripId;if(!o)throw new Error(`No tripId available for item ${i.id}`);return{id:i.id,trip_id:o,name:i.name,category:i.category,quantity:i.quantity,notes:i.notes,person_id:i.personId!==void 0?i.personId:null,day_index:i.dayIndex!==void 0?i.dayIndex:null,rule_id:i.ruleId,rule_hash:i.ruleHash,packed:i.packed,version:i.version,is_deleted:i.isDeleted||!1,created_at:i.createdAt,updated_at:i.updatedAt}}),{error:n}=await J.from("trip_items").upsert(r);if(n)throw new Error(`Failed to batch upsert items: ${n.message}`)}}async function qm(t,e){if(t.length!==0)if(console.log(`📦 [SYNC] Pushing ${t.length} default item rule ${e} changes`),e==="delete"){const r=t.map(s=>s.entityId),{error:n}=await J.from("default_item_rules").update({is_deleted:!0,updated_at:new Date().toISOString()}).in("id",r);if(n)throw new Error(`Failed to batch delete default item rules: ${n.message}`)}else{const r=t.map(s=>{const i=s.data;return{id:i.id,rule_id:i.id,original_rule_id:i.originalRuleId,name:i.name,calculation:i.calculation,conditions:i.conditions,notes:i.notes,category_id:i.categoryId,subcategory_id:i.subcategoryId,pack_ids:i.packIds,user_id:s.userId,version:1,is_deleted:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}),{error:n}=await J.from("default_item_rules").upsert(r);if(n)throw new Error(`Failed to batch upsert default item rules: ${n.message}`)}}async function Gm(t,e){if(t.length!==0)if(console.log(`📦 [SYNC] Pushing ${t.length} trip rule ${e} changes`),e==="delete"){const r=t.map(i=>{const o=i.data;return J.from("trip_default_item_rules").update({is_deleted:!0,updated_at:new Date().toISOString()}).eq("trip_id",o.tripId).eq("rule_id",o.ruleId)}),s=(await Promise.all(r)).filter(i=>i.error);if(s.length>0)throw new Error(`Failed to batch delete trip rules: ${s.map(i=>i.error?.message).join(", ")}`)}else{const r=t.map(s=>{const i=s.data;return{trip_id:i.tripId,rule_id:i.ruleId,user_id:s.userId,version:i.version,is_deleted:i.isDeleted||!1,created_at:i.createdAt,updated_at:i.updatedAt}}),{error:n}=await J.from("trip_default_item_rules").upsert(r);if(n)throw new Error(`Failed to batch upsert trip rules: ${n.message}`)}}async function Km(t,e){console.log(`🔄 [SYNC] Processing ${t.length} user person ${e} operations`);for(const r of t){const n=r.data,[s,i]=t.reduce(([o,a],l)=>(l.entityType==="user_person"&&(l.operation==="create"||l.operation==="update"?o.push({name:n.name,user_id:n.userId,birth_date:n.birthDate??null,gender:n.gender??null,settings:n.settings,is_user_profile:n.isUserProfile,version:n.version,created_at:n.createdAt,updated_at:n.updatedAt,id:n.id,is_deleted:n.isDeleted??!1,auto_add_to_new_trips:n.autoAddToNewTrips??!1}):l.operation==="delete"&&a.push(l)),[o,a]),[[],[]]);try{if(e==="create"||e==="update"){const{error:o}=await J.from("user_people").upsert(s);if(o)throw console.error(`❌ [SYNC] Error ${e}ing user person ${n.id}:`,o),o}else if(e==="delete"){const{error:o}=await J.from("user_people").delete().in("id",i.map(a=>a.id));if(o)throw console.error(`❌ [SYNC] Error deleting user person ${n.id}:`,o),o}console.log(`✅ [SYNC] Successfully ${e}d user person: ${n.name}`)}catch(o){throw console.error(`❌ [SYNC] Failed to ${e} user person ${n.id}:`,o),o}}}async function Jm(t,e){if(t.length!==0){console.log(`🔄 [SYNC] Processing ${t.length} user preferences ${e} operations`);for(const r of t){const n=r.data;try{if(e==="create"||e==="update"){const{error:s}=await J.from("user_profiles").upsert({id:r.userId,preferences:n,updated_at:new Date().toISOString()},{onConflict:"id"});if(s)throw console.error(`❌ [SYNC] Error ${e}ing user preferences for ${r.userId}:`,s),s;console.log(`✅ [SYNC] Successfully ${e}d user preferences for user: ${r.userId}`)}else if(e==="delete"){const{error:s}=await J.from("user_profiles").update({preferences:null,updated_at:new Date().toISOString()}).eq("id",r.userId);if(s)throw console.error(`❌ [SYNC] Error deleting user preferences for ${r.userId}:`,s),s;console.log(`✅ [SYNC] Successfully cleared user preferences for user: ${r.userId}`)}}catch(s){throw console.error(`❌ [SYNC] Failed to ${e} user preferences for ${r.userId}:`,s),s}}}}const Qm=t=>({type:"SET_SYNC_STATE",payload:t}),Zm=t=>({type:"SET_SYNC_INITIALIZED",payload:t}),Xm=t=>({type:"ADD_SYNC_CONFLICT",payload:t}),Ml=t=>({type:"REMOVE_SYNC_CONFLICT",payload:t}),eS=()=>({type:"CLEAR_SYNC_CONFLICTS"}),Bl=t=>({type:"SET_SYNC_CONFLICTS",payload:t}),zl=t=>({type:"SET_SYNC_ONLINE_STATUS",payload:t}),Es=t=>({type:"SET_SYNC_SYNCING_STATUS",payload:t}),Hl=t=>({type:"UPDATE_LAST_SYNC_TIMESTAMP",payload:t}),tS=t=>({type:"SET_SYNC_PENDING_CHANGES",payload:t}),Wl=t=>({type:"SET_SYNC_ERROR",payload:t}),rS=()=>({type:"RESET_SYNC_STATE"}),nS=t=>({type:"MERGE_SYNCED_TRIP",payload:t}),sS=t=>({type:"MERGE_SYNCED_ITEM",payload:t}),wE=zs("sync/resolveConflict",async(t,{dispatch:e})=>{const{conflictId:r,strategy:n,manualData:s,conflict:i}=t;console.log(`🔧 [RESOLVE_CONFLICT] Resolving conflict ${r} with strategy: ${n}`);try{let o;switch(n){case"local":o=i.localVersion;break;case"server":o=i.serverVersion;break;case"manual":o=s||i.serverVersion;break;default:throw new Error(`Unknown resolution strategy: ${n}`)}switch(console.log(`🔧 [RESOLVE_CONFLICT] Applying ${n} data for ${i.entityType}:${i.entityId}`),i.entityType){case"trip":{const a=o;await rt.saveTrip(a),n!=="local"&&e(nS(a)),console.log(`✅ [RESOLVE_CONFLICT] Applied trip data to IndexedDB${n!=="local"?" and Redux":""}`);break}case"person":{const a=o;await nt.savePerson(a),e({type:"UPDATE_PERSON",payload:a}),console.log("✅ [RESOLVE_CONFLICT] Applied person data to IndexedDB and Redux");break}case"item":{const a=o;await Et.saveItem(a),n!=="local"&&e(sS(a)),console.log(`✅ [RESOLVE_CONFLICT] Applied item data to IndexedDB${n!=="local"?" and Redux":""}`);break}case"default_item_rule":{const a=o;await je.saveDefaultItemRule(a),console.log("✅ [RESOLVE_CONFLICT] Applied rule data to IndexedDB");break}case"trip_rule":{const a=o;await st.saveTripRule(a),console.log("✅ [RESOLVE_CONFLICT] Applied trip rule data to IndexedDB");break}case"user_person":{const a=o;await Fe.saveUserPerson(a),e(Qy(a)),console.log("✅ [RESOLVE_CONFLICT] Applied user person data to IndexedDB and Redux");break}case"user_preferences":{const a=o;await bt.savePreferences(a),e({type:"SYNC_USER_PREFERENCES",payload:a}),console.log("✅ [RESOLVE_CONFLICT] Applied user preferences data to IndexedDB and Redux");break}default:console.warn(`🔧 [RESOLVE_CONFLICT] Unknown entity type: ${i.entityType}`)}return e(Ml(r)),console.log(`✅ [RESOLVE_CONFLICT] Successfully resolved conflict ${r} using ${n} strategy`),{conflictId:r,strategy:n,applied:!0}}catch(o){throw console.error(`❌ [RESOLVE_CONFLICT] Failed to resolve conflict ${r}:`,o),o}}),$o={ADD_PERSON:Vg,REMOVE_PERSON:Yg,UPDATE_PERSON:qg,CREATE_PERSON_FROM_PROFILE:vs,CALCULATE_DEFAULT_ITEMS:Re,UPDATE_TRIP_EVENTS:Kg,CALCULATE_DAYS:Gg,CREATE_ITEM_RULE:Qg,UPDATE_ITEM_RULE:Zg,DELETE_ITEM_RULE:Xg,ADD_RULE_OVERRIDE:ey,UPDATE_PACKING_LIST_VIEW:ty,CALCULATE_PACKING_LIST:ne,TOGGLE_ITEM_PACKED:ry,LOAD_DEMO_DATA:oy,CLEAR_DEMO_DATA:Cy,CLEAR_TRIP_DATA:ky,CLEAR_ALL_DATA:t=>(console.log("🧹 [CLEAR_ALL_DATA] Clearing all data except auth"),{...Kr,auth:t.auth}),TOGGLE_RULE_PACK:Dy,CREATE_RULE_PACK:Oy,UPDATE_RULE_PACK:xy,DELETE_RULE_PACK:$y,OPEN_RULE_PACK_MODAL:Uy,CLOSE_RULE_PACK_MODAL:Ly,SET_RULE_PACK_MODAL_TAB:Ny,OPEN_LOGIN_MODAL:jy,CLOSE_LOGIN_MODAL:Fy,CREATE_TRIP:tm,SELECT_TRIP:rm,DELETE_TRIP:nm,UPDATE_TRIP_SUMMARY:sm,INIT_FLOW:im,ADVANCE_FLOW:om,RESET_FLOW:am,SET_WIZARD_STEP:dm,RESET_WIZARD:fm,TRIGGER_CONFETTI_BURST:By,HYDRATE_OFFLINE:zy,SET_SYNC_STATE:gm,SET_SYNC_INITIALIZED:ym,ADD_SYNC_CONFLICT:mm,REMOVE_SYNC_CONFLICT:Sm,CLEAR_SYNC_CONFLICTS:wm,SET_SYNC_CONFLICTS:vm,SET_SYNC_ONLINE_STATUS:_m,SET_SYNC_SYNCING_STATUS:Em,UPDATE_LAST_SYNC_TIMESTAMP:bm,SET_SYNC_PENDING_CHANGES:Im,SET_SYNC_ERROR:Tm,RESET_SYNC_STATE:Cm,MERGE_SYNCED_TRIP:Rm,MERGE_SYNCED_PERSON:Pm,MERGE_SYNCED_ITEM:Am,MERGE_SYNCED_USER_PERSON:t=>t,TRACK_SYNC_CHANGE:t=>t,PROCESS_SYNCED_TRIP_ITEMS:jl,BULK_UPSERT_SYNCED_ENTITIES:$m,SYNC_UPDATE_TRIP_SUMMARIES:(t,e)=>(console.log(`🔄 [SYNC_UPDATE_TRIP_SUMMARIES] Updating ${e.payload.summaries.length} trip summaries from sync`),{...t,trips:{...t.trips,summaries:e.payload.summaries}}),LOAD_USER_PREFERENCES:Um,UPDATE_USER_PREFERENCES:Lm,UPDATE_LAST_SELECTED_TRIP_ID:Nm,SYNC_USER_PREFERENCES:jm},vE={advanceFlow:cm,resetFlow:um,initFlow:lm,setWizardStep:hm,resetWizard:pm,clearDemoData:Ry,triggerConfettiBurst:t=>({type:"TRIGGER_CONFETTI_BURST",payload:t}),addPerson:Wg,createTrip:em,createItemRule:Jg,createPersonFromProfile:Ky,syncFromServer:Fl,setSyncState:Qm,setSyncInitialized:Zm,addSyncConflict:Xm,removeSyncConflict:Ml,clearSyncConflicts:eS,setSyncConflicts:Bl,setSyncOnlineStatus:zl,setSyncSyncingStatus:Es,updateLastSyncTimestamp:Hl,setSyncPendingChanges:tS,setSyncError:Wl,resetSyncState:rS};let Qt=!1,vt=null;async function Ir(t,e){console.log(`🔄 [SYNC_MIDDLEWARE] Starting IndexedDB reload for user: ${e}`);try{const{loadOfflineState:r}=await z(async()=>{const{loadOfflineState:s}=await import("./chunk-Tf_KtQ4i.js");return{loadOfflineState:s}},__vite__mapDeps([0,1])),n=await r(e);console.log(`✅ [SYNC_MIDDLEWARE] Successfully loaded offline state for ${Object.keys(n.trips.byId).length} trips and ${n.userPeople?.people?.length||0} user people`),console.log("🔄 [SYNC_MIDDLEWARE] User people loaded:",n.userPeople?.people?.map(s=>({id:s.id,name:s.name,isUserProfile:s.isUserProfile,updatedAt:s.updatedAt}))||[]),console.log("🔄 [SYNC_MIDDLEWARE] Dispatching HYDRATE_OFFLINE action"),t({type:"HYDRATE_OFFLINE",payload:n}),console.log("🔄 [SYNC_MIDDLEWARE] Successfully hydrated Redux state from IndexedDB")}catch(r){console.error("❌ [SYNC_MIDDLEWARE] Failed to reload from IndexedDB:",r)}}async function Hn(t,e){if(xt(e)){console.log("🔄 [SYNC_MIDDLEWARE] Skipping sync for local user");return}if(Qt){console.log(`🔄 [SYNC_MIDDLEWARE] Sync already in progress for user ${vt}, skipping duplicate sync for ${e}`);return}if(vt===e){console.log(`🔄 [SYNC_MIDDLEWARE] Sync already pending for user ${e}, skipping duplicate`);return}try{console.log("🔄 [SYNC_MIDDLEWARE] Starting sync service..."),Qt=!0,vt=e,t(zl(!0));const n=await(await A()).get("syncMetadata","lastSyncTimestamp"),s=n?new Date(n).toISOString():void 0;try{await t(Fl({userId:e,since:s}))}catch{console.error("❌ [SYNC_MIDDLEWARE] Failed to perform sync")}console.log("✅ [SYNC_MIDDLEWARE] Sync service started successfully")}catch(r){console.error("❌ [SYNC_MIDDLEWARE] Failed to start sync service:",r)}finally{Qt=!1,vt=null}}async function Y(t,e){const r=He(),n={...t,id:r,timestamp:Date.now(),synced:!1};console.log(`🔄 [SYNC_MIDDLEWARE] Tracking change: ${t.operation} ${t.entityType}:${t.entityId} for user: ${e}`);try{const s=await A();try{await s.add("syncChanges",n),console.log(`💾 [SYNC_MIDDLEWARE] Stored change in IndexedDB: ${t.entityType}:${t.entityId}`)}catch{console.warn("🔄 [SYNC_MIDDLEWARE] Changes table not available yet")}if(xt(e)){console.log(`🔄 [SYNC_MIDDLEWARE] Skipping server push for local user: ${e}`);try{await s.put("syncChanges",{...n,synced:!0})}catch(i){console.warn("🔄 [SYNC_MIDDLEWARE] Could not mark change as synced",i)}return}await Hm(n);try{await s.put("syncChanges",{...n,synced:!0})}catch(i){console.warn("🔄 [SYNC_MIDDLEWARE] Could not mark change as synced",i)}console.log(`✅ [SYNC_MIDDLEWARE] Successfully pushed change: ${t.entityType}:${t.entityId}`)}catch(s){console.error(`❌ [SYNC_MIDDLEWARE] Failed to handle change: ${t.entityType}:${t.entityId}`,s)}}function iS(t,e,r){const n=t.userPreferences,s=e.userPreferences;!n&&s?(console.log("🔄 [SYNC_MIDDLEWARE] User preferences created"),bt.savePreferences(s),Y({userId:r,entityType:"user_preferences",entityId:r,operation:"create",data:s,version:1},r)):n&&s&&!Ce(n,s)&&(console.log("🔄 [SYNC_MIDDLEWARE] User preferences updated"),bt.savePreferences(s),Y({userId:r,entityType:"user_preferences",entityId:r,operation:"update",data:s,version:1},r))}function oS(t,e,r){const n=t.userPeople?.people||[],s=e.userPeople?.people||[],i=new Map(n.map(a=>[a.id,a])),o=new Map(s.map(a=>[a.id,a]));for(const a of s){const l=i.get(a.id);l?Ce(l,a)||(console.log(`🔄 [SYNC_MIDDLEWARE] User person updated: ${a.name} (${a.isUserProfile?"profile":"template"})`),Fe.saveUserPerson(a),Y({userId:r,entityType:"user_person",entityId:a.id,operation:"update",data:a,version:a.version||1},r)):(console.log(`🔄 [SYNC_MIDDLEWARE] User person created: ${a.name} (${a.isUserProfile?"profile":"template"})`),Fe.saveUserPerson(a),Y({userId:r,entityType:"user_person",entityId:a.id,operation:"create",data:a,version:a.version||1},r))}for(const a of n)o.has(a.id)||(console.log(`🔄 [SYNC_MIDDLEWARE] User person deleted: ${a.name} (${a.isUserProfile?"profile":"template"})`),Fe.deleteUserPersonById(a.id),Y({userId:r,entityType:"user_person",entityId:a.id,operation:"delete",data:{...a,isDeleted:!0},version:a.version||1},r))}const aS=t=>e=>r=>{const n=t.getState(),s=e(r),i=t.getState(),o=i.auth.user?.id;if(!o)return s;if(r.type==="auth/loginSuccess"&&o)return Ir(e,o),Hn(e,o),s;if(r.type==="auth/initializeAuth/fulfilled"&&o!==n.auth.user?.id)return console.log(`🔄 [SYNC_MIDDLEWARE] Auth initialized with user ${o}, reloading from IndexedDB`),Ir(e,o),Hn(e,o),s;if(r.type==="FORCE_RELOAD_USER_PEOPLE"){const d=r.payload?.userId;return d&&(console.log(`🔄 [SYNC_MIDDLEWARE] Force reload requested for user: ${d}`),Ir(e,d)),s}if(r.type==="HYDRATE_OFFLINE")return s;if(oS(n,i,o),iS(n,i,o),n.auth.user?.id!==i.auth.user?.id&&o)return console.log(`🔄 [SYNC_MIDDLEWARE] Detected auth change (${r.type}), scheduling IndexedDB reload and sync service start`),setTimeout(()=>{Ir(t.dispatch,o).then(async()=>{xt(o)?console.log(`🔄 [SYNC_MIDDLEWARE] Skipping sync service for local user: ${o}`):await Hn(t.dispatch,o)}).catch(d=>{console.error("❌ [SYNC_MIDDLEWARE] IndexedDB reload failed:",d)})},100),s;if(r.type==="sync/syncFromServer/fulfilled"){console.log("🔄 [SYNC_MIDDLEWARE] Sync completed, processing pending items");try{Dm(t.dispatch)}catch(d){console.error("❌ [SYNC_MIDDLEWARE] Failed to process pending items:",d)}finally{Qt=!1,vt=null,console.log("🔄 [SYNC_MIDDLEWARE] Sync tracking reset - ready for next sync")}return s}if(r.type==="sync/syncFromServer/rejected")return console.log("❌ [SYNC_MIDDLEWARE] Sync failed, resetting sync tracking"),Qt=!1,vt=null,s;const l=["UPSERT","SELECT_TRIP","HYDRATE_OFFLINE","sync/","PROCESS_SYNCED_TRIP_ITEMS","BULK_UPSERT_SYNCED_ENTITIES"];if(r.type!=="sync/resolveConflict/fulfilled"&&!r.type.includes("MERGE_SYNCED_")&&l.some(d=>r.type.includes(d)))return s;const c=n.trips.selectedTripId,u=i.trips.selectedTripId;if(console.log("🔄 [SYNC_MIDDLEWARE] Tracking changes",{prevTripId:c,nextTripId:u}),!u||o==="local-user")return console.log("No trip selected or local user, skipping sync tracking"),s;try{r.type==="TOGGLE_ITEM_PACKED"?lS(n,i,u,o,r):uS(n,i,c,u,o,r)}catch(d){console.error("🚨 [SYNC_MIDDLEWARE] Error tracking changes:",d)}return s};function lS(t,e,r,n,s){const{itemId:i}=s.payload,o=t.trips.byId[r]?.calculated.packingListItems||[],a=e.trips.byId[r]?.calculated.packingListItems||[],l=o.find(u=>u.id===i),c=a.find(u=>u.id===i);if(!l||!c){console.warn(`🚨 [SYNC_MIDDLEWARE] Could not find item ${i} for packing status change`);return}if(l.isPacked!==c.isPacked){console.log(`🔄 [SYNC_MIDDLEWARE] Packing status changed for item ${i}: ${l.isPacked} -> ${c.isPacked}`),cS(i,r,c,c.isPacked);const u={entityType:"item",entityId:i,operation:"update",userId:n,tripId:r,version:1,data:{id:i,tripId:r,name:c.name,category:c.categoryId,quantity:c.quantity,notes:c.notes,personId:c.personId,dayIndex:c.dayIndex,ruleId:c.ruleId,ruleHash:c.ruleHash,packed:c.isPacked,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,_packingStatusOnly:!0,_previousStatus:l.isPacked}};Y(u,n)}}function cS(t,e,r,n){Et.saveItem({id:t,tripId:e,name:r.name,category:r.categoryId,quantity:r.quantity,notes:r.notes,personId:r.personId,dayIndex:r.dayIndex,ruleId:r.ruleId,ruleHash:r.ruleHash,packed:n,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1}).catch(s=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to update item ${t} in storage:`,s)})}function uS(t,e,r,n,s,i){dS(t,e,r,n,s),fS(t,e,n,s),hS(t,e,n,s),i&&["TOGGLE_RULE_PACK","CREATE_DEFAULT_ITEM_RULE","UPDATE_DEFAULT_ITEM_RULE","DELETE_DEFAULT_ITEM_RULE","APPLY_RULE_PACK","REMOVE_RULE_PACK"].includes(i.type)&&pS(t,e,n,s),i&&["CREATE_RULE_PACK","UPDATE_RULE_PACK","DELETE_RULE_PACK"].includes(i.type)&&gS(t,e,n,s)}function dS(t,e,r,n,s){const i=n?t.trips.byId[n]:null,o=n?e.trips.byId[n]:null;if(!i&&o){console.log(`🔄 [SYNC_MIDDLEWARE] Trip created: ${n}`);const a={id:n??"never",userId:s,title:o.trip.title,description:o.trip.description,days:o.trip.days,tripEvents:o.trip.tripEvents,settings:o.trip.settings,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1,defaultItemRules:[]};rt.saveTrip(a).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save trip ${n}:`,c)}),Y({entityType:"trip",entityId:n??"never",operation:"create",userId:s,version:1,data:a},s)}else if(r===n&&i&&o&&!Ce(i.trip,o.trip)){console.log(`🔄 [SYNC_MIDDLEWARE] Trip updated: ${n}`);const a={id:o.trip.id,userId:s,title:o.trip.title,description:o.trip.description,days:o.trip.days,tripEvents:o.trip.tripEvents,settings:o.trip.settings,createdAt:i.trip.createdAt,updatedAt:new Date().toISOString(),version:(i.trip.version||1)+1,isDeleted:!1,defaultItemRules:[]};rt.saveTrip(a).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save trip ${n}:`,c)});const l={entityType:"trip",entityId:o.trip.id,operation:"update",userId:s,version:a.version,data:a};Y(l,s)}else{const a=Object.keys(t.trips.byId),l=Object.keys(e.trips.byId);if(a.length>l.length){const c=a.find(u=>!l.includes(u));if(c){console.log(`🔄 [SYNC_MIDDLEWARE] Trip deleted: ${c}`),rt.deleteTrip(c).catch(d=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to delete trip ${c}:`,d)});const u={entityType:"trip",entityId:c,operation:"delete",userId:s,version:1,data:{...t.trips.byId[c]?.trip,isDeleted:!0,updatedAt:new Date().toISOString()}};Y(u,s)}}}}function fS(t,e,r,n){const s=r?t.trips.byId[r]?.people||[]:[],i=r?e.trips.byId[r]?.people||[]:[];for(const o of i){const a=s.find(l=>l.id===o.id);if(a){if(!Ce(a,o)){console.log(`🔄 [SYNC_MIDDLEWARE] Person updated: ${o.id}`);const l={...o,updatedAt:new Date().toISOString(),version:(a.version||1)+1};if(nt.savePerson(l).catch(u=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save person ${o.id}:`,u)}),!r)throw new Error("Trip ID is required");const c={entityType:"person",entityId:o.id,operation:"update",userId:n,tripId:r,version:l.version,data:l};Y(c,n)}}else{console.log(`🔄 [SYNC_MIDDLEWARE] Person created: ${o.id}`);const l={...o,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),version:1,isDeleted:!1};if(nt.savePerson(l).catch(u=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save person ${o.id}:`,u)}),!r)throw new Error("Trip ID is required");const c={entityType:"person",entityId:o.id,operation:"create",userId:n,tripId:r,version:1,data:l};Y(c,n)}}for(const o of s)if(!i.find(l=>l.id===o.id)){if(console.log(`🔄 [SYNC_MIDDLEWARE] Person deleted: ${o.id}`),nt.deletePerson(o.id).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to delete person ${o.id}:`,c)}),!r)throw new Error("Trip ID is required");const l={entityType:"person",entityId:o.id,operation:"delete",userId:n,tripId:r,version:(o.version||1)+1,data:{...o,isDeleted:!0,updatedAt:new Date().toISOString()}};Y(l,n)}}function hS(t,e,r,n){const s=r?t.trips.byId[r]?.trip?.defaultItemRules||[]:[],i=r?e.trips.byId[r]?.trip?.defaultItemRules||[]:[];for(const o of i){const a=s.find(l=>l.id===o.id);if(a){if(!Ce(a,o)){if(console.log(`🔄 [SYNC_MIDDLEWARE] Default item rule updated: ${o.id}`),je.saveDefaultItemRule(o).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save rule ${o.id}:`,c)}),!r)throw new Error("Trip ID is required");const l={entityType:"default_item_rule",entityId:o.id,operation:"update",userId:n,tripId:r,version:1,data:o};Y(l,n)}}else{console.log(`🔄 [SYNC_MIDDLEWARE] Default item rule created: ${o.id}`),je.saveDefaultItemRule(o).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save rule ${o.id}:`,c)});const l={entityType:"default_item_rule",entityId:o.id,operation:"create",userId:n,tripId:r??"never",version:1,data:o};Y(l,n)}}for(const o of s)if(!i.find(l=>l.id===o.id)){if(console.log(`🔄 [SYNC_MIDDLEWARE] Default item rule deleted: ${o.id}`),je.deleteDefaultItemRule(o.id).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to delete rule ${o.id}:`,c)}),!r)throw new Error("Trip ID is required");const l={entityType:"default_item_rule",entityId:o.id,operation:"delete",userId:n,tripId:r,version:1,data:{...o,isDeleted:!0}};Y(l,n)}}function pS(t,e,r,n){const s=r?t.trips.byId[r]?.trip?.defaultItemRules||[]:[],i=r?e.trips.byId[r]?.trip?.defaultItemRules||[]:[];for(const o of i)if(!s.find(l=>l.id===o.id)){if(console.log(`🔄 [SYNC_MIDDLEWARE] Trip rule association created: trip ${r} -> rule ${o.id}`),!r)throw new Error("Trip ID is required");const l=new Date().toISOString(),c={id:`${r}-${o.id}`,tripId:r,ruleId:o.id,createdAt:l,updatedAt:l,version:1,isDeleted:!1};st.saveTripRule(c).catch(d=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save trip rule ${r}-${o.id}:`,d)});const u={entityType:"trip_rule",entityId:`${r}-${o.id}`,operation:"create",userId:n,tripId:r,version:1,data:c};Y(u,n)}if(s.length>0&&i.length>=0){for(const o of s)if(!i.find(l=>l.id===o.id)){if(console.log(`🔄 [SYNC_MIDDLEWARE] Trip rule association deleted: trip ${r} -> rule ${o.id}`),!r)throw new Error("Trip ID is required");st.deleteTripRule(r,o.id).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to delete trip rule ${r}-${o.id}:`,c)});const l={entityType:"trip_rule",entityId:`${r}-${o.id}`,operation:"delete",userId:n,tripId:r,version:1,data:{id:`${r}-${o.id}`,tripId:r,ruleId:o.id,isDeleted:!0,updatedAt:new Date().toISOString()}};Y(l,n)}}else s.length>0&&i.length===0&&console.warn(`⚠️ [SYNC_MIDDLEWARE] Trip rules went from ${s.length} to 0 - possible state reset, not tracking deletions`)}function gS(t,e,r,n){const s=t.rulePacks||[],i=e.rulePacks||[];if(!r)throw new Error("Trip ID is required");console.log(`🔄 [SYNC_MIDDLEWARE] Tracking rule pack changes: ${s.length} -> ${i.length}`);for(const o of i){const a=s.find(l=>l.id===o.id);if(a){if(!Ce(a,o)){console.log(`🔄 [SYNC_MIDDLEWARE] Rule pack updated: ${o.id}`),Mn.saveRulePack(o).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save rule pack ${o.id}:`,c)});const l={entityType:"rule_pack",entityId:o.id,operation:"update",userId:n,version:1,data:o};Y(l,n)}}else{console.log(`🔄 [SYNC_MIDDLEWARE] Rule pack created: ${o.id}`),Mn.saveRulePack(o).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to save rule pack ${o.id}:`,c)});const l={entityType:"rule_pack",entityId:o.id,operation:"create",userId:n,version:1,data:o};Y(l,n)}}for(const o of s)if(!i.find(l=>l.id===o.id))if(console.log(`🔄 [SYNC_MIDDLEWARE] Rule pack potentially deleted: ${o.id}`),o&&!o.metadata?.isBuiltIn){console.log(`🔄 [SYNC_MIDDLEWARE] Confirming rule pack deletion: ${o.id}`),Mn.deleteRulePack(o.id).catch(c=>{console.error(`🚨 [SYNC_MIDDLEWARE] Failed to delete rule pack ${o.id}:`,c)});const l={entityType:"rule_pack",entityId:o.id,operation:"delete",userId:n,version:1,data:{...o,isDeleted:!0}};Y(l,n)}else console.log(`🔄 [SYNC_MIDDLEWARE] Skipping deletion of built-in rule pack: ${o.id}`)}function Qs(t){const e=new Date().toISOString();return{trip:{id:t,userId:"",title:"New Trip",description:"",days:[],tripEvents:[],createdAt:e,updatedAt:e,lastSyncedAt:void 0,settings:{defaultTimeZone:"UTC",packingViewMode:"by-day"},version:1,isDeleted:!1,defaultItemRules:[]},people:[],ruleOverrides:[],packingListView:{viewMode:"by-day",filters:{packed:!0,unpacked:!0,excluded:!1}},calculated:{defaultItems:[],packingListItems:[]},isLoading:!1}}const Kr={trips:{summaries:[],selectedTripId:null,byId:{}},rulePacks:xl,userPreferences:null,sync:{syncState:{lastSyncTimestamp:null,pendingChanges:[],isOnline:!0,isSyncing:!1,conflicts:[]},isInitialized:!1,lastError:null},ui:{rulePackModal:{isOpen:!1,activeTab:"browse",selectedPackId:void 0},loginModal:{isOpen:!1},flow:{steps:[],current:null},tripWizard:{currentStep:1},confetti:{burstId:0,source:null}},auth:pg,userPeople:{people:[],isLoading:!1,error:null,hasTriedToLoad:!1}};function yS(t){return(e,r)=>{if("type"in r&&typeof r.type=="string"&&r.type in $o){const n=r.type,s=$o[n];if(s)return s(e??t,r)}return"type"in r&&typeof r.type=="string"&&!r.type.startsWith("@@redux")&&!r.type.startsWith("userProfile")&&!r.type.startsWith("userPeople")&&!r.type.startsWith("auth")&&!r.type.startsWith("sync")&&!r.type.startsWith("UPSERT")&&console.warn(`🏪 [STORE] Unknown action: ${r.type}`),e??t}}function mS(t,e){const r=e??t?.redux?.ssrState,n=yS(r??{...Kr,auth:Kr.auth}),i=tf({reducer:(o,a)=>({...n(o,a),auth:hg(o?.auth,a),userPeople:Zy(o?.userPeople,a)}),preloadedState:r,middleware:o=>o().concat(aS)});return typeof globalThis<"u"&&typeof globalThis.window<"u"&&(globalThis.__REDUX_STORE__=i),i}var Wn={exports:{}},Vn={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uo;function SS(){if(Uo)return Vn;Uo=1;var t=ca();function e(l,c){return l===c&&(l!==0||1/l===1/c)||l!==l&&c!==c}var r=typeof Object.is=="function"?Object.is:e,n=t.useSyncExternalStore,s=t.useRef,i=t.useEffect,o=t.useMemo,a=t.useDebugValue;return Vn.useSyncExternalStoreWithSelector=function(l,c,u,d,f){var h=s(null);if(h.current===null){var y={hasValue:!1,value:null};h.current=y}else y=h.current;h=o(function(){function _(w){if(!I){if(I=!0,b=w,w=d(w),f!==void 0&&y.hasValue){var S=y.value;if(f(S,w))return p=S}return p=w}if(S=p,r(b,w))return S;var v=d(w);return f!==void 0&&f(S,v)?(b=w,S):(b=w,p=v)}var I=!1,b,p,m=u===void 0?null:u;return[function(){return _(c())},m===null?void 0:function(){return _(m())}]},[c,u,d,f]);var E=n(l,h[0],h[1]);return i(function(){y.hasValue=!0,y.value=E},[E]),a(E),E},Vn}var Lo;function wS(){return Lo||(Lo=1,Wn.exports=SS()),Wn.exports}var vS=wS();function _S(t){t()}function ES(){let t=null,e=null;return{clear(){t=null,e=null},notify(){_S(()=>{let r=t;for(;r;)r.callback(),r=r.next})},get(){const r=[];let n=t;for(;n;)r.push(n),n=n.next;return r},subscribe(r){let n=!0;const s=e={callback:r,next:null,prev:e};return s.prev?s.prev.next=s:t=s,function(){!n||t===null||(n=!1,s.next?s.next.prev=s.prev:e=s.prev,s.prev?s.prev.next=s.next:t=s.next)}}}}var No={notify(){},get:()=>[]};function bS(t,e){let r,n=No,s=0,i=!1;function o(E){u();const _=n.subscribe(E);let I=!1;return()=>{I||(I=!0,_(),d())}}function a(){n.notify()}function l(){y.onStateChange&&y.onStateChange()}function c(){return i}function u(){s++,r||(r=t.subscribe(l),n=ES())}function d(){s--,r&&s===0&&(r(),r=void 0,n.clear(),n=No)}function f(){i||(i=!0,u())}function h(){i&&(i=!1,d())}const y={addNestedSub:o,notifyNestedSubs:a,handleChangeWrapper:l,isSubscribed:c,trySubscribe:f,tryUnsubscribe:h,getListeners:()=>n};return y}var IS=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",TS=IS(),CS=()=>typeof navigator<"u"&&navigator.product==="ReactNative",RS=CS(),PS=()=>TS||RS?B.useLayoutEffect:B.useEffect,AS=PS(),kS=Symbol.for("react-redux-context"),DS=typeof globalThis<"u"?globalThis:{};function OS(){if(!B.createContext)return{};const t=DS[kS]??=new Map;let e=t.get(B.createContext);return e||(e=B.createContext(null),t.set(B.createContext,e)),e}var Be=OS();function xS(t){const{children:e,context:r,serverState:n,store:s}=t,i=B.useMemo(()=>{const l=bS(s);return{store:s,subscription:l,getServerState:n?()=>n:void 0}},[s,n]),o=B.useMemo(()=>s.getState(),[s]);AS(()=>{const{subscription:l}=i;return l.onStateChange=l.notifyNestedSubs,l.trySubscribe(),o!==s.getState()&&l.notifyNestedSubs(),()=>{l.tryUnsubscribe(),l.onStateChange=void 0}},[i,o]);const a=r||Be;return B.createElement(a.Provider,{value:i},e)}var _E=xS;function Zs(t=Be){return function(){return B.useContext(t)}}var Vl=Zs();function Yl(t=Be){const e=t===Be?Vl:Zs(t),r=()=>{const{store:n}=e();return n};return Object.assign(r,{withTypes:()=>r}),r}var ql=Yl();function $S(t=Be){const e=t===Be?ql:Yl(t),r=()=>e().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var US=$S(),LS=(t,e)=>t===e;function NS(t=Be){const e=t===Be?Vl:Zs(t),r=(n,s={})=>{const{equalityFn:i=LS}=typeof s=="function"?{equalityFn:s}:s,o=e(),{store:a,subscription:l,getServerState:c}=o;B.useRef(!0);const u=B.useCallback({[n.name](f){return n(f)}}[n.name],[n]),d=vS.useSyncExternalStoreWithSelector(l.addNestedSub,a.getState,c||a.getState,u,i);return B.useDebugValue(d),d};return Object.assign(r,{withTypes:()=>r}),r}var jS=NS();const EE=US.withTypes(),bE=jS.withTypes();ql.withTypes();const FS=t=>t.trips.summaries,IE=U([FS,t=>t.trips.byId],(t,e)=>t.map(r=>{const n=e[r.tripId];if(!n)return r;const s=n.people.length,i=n.calculated.packingListItems,o=i.reduce((l,c)=>l+c.quantity,0),a=i.filter(l=>l.isPacked).reduce((l,c)=>l+c.quantity,0);return{...r,totalPeople:s,totalItems:o,packedItems:a}})),MS=t=>t.trips.selectedTripId,Ve=U([MS,t=>t.trips.byId],(t,e)=>t?e[t]:void 0),BS=U([Ve],t=>t?.people||[]),zS=U([Ve],t=>t?.trip.days||[]),TE=U([Ve],t=>t?.trip);U([Ve],t=>t?.ruleOverrides||[]);const Gl=U([Ve],t=>t?.packingListView||{viewMode:"by-day",filters:{packed:!0,unpacked:!0,excluded:!1}}),HS=U([Ve],t=>t?.calculated||{defaultItems:[],packingListItems:[]}),CE=U([Ve],t=>t?.trip?.defaultItemRules||[]);U([Ve],t=>t?.trip?.defaultItemRules||[]);const Xs=t=>t.userPreferences;U([Xs],t=>t?.lastSelectedTripId||null);const RE=U([Xs],t=>t?.theme||"system");U([Xs],t=>t?.autoSyncEnabled??!0);const WS=U([HS],t=>t.packingListItems),Sn=Gl,VS=zS,PE=U([Gl],t=>t.viewMode),YS=U([WS,Sn],(t,e)=>t.filter(r=>r.isOverridden?e.filters.excluded:r.isPacked?e.filters.packed:e.filters.unpacked)),Kl=U([YS,Sn],(t,e)=>{const r=[],n=[];return t.forEach(s=>{e.viewMode==="by-day"?s.dayIndex!==void 0?r.push(s):n.push(s):s.personId!==void 0?r.push(s):n.push(s)}),{viewSpecificItems:r,generalItems:n}}),Jl=t=>{const e=new Map;return t.forEach(r=>{const n=`${r.ruleId}-${r.itemName}`,s=e.get(n)||[];s.push(r),e.set(n,s)}),Array.from(e.entries()).map(([,r])=>{const n=r[0],s=r.some(h=>h.isExtra),i=r.filter(h=>!h.isExtra),o=r.filter(h=>h.isExtra),a=i.reduce((h,y)=>h+y.quantity,0),l=o.reduce((h,y)=>h+y.quantity,0),c=a+l,u=i.filter(h=>h.isPacked).reduce((h,y)=>h+y.quantity,0),d=o.filter(h=>h.isPacked).reduce((h,y)=>h+y.quantity,0),f=u+d;return{baseItem:n,instances:r,displayName:n.itemName,totalCount:c,packedCount:f,metadata:{isExtra:s,dayIndex:n.dayIndex,dayStart:n.dayStart,dayEnd:n.dayEnd}}})},Ql=t=>{const e=new Map;return t.forEach(r=>{const n=`${r.ruleId}-${r.itemName}-${r.dayIndex}`,s=e.get(n)||[];s.push(r),e.set(n,s)}),Array.from(e.entries()).map(([,r])=>{const n=r[0],s={dayIndex:n.dayIndex,dayStart:n.dayStart,dayEnd:n.dayEnd},i=r.reduce((a,l)=>a+l.quantity,0),o=r.filter(a=>a.isPacked).reduce((a,l)=>a+l.quantity,0);return{baseItem:n,instances:r,displayName:n.itemName,totalCount:i,packedCount:o,metadata:s}})},qS=U([Kl,Sn,BS,VS],({viewSpecificItems:t},e,r,n)=>e.viewMode==="by-day"?n.map((s,i)=>{const o=t.filter(l=>l.dayIndex===i),a=Ql(o);return{type:"day",day:s,index:i,items:a}}):r.map(s=>{const i=t.filter(a=>a.personId===s.id),o=Jl(i);return{type:"person",person:s,items:o}})),GS=U([Kl,Sn],({generalItems:t},e)=>e.viewMode==="by-day"?Ql(t):Jl(t)),AE=U([qS,GS],(t,e)=>({groupedItems:t.map(n=>({...n,items:n.items.map(s=>({...s,metadata:{...s.metadata,isExtra:s.metadata.isExtra||!1}}))})),groupedGeneralItems:e.map(n=>({...n,metadata:{...n.metadata,isExtra:n.metadata.isExtra||!1}}))}));function Zl(){let t;return{promise:new Promise(r=>t=r),resolve:t}}function or(t,e){g(!t.startsWith("#"));const{searchOriginal:r,hashOriginal:n,pathname:s}=tn(t,"/");let i=`${s}${r||""}`;return e?.withoutHash||(i+=n||""),g(i.startsWith("/")),i}function ei(t){return or(window.location.href,t)}function Xl(){g(Pe())}const ec=ae("utils/assertRouterType.ts",{});function wn(){JS(KS()),ec.isClientRouting=!0}function KS(){return ec.isClientRouting!==!1}function JS(t){R(Pe(),`${T.cyan("import { something } from 'vike/client/router'")} is forbidden on the server-side`,{showStackTrace:!0}),V(t,"You shouldn't `import { something } from 'vike/client/router'` when using Server Routing. The 'vike/client/router' utilities work only with Client Routing. In particular, don't `import { navigate }` nor `import { prefetch }` as they unnecessarily bloat your client-side bundle sizes.",{showStackTrace:!0,onlyOnce:!0})}function QS(){Xl(),wn()}function ZS(){const t=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__?.renderers?.size,e=!!window.__REACT_DEVTOOLS_GLOBAL_HOOK__?.rendererInterfaces?.size,r=!!window.__vite_plugin_react_preamble_installed__;return t||e||r}function jo(t,e){return!q(t)||!q(e)?!1:t.message===e.message}function Xe(t){window.location.href=t}function XS(t){return new Promise(e=>setTimeout(e,t))}function ew(t,e){let r=!1;return()=>{r||(r=!0,setTimeout(()=>{r=!1,t()},e))}}function tc(t){window.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&t()})}function tw(t){window.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&t()})}function $r(t,e){g(t===e)}const Yn={};function rw(t,e=100,r=5){const n=new Date;let s=Yn[t]??(Yn[t]=Fo(n));n.getTime()-s.start.getTime()>r*1e3&&(s=Yn[t]=Fo(n)),s.count++;const o=`[Infinite Loop] Rendering ${s.count} times within ${r} seconds [${t}]`;s.count>e&&R(!1,o),!s.warned&&s.count>e*.5&&(V(!1,o,{onlyOnce:!1,showStackTrace:!0}),s.warned=!0)}function Fo(t){return{count:0,start:t}}QS();const nw=[{is:t=>t===void 0,match:t=>t==="!undefined",serialize:()=>"!undefined",deserialize:()=>{}},{is:t=>t===1/0,match:t=>t==="!Infinity",serialize:()=>"!Infinity",deserialize:()=>1/0},{is:t=>t===-1/0,match:t=>t==="!-Infinity",serialize:()=>"!-Infinity",deserialize:()=>-1/0},{is:t=>typeof t=="number"&&isNaN(t),match:t=>t==="!NaN",serialize:()=>"!NaN",deserialize:()=>NaN},{is:t=>t instanceof Date,match:t=>t.startsWith("!Date:"),serialize:t=>"!Date:"+t.toISOString(),deserialize:t=>new Date(t.slice(6))},{is:t=>typeof t=="bigint",match:t=>t.startsWith("!BigInt:"),serialize:t=>"!BigInt:"+t.toString(),deserialize:t=>{if(typeof BigInt>"u")throw new Error("Your JavaScript environement does not support BigInt. Consider adding a polyfill.");return BigInt(t.slice(8))}},{is:t=>t instanceof RegExp,match:t=>t.startsWith("!RegExp:"),serialize:t=>"!RegExp:"+t.toString(),deserialize:t=>{t=t.slice(8);const e=t.match(/\/(.*)\/(.*)?/),r=e[1],n=e[2];return new RegExp(r,n)}},{is:t=>t instanceof Map,match:t=>t.startsWith("!Map:"),serialize:(t,e)=>"!Map:"+e(Array.from(t.entries())),deserialize:(t,e)=>new Map(e(t.slice(5)))},{is:t=>t instanceof Set,match:t=>t.startsWith("!Set:"),serialize:(t,e)=>"!Set:"+e(Array.from(t.values())),deserialize:(t,e)=>new Set(e(t.slice(5)))},{is:t=>typeof t=="string"&&t.startsWith("!"),match:t=>t.startsWith("!"),serialize:t=>"!"+t,deserialize:t=>t.slice(1)}];function ti(t){const e=JSON.parse(t);return ri(e)}function ri(t){return typeof t=="string"?sw(t):(typeof t=="object"&&t!==null&&Object.entries(t).forEach(([e,r])=>{t[e]=ri(r)}),t)}function sw(t){for(const{match:e,deserialize:r}of nw)if(e(t))return r(t,ti);return t}const iw="vike_pageContext",ow="vike_globalContext";function aw(){const t=rc(iw);return g(O(t,"pageId","string")),g(O(t,"routeParams","string{}")),t}function lw(){return rc(ow)}function rc(t){const e=document.getElementById(t);R(e,`Couldn't find #${t} (which Vike automatically injects in the HTML): make sure it exists (i.e. don't remove it and make sure your HTML isn't malformed)`);const r=e.textContent;return g(r),ti(r)}function ni(t,e){return sc(t,e,!0)}function nc(t,e){return sc(t,e,!1)}function sc(t,e,r){const n=r?"CLIENT_ONLY":"SERVER_ONLY",s=t.filter(h=>h.isRelevant(e)&&h.fileType!==".page.route").sort(cw(r,e)),i=h=>{const y=s.filter(_=>_.pageId===e&&_.isEnv(h?"CLIENT_AND_SERVER":n));R(y.length<=1,`Merge the following files into a single file: ${y.map(_=>_.filePath).join(" ")}`);const E=y[0];return g(E===void 0||!E.isDefaultPageFile),E},o=i(!1),a=i(!0),l=h=>s.filter(y=>y.isRendererPageFile&&y.isEnv(h?"CLIENT_AND_SERVER":n))[0],c=l(!1),u=l(!0),d=s.filter(h=>h.isDefaultPageFile&&!h.isRendererPageFile&&(h.isEnv(n)||h.isEnv("CLIENT_AND_SERVER")));return[o,a,...d,c,u].filter(wu)}function cw(t,e){const r=t?"CLIENT_ONLY":"SERVER_ONLY",n=-1,s=1,i=0;return(o,a)=>{if(!o.isDefaultPageFile&&a.isDefaultPageFile)return n;if(!a.isDefaultPageFile&&o.isDefaultPageFile)return s;{const l=o.isRendererPageFile,c=a.isRendererPageFile;if(!l&&c)return n;if(!c&&l)return s;g(l===c)}{const l=Mo(e,o.filePath),c=Mo(e,a.filePath);if(l<c)return n;if(c<l)return s;g(l===c)}{if(o.isEnv(r)&&a.isEnv("CLIENT_AND_SERVER"))return n;if(a.isEnv(r)&&o.isEnv("CLIENT_AND_SERVER"))return s}return i}}function Mo(t,e){let r=0;for(;r<t.length&&r<e.length&&t[r]===e[r];r++);const n=t.slice(r),s=e.slice(r),i=n.split("/").length,o=s.split("/").length;return i+o}async function uw(t,e){const n=nc(t,e).filter(i=>i.fileType===".page.server");return await Promise.all(n.map(async i=>{i.exportNames||(g(i.loadExportNames,e),await i.loadExportNames())})),{hasOnBeforeRenderServerSideOnlyHook:n.some(({exportNames:i})=>(g(i),i.includes("onBeforeRender")))}}const Bo=["urlPathname","urlParsed"],dw=["Page","pageExports","exports"];function fw(t){[...dw,...Bo].forEach(r=>{r in t&&(Bo.includes(r)?(g(r.startsWith("url")),V(!1,`pageContext.${r} is already available in the browser when using Client Routing; adding '${r}' to passToClient has no effect`,{onlyOnce:!0})):V(!1,`pageContext.${r} is a built-in that cannot be overriden; adding '${r}' to passToClient has no effect`,{onlyOnce:!0}),delete t[r])})}const hw="/";function pw(t,e,r){const{pathnameOriginal:n,searchOriginal:s,hashOriginal:i}=tn(t,hw);t.startsWith("/")&&g(t===`${n}${s||""}${i||""}`,{url:t});const o=n.endsWith("/");let a;return a=n+(o?"":"/")+"index",g(a),a=a+e,`${a}${s||""}${i||""}`}const gw=".pageContext.json";function yw(t){return pw(t,gw)}function ic(t,{hookName:e,hookFilePath:r}){if(t==null)return;g(!e.endsWith(")"));const n=`The ${T.cyan("pageContext")} object provided by the ${e}() hook defined by ${r}`;R(q(t),`${n} should be an object (but it's ${T.cyan(`typeof pageContext === ${JSON.stringify(typeof t)}`)} instead)`),R(!("isPageContext"in t),`${n} shouldn't be the whole ${T.cyan("pageContext")} object, see https://vike.dev/pageContext-manipulation#do-not-return-entire-pagecontext`),V(!("pageId"in t),`${n} sets ${T.cyan("pageContext.pageId")} which means that Vike's routing is overriden. This is an experimental feature: make sure to contact a vike maintainer before using this.`,{onlyOnce:!0}),R(!("is404"in t),`${n} sets ${T.cyan("pageContext.is404")} which is forbidden, use ${T.cyan("throw render()")} instead, see https://vike.dev/render`)}function mw(t,e,r){g(!r.endsWith(" "));const n=[],s=Object.keys(t);for(const i of s)e.includes(i)||n.push(i);R(n.length===0,[r,"returned an object with following unknown keys:",bi(n)+".","Only following keys are allowed:",bi(e)+"."].join(" "))}function Sw(t,e){if(t==null)return;const r=`The onBeforeRender() hook defined by ${e}`;R(er(t),`${r} should return a plain JavaScript object, ${T.cyan("undefined")}, or ${T.cyan("null")}`),mw(t,["pageContext"],r),t.pageContext&&ic(t.pageContext,{hookName:"onBeforeRender",hookFilePath:e})}function ww(t,e){if(!er(t))return!1;for(const r of Object.keys(t))if(!e.includes(r))return!1;return!0}function vw(t,e,r=n=>n){if(g(t.length>0),t.length===1)return r(t[0]);const n=t.slice(0,t.length-1),s=t[t.length-1];return n.map(r).join(", ")+`, ${e} `+r(s)}Pe()&&wn();const _w="The guard() hook defined by";async function Ew(t,e){let r;t._pageFilesAll.length>0?(g(t._pageConfigs.length===0),r=bw(t.pageId,t._pageFilesAll)):r=Kn(t,"guard"),r&&await Oa(r,t,e)}function bw(t,e){const r=e.find(l=>l.pageId===t&&l.fileType===".page.route");if(!r)return null;const{filePath:n,fileExports:s}=r;g(s);const i=s.guard;if(!i)return null;const o=n,a=nn("guard");return R(ze(i),`${_w} ${o} should be a function`),{hookFn:i,hookName:"guard",hookFilePath:o,hookTimeout:a}}function Iw(t){const e=new Error("AbortRender");return D(e,{_pageContextAbort:t,[oc]:!0}),e}const oc="_isAbortError";function zo(t){return typeof t=="object"&&t!==null&&oc in t}function Tw(t){return t._urlRewrite||t._urlRedirect||t.abortStatusCode?(g(O(t,"_abortCall","string")),!0):!1}function Cw(t){Rw(t);const e={_urlRewrite:null};return t.forEach(r=>{Object.assign(e,r)}),e}function Rw(t){const e=[];t.forEach(r=>{const n=r._urlRewrite;{const s=e.indexOf(n);if(s!==-1){const i=[...e.slice(s),n].map(o=>`render('${o}')`).join(" => ");R(!1,`Infinite loop of render() calls: ${i}`)}}e.push(n)})}function Pw(t,e){const r=[t>0&&T.cyan("throw render('/some-url')"),e>0&&T.cyan("throw redirect('/some-url')")].filter(Boolean).join(" and ");R(t+e<=7,`Maximum chain length of 7 ${r} exceeded. Did you define an infinite loop of ${r}?`)}const Aw="_pageContextInitIsPassedToClient",ac="_isServerSideError";function kw(){Xl()}kw();function Dw(t){const e=t.config?.Page||t.exports?.Page;return D(t,{Page:e}),Da(t),Ow(t),lc(t)}function lc(t){return sn(t)}function Ow(t){xw(t)}function xw(t){Object.entries(t).forEach(([e,r])=>{delete t[e],t[e]=r})}function Zt(t){return Dw(t)}const cc=ae("client-routing-runtime/getPageContextFromHooks.ts",{});function $w(){const t=aw();return R(!("urlOriginal"in t),"Adding 'urlOriginal' to passToClient is forbidden"),hc(t),D(t,{_hasPageContextFromServer:!0}),t}async function Uw(t){for(const e of["data","onBeforeRender"])dc(e,t)&&await uc(e,t);return t}async function bs(t,e){const r={_hasPageContextFromServer:!1};if(!e&&await Fw(t)){const n=await Mw(t);if("is404ServerSideRouted"in n)return{is404ServerSideRouted:!0};const{pageContextFromServer:s}=n;r._hasPageContextFromServer=!0,g(!(ac in s)),g(!("serverSideError"in s)),D(r,s)}return{pageContextFromServerHooks:r}}async function Ho(t,e){let r=!1;for(const i of["guard","data","onBeforeRender"])i==="guard"?!e&&!t._hasPageContextFromServer&&await Ew(t,o=>Zt(o)):(dc(i,t)||!t._hasPageContextFromServer)&&(i==="data"&&(r=!0),await uc(i,t));const n=fc("data",t);return(r&&n.client||t._hasPageContextFromServer&&n.server)&&await si("onData",t),t}async function si(t,e){return await Zu(t,e,r=>Zt(r))}async function uc(t,e){let r;t==="data"?r=await Lw(e):r=await Nw(e),Object.assign(e,r)}async function Lw(t){const r=(await si("data",t))[0];if(!r)return;const{hookReturn:n}=r;return{data:n}}async function Nw(t){const r=(await si("onBeforeRender",t))[0];if(!r)return;const{hookReturn:n,hookFilePath:s}=r,i={};Sw(n,s);const o=n?.pageContext;return o&&D(i,o),i}function jw(t){t[Aw]&&(cc.pageContextInitIsPassedToClient=!0)}async function Fw(t){return!!cc.pageContextInitIsPassedToClient||await Wo("data",t)||await Wo("onBeforeRender",t)}async function Wo(t,e){if(e._pageConfigs.length>0){const r=ba(e.pageId,e._pageConfigs),n=Tt(r,`${t}Env`)?.value;if(n===null)return!1;g(q(n));const{client:s,server:i}=n;return g(s===!0||s===void 0),g(i===!0||i===void 0),g(s||i),!!i&&!s}else{if(t==="data")return!1;g(t==="onBeforeRender");const{hasOnBeforeRenderServerSideOnlyHook:r}=await uw(e._pageFilesAll,e.pageId);return r}}function dc(t,e){const r=fc(t,e);return!!r.client&&!r.server}function fc(t,e){if(e._pageConfigs.length>0){const r=ba(e.pageId,e._pageConfigs);return Tt(r,`${t}Env`)?.value??{}}else return{client:!1,server:!0}}async function Mw(t){const e=yw(t._urlRewrite??t.urlOriginal),r=await fetch(e);{const i=r.headers.get("content-type"),o="application/json",a=i&&i.includes(o);if(!a&&r.status===404)return Xe(t.urlOriginal),{is404ServerSideRouted:!0};R(a,`Wrong Content-Type for ${e}: it should be ${o} but it's ${i} instead. Make sure to properly use pageContext.httpResponse.headers, see https://vike.dev/renderPage`)}const n=await r.text(),s=ti(n);if(g(q(s)),Tw(s))throw Iw(s);if("serverSideError"in s||ac in s)throw pa("pageContext couldn't be fetched because an error occurred on the server-side");return g(O(s,"pageId","string")),hc(s),{pageContextFromServer:s}}function hc(t){fw(t)}async function Bw(t,e,r){return D(t,r),await $a("onCreatePageContext",e,t,t,sn),t}function zw(){const t={_isOriginalObject:!0,isPageContext:!0};return wt(t,"_isOriginalObject",!1),t}function Hw(t){g(typeof t.urlOriginal=="string"),Da(t);const e={};return Pr(e,"urlPathname",{get:gc,enumerable:!0,configurable:!0}),Pr(e,"url",{get:Ww,enumerable:!1,configurable:!0}),Pr(e,"urlParsed",{get:Vw,enumerable:!0,configurable:!0}),e}function pc(t){const e=o=>g(typeof r=="string",{src:o,urlResolved:r});let r,n;t.urlLogical?(r=t.urlLogical,n=!1,e(1)):t._urlRewrite?(r=t._urlRewrite,n=!1,e(2)):(r=t.urlOriginal,n=!0,e(3)),e(4);let s=t._urlHandler;s||(s=o=>o),r=s(r);const i=n?t._baseServer:"/";return tn(r,i)}function gc(){const{pathname:t}=pc(this),e=t;return g(e.startsWith("/")),e}function Ww(){return V(!1,"`pageContext.url` is outdated. Use `pageContext.urlPathname`, `pageContext.urlParsed`, or `pageContext.urlOriginal` instead. (See https://vike.dev/migration/0.4.23 for more information.)",{onlyOnce:!0,showStackTrace:!0}),gc.call(this)}function Vw(){const{isBaseMissing:t,...e}=pc(this),r=Pe(),n=i=>{V(r,`pageContext.urlParsed.${i} isn't available on the server-side (HTTP requests don't include the URL hash)`,{onlyOnce:!0,showStackTrace:!0})},s={...e,get hash(){return n("hash"),e.hash},get hashOriginal(){return n("hashOriginal"),e.hashOriginal},get hashString(){return V(!1,"pageContext.urlParsed.hashString has been renamed to pageContext.urlParsed.hashOriginal",{onlyOnce:!0,showStackTrace:!0}),n("hashString"),e.hashOriginal},get searchString(){return V(!1,"pageContext.urlParsed.searchString has been renamed to pageContext.urlParsed.searchOriginal",{onlyOnce:!0,showStackTrace:!0}),e.searchOriginal}};return wt(s,"hashString",!1),wt(s,"searchString",!1),r||(wt(s,"hash",!1),wt(s,"hashOriginal",!1)),s}function yc(){const t="/packing-list";return g(Yw(t)),t}function Yw(t){return t.startsWith("/")}const qw=["clientRouting"];function Gw(t){qw.forEach(e=>{if(g(t.fileExports),!(e in t.fileExports))return;const r=`The value of \`${e}\` is only allowed to be \`true\`.`;R(t.fileExports[e]!==!1,`${t.filePath} has \`export { ${e} }\` with the value \`false\` which is prohibited: remove \`export { ${e} }\` instead. (${r})`),R(t.fileExports[e]===!0,`${t.filePath} has \`export { ${e} }\` with a forbidden value. ${r}`)})}const mc=["render","clientRouting","prerender","doNotPrerender"];function Kw(t,e){R(!mc.includes(t),`${e} has \`export default { ${t} }\` which is prohibited, use \`export { ${t} }\` instead.`)}function Jw(t){const e=".page.",r=Ue(t.split(e),0,-1).join(e);return g(!r.includes("\\")),r}function Qw(t,e){if(e.length>0){const n=e.filter(s=>s.isErrorPage);return n.length===0?null:(R(n.length===1,"Only one error page can be defined"),n[0].pageId)}const r=xs(t.map(({pageId:n})=>n).filter(n=>vn(n)));if(R(r.length<=1,`Only one _error.page.js is allowed, but found several: ${r.join(" ")}`),r.length>0){const n=r[0];return g(n),n}return null}function vn(t,e){return g(!t.includes("\\")),t.includes("/_error")}const Zw=[".page",".page.server",".page.route",".page.client",".css"];function Xw(t){if(t.endsWith(".css"))return".css";g(Ea(t),t);const r=t.split("/").slice(-1)[0].split("."),n=r.slice(-3)[0],s=r.slice(-2)[0];if(s==="page")return".page";if(g(n==="page",t),s==="server")return".page.server";if(s==="client")return".page.client";if(s==="route")return".page.route";g(!1,t)}function Sc(t){const e=i=>s.pageId===i||s.isDefaultPageFile&&(Vo(s.filePath)||ev(i,s.filePath)),r=Xw(t),s={filePath:t,fileType:r,isEnv:i=>{if(g(r!==".page.route"),i==="CLIENT_ONLY")return r===".page.client"||r===".css";if(i==="SERVER_ONLY")return r===".page.server";if(i==="CLIENT_AND_SERVER")return r===".page";g(!1)},isRelevant:e,isDefaultPageFile:Is(t),isRendererPageFile:r!==".css"&&Is(t)&&Vo(t),isErrorPageFile:vn(t),pageId:Jw(t)};return s}function Is(t){return vn(t)?!1:t.includes("/_default")}function Vo(t){return t.includes("/renderer/")}function ev(t,e){g(!t.endsWith("/")),g(!e.endsWith("/")),g(Is(e));const r=Ue(e.split("/"),0,-1).filter(n=>n!=="_default").join("/");return t.startsWith(r)}const tv=["$$registrations","_rerender_only"],rv=[".md",".mdx"];function nv(t,e,r){const n=Object.keys(t),s=c=>c==="default"||c===r,i=n.filter(s),o=T.code("export default"),a=T.code(`export { ${r} }`);i.length===0&&R(!1,`${e} should have ${a} or ${o}`),i.length===2&&R(!1,`${e} is ambiguous: remove ${o} or ${a}`),g(i.length===1);const l=n.filter(c=>!s(c)).filter(c=>!tv.includes(c));rv.some(c=>e.endsWith(c))||l.forEach(c=>{V(!1,`${e} unexpected ${T.cyan(`export { ${c} }`)}, see https://vike.dev/no-side-exports`,{onlyOnce:!0})})}function sv(t,e){const r=t.map(s=>{const i=Ts(s.configValuesSerialized);return iv(i),{...s,configValues:i}}),n={configValues:{}};{const s=Ts(e.configValuesSerialized);Object.assign(n.configValues,s)}return{pageConfigs:r,pageConfigGlobal:n}}function iv(t){const e="route",r=t[e];if(!r)return;const{value:n,definedAtData:s}=r,i=typeof n;g(s);const o=Uu("Config",e,s);R(i==="string"||ze(n),`${o} has an invalid type '${i}': it should be a string or a function instead, see https://vike.dev/route`)}function Ts(t){const e={};return Object.entries(t).forEach(([n,s])=>{let i;if(s.type==="cumulative"){const{valueSerialized:o,...a}=s;i={value:o.map((c,u)=>{const{value:d,sideExports:f}=Yo(c,n,()=>{const h=s.definedAtData[u];return g(h),h});return r(f),d}),...a}}else{const{valueSerialized:o,...a}=s,{value:l,sideExports:c}=Yo(o,n,()=>{g(s.type!=="computed");const{definedAtData:u}=s;return Array.isArray(u)?u[0]:u});r(c),i={value:l,...a}}e[n]=i}),e;function r(n){n.forEach(s=>{const{configName:i,configValue:o}=s;e[i]||(e[i]=o)})}}function Yo(t,e,r){if(t.type==="js-serialized"){let{value:n}=t;return n=ri(n),{value:n,sideExports:[]}}if(t.type==="pointer-import"){const{value:n}=t;return{value:n,sideExports:[]}}if(t.type==="plus-file"){const n=r(),{exportValues:s}=t;g(!n.definedBy),nv(s,n.filePathToShowToUser,e);let i,o=!1;const a=[];return Object.entries(s).forEach(([l,c])=>{l!=="default"&&l!==e?a.push({configName:l,configValue:{type:"standard",value:c,definedAtData:{filePathToShowToUser:n.filePathToShowToUser,fileExportPathToShowToUser:[l]}}}):(i=c,g(!o),o=!0)}),g(o),{value:i,sideExports:a}}g(!1)}function ov(t){g(O(t,"pageFilesLazy","object")),g(O(t,"pageFilesEager","object")),g(O(t,"pageFilesExportNamesLazy","object")),g(O(t,"pageFilesExportNamesEager","object")),g(O(t.pageFilesLazy,".page")),g(O(t.pageFilesLazy,".page.client")||O(t.pageFilesLazy,".page.server")),g(O(t,"pageFilesList","string[]")),g(O(t,"pageConfigsSerialized")),g(O(t,"pageConfigGlobalSerialized"));const{pageConfigsSerialized:e,pageConfigGlobalSerialized:r}=t;av(e),lv(r);const{pageConfigs:n,pageConfigGlobal:s}=sv(e,r),i={};Tr(t.pageFilesLazy).forEach(({filePath:a,pageFile:l,globValue:c})=>{l=i[a]=i[a]??l;const u=c;qo(u),l.loadFile=async()=>{"fileExports"in l||(l.fileExports=await u(),Gw(l))}}),Tr(t.pageFilesExportNamesLazy).forEach(({filePath:a,pageFile:l,globValue:c})=>{l=i[a]=i[a]??l;const u=c;qo(u),l.loadExportNames=async()=>{if(!("exportNames"in l)){const d=await u();g(O(d,"exportNames","string[]"),l.filePath),l.exportNames=d.exportNames}}}),Tr(t.pageFilesEager).forEach(({filePath:a,pageFile:l,globValue:c})=>{l=i[a]=i[a]??l;const u=c;g(q(u)),l.fileExports=u}),Tr(t.pageFilesExportNamesEager).forEach(({filePath:a,pageFile:l,globValue:c})=>{l=i[a]=i[a]??l;const u=c;g(q(u)),g(O(u,"exportNames","string[]"),l.filePath),l.exportNames=u.exportNames}),t.pageFilesList.forEach(a=>{i[a]=i[a]??Sc(a)});const o=Object.values(i);return o.forEach(({filePath:a})=>{g(!a.includes("\\"))}),{pageFilesAll:o,pageConfigs:n,pageConfigGlobal:s}}function Tr(t){const e=[];return Object.entries(t).forEach(([r,n])=>{g(Zw.includes(r)),g(q(n)),Object.entries(n).forEach(([s,i])=>{const o=Sc(s);g(o.fileType===r),e.push({filePath:s,pageFile:o,globValue:i})})}),e}function qo(t){g(ze(t))}function av(t){g(Te(t)),t.forEach(e=>{g(q(e)),g(O(e,"pageId","string")),g(O(e,"routeFilesystem")),g(O(e,"configValuesSerialized"))})}function lv(t){g(O(t,"configValuesSerialized"))}function cv(t,e,r){const n=uv({pageConfigGlobalValues:t,pageConfigValues:r});let s;if(e.isErrorPage)s={...n,isErrorPage:!0};else{const i=n.config.route??e.routeFilesystem.routeString;s={...n,route:i}}return[e.pageId,s]}function uv({pageConfigGlobalValues:t,pageConfigValues:e}){const r=vc({pageConfigGlobalValues:t,pageConfigValues:e});return wc(r)}function wc(t){const e=t;return{config:e.config,_source:e.source,_sources:e.sources,_from:e.from}}function vc({pageConfigGlobalValues:t,pageConfigValues:e}){const r={...t,...e};return _c({configValues:r})}function dv({pageConfigGlobalValues:t}){const e=_c({configValues:t});return wc(e)}function fv(t,e,r){const n={},s={},i={};t.forEach(f=>{hv(f).forEach(({exportName:y,exportValue:E,isFromDefaultExport:_})=>{g(y!=="default"),i[y]=i[y]??[],i[y].push({exportValue:E,exportSource:`${f.filePath} > ${_?`\`export default { ${y} }\``:`\`export { ${y} }\``}`,filePath:f.filePath,_filePath:f.filePath,_fileType:f.fileType,_isFromDefaultExport:_})})});let o,a,l;if(e){const f=vc({pageConfigGlobalValues:r.configValues,pageConfigValues:e.configValues});o=f.source,a=f.sources,l=f.from,Object.assign(n,f.config),Object.assign(s,f.configEntries),Object.assign(i,f.exportsAll)}else o={},a={},l={configsStandard:{},configsCumulative:{},configsComputed:{}};const c={},u={};Object.entries(i).forEach(([f,h])=>{h.forEach(({exportValue:y,_fileType:E,_isFromDefaultExport:_})=>{u[f]=u[f]??y,E===".page"&&!_&&(f in c||(c[f]=y))})}),g(!("default"in u)),g(!("default"in i));const d={config:n,from:l,source:o,sources:a,configEntries:s,exports:u,exportsAll:i};return Pr(d,"pageExports",{get:()=>(Pe()||V(!1,"pageContext.pageExports is outdated, use pageContext.exports instead",{onlyOnce:!0,showStackTrace:!0}),c),enumerable:!1,configurable:!0}),d}function _c(t){const e={},r={},n={},s={},i={},o={configsStandard:{},configsCumulative:{},configsComputed:{}},a=(c,u)=>{s[u]=c,i[u]??(i[u]=[]),i[u].push(c)},l=(c,u,d)=>{const f=Ia(d),h=Ca("Config",c,d);r[c]=r[c]??[],r[c].push({configValue:u,configDefinedAt:h,configDefinedByFile:f});const y=c;n[y]=n[y]??[],n[y].push({exportValue:u,exportSource:h,filePath:f,_filePath:f,_fileType:null,_isFromDefaultExport:null})};return Object.entries(t.configValues).forEach(([c,u])=>{const{value:d}=u;if(e[c]=e[c]??d,u.type==="standard"){const f={type:"configsStandard",value:u.value,definedAt:tr(u.definedAtData,c)};a(f,c),o.configsStandard[c]=f,l(c,d,u.definedAtData)}if(u.type==="cumulative"){const f={type:"configsCumulative",values:u.value.map((h,y)=>{const E=u.definedAtData[y];g(E);const _=tr(E,c);return l(c,h,E),{value:h,definedAt:_}})};a(f,c),o.configsCumulative[c]=f}if(u.type==="computed"){const f={type:"configsComputed",value:u.value};a(f,c),o.configsComputed[c]=f,l(c,d,u.definedAtData)}}),{config:e,configEntries:r,exportsAll:n,source:s,sources:i,from:o}}function hv(t){const{filePath:e,fileExports:r}=t;g(r),g(Ea(e));const n=[];return Object.entries(r).sort(pu(([s])=>s==="default")).forEach(([s,i])=>{let o=s==="default";if(o)if(Du(e))s="Page";else{R(q(i),`The ${T.cyan("export default")} of ${e} should be an object.`),Object.entries(i).forEach(([a,l])=>{Kw(a,e),n.push({exportName:a,exportValue:l,isFromDefaultExport:o})});return}n.push({exportName:s,exportValue:i,isFromDefaultExport:o})}),n.forEach(({exportName:s,isFromDefaultExport:i})=>{g(!(i&&mc.includes(s)))}),n}async function pv(t,e,r){const n=gv(t),s=await r?.(n);return D(n,s),e.globalContext?D(e.globalContext,n,!0):(e.globalContext=n,await $a("onCreateGlobalContext",n._pageConfigGlobal,null,n,ka)),e.globalContext}function gv(t){const{pageFilesAll:e,allPageIds:r,pageConfigs:n,pageConfigGlobal:s,userFriendlyConfigsGlobal:i,userFriendlyConfigsPageEager:o}=yv(t),a={isGlobalContext:!0,_isOriginalObject:!0,_virtualFileExports:t,_pageFilesAll:e,_pageConfigs:n,_pageConfigGlobal:s,_allPageIds:r,_userFriendlyConfigsGlobal:i,config:i.config,pages:o};return wt(a,"_isOriginalObject",!1),a}function yv(t){const{pageFilesAll:e,pageConfigs:r,pageConfigGlobal:n}=ov(t),s=mv(e,r),i=dv({pageConfigGlobalValues:n.configValues}),o=Object.fromEntries(r.map(a=>cv(n.configValues,a,a.configValues)));return{pageFilesAll:e,allPageIds:s,pageConfigs:r,pageConfigGlobal:n,userFriendlyConfigsGlobal:i,userFriendlyConfigsPageEager:o}}function mv(t,e){const r=t.filter(({isDefaultPageFile:i})=>!i).map(({pageId:i})=>i),n=xs(r),s=e.map(i=>i.pageId);return[...n,...s]}const me=ae("createGetGlobalContextClient.ts",(()=>{const{promise:t,resolve:e}=Zl();return{globalContextPromise:t,globalContextPromiseResolve:e}})());function Sv(t,e,r){return g(me.isClientRouting===void 0||me.isClientRouting===e),me.isClientRouting=e,n(),n;async function n(){if(me.globalContext&&me.globalContext._virtualFileExports!==t)return me.globalContext;const s=await pv(t,me,async i=>{const o={isClientSide:!0};return D(o,lw()),D(o,await r?.(i)),o});return g(me.globalContext),me.globalContextPromiseResolve(me.globalContext),s}}function wv(t,e){const n=e.filter(({filesystemRoot:i})=>t.startsWith(i)).sort(Rr(({filesystemRoot:i})=>i.length))[0];let s;if(n){const{filesystemRoot:i,urlRoot:o}=n,a={pageId:t,filesystemRoot:i,urlRoot:o};g(o.startsWith("/")&&t.startsWith("/")&&i.startsWith("/"),a),g(t.startsWith(i),a),i!=="/"?(g(!i.endsWith("/"),a),s=Ue(t,i.length,0)):s=t,g(s.startsWith("/"),a),s=o+(o.endsWith("/")?"":"/")+Ue(s,1,0)}else s=t;return g(s.startsWith("/")),s=s.split("/").filter(i=>i!=="pages"&&i!=="src"&&i!=="index").join("/"),g(!s.includes(".page.")),g(!s.endsWith(".")),s.endsWith("/index")&&(s=Ue(s,0,-6)),s===""&&(s="/"),g(s.startsWith("/")),g(!s.endsWith("/")||s==="/"),s}async function vv(t,e,r){let{hookReturn:n}=La({hookFn:t,hookFilePath:r,hookName:"route"},e,sn);if(Ec(n,`The Route Function ${r}`),n=await n,n===!1)return null;if(n===!0&&(n={}),R(er(n),`The Route Function ${r} should return a boolean or a plain JavaScript object (but it's ${T.cyan(`typeof result === ${JSON.stringify(typeof n)}`)} instead)`),"match"in n){const{match:o}=n;if(R(typeof o=="boolean",`The ${T.cyan("match")} value returned by the Route Function ${r} should be a boolean.`),!o)return null}let s=null;"precedence"in n&&(s=n.precedence,R(typeof s=="number",`The ${T.cyan("precedence")} value returned by the Route Function ${r} should be a number.`)),bc(n,`The ${T.cyan("routeParams")} object returned by the Route Function ${r} should`);const i=n.routeParams||{};return R(!("pageContext"in n),`Providing ${T.cyan("pageContext")} in Route Functions is prohibited, see https://vike.dev/route-function#cannot-provide-pagecontext`),g(er(i)),Object.keys(n).forEach(o=>{R(o==="match"||o==="routeParams"||o==="precedence",`The Route Function ${r} returned an object with an unknown property ${T.cyan(o)} (the known properties are ${T.cyan("match")}, ${T.cyan("routeParams")}, and ${T.cyan("precedence")})`)}),{precedence:s,routeParams:i}}function Ec(t,e){V(!_u(t),`${e} returned a promise, but asynchronous routing is deprecated and will be removed in the next major release, see https://vike.dev/route-function#async`,{onlyOnce:!0})}function Go(){const t=T.cyan("iKnowThePerformanceRisksOfAsyncRouteFunctions");V(!1,`${t} is deprecated and will be removed in the next major release`,{onlyOnce:!0})}function bc(t,e){g(e.endsWith(" should")),O(t,"routeParams")&&(g(e.endsWith(" should")),R(O(t,"routeParams","string{}"),`${e} be an object holding string values.`))}async function _v(t,e,r,n){await Promise.all(t.filter(a=>a.fileType===".page.route").map(a=>a.loadFile?.()));const{onBeforeRouteHook:s,filesystemRoots:i}=bv(t,e,r);return{pageRoutes:Ev(i,t,e,n),onBeforeRouteHook:s}}function Ev(t,e,r,n){const s=[];if(r.length>0){g(t===null);const i=!0;r.filter(o=>!o.isErrorPage).forEach(o=>{const a=o.pageId;let l=null;{const c="route",u=Tt(o,c);if(u){const d=u.value;g(u.definedAtData);const f=tr(u.definedAtData,c);if(typeof d=="string")l={pageId:a,comesFromV1PageConfig:i,routeString:d,routeDefinedAtString:f,routeType:"STRING"};else{const{definedAtData:h}=u;g(!Te(h)&&!h.definedBy);const{filePathToShowToUser:y}=h;g(y),g(ze(d)),Tt(o,"iKnowThePerformanceRisksOfAsyncRouteFunctions","boolean")&&Go(),l={pageId:a,comesFromV1PageConfig:i,routeFunction:d,routeFunctionFilePath:y,routeDefinedAtString:f,routeType:"FUNCTION"}}}}if(!l){const{routeFilesystem:c}=o;g(c);const{routeString:u,definedAtLocation:d}=c;g(c.routeString.startsWith("/")),l={pageId:a,routeFilesystemDefinedBy:d,comesFromV1PageConfig:i,routeString:u,routeDefinedAtString:null,routeType:"FILESYSTEM"}}g(l),s.push(l)})}if(r.length===0){g(t);const i=!1;n.filter(o=>!vn(o)).forEach(o=>{const a=e.find(l=>l.pageId===o&&l.fileType===".page.route");if(!a||!("default"in a.fileExports)){const l=wv(o,t);g(l.startsWith("/")),g(!l.endsWith("/")||l==="/"),s.push({pageId:o,comesFromV1PageConfig:i,routeString:l,routeDefinedAtString:null,routeFilesystemDefinedBy:`${o}.page.*`,routeType:"FILESYSTEM"})}else{const{filePath:l,fileExports:c}=a;if(g(c.default),O(c,"default","string")){const u=c.default;R(u.startsWith("/"),`A Route String should start with a leading slash '/' but ${l} has \`export default '${u}'\`. Make sure to \`export default '/${u}'\` instead.`),s.push({pageId:o,comesFromV1PageConfig:i,routeString:u,routeDefinedAtString:l,routeType:"STRING"});return}if(O(c,"default","function")){const u=c.default;"iKnowThePerformanceRisksOfAsyncRouteFunctions"in c&&Go(),s.push({pageId:o,comesFromV1PageConfig:i,routeFunction:u,routeFunctionFilePath:l,routeDefinedAtString:l,routeType:"FUNCTION"});return}R(!1,`The default export of ${l} should be a string or a function.`)}})}return s}function bv(t,e,r){if(e.length>0)return{onBeforeRouteHook:Mu(r,"onBeforeRoute"),filesystemRoots:null};let n=null;const s=[];return t.filter(i=>i.fileType===".page.route"&&i.isDefaultPageFile).forEach(({filePath:i,fileExports:o})=>{if(g(o),"onBeforeRoute"in o){R(O(o,"onBeforeRoute","function"),`\`export { onBeforeRoute }\` of ${i} should be a function.`);const{onBeforeRoute:a}=o,l="onBeforeRoute";n={hookFilePath:i,hookFn:a,hookName:l,hookTimeout:nn(l)}}"filesystemRoutingRoot"in o&&(R(O(o,"filesystemRoutingRoot","string"),`\`export { filesystemRoutingRoot }\` of ${i} should be a string.`),R(O(o,"filesystemRoutingRoot","string"),`\`export { filesystemRoutingRoot }\` of ${i} is \`'${o.filesystemRoutingRoot}'\` but it should start with a leading slash \`/\`.`),s.push({filesystemRoot:Iv(i),urlRoot:o.filesystemRoutingRoot}))}),{onBeforeRouteHook:n,filesystemRoots:s}}function Iv(t){g(t.startsWith("/")),g(!t.endsWith("/"));const e=t.split("/"),r=Ue(e,0,-1).join("/")||"/";return g(r.startsWith("/")),g(!r.endsWith("/")||r==="/"),r}const Tv={createStore:mS},Cv=Object.freeze(Object.defineProperty({__proto__:null,default:Tv},Symbol.toStringTag,{value:"Module"})),ii={},Ic={},Rv={},_n={},Pv=[],Tc={},Av=[{pageId:"/pages/_error",isErrorPage:!0,routeFilesystem:void 0,loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/_error",moduleExports:z(()=>import("../entries/pages_error.CXjL97O7.js"),__vite__mapDeps([2,3,1,4,5,6]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/auth/callback",isErrorPage:void 0,routeFilesystem:{routeString:"/auth/callback",definedAtLocation:"/pages/auth/callback/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/auth/callback",moduleExports:z(()=>import("../entries/pages_auth_callback.D6Bhgm1h.js"),__vite__mapDeps([7,3,1,4,5,6]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/days",isErrorPage:void 0,routeFilesystem:{routeString:"/days",definedAtLocation:"/pages/days/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/days",moduleExports:z(()=>import("../entries/pages_days.CM8Pzhdv.js"),__vite__mapDeps([8,3,1,4,5,6,9,10,11,12,13,14,15]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/defaults",isErrorPage:void 0,routeFilesystem:{routeString:"/defaults",definedAtLocation:"/pages/defaults/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/defaults",moduleExports:z(()=>import("../entries/pages_defaults.DwFSgICJ.js"),__vite__mapDeps([16,3,1,4,5,6,17,13,14,15,10,18]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/index",isErrorPage:void 0,routeFilesystem:{routeString:"/",definedAtLocation:"/pages/index/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/index",moduleExports:z(()=>import("../entries/pages_index.sXFcBpKY.js"),__vite__mapDeps([19,3,1,4,5,6,13,14,15]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/login",isErrorPage:void 0,routeFilesystem:{routeString:"/login",definedAtLocation:"/pages/login/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/login",moduleExports:z(()=>import("../entries/pages_login.Dk1k-TJs.js"),__vite__mapDeps([20,3,1,4,5,6]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/packing-list",isErrorPage:void 0,routeFilesystem:{routeString:"/packing-list",definedAtLocation:"/pages/packing-list/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/packing-list",moduleExports:z(()=>import("../entries/pages_packing-list.BMGbXf1d.js"),__vite__mapDeps([21,3,1,4,5,6,11,17,14,13,15]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/people",isErrorPage:void 0,routeFilesystem:{routeString:"/people",definedAtLocation:"/pages/people/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/people",moduleExports:z(()=>import("../entries/pages_people.DcPyxW9f.js"),__vite__mapDeps([22,3,1,4,5,6,13,14,15,18]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/people/manage",isErrorPage:void 0,routeFilesystem:{routeString:"/people/manage",definedAtLocation:"/pages/people/manage/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/people/manage",moduleExports:z(()=>import("../entries/pages_people_manage.59LBf681.js"),__vite__mapDeps([23,3,1,4,5,6,13,14]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/profile",isErrorPage:void 0,routeFilesystem:{routeString:"/profile",definedAtLocation:"/pages/profile/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/profile",moduleExports:z(()=>import("../entries/pages_profile.C8__wvAu.js"),__vite__mapDeps([24,3,1,4,5,6,13]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/settings",isErrorPage:void 0,routeFilesystem:{routeString:"/settings",definedAtLocation:"/pages/settings/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/settings",moduleExports:z(()=>import("../entries/pages_settings.5Zl8cYt1.js"),__vite__mapDeps([25,3,1,4,5,6,26,13,14]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/trips",isErrorPage:void 0,routeFilesystem:{routeString:"/trips",definedAtLocation:"/pages/trips/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/trips",moduleExports:z(()=>import("../entries/pages_trips.D7tMdOaE.js"),__vite__mapDeps([27,3,1,4,5,6,13,26,12]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/trips/@tripId",isErrorPage:void 0,routeFilesystem:{routeString:"/trips/@tripId",definedAtLocation:"/pages/trips/@tripId/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/trips/@tripId",moduleExports:z(()=>import("../entries/pages_trips_-tripId.C0uGqSbS.js"),__vite__mapDeps([28,3,1,4,5,6,13]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/trips/@tripId/settings",isErrorPage:void 0,routeFilesystem:{routeString:"/trips/@tripId/settings",definedAtLocation:"/pages/trips/@tripId/settings/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/trips/@tripId/settings",moduleExports:z(()=>import("../entries/pages_trips_-tripId_settings.A2U0xfej.js"),__vite__mapDeps([29,3,1,4,5,6,13]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/trips/@tripId/wizard",isErrorPage:void 0,routeFilesystem:{routeString:"/trips/@tripId/wizard",definedAtLocation:"/pages/trips/@tripId/wizard/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/trips/@tripId/wizard",moduleExports:z(()=>import("../entries/pages_trips_-tripId_wizard.DoSPr6pa.js"),__vite__mapDeps([30,3,1,4,5,6,11,13,9,10]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/trips/new",isErrorPage:void 0,routeFilesystem:{routeString:"/trips/new",definedAtLocation:"/pages/trips/new/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/trips/new",moduleExports:z(()=>import("../entries/pages_trips_new.j5TCN3SF.js"),__vite__mapDeps([31,3,1,4,5,6,13]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}},{pageId:"/pages/version",isErrorPage:void 0,routeFilesystem:{routeString:"/version",definedAtLocation:"/pages/version/"},loadConfigValuesAll:()=>({moduleId:"virtual:vike:pageConfigValuesAll:client:/pages/version",moduleExports:z(()=>import("../entries/pages_version.Ct7F9gy3.js"),__vite__mapDeps([32,3,1,4,5,6]))}),configValuesSerialized:{isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:{server:!0}}},clientRouting:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","clientRouting"]},valueSerialized:{type:"js-serialized",value:!0}}}}],kv={configValuesSerialized:{redux:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+redux.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Cv}}}},Dv=Object.assign({}),Ov={...Dv};ii[".page"]=Ov;const xv=Object.assign({}),$v={...xv};_n[".page"]=$v;const Uv=Object.assign({}),Lv={...Uv};_n[".page.server"]=Lv;const Nv=Object.assign({}),jv={...Nv};Ic[".page.route"]=jv;const Fv=Object.assign({}),Mv={...Fv};ii[".page.client"]=Mv;const Bv=Object.assign({}),zv={...Bv};_n[".page.client"]=zv;const Hv=Object.assign({}),Wv={...Hv};Tc[".page.server"]=Wv;const Vv=Object.freeze(Object.defineProperty({__proto__:null,neverLoaded:Tc,pageConfigGlobalSerialized:kv,pageConfigsSerialized:Av,pageFilesEager:Ic,pageFilesExportNamesEager:_n,pageFilesExportNamesLazy:Rv,pageFilesLazy:ii,pageFilesList:Pv},Symbol.toStringTag,{value:"Module"})),Yv=Sv(Vv,!0,qv);async function qv(t){const{pageRoutes:e,onBeforeRouteHook:r}=await _v(t._pageFilesAll,t._pageConfigs,t._pageConfigGlobal,t._allPageIds);return{_pageRoutes:e,_onBeforeRouteHook:r}}async function Cc(t){const e=await Yv(),r=yc();g(Us(r));const n=zw();D(n,{isClientSide:!0,isPrerendering:!1,urlOriginal:t,_globalContext:e,_pageFilesAll:e._pageFilesAll,_pageConfigs:e._pageConfigs,_pageConfigGlobal:e._pageConfigGlobal,_allPageIds:e._allPageIds,_pageRoutes:e._pageRoutes,_onBeforeRouteHook:e._onBeforeRouteHook,_urlHandler:null,_urlRewrite:null,_baseServer:r});const s=Hw(n);D(n,s);const i=await Bw(n,e._pageConfigGlobal,e._userFriendlyConfigsGlobal);return $r(n,i),n}function Rc(t,e){const r=t.filter(s=>s.pageId===e);return g(r.length<=1),r[0]??null}async function Gv(t,e){if("isAllLoaded"in t)return t;const{moduleId:r,moduleExports:n}=t.loadConfigValuesAll(),s=await n;s||g(!1,{moduleExports:n,configValuesLoaded:s,moduleId:r});const i=Ts(s.configValuesSerialized);return Object.assign(t.configValues,i),D(t,{isAllLoaded:!0}),t}const Pc="__whileFetchingAssets";async function Cs(t,e,r,n){const s=ni(e,t),i=Rc(r,t);let o;const a=!1;try{o=(await Promise.all([i&&Gv(i,a),...s.map(d=>d.loadFile?.())]))[0]}catch(u){throw Kv(u)&&Object.assign(u,{[Pc]:!0}),u}const l=fv(s,o,n),c={};return D(c,l),D(c,{_pageFilesLoaded:s}),c}function oi(t){return t?t[Pc]===!0:!1}function Kv(t){return t instanceof Error?["Failed to fetch dynamically imported module","error loading dynamically imported module","Importing a module script failed","error resolving module specifier","failed to resolve module"].some(r=>t.message.toLowerCase().includes(r.toLowerCase())):!1}function Ac(t){const e=t.getAttribute("href");return e===null||!wa(e)||e===""||cu(e)||Zv(e)||Qv(t)||!Xv(e)||!Jv(t)}function Jv(t){if(e_()){const r=t.getAttribute("data-vike-link");return r!==null&&r!=="false"}else return!0}function Qv(t){const e=t.getAttribute("target"),r=t.getAttribute("rel");return e==="_blank"||e==="_external"||r==="external"||t.hasAttribute("download")}function Zv(t){return!!(t.startsWith("#")||t.includes("#")&&or(t,{withoutHash:!0})===or(window.location.href,{withoutHash:!0}))}function kE(t){return t.startsWith("#")?t===window.location.hash:or(t)===or(window.location.href)}function Xv(t){const e=yc();g(Us(e));const{isBaseMissing:r}=tn(t,e);return!r}function e_(){return!!window._disableAutomaticLinkInterception}function Xt(t){return t.fileType===".css"?[]:t.exportNames?t.exportNames:(g(t.fileExports,t.filePath),Object.keys(t.fileExports))}function t_({pageFilesClientSide:t,pageFilesServerSide:e,pageId:r}){return{isHtmlOnly:n(),isClientRouting:i()};function n(){return e.some(a=>a.pageId===r&&a.fileType===".page")?(s(),!1):!(!e.some(a=>a.pageId===r&&a.fileType===".page.server")||t.some(a=>a.pageId===r&&a.fileType===".page.client"&&Xt(a).includes("render")))}function s(){const o=t.some(a=>Xt(a).includes("render"));R(o,["No client-side `render()` hook found.","See https://vike.dev/render-modes for more information.",["Loaded client-side page files (none of them `export { render }`):",...t.map((a,l)=>` (${l+1}): ${a.filePath}`)].join(`
`)].join(" "))}function i(){return t.some(a=>Xt(a).includes("clientRouting"))}}function r_({pageFilesClientSide:t,pageFilesServerSide:e,isHtmlOnly:r,isClientRouting:n}){let s=[];const i=e.filter(a=>!t.includes(a)),o=[];if(o.push(...t.map(a=>({id:a.filePath,onlyAssets:!1,eagerlyImported:!1}))),o.push(...i.map(a=>({id:a.filePath,onlyAssets:!0,eagerlyImported:!1}))),r)s=t.map(a=>a.filePath);else{const a=n_(n);o.push({id:a,onlyAssets:!1,eagerlyImported:!1}),s=[a]}return{clientEntries:s,clientDependencies:o}}function n_(t){return t?"@@vike/dist/esm/client/client-routing-runtime/entry.js":"@@vike/dist/esm/client/server-routing-runtime/entry.js"}function s_(t,e){let r=ni(t,e);const n=nc(t,e),{isHtmlOnly:s,isClientRouting:i}=t_({pageFilesClientSide:r,pageFilesServerSide:n,pageId:e});s&&(r=r.filter(l=>l.isEnv("CLIENT_ONLY")&&!Xt(l).includes("render")),r=o_(r));const{clientEntries:o,clientDependencies:a}=r_({pageFilesClientSide:r,pageFilesServerSide:n,isHtmlOnly:s,isClientRouting:i});return{isHtmlOnly:s,isClientRouting:i,clientEntries:o,clientDependencies:a,pageFilesClientSide:r,pageFilesServerSide:n}}async function i_(t,e,{sharedPageFilesAlreadyLoaded:r}){const n=ni(t,e);await Promise.all(n.map(async s=>{g(s.isEnv("CLIENT_ONLY")||s.isEnv("CLIENT_AND_SERVER")),await s.loadExportNames?.()}))}function o_(t){const e=[];for(const r of t)if(e.push(r),Xt(r).includes("overrideDefaultPages"))break;return e}function a_(t,e,r){if(t){const n=Tt(t,"clientRouting","boolean")?.value??!1;return{isClientRuntimeLoaded:Tt(t,"isClientRuntimeLoaded","boolean")?.value??!1,isClientRouting:n}}else{const{isHtmlOnly:n,isClientRouting:s}=s_(e,r);return{isClientRuntimeLoaded:!n,isClientRouting:s}}}async function Rs(t,e){await i_(e._pageFilesAll,t,{sharedPageFilesAlreadyLoaded:!1});const r=Rc(e._pageConfigs,t),{isClientRuntimeLoaded:n,isClientRouting:s}=a_(r,e._pageFilesAll,t);return n&&s}const kc="@",Ps=":";function l_(t,e="Invalid"){let r=`${e} Route String ${et(t)}`;R(t!=="",`${r} (empty string): set it to ${et("/")} instead`),R(["/","*"].includes(t[0]),`${r}: it should start with ${et("/")} or ${et("*")}`),R(!t.includes("**"),`${r}: set it to ${et(t.split("**").join("*"))} instead`)}function As(t,e){l_(t);const r=ai(t),n=r.map(d=>d.param?"[^/]+":d.glob?".*":bu(d.static)).map(d=>`(${d})`).join(""),s=new RegExp(`^${n}/?$`),i=e.match(s);if(!i)return null;const o={},[a,...l]=i;let c=0;const u=r.filter(d=>d.glob).length>1;return r.forEach((d,f)=>{let h=l[f];if(d.param&&(o[d.param]=h),d.glob){const y=`*${u?++c:""}`;o[y]=h}}),{routeParams:o}}function ai(t){const e=[],r=s=>{const i=e[e.length-1];i?.static?i.static+=s:e.push({static:s})},n=t.split("/");return n.forEach((s,i)=>{i!==0&&r("/"),u_(s)?(V(!s.startsWith(Ps),`Outdated Route String ${et(t)}, use ${et(t.split(Ps).join(kc))} instead`,{onlyOnce:!0}),e.push({param:s.slice(1)})):s==="*"&&i===n.length-1&&t!=="*"&&t!=="/*"?e.push({glob:!0}):s.split("*").forEach((o,a)=>{a!==0&&e.push({glob:!0}),o!==""&&r(o)})}),e}function c_(t){const e=[];return ai(t).forEach(n=>{n.param&&e.push(n.param)}),e}function Cr(t){const e=ai(t),r=a=>a?.split("/").filter(Boolean).length||0;let n=0;for(const a of e){if(!a.static)break;n+=r(a.static)}const s=e.map(a=>r(a.static)).reduce((a,l)=>a+l,0),i=e.filter(a=>a.param).length,o=e.filter(a=>a.glob).length;return{numberOfStaticPartsBeginning:n,numberOfStaticParts:s,numberOfParams:i,numberOfGlobs:o}}function u_(t){return t.startsWith(kc)||t.startsWith(Ps)}function Ko(t){const r=As(t,t);return g(r),Object.keys(r.routeParams).length===0}function et(t){return Pe()?`'${t}'`:(t===""&&(t="''"),T.cyan(t))}function d_(t){t.sort(f_).sort(Ge(e=>e.routeType==="FUNCTION"&&!!e.precedence&&e.precedence<0)).sort(Ge(e=>e.routeType==="STRING"&&Ko(e.routeString)===!1)).sort(Ge(e=>e.routeType==="FUNCTION"&&!e.precedence)).sort(Ge(e=>e.routeType==="STRING"&&Ko(e.routeString)===!0)).sort(Ge(e=>e.routeType==="FILESYSTEM")).sort(Ge(e=>e.routeType==="FUNCTION"&&!!e.precedence&&e.precedence>0))}function f_(t,e){{const r=t.precedence??0,n=e.precedence??0;if(r!==n)return r>n?-1:1}if(!e.routeString||!t.routeString)return 0;{const n=Rr(s=>Cr(s).numberOfStaticPartsBeginning)(t.routeString,e.routeString);if(n!==0)return n}{const n=Rr(s=>Cr(s).numberOfStaticParts)(t.routeString,e.routeString);if(n!==0)return n}{const n=hu(s=>Cr(s).numberOfGlobs)(t.routeString,e.routeString);if(n!==0)return n}{const n=Rr(s=>Cr(s).numberOfParams)(t.routeString,e.routeString);if(n!==0)return n}return 0}async function h_(t){const e={};if(!t._onBeforeRouteHook)return null;const r=await p_(t._onBeforeRouteHook,t);return r&&(D(e,r),O(e,"pageId","string")||O(e,"pageId","null"))?(O(e,"routeParams")?g(O(e,"routeParams","object")):D(e,{routeParams:{}}),D(e,{_routingProvidedByOnBeforeRouteHook:!0,_debugRouteMatches:"CUSTOM_ROUTING"}),e):(D(e,{_routingProvidedByOnBeforeRouteHook:!1}),e)}async function p_(t,e){let{hookReturn:r}=La(t,e,sn);Ec(r,`The onBeforeRoute() hook ${t.hookFilePath}`),r=await r;const n=`The onBeforeRoute() hook defined by ${t.hookFilePath}`;if(R(r==null||ww(r,["pageContext"])&&O(r,"pageContext"),`${n} should return ${T.cyan("null")}, ${T.cyan("undefined")}, or a plain JavaScript object ${T.cyan("{ pageContext: { /* ... */ } }")}`),r==null)return null;if(R(O(r,"pageContext","object"),`${n} returned ${T.cyan("{ pageContext }")} but pageContext should be a plain JavaScript object.`),O(r.pageContext,"pageId")&&!O(r.pageContext,"pageId","null")){const o=`${n} returned ${T.cyan("{ pageContext: { pageId } }")} but ${T.cyan("pageId")} should be`;R(O(r.pageContext,"pageId","string"),`${o} a string or null`),R(e._allPageIds.includes(r.pageContext.pageId),`${o} ${vw(e._allPageIds.map(a=>T.cyan(a)),"or")}`)}O(r.pageContext,"routeParams")&&bc(r.pageContext,`${n} returned ${T.cyan("{ pageContext: { routeParams } }")} but routeParams should`);const s=o=>`${n} returned ${T.cyan(`{ pageContext: { ${o} } }`)} which is deprecated. Return ${T.cyan("{ pageContext: { urlLogical } }")} instead.`;O(r.pageContext,"url")&&(V(!1,s("url"),{onlyOnce:!0}),r.pageContext.urlLogical=r.pageContext.url,delete r.pageContext.url),O(r.pageContext,"urlOriginal")&&(V(!1,s("urlOriginal"),{onlyOnce:!0}),r.pageContext.urlLogical=r.pageContext.urlOriginal,delete r.pageContext.urlOriginal),O(r.pageContext,"urlLogical")&&du(r.pageContext.urlLogical,`${n} returned ${T.cyan("{ pageContext: { urlLogical } }")} and ${T.cyan("urlLogical")}`),ic(r.pageContext,{hookFilePath:t.hookFilePath,hookName:"onBeforeRoute"});const i={};return D(i,r.pageContext),i}const Ft=ae("route/debug.ts",{});function Jo(...t){Ft.createDebugger&&(Ft.debug||(Ft.debug=Ft.createDebugger("vike:routing")),Ft.debug(...t))}Pe()&&wn();async function Dc(t,e){Jo("Pages routes:",t._pageRoutes);const r={};{const a=await h_(t);if(a){if(a._routingProvidedByOnBeforeRouteHook)return g(a.pageId),a;D(r,a)}D(t,a)}const n=t._allPageIds;R(n.length>0,"No page found. You must create at least one page."),g(t._pageFilesAll.length>0||t._pageConfigs.length>0);const{urlPathname:s}=t;g(s.startsWith("/"));const i=[];await Promise.all(t._pageRoutes.map(async a=>{const{pageId:l,routeType:c}=a;if(a.routeType==="FILESYSTEM"){const{routeString:u}=a,d=As(u,s);if(d){const{routeParams:f}=d;i.push({pageId:l,routeParams:f,routeString:u,routeType:c})}return}if(a.routeType==="STRING"){const{routeString:u}=a,d=As(u,s);if(d){const{routeParams:f}=d;g(c==="STRING"),i.push({pageId:l,routeString:u,routeParams:f,routeType:c})}return}if(a.routeType==="FUNCTION"){const{routeFunction:u,routeFunctionFilePath:d}=a,f=await vv(u,t,d);if(f){const{routeParams:h,precedence:y}=f;i.push({pageId:l,precedence:y,routeParams:h,routeType:c})}return}g(!1)})),d_(i);const o=i[0]??null;if(Jo(`Route matches for URL ${T.cyan(s)} (in precedence order):`,i),D(r,{_debugRouteMatches:i}),D(r,{_routeMatch:o}),!o)return D(r,{pageId:null,routeParams:{}}),r;{const{routeParams:a}=o;g(er(a)),D(r,{pageId:o.pageId,routeParams:o.routeParams})}return r}const Oc=ae("client-routing-runtime/getPageContextCurrent.ts",{pageContextCurrent:null});function xc(){const{pageContextCurrent:t}=Oc;return t}function Qo(t){Oc.pageContextCurrent=t}const Jr=5e3,Zo={staticAssets:"hover",pageContext:Jr},ks={staticAssets:"hover",pageContext:!1},g_=ks;function li(t,e){let r=g_;if("prefetchLinks"in t.exports&&R(!1,"`export { prefetchLinks }` is deprecated, use `export { prefetchStaticAssets }` instead."),"prefetchStaticAssets"in t.exports){const n=t.exports.prefetchStaticAssets;r.staticAssets=n}if("prefetch"in t.exports){const{prefetch:n}=t.exports;n===!0&&(r=Zo),n===!1&&(r=ks),Object.assign(r,n),r.pageContext===!0&&(r.pageContext=Jr)}if(r.staticAssets,e){{let n=e.getAttribute("data-prefetch");n!==null&&(n===""&&(n="true"),n==="true"&&(r=Zo),n==="false"&&(r=ks))}{let n=e.getAttribute("data-prefetch-static-assets");n!==null&&(n==="false"&&(r.staticAssets=!1),r.staticAssets=n)}{let n=e.getAttribute("data-prefetch-page-context");if(n!==null){n===""&&(n="true"),n==="true"&&(r.pageContext=Jr),n==="false"&&(r.pageContext=!1);const s=parseInt(n,10);Number.isNaN(s)||(r.pageContext=s)}}}return r}wn();const he=ae("client-routing-runtime/prefetch.ts",{linkPrefetchHandlerAdded:new WeakSet,addLinkPrefetchHandlers_debounce:null,mutationObserver:new MutationObserver(ci),linkTags:document.getElementsByTagName("A"),prefetchedPageContexts:{}});function y_(t){if(!li(t,null).pageContext)return null;const r=ui(t.urlPathname),n=he.prefetchedPageContexts[r];return!n||n.result.is404ServerSideRouted||Uc(n)?null:n.result.pageContextFromServerHooks}async function m_(t){try{await Cs(t.pageId,t._pageFilesAll,t._pageConfigs,t._pageConfigGlobal)}catch(e){if(oi(e))Os(e,!0);else throw e}}async function S_(t,e){const r=await bs(t,!1);$c(t,r,e)}function Xo(t,e){di()&&$c(t,e,null)}function $c(t,e,r){r===null&&(r=w_());const n=ui(t.urlPathname);g(di()),he.prefetchedPageContexts[n]={resultFetchedAt:Date.now(),resultMaxAge:r,result:e}}function w_(){const t=xc();if(!t)return 1/0;const e=li(t,null);return typeof e.pageContext=="number"?e.pageContext:Jr}function ci(){he.addLinkPrefetchHandlers_debounce&&clearTimeout(he.addLinkPrefetchHandlers_debounce),he.addLinkPrefetchHandlers_debounce=setTimeout(()=>{"requestIdleCallback"in window?requestIdleCallback(ea,{timeout:300}):setTimeout(ea,150)},250)}function DE(){ci()}function v_(){he.mutationObserver.observe(document.body,{childList:!0,subtree:!0})}function __(){he.mutationObserver.disconnect()}function ea(){for(let t of he.linkTags){if(he.linkPrefetchHandlerAdded.has(t)||(he.linkPrefetchHandlerAdded.add(t),Ac(t)))continue;t.addEventListener("mouseover",()=>{qn(t,"hover")},{passive:!0}),t.addEventListener("touchstart",()=>{qn(t,"hover")},{passive:!0}),new IntersectionObserver(r=>{r.forEach(n=>{n.isIntersecting&&qn(t,"viewport")})}).observe(t)}}async function qn(t,e){let r;const n=xc();if(n)r=li(n,t);else if(di())r={staticAssets:"hover",pageContext:1/0};else return;if(Ac(t))return;const s=t.getAttribute("href"),i=await E_(s);i?.pageId&&(g(O(i,"pageId","string")),await Rs(i.pageId,i)&&await Promise.all([(async()=>{r.staticAssets===e&&await m_(i)})(),(async()=>{if(e!=="viewport"&&r.pageContext){const o=ui(s),a=he.prefetchedPageContexts[o];if(!a||Uc(a)){const l=r.pageContext;await S_(i,l)}}})()]))}function Uc(t){return Date.now()-t.resultFetchedAt>t.resultMaxAge}async function E_(t){const e=await Cc(t);let r;try{r=await Dc(e)}catch{return null}return D(e,r),e}function ui(t){return t.startsWith("#")&&(t="/"),g(t.startsWith("/"),{urlPathname:t}),t.split("#")[0]}function di(){return"_isBrilloutDocpress"in window}async function b_(t,e){let r=null;r=Kn(t,"render");{const n=Kn(t,"onRenderClient");n&&(r=n)}if(!r){const n=I_(t);if(g(n),t._pageConfigs.length>0)R(!1,`No onRenderClient() hook defined for URL '${n}', but it's needed, see https://vike.dev/onRenderClient`);else{const s=t._pageFilesLoaded.filter(o=>o.fileType===".page.client");let i;s.length===0?i="No file `*.page.client.*` found for URL "+n:i="One of the following files should export a render() hook: "+s.map(o=>o.filePath).join(" "),R(!1,i)}}await Oa(r,t,e)}function I_(t){let e;try{e=t.urlPathname??t.urlOriginal}catch{}return e=e??window.location.href,e}R_();const Ds=ae("client-routing-runtime/history.ts",{previous:yi()});function Lc(){const t=Nc();if(Dt(t))return;const e=T_(t);gi(e)}function T_(t){const e=pi(),r=hi(),n="browser";let s;return t?s={timestamp:t.timestamp??e,scrollPosition:t.scrollPosition??r,triggeredBy:t.triggeredBy??n,_isVikeEnhanced:!0}:s={timestamp:e,scrollPosition:r,triggeredBy:n,_isVikeEnhanced:!0},g(Dt(s)),s}function fi(){const t=Nc();return g(Dt(t),{state:t}),t}function Nc(){return window.history.state}function hi(){return{x:window.scrollX,y:window.scrollY}}function pi(){return new Date().getTime()}function ta(){const t=hi(),e=fi();gi({...e,scrollPosition:t})}function C_(t,e){if(e)gi(fi(),t);else{const r={timestamp:pi(),scrollPosition:null,triggeredBy:"vike",_isVikeEnhanced:!0};window.history.pushState(r,"",t)}}function gi(t,e){const r=e??null;window.history.replaceState(t,"",r)}function ra(t,e){History.prototype.replaceState.bind(window.history)(t,"",e)}function OE(){["pushState","replaceState"].forEach(t=>{const e=window.history[t].bind(window.history);window.history[t]=(r={},...n)=>{R(r==null||q(r),`history.${t}(state) argument state must be an object`);const s=Dt(r)?r:{_isVikeEnhanced:!0,scrollPosition:hi(),timestamp:pi(),triggeredBy:"user",...r};g(Dt(s));const i=e(s,...n);return Ds.previous=yi(),i}})}function Dt(t){return!!(q(t)&&"_isVikeEnhanced"in t)}function yi(){return{url:ei(),state:fi()}}function xE(){const{previous:t}=Ds,e=window.history.state!==null;e||Lc(),g(Dt(window.history.state));const r=yi();return Ds.previous=r,{isHistoryStateEnhanced:e,previous:t,current:r}}function R_(){Lc()}function P_(t,e){if(!t&&e&&k_(e)){A_(e);return}if(t&&"x"in t){jc(t);return}if(t?.preserveScroll)return;const r=O_();D_(r)}function A_(t){const e=window.history.state;ra(null,t),g(window.history.state===null),window.location.replace(t),ra(e,t)}function k_(t){return t.includes("#")&&t.includes(":~:text")}function D_(t){if(!t)na();else{const e=decodeURIComponent(t),r=document.getElementById(e)||document.getElementsByName(e)[0];r?(r.scrollIntoView(),r.focus()):t==="top"&&na()}}function na(){jc({x:0,y:0})}function jc(t){const e=()=>{window.scrollTo(t.x,t.y)},r=()=>window.scrollX===t.x&&window.scrollY===t.y;r()||(e(),!r()&&requestAnimationFrame(()=>{e(),!r()&&setTimeout(async()=>{if(e(),r())return;const n=new Date().getTime();for(;;)if(await XS(10),e(),r()||new Date().getTime()-n>100)return},0)}))}function O_(){let{hash:t}=window.location;return t===""?null:(g(t.startsWith("#")),t=t.slice(1),t)}function $E(){window.addEventListener("scroll",ew(ta,Math.ceil(1e3/3)),{passive:!0}),tc(ta)}const Fc=ae("client-routing-runtime/scrollRestoration.ts",{});function UE(){sa(),tc(sa),tw(()=>Fc.initialRenderIsDone&&Mc())}function x_(){Fc.initialRenderIsDone=!0,Mc()}function Mc(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual")}function sa(){"scrollRestoration"in window.history&&(window.history.scrollRestoration="auto")}const M=ae("client-routing-runtime/renderPageClientSide.ts",(()=>{const{promise:t,resolve:e}=Zl();return{renderCounter:0,firstRenderStartPromise:t,firstRenderStartPromiseResolve:e}})()),{firstRenderStartPromise:LE}=M;async function ia(t){rw("renderPageClientSide()");const{urlOriginal:e=ei(),overwriteLastHistoryEntry:r=!1,isBackwardNavigation:n,pageContextsFromRewrite:s=[],redirectCount:i=0,doNotRenderIfSamePage:o,isClientSideNavigation:a=!0,pageContextInitClient:l}=t;let{scrollTarget:c}=t;const{previousPageContext:u}=M;__();const{isRenderOutdated:d,setHydrationCanBeAborted:f,isFirstRender:h}=L_();Pw(s.length,i);const y={urlOriginal:e,isBackwardNavigation:n,pageContextsFromRewrite:s,isClientSideNavigation:a,pageContextInitClient:l,isFirstRender:h};if(M.clientRoutingIsDisabled){Xe(e);return}if(M.firstRenderStartPromiseResolve(),d())return;await E();return;async function E(){const b=async m=>{await _({err:m})},p=await oa(!1,y);if(!d()){if(M.isFirstRenderDone&&(g(u),!M.isTransitioning)){M.isTransitioning=!0;const m=Jn("onPageTransitionStart",u),w=await Lr(m,p,lc);if("err"in w){await b(w.err);return}if(d())return}if(h){const m=$w();g(!("urlOriginal"in m)),D(p,m),Xo(p,{pageContextFromServerHooks:m})}else{let m;try{m=await Dc(p)}catch(v){await b(v);return}if(d())return;if(!m.pageId){Xe(e);return}g(O(m,"pageId","string"));const w=await Rs(m.pageId,p);if(d())return;if(!w){Xe(e);return}const S=m.pageId&&u?.pageId&&m.pageId===u.pageId;if(o&&S)return;g(!("urlOriginal"in m)),D(p,m)}try{D(p,await Cs(p.pageId,p._pageFilesAll,p._pageConfigs,p._pageConfigGlobal))}catch(m){if(aa(m,p,h))return;await b(m);return}if(!d()&&(Qo(p),p.exports.hydrationCanBeAborted?f():V(!ZS(),"You seem to be using React; we recommend setting hydrationCanBeAborted to true, see https://vike.dev/hydrationCanBeAborted",{onlyOnce:!0}),!d()))if(h){g(O(p,"_hasPageContextFromServer","true"));let m;try{m=await Uw(p)}catch(w){await b(w);return}if(d())return;$r(p,m),await I(p)}else{let m;const w=y_(p);if(w)m=w;else try{const v=await bs(p,!1);if(v.is404ServerSideRouted)return;m=v.pageContextFromServerHooks,Xo(p,v)}catch(v){await b(v);return}if(d())return;g(!("urlOriginal"in m)),D(p,m);let S;try{S=await Ho(p,!1)}catch(v){await b(v);return}if(d())return;$r(p,S),await I(p)}}}async function _(b){const p=x=>{jo(x,b.err)||console.error(x)};if("err"in b){const{err:x}=b;g(x),zo(x)||console.error(x)}const m=await oa(!0,y);if(d())return;if(D(m,{routeParams:{}}),b.is404&&D(m,{is404:!0}),b.pageContextError&&D(m,b.pageContextError),"err"in b){const{err:x}=b;if(g(!("errorWhileRendering"in m)),D(m,{errorWhileRendering:x}),zo(x)){const F=x._pageContextAbort;if(F._urlRewrite){await ia({...t,scrollTarget:void 0,pageContextsFromRewrite:[...s,F]});return}if(F._urlRedirect){const we=F._urlRedirect.url;if(we.startsWith("/"))await ia({...t,scrollTarget:void 0,urlOriginal:we,overwriteLastHistoryEntry:!1,isBackwardNavigation:!1,redirectCount:i+1});else{Xe(we);return}return}g(F.abortStatusCode),g(!("urlOriginal"in F)),D(m,F),F.abortStatusCode===404&&D(m,{is404:!0})}else D(m,{is404:!1})}const w=Qw(m._pageFilesAll,m._pageConfigs);if(!w)throw new Error("No error page defined.");D(m,{pageId:w});const S=await Rs(m.pageId,m);if(d())return;if(!S){Xe(e);return}try{D(m,await Cs(m.pageId,m._pageFilesAll,m._pageConfigs,m._pageConfigGlobal))}catch(x){if(aa(x,m,h))return;p(x);return}if(d())return;Qo(m);let v;try{const x=await bs(m,!0);if(x.is404ServerSideRouted)return;v=x.pageContextFromServerHooks}catch(x){p(x);return}if(d())return;g(!("urlOriginal"in v)),D(m,v);let C;try{C=await Ho(m,!0)}catch(x){p(x);return}d()||($r(m,C),await I(m,b))}async function I(b,p){const m=async v=>{p?jo(v,p.err)||console.error(v):await _({err:v})};if(M.onRenderClientPreviousPromise&&(await M.onRenderClientPreviousPromise,g(M.onRenderClientPreviousPromise===void 0),d()))return;U_(e,r),M.previousPageContext=b,g(M.onRenderClientPreviousPromise===void 0);const w=(async()=>{let v;try{await b_(b,Zt)}catch(C){v=C}return M.onRenderClientPreviousPromise=void 0,M.isFirstRenderDone=!0,v})();M.onRenderClientPreviousPromise=w;const S=await w;if(g(M.onRenderClientPreviousPromise===void 0),!(S&&(await m(S),!p))){if(h&&!S){const v=await xa("onHydrationEnd",b,Zt);if("err"in v&&(await m(v.err),!p)||d(!0))return}if(!d(!0)){if(M.isTransitioning){M.isTransitioning=void 0,g(u);const v=Jn("onPageTransitionEnd",u),C=await Lr(v,b,Zt);if("err"in C&&(await m(C.err),!p)||d(!0))return}if(!c&&u){const v=la(u),C=la(b);C!==!1&&v!==!1&&N_(C,v)&&(c={preserveScroll:!0})}P_(c,e),x_(),b._hasPageContextFromServer&&jw(b),v_(),ci(),M.renderedPageContext=b,$_(e)}}}}async function oa(t,{urlOriginal:e,isBackwardNavigation:r,pageContextsFromRewrite:n,isClientSideNavigation:s,pageContextInitClient:i,isFirstRender:o}){const a=M.previousPageContext??null,l=await Cc(e);D(l,{isBackwardNavigation:r,isClientSideNavigation:s,isHydration:o&&!t,previousPageContext:a,...i}),Object.defineProperty(l,"_previousPageContext",{get(){return V(!1,"pageContext._previousPageContext has been renamed pageContext.previousPageContext",{showStackTrace:!0,onlyOnce:!0}),a},enumerable:!1});{const c=Cw(n);g(!("urlOriginal"in c)),D(l,c)}return l}function $_(t){window._vike??(window._vike={}),window._vike.fullyRenderedUrl=t}function U_(t,e){ei()!==t&&C_(t,e)}function aa(t,e,r){if(!oi(t))return!1;if(r)throw Os(t,!1),t;return Os(t,!0),Xe(e.urlOriginal),!0}function Os(t,e){g(oi(t)),M.clientRoutingIsDisabled=!0,e&&console.log(t),eu(!1,["Failed to fetch static asset.","This usually happens when a new frontend is deployed.","Falling back to Server Routing.","(The next page navigation will use Server Routing instead of Client Routing.)"].filter(Boolean).join(" "),{onlyOnce:!0})}function L_(){const t=++M.renderCounter;g(t>=1);let e=!1;return{isRenderOutdated:s=>t===1&&!e&&!s?!1:t!==M.renderCounter,setHydrationCanBeAborted:()=>{e=!0},isFirstRender:t===1}}function NE(){return M.renderCounter}function la(t){const e=t.from.configsStandard.keepScrollPosition;if(!e)return!1;let r=e.value;const n=e.definedAt;g(n);const s=c_(n);return ze(r)&&(r=r(t,{configDefinedAt:e.definedAt})),r===!0?[n,...s.map(i=>{const o=t.routeParams[i];return g(o),o})]:r}function N_(t,e){return t===e?!0:!Array.isArray(t)||!Array.isArray(e)?!1:t.length===e.length&&t.every((r,n)=>t[n]===e[n])}export{va as $,rE as A,Hy as B,gE as C,yE as D,mE as E,oE as F,nE as G,SE as H,uE as I,Rt as J,rd as K,on as L,js as M,ja as N,Na as O,jr as P,id as Q,Ce as R,wE as S,tE as T,nd as U,M_ as V,Ci as W,W_ as X,H_ as Y,R as Z,wa as _,vE as a,LE as a0,ia as a1,wn as a2,X_ as a3,RE as a4,_E as a5,rw as a6,xE as a7,P_ as a8,kE as a9,D_ as aa,Ac as ab,DE as ac,UE as ad,OE as ae,R_ as af,$E as ag,g as ah,NE as ai,F_ as aj,bt as ak,Fe as al,rt as am,nt as an,Et as ao,st as ap,Qs as aq,ne as ar,Re as as,bE as b,U as c,HS as d,MS as e,He as f,BS as g,ed as h,B_ as i,z_ as j,Nr as k,CE as l,zS as m,IE as n,PE as o,xe as p,Sn as q,AE as r,TE as s,eE as t,EE as u,Xy as v,Wy as w,Qy as x,pE as y,sE as z};
