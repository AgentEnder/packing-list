import{j as e,az as C,ao as F,aD as O,H as V,aE as Y,M as q}from"./chunk-CkW1dBBz.js";import{r as x}from"./chunk-pSdIku02.js";import{u as G,b as J,f as u}from"./chunk-Bwb-TI-m.js";import{R as K}from"./chunk-BWj-pErp.js";const Q={leave_home:"Leave Home",arrive_destination:"Arrive at Destination",leave_destination:"Leave Destination",arrive_home:"Arrive Home"},E={leave_home:e.jsx(Y,{className:"w-4 h-4"}),arrive_destination:e.jsx(V,{className:"w-4 h-4"}),leave_destination:e.jsx(O,{className:"w-4 h-4"}),arrive_home:e.jsx(F,{className:"w-4 h-4"})};function X({events:m,onEventClick:v,className:p=""}){if(m.length===0)return e.jsx("div",{className:`text-center text-gray-500 py-8 ${p}`,children:"No events in timeline"});const r=[...m].sort((s,n)=>s.date.localeCompare(n.date));return e.jsx("ul",{className:`timeline timeline-vertical ${p}`,children:r.map((s,n)=>e.jsxs("li",{children:[n>0&&e.jsx("hr",{}),e.jsx("div",{className:"timeline-start text-end",children:C(s.date)}),e.jsx("div",{className:"timeline-middle",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-base-200 rounded-full",children:E[s.type]||E.arrive_destination})}),e.jsxs("div",{className:`timeline-end timeline-box ${v?"cursor-pointer hover:bg-base-200":""}`,onClick:()=>v?.(s),"data-testid":`timeline-event-${s.type}${s.location?`-${s.location}`:""}`,children:[e.jsx("div",{className:"font-semibold","data-testid":`timeline-event-title-${s.type}`,children:Q[s.type]||s.type}),s.location&&e.jsx("div",{className:"text-sm text-gray-600","data-testid":`timeline-event-location-${s.location}`,children:s.location}),s.notes&&e.jsx("div",{className:"text-xs text-gray-500 mt-1","data-testid":`timeline-event-notes-${s.id}`,children:s.notes})]}),n<r.length-1&&e.jsx("hr",{})]},s.id))})}const ee=[{id:1,title:"Trip Duration"},{id:2,title:"Destinations"},{id:3,title:"Review"},{id:4,title:"Packing Rules",optional:!0}];function ae(m){const v=m.find(i=>i.type==="leave_home"),p=m.find(i=>i.type==="arrive_home"),r=m.filter(i=>i.type==="arrive_destination"),s=m.filter(i=>i.type==="leave_destination"),n=[];return r.forEach(i=>{const t=s.find(D=>D.location===i.location);t&&i.location&&n.push({id:u(),location:i.location,arriveDate:i.date,leaveDate:t.date,arriveNotes:i.notes,leaveNotes:t.notes})}),{leaveHomeDate:v?.date||"",arriveHomeDate:p?.date||"",leaveHomeNotes:v?.notes||"",arriveHomeNotes:p?.notes||"",destinations:n.sort((i,t)=>i.arriveDate.localeCompare(t.arriveDate))}}function ne({open:m,onClose:v,onSave:p,currentEvents:r=[],fullPage:s=!1}){const n=G(),i=J(a=>a.ui.tripWizard.currentStep),[t,D]=x.useState({leaveHomeDate:"",arriveHomeDate:"",leaveHomeNotes:"",arriveHomeNotes:""}),[c,j]=x.useState([]),[l,h]=x.useState({id:"",location:"",arriveDate:"",leaveDate:"",arriveNotes:"",leaveNotes:""}),[f,H]=x.useState(null);x.useEffect(()=>{if(r.length>0){const a=ae(r);D({leaveHomeDate:a.leaveHomeDate,arriveHomeDate:a.arriveHomeDate,leaveHomeNotes:a.leaveHomeNotes,arriveHomeNotes:a.arriveHomeNotes}),j(a.destinations)}},[r]);const b=a=>{D({...t,[a.target.name]:a.target.value})},N=a=>{h({...l,[a.target.name]:a.target.value})},S=()=>{!l.location||!l.arriveDate||!l.leaveDate||(j([...c,{...l,id:u()}]),h({id:"",location:"",arriveDate:"",leaveDate:"",arriveNotes:"",leaveNotes:""}))},A=a=>{j(c.filter(d=>d.id!==a))},R=a=>{const d=c.find(o=>o.id===a);d&&(h(d),H(a))},k=()=>{f&&(j(c.map(a=>a.id===f?{...l,id:a.id}:a)),h({id:"",location:"",arriveDate:"",leaveDate:"",arriveNotes:"",leaveNotes:""}),H(null))},$=()=>{h({id:"",location:"",arriveDate:"",leaveDate:"",arriveNotes:"",leaveNotes:""}),H(null)},g=()=>{const a=[];return t.leaveHomeDate&&a.push({id:u(),type:"leave_home",date:t.leaveHomeDate,notes:t.leaveHomeNotes}),[...c].sort((o,w)=>o.arriveDate.localeCompare(w.arriveDate)).forEach(o=>{a.push({id:u(),type:"arrive_destination",date:o.arriveDate,location:o.location,notes:o.arriveNotes}),a.push({id:u(),type:"leave_destination",date:o.leaveDate,location:o.location,notes:o.leaveNotes})}),t.arriveHomeDate&&a.push({id:u(),type:"arrive_home",date:t.arriveHomeDate,notes:t.arriveHomeNotes}),a},P=()=>{const a=g();p(a),s||v()},B=()=>{const a=g();p(a),s||v()},W=()=>{v(),h({id:"",location:"",arriveDate:"",leaveDate:"",arriveNotes:"",leaveNotes:""}),n({type:"SET_WIZARD_STEP",payload:{step:1}})},T=a=>{switch(a){case 1:return!0;case 2:return!!(t.leaveHomeDate&&t.arriveHomeDate);case 3:return!!(t.leaveHomeDate&&t.arriveHomeDate)&&c.length>0;case 4:return!!(t.leaveHomeDate&&t.arriveHomeDate)&&c.length>0;default:return!1}},I=a=>{T(a)&&n({type:"SET_WIZARD_STEP",payload:{step:a}})},z=!!(t.leaveHomeDate&&t.arriveHomeDate),L=c.length>0,U=()=>!t.leaveHomeDate||!t.arriveHomeDate?!1:t.leaveHomeDate<=t.arriveHomeDate,y=(a,d,o=!0,w=!1)=>e.jsxs("div",{className:"flex justify-between mt-6",children:[a?e.jsx("button",{className:"btn",onClick:()=>n({type:"SET_WIZARD_STEP",payload:{step:a}}),children:"Back"}):e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[w&&e.jsx("button",{className:"btn btn-primary",onClick:P,children:r.length>0?"Update Trip":"Save Trip"}),d&&e.jsx("button",{className:"btn btn-primary",onClick:()=>n({type:"SET_WIZARD_STEP",payload:{step:d}}),disabled:!o||i===1&&!U(),children:"Next"})]})]}),Z=a=>{const d=T(a.id);return`step ${i>=a.id?"step-primary":""} ${d?"cursor-pointer":"cursor-not-allowed opacity-50"}`},M=()=>{switch(i){case 1:return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Trip Duration"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"When do you leave home?"})}),e.jsx("input",{type:"date",name:"leaveHomeDate",value:t.leaveHomeDate,onChange:b,className:"input input-bordered w-full"}),e.jsx("textarea",{name:"leaveHomeNotes",value:t.leaveHomeNotes,onChange:b,placeholder:"Notes (e.g., flight details)",className:"textarea textarea-bordered w-full mt-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"When do you return home?"})}),e.jsx("input",{type:"date",name:"arriveHomeDate",value:t.arriveHomeDate,onChange:b,className:"input input-bordered w-full"}),e.jsx("textarea",{name:"arriveHomeNotes",value:t.arriveHomeNotes,onChange:b,placeholder:"Notes (e.g., flight details)",className:"textarea textarea-bordered w-full mt-2"})]})]}),y(null,2,z)]});case 2:return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Add Destinations"}),c.length>0&&e.jsx("div",{className:"space-y-2","data-testid":"destinations-list",children:c.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-base-200 p-3 rounded",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:a.location}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[C(a.arriveDate)," -"," ",C(a.leaveDate)]}),(a.arriveNotes||a.leaveNotes)&&e.jsxs("div",{className:"mt-2 text-sm",children:[a.arriveNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Arrival:"})," ",a.arriveNotes]}),a.leaveNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Departure:"})," ",a.leaveNotes]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>R(a.id),"data-testid":`edit-destination-${a.location}`,children:"Edit"}),e.jsx("button",{className:"btn btn-sm btn-error",onClick:()=>A(a.id),children:"Remove"})]})]},a.id))}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 p-4 rounded",children:[e.jsx("h5",{className:"text-sm font-medium mb-3",children:f?"Edit Destination":"Add New Destination"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",name:"location",placeholder:"Destination",className:"input input-bordered w-full",value:l.location,onChange:N}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Arrival Date"})}),e.jsx("input",{type:"date",name:"arriveDate",className:"input input-bordered w-full",value:l.arriveDate,onChange:N,min:t.leaveHomeDate,max:t.arriveHomeDate}),e.jsx("textarea",{name:"arriveNotes",placeholder:"Arrival notes (optional)",className:"textarea textarea-bordered w-full",value:l.arriveNotes,onChange:N})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Departure Date"})}),e.jsx("input",{type:"date",name:"leaveDate",className:"input input-bordered w-full",value:l.leaveDate,onChange:N,min:l.arriveDate||t.leaveHomeDate,max:t.arriveHomeDate}),e.jsx("textarea",{name:"leaveNotes",placeholder:"Departure notes (optional)",className:"textarea textarea-bordered w-full",value:l.leaveNotes,onChange:N})]})]})]}),e.jsx("div",{className:"flex justify-end gap-2 mt-4",children:f?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-ghost",onClick:$,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:k,disabled:!l.location||!l.arriveDate||!l.leaveDate,children:"Update Destination"})]}):e.jsx("button",{className:"btn btn-outline btn-primary",onClick:S,disabled:!l.location||!l.arriveDate||!l.leaveDate,children:"Add Destination"})})]}),y(1,3,!!L)]});case 3:return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Review Your Trip"}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx(X,{events:g(),className:"max-w-xl mx-auto"})}),y(2,4,!0,!0)]});case 4:return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Suggested Packing Rules"}),e.jsx("p",{className:"text-base-content/70",children:"Based on your trip details, here are some suggested rule packs that might be helpful. You can always modify these later from the Defaults page."}),e.jsx(K,{onRulesApplied:B}),y(3,null,!0,!0)]});default:return null}};x.useEffect(()=>{if(i===4){const a=g();n({type:"UPDATE_TRIP_EVENTS",payload:a})}},[i]);const _=e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"steps steps-horizontal w-full mb-6",children:ee.map(a=>e.jsxs("li",{className:Z(a),onClick:()=>I(a.id),children:[a.title,a.optional&&e.jsx("span",{className:"text-xs text-base-content/60 ml-1",children:"(Optional)"})]},a.id))}),M()]});return s?e.jsx("div",{className:"px-4",children:_}):e.jsx(q,{isOpen:m,onClose:W,title:r.length>0?"Edit Trip":"Configure Trip",size:"2xl",modalBoxClassName:"w-11/12 max-w-2xl",children:_})}export{ne as T};
