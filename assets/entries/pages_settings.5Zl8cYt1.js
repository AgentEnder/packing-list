import{R as Ce,e as ue,V as ke,j as e,A as z,Y as Z,Z as De,h as fe,_ as Ae,Q as J,M as ge,C as pe,g as Q,l as je,$ as be,O as ye,T as V,a0 as me,a1 as ne,a2 as Te,a3 as Ee,N as Me,w as Oe,a4 as re,a5 as q,a6 as Le,a7 as Pe,a8 as _e,a9 as Re,aa as R,ab as $e,ac as se,ad as Ve,ae as G,af as Ue,ag as Ie,ah as Fe,ai as ve,aj as le,ak as Be,al as Ne,am as we,an as ie,ao as We,p as ze,S as te,ap as He,aq as Ye,n as Ke,U as qe,ar as Je,i as Ge,W as Ze,o as Qe,L as Xe,a as es,b as ss,c as ts,d as as}from"../chunks/chunk-CkW1dBBz.js";import{J as H,K as ns,L as rs,M as ee,N as ls,O as is,P as ae,Q as cs,t as os,R as F,b as ds,u as oe,S as ms,T as hs}from"../chunks/chunk-Bwb-TI-m.js";import{r as S,R as ce,a as X}from"../chunks/chunk-pSdIku02.js";import{a as xs,e as us,n as fs}from"../chunks/chunk-FfNSx1qK.js";import{P as gs,a as ps}from"../chunks/chunk-CIGAIrCQ.js";import{a as he}from"../chunks/chunk-pm1Kw1LK.js";/* empty css                      *//* empty css                      *//* empty css                      */function W(n,a,o){const{years:l=0,months:c=0,weeks:m=0,days:r=0,hours:g=0,minutes:f=0,seconds:v=0}=a,p=H(n,o?.in),u=c||l?xs(p,c+l*12):p,D=r||m?ns(u,r+m*7):u,h=f+g*60,N=(v+h*60)*1e3;return rs(n,+D+N)}function js(n,a,o){const[l,c]=ee(o?.in,n,a),m=l.getFullYear()-c.getFullYear(),r=l.getMonth()-c.getMonth();return m*12+r}function bs(n,a,o){const[l,c]=ee(o?.in,n,a),m=xe(l,c),r=Math.abs(Ce(l,c));l.setDate(l.getDate()-m*r);const g=+(xe(l,c)===-m),f=m*(r-g);return f===0?0:f}function xe(n,a){const o=n.getFullYear()-a.getFullYear()||n.getMonth()-a.getMonth()||n.getDate()-a.getDate()||n.getHours()-a.getHours()||n.getMinutes()-a.getMinutes()||n.getSeconds()-a.getSeconds()||n.getMilliseconds()-a.getMilliseconds();return o<0?-1:o>0?1:o}function de(n){return a=>{const l=(n?Math[n]:Math.trunc)(a);return l===0?0:l}}function ys(n,a,o){const[l,c]=ee(o?.in,n,a),m=(+l-+c)/ls;return de(o?.roundingMethod)(m)}function Se(n,a){return+H(n)-+H(a)}function vs(n,a,o){const l=Se(n,a)/is;return de(o?.roundingMethod)(l)}function Ns(n,a){const o=H(n,a?.in);return o.setHours(23,59,59,999),o}function ws(n,a){const o=H(n,a?.in);return+Ns(o,a)==+us(o,a)}function Ss(n,a,o){const[l,c,m]=ee(o?.in,n,n,a),r=ae(c,m),g=Math.abs(js(c,m));if(g<1)return 0;c.getMonth()===1&&c.getDate()>27&&c.setDate(30),c.setMonth(c.getMonth()-r*g);let f=ae(c,m)===-r;ws(l)&&g===1&&ae(l,m)===1&&(f=!1);const v=r*(g-+f);return v===0?0:v}function Cs(n,a,o){const l=Se(n,a)/1e3;return de(o?.roundingMethod)(l)}function ks(n,a){const{start:o,end:l}=fs(a?.in,n),c={},m=cs(l,o);m&&(c.years=m);const r=W(o,{years:c.years}),g=Ss(l,r);g&&(c.months=g);const f=W(r,{months:c.months}),v=bs(l,f);v&&(c.days=v);const p=W(f,{days:c.days}),u=ys(l,p);u&&(c.hours=u);const D=W(p,{hours:c.hours}),h=vs(l,D);h&&(c.minutes=h);const b=W(D,{minutes:c.minutes}),N=Cs(l,b);return N&&(c.seconds=N),c}function Ds({onSignOut:n,onAccountDeleted:a,showToast:o}){const{user:l,signOut:c,deleteAccount:m,loading:r}=ue(),{openLoginModal:g}=ke(),[f,v]=S.useState(!1),[p,u]=S.useState(""),[D,h]=S.useState(!1),[b,N]=S.useState(null),E=()=>{if(l?.created_at){const x=new Date(l.created_at),i=ks({start:x,end:new Date}),w=[];return i.years&&i.years>0&&w.push(`${i.years} year${i.years===1?"":"s"}`),i.months&&i.months>0&&w.push(`${i.months} month${i.months===1?"":"s"}`),i.days&&i.days>0&&w.push(`${i.days} day${i.days===1?"":"s"}`),i.hours&&i.hours>0&&w.push(`${i.hours} hour${i.hours===1?"":"s"}`),i.minutes&&i.minutes>0&&w.push(`${i.minutes} minute${i.minutes===1?"":"s"}`),i.seconds&&i.seconds>0&&w.push(`${i.seconds} second${i.seconds===1?"":"s"}`),w.join(", ")}return"Unknown"};if(S.useEffect(()=>{if(l?.created_at){const x=()=>{const i=E();N(i)};x();const y=setInterval(x,1e3);return()=>clearInterval(y)}else return N(null),()=>{}},[l?.created_at]),!l)return e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title",children:[e.jsx(z,{className:"w-5 h-5"}),"Account"]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Sign in to access more features"}),e.jsx("div",{className:"text-sm",children:"Create an account to sync your packing lists across devices and access additional features."})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{className:"btn btn-primary",onClick:g,children:"Sign In / Sign Up"})})]})});const O=async()=>{try{const x=await c();if(x.type.endsWith("/rejected"))throw new Error(x.payload||"Sign out failed");o?.("Successfully signed out"),n?.()}catch(x){o?.("Error signing out. See console for details."),console.error(x)}},t=async()=>{if(p!=="DELETE"){o?.('Please type "DELETE" to confirm account deletion');return}h(!0);try{const x=await m();if(x.type.endsWith("/rejected")){const y=x.payload||"Unknown error occurred";o?.(`Error deleting account: ${y}`)}else o?.("Account successfully deleted"),a?.()}catch(x){o?.("Error deleting account. See console for details."),console.error(x)}h(!1),v(!1),u("")};return e.jsxs("div",{className:"card bg-base-100 shadow-xl",children:[e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title",children:[e.jsx(z,{className:"w-5 h-5"}),"Account Management"]}),e.jsx("p",{className:"text-base-content/70",children:"Manage your account settings, security, and data."}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Account Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-base-content/70"}),e.jsx("span",{className:"text-sm font-medium",children:"Email:"}),e.jsx("span",{className:"text-sm",children:l.email})]}),l.name&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-base-content/70"}),e.jsx("span",{className:"text-sm font-medium",children:"Name:"}),e.jsx("span",{className:"text-sm",children:l.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4 text-base-content/70"}),e.jsx("span",{className:"text-sm font-medium",children:"Member for:"}),e.jsx("span",{className:"text-sm",children:b})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-base-content/70"}),e.jsx("span",{className:"text-sm font-medium",children:"User ID:"}),e.jsx("span",{className:"text-sm font-mono text-xs",children:l.id})]})]})]})}),e.jsx("div",{className:"divider mt-8"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[e.jsxs("button",{className:`btn btn-error btn-outline ${r?"loading":""}`,onClick:O,disabled:r,children:[e.jsx(Ae,{className:"w-4 h-4"}),"Sign Out"]}),e.jsxs("button",{className:"btn btn-error",onClick:()=>v(!0),children:[e.jsx(J,{className:"w-4 h-4"}),"Delete Account"]})]})]}),e.jsxs(ge,{isOpen:f,onClose:()=>{v(!1),u("")},title:"Delete Account",size:"md","data-testid":"delete-confirm-modal",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"alert alert-error",children:e.jsxs("div",{className:"flex",children:[e.jsx(J,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:"This action cannot be undone!"}),e.jsx("div",{className:"text-sm",children:"This will permanently delete your account and all associated data."})]})]})}),e.jsxs("p",{children:["To confirm, type ",e.jsx("strong",{children:"DELETE"})," in the box below:"]}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Type DELETE to confirm",value:p,onChange:x=>u(x.target.value),disabled:D})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{className:"btn",onClick:()=>{v(!1),u("")},children:"Cancel"}),e.jsxs("button",{className:`btn btn-error ${D?"loading":""}`,onClick:t,disabled:D||p!=="DELETE",children:[!D&&e.jsx(J,{className:"w-4 h-4"}),"Delete Account"]})]})]})]})}function As({userId:n,userEmail:a}){const{user:o,hasOfflinePasscode:l,offlineAccounts:c,setOfflinePasscode:m,removeOfflinePasscode:r,isOfflineMode:g}=os(),[f,v]=S.useState(!1),[p,u]=S.useState(""),[D,h]=S.useState(""),[b,N]=S.useState(""),[E,O]=S.useState(""),[t,x]=S.useState(!1),[y,i]=S.useState(null),[w,L]=S.useState(null),$=n||o?.id,P=a||o?.email,U=c.find(M=>M.id===$||M.email===P),B=async M=>{if(M.preventDefault(),i(null),L(null),D!==b){i("Passcodes do not match");return}if(D.length<4){i("Passcode must be at least 4 characters");return}try{await m(p||void 0,D,$),L("Offline passcode set successfully"),v(!1),u(""),h(""),N("")}catch(I){i(I instanceof Error?I.message:"Failed to set passcode")}},Y=async M=>{M.preventDefault(),i(null),L(null);try{await r(E,$),L("Offline passcode removed successfully"),x(!1),O("")}catch(I){i(I instanceof Error?I.message:"Failed to remove passcode")}};return U?e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Offline Account Security"}),e.jsxs("p",{className:"text-sm text-base-content/70 mb-4",children:["Manage passcode protection for your offline account (",P,")"]}),y&&e.jsx("div",{className:"alert alert-error mb-4",children:e.jsx("span",{children:y})}),w&&e.jsx("div",{className:"alert alert-success mb-4",children:e.jsx("span",{children:w})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Passcode Protection"}),e.jsx("p",{className:"text-sm text-base-content/70",children:l?"Passcode is enabled for this offline account":"No passcode set - passwordless access enabled"})]}),e.jsx("div",{className:"badge badge-lg",children:l?"Protected":"Unprotected"})]})}),!f&&!t&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>v(!0),children:l?"Change Passcode":"Set Passcode"}),l&&e.jsx("button",{className:"btn btn-outline btn-error",onClick:()=>x(!0),children:"Remove Passcode"})]}),f&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:l?"Change Passcode":"Set New Passcode"}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[!g&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Current Password (for verification)"})}),e.jsx("input",{type:"password",className:"input input-bordered",value:p,onChange:M=>u(M.target.value),placeholder:"Your current online password"})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"New Passcode"})}),e.jsx("input",{type:"password",className:"input input-bordered",value:D,onChange:M=>h(M.target.value),placeholder:"Enter 4+ digit passcode",required:!0,minLength:4})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Confirm Passcode"})}),e.jsx("input",{type:"password",className:"input input-bordered",value:b,onChange:M=>N(M.target.value),placeholder:"Confirm your passcode",required:!0,minLength:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:l?"Update Passcode":"Set Passcode"}),e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:M=>{M.preventDefault(),v(!1),u(""),h(""),N(""),i(null)},children:"Cancel"})]})]})]}),t&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Remove Passcode Protection"}),e.jsx("p",{className:"text-sm text-warning mb-4",children:"Warning: Removing passcode protection will allow passwordless access to this offline account."}),e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Current Passcode"})}),e.jsx("input",{type:"password",className:"input input-bordered",value:E,onChange:M=>O(M.target.value),placeholder:"Enter current passcode",required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-error",children:"Remove Passcode"}),e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:M=>{M.preventDefault(),x(!1),O(""),i(null)},children:"Cancel"})]})]})]})]})}):e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current flex-shrink-0 w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"No offline account found. Sign in online first to create an offline account."})]})})}const Ts=({localValue:n,serverValue:a,path:o="",showPath:l=!1,expanded:c=!1})=>{const[m,r]=S.useState(c),g=h=>h===void 0?"(undefined)":h===null?"null":typeof h=="boolean"?h.toString():typeof h=="string"?`"${h}"`:typeof h=="number"?h.toString():Array.isArray(h)?`[${h.length} items]`:typeof h=="object"?`{${Object.keys(h).length} properties}`:String(h),f=h=>h!=null&&typeof h=="object"&&Object.keys(h).length>0,v=(h,b,N)=>{const E=new Set([...Object.keys(h),...Object.keys(b)]);return Array.from(E).reduce((O,t)=>{const x=N?`${N}.${t}`:t,y=h[t],i=b[t];let w="same";return t in h?t in b?F(y,i)||(w="changed"):w="removed":w="added",w==="same"||O.push(e.jsxs("div",{className:"ml-4 border-l border-gray-200 pl-3 py-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[w==="added"&&e.jsx(je,{className:"h-3 w-3 text-green-600"}),w==="removed"&&e.jsx(be,{className:"h-3 w-3 text-red-600"}),w==="changed"&&e.jsx(ye,{className:"h-3 w-3 text-yellow-600"}),e.jsxs("span",{className:"font-mono text-xs",children:[t,":"]})]}),e.jsxs("div",{className:"ml-5 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:`p-1 rounded ${w==="removed"?"bg-red-50 text-red-700":w==="changed"?"bg-yellow-50 text-yellow-700":"bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Local"}),e.jsx("div",{className:"font-mono",children:w==="added"?"(not present)":g(y)})]}),e.jsxs("div",{className:`p-1 rounded ${w==="added"?"bg-green-50 text-green-700":w==="changed"?"bg-yellow-50 text-yellow-800":"bg-gray-50"}`,children:[e.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Server"}),e.jsx("div",{className:"font-mono",children:w==="removed"?"(not present)":g(i)})]})]}),w==="changed"&&y&&i&&typeof y=="object"&&typeof i=="object"&&!Array.isArray(y)&&!Array.isArray(i)?e.jsx("div",{className:"mt-2",children:v(y,i,x)}):null]},x)),O},[])};if(!f(n)&&!f(a))return F(n,a)?e.jsx("div",{className:"text-sm text-gray-600",children:"Values are identical"}):e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Local"}),e.jsx("div",{className:"font-mono text-yellow-700",children:g(n)})]}),e.jsxs("div",{className:"p-2 bg-yellow-50 border border-yellow-200 rounded",children:[e.jsx("div",{className:"font-medium text-gray-600 mb-1",children:"Server"}),e.jsx("div",{className:"font-mono text-yellow-800",children:g(a)})]})]});const p=f(n)?n:{},u=f(a)?a:{};return F(p,u)?e.jsx("div",{className:"text-sm text-gray-600",children:"Objects are identical"}):e.jsxs("div",{className:"space-y-2",children:[l&&o&&e.jsxs("div",{className:"text-xs text-gray-500 font-mono",children:["Path: ",o]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg",children:[e.jsxs("button",{onClick:()=>r(!m),className:"w-full flex items-center justify-between p-3 text-left hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[m?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Object Differences"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[m?"Collapse":"Expand"," details"]})]}),m&&e.jsx("div",{className:"border-t border-gray-200 p-3 bg-gray-50",children:v(p,u,o)})]})]})},Es=({localData:n,serverData:a,expanded:o=!0,conflict:l,showOnlyConflicts:c=!1})=>{const[m,r]=ce.useState(o),g=ce.useMemo(()=>{if(l?.conflictDetails?.conflicts){const t=new Set(l.conflictDetails.conflicts.map(y=>y.path)),x=l.conflictDetails.conflicts.map(y=>{const i=y.path.split("."),w=i[0],L=i.length>1;return{key:w,localValue:y.localValue,serverValue:y.serverValue,type:y.type==="modified"?"changed":y.type==="added"?"added":"removed",path:y.path,isNested:L}});if(!c){const y=new Set([...Object.keys(n),...Object.keys(a)]);for(const i of y)if(!t.has(i)){const w=n[i],L=a[i];x.push({key:i,localValue:w,serverValue:L,type:"same"})}}return x}else{const t=new Set([...Object.keys(n),...Object.keys(a)]);return Array.from(t).map(x=>{const y=n[x],i=a[x];return x in n?x in a?F(y,i)?{key:x,localValue:y,serverValue:i,type:"same"}:{key:x,localValue:y,serverValue:i,type:"changed"}:{key:x,localValue:y,serverValue:void 0,type:"removed"}:{key:x,localValue:void 0,serverValue:i,type:"added"}})}},[n,a,l,c]),f=t=>["timestamp","createdAt","updatedAt","lastModified","created_at","updated_at","last_modified"].some(y=>t.toLowerCase().includes(y.toLowerCase())),v=t=>{if(typeof t=="number")return t>9466848e5&&t<41024448e5;if(typeof t=="string"){const x=new Date(t);return!isNaN(x.getTime())&&x.getFullYear()>2e3}return!1},p=t=>{let x;if(typeof t=="number")x=new Date(t);else if(typeof t=="string")x=new Date(t);else return String(t);if(isNaN(x.getTime()))return String(t);const i=new Date().getTime()-x.getTime(),w=Math.floor(i/(1e3*60)),L=Math.floor(i/(1e3*60*60)),$=Math.floor(i/(1e3*60*60*24));let P="";w<1?P="just now":w<60?P=`${w}m ago`:L<24?P=`${L}h ago`:$<7&&(P=`${$}d ago`);const U=x.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"}),B=typeof t=="number"?t.toString():String(t);return`${P?`${U} (${P})`:U}

Raw: ${B}`},u=(t,x)=>t===void 0?"(not set)":t===null?"null":x&&(f(x)||v(t))?p(t):typeof t=="boolean"?t.toString():typeof t=="string"?`"${t}"`:typeof t=="number"?t.toString():typeof t=="object"?Array.isArray(t)?`[${t.length} items]`:`{${Object.keys(t).length} properties}`:String(t),D=t=>t!=null&&typeof t=="object"&&!Array.isArray(t)&&Object.keys(t).length>0,h=t=>{switch(t){case"added":return e.jsx(je,{className:"h-4 w-4 text-green-600"});case"removed":return e.jsx(be,{className:"h-4 w-4 text-red-600"});case"changed":return e.jsx(ye,{className:"h-4 w-4 text-yellow-600"});default:return null}},b=t=>{switch(t){case"added":return"bg-green-50 border-green-200";case"removed":return"bg-red-50 border-red-200";case"changed":return"bg-yellow-50 border-yellow-200";default:return"bg-gray-50 border-gray-200"}},N=(t,x)=>{switch(t){case"added":return x?"text-gray-400":"text-green-700 font-medium";case"removed":return x?"text-red-700 font-medium":"text-gray-400";case"changed":return x?"text-yellow-700":"text-yellow-800 font-medium";default:return"text-gray-700"}},E=g.filter(t=>t.type!=="same"),O=g.filter(t=>t.type==="same");return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[E.length," field",E.length!==1?"s":""," ","changed",O.length>0&&e.jsxs("span",{children:[", ",O.length," unchanged"]})]}),e.jsxs("button",{onClick:()=>r(!m),className:"flex items-center space-x-1 text-sm text-blue-600 hover:text-blue-800",children:[m?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"}),e.jsxs("span",{children:[m?"Collapse":"Expand"," details"]})]})]}),m&&e.jsxs("div",{className:"space-y-2",children:[E.map(t=>e.jsxs("div",{className:`p-3 rounded-lg border ${b(t.type)}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[h(t.type),e.jsx("span",{className:"font-medium text-gray-900",children:t.path||t.key}),t.isNested&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:"Nested"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:t.type})]}),t.isNested&&t.path&&e.jsxs("div",{className:"mb-2 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Path:"})," ",t.path]}),t.type==="changed"&&D(t.localValue)&&D(t.serverValue)?e.jsx("div",{className:"mt-2",children:e.jsx(Ts,{localValue:t.localValue,serverValue:t.serverValue,path:t.path||t.key,showPath:!!t.isNested,expanded:!1})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Local Version"}),e.jsx("div",{className:`text-sm p-2 bg-white rounded border font-mono whitespace-pre-line ${N(t.type,!0)}`,children:u(t.localValue,t.key)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-gray-600 mb-1",children:"Server Version"}),e.jsx("div",{className:`text-sm p-2 bg-white rounded border font-mono whitespace-pre-line ${N(t.type,!1)}`,children:u(t.serverValue,t.key)})]})]})]},t.path||t.key)),O.length>0&&e.jsxs("details",{className:"group",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 hover:text-gray-800",children:e.jsxs("span",{className:"inline-flex items-center space-x-1",children:[e.jsx(Q,{className:"h-3 w-3 transition-transform group-open:rotate-90"}),e.jsxs("span",{children:["Show ",O.length," unchanged fields"]})]})}),e.jsx("div",{className:"mt-2 space-y-2",children:O.map(t=>e.jsxs("div",{className:"p-2 rounded border border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-1",children:t.key}),e.jsx("div",{className:"text-sm text-gray-600 font-mono whitespace-pre-line",children:u(t.localValue,t.key)})]},t.key))})]})]})]})},Ms=({conflict:n,onResolve:a,onCancel:o,...l})=>{const[c,m]=S.useState("server"),[r,g]=S.useState("strategy"),[f,v]=S.useState(new Map),p=n.localVersion,u=n.serverVersion,D=(s,j)=>j.split(".").reduce((d,C)=>{if(d&&typeof d=="object"&&C in d)return d[C]},s),h=(s,j,d)=>{const C=j.split("."),A=C.pop();if(!A)return;let k=s;for(const T of C)(!(T in k)||typeof k[T]!="object"||k[T]===null)&&(k[T]={}),k=k[T];k[A]=d},b=s=>["timestamp","createdAt","updatedAt","lastModified","created_at","updated_at","last_modified","publishedAt","published_at"].some(d=>s.toLowerCase().includes(d.toLowerCase())),N=s=>["timestamp","updatedAt","updated_at","lastModified","last_modified","createdAt","created_at"].some(d=>s.toLowerCase()===d.toLowerCase()),E=S.useMemo(()=>{if(n.conflictDetails){const s=[];n.conflictDetails.conflicts.forEach(C=>{const A=C.path,k="server",T=C.serverValue;s.push({key:A,value:T,source:k,isConflicted:!0})});const j=new Set(n.conflictDetails.conflicts.map(C=>C.path.split(".")[0]));return new Set([...Object.keys(p),...Object.keys(u)]).forEach(C=>{if(!j.has(C)){const A=p[C],k=u[C],T=!F(A,k);s.push({key:C,value:T?k:A,source:T?"server":"local",isConflicted:T})}}),s}else{const s=new Set([...Object.keys(p),...Object.keys(u)]);return Array.from(s).map(d=>{const C=p[d],A=u[d],k=!F(C,A),T=k?"server":"local";return{key:d,value:T==="local"?C:A,source:T,isConflicted:k}})}},[p,u,n]),O=S.useMemo(()=>E.filter(s=>!N(s.key)),[E]),t=S.useMemo(()=>E.filter(s=>N(s.key)),[E]);ce.useEffect(()=>{if(f.size===0){const s=new Map;E.forEach(j=>{s.set(j.key,j)}),v(s)}},[E,f.size]);const x=S.useMemo(()=>{if(n.conflictDetails){const s={...n.conflictDetails.mergedObject};f.forEach(d=>{N(d.key)||(d.key.includes(".")?h(s,d.key,d.value):s[d.key]=d.value)});const j=Date.now();return t.forEach(d=>{d.key.toLowerCase()==="timestamp"||d.key.toLowerCase()==="updatedat"||d.key.toLowerCase()==="updated_at"||d.key.toLowerCase()==="lastmodified"||d.key.toLowerCase()==="last_modified"?s[d.key]=j:(d.key.toLowerCase()==="createdat"||d.key.toLowerCase()==="created_at")&&(s[d.key]=p[d.key]??u[d.key]??j)}),s}else{const s={};f.forEach(d=>{N(d.key)||(s[d.key]=d.value)});const j=Date.now();return t.forEach(d=>{d.key.toLowerCase()==="timestamp"||d.key.toLowerCase()==="updatedat"||d.key.toLowerCase()==="updated_at"||d.key.toLowerCase()==="lastmodified"||d.key.toLowerCase()==="last_modified"?s[d.key]=j:(d.key.toLowerCase()==="createdat"||d.key.toLowerCase()==="created_at")&&(s[d.key]=p[d.key]??u[d.key]??j)}),s}},[f,t,p,u,n]),y=S.useMemo(()=>{const s=Array.from(f.values()).filter(d=>!N(d.key)&&(d.source!=="local"||!F(d.value,p[d.key]))),j=t.filter(d=>d.key.toLowerCase()!=="createdat"&&d.key.toLowerCase()!=="created_at");return[...s,...j]},[f,p,t]),i=s=>{let j;if(typeof s=="number")j=new Date(s);else if(typeof s=="string")j=new Date(s);else return"Unknown";if(isNaN(j.getTime()))return"Invalid Date";const C=new Date().getTime()-j.getTime(),A=Math.floor(C/(1e3*60)),k=Math.floor(C/(1e3*60*60)),T=Math.floor(C/(1e3*60*60*24));let _="";A<1?_="just now":A<60?_=`${A}m ago`:k<24?_=`${k}h ago`:T<7&&(_=`${T}d ago`);const K=j.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"});return _?`${K} (${_})`:K},w=(s,j)=>{if(s==null)return"(not set)";if(b(j)&&(typeof s=="number"||typeof s=="string")){const d=i(s),C=String(s);return`${d}

Raw: ${C}`}return typeof s=="object"?JSON.stringify(s,null,2):String(s)},L=s=>{switch(s){case"trip":return"Trip";case"person":return"Person";case"item":return"Item";case"rule_override":return"Rule Override";case"default_item_rule":return"Default Rule";case"rule_pack":return"Rule Pack";default:return s}},$=s=>s.name?s.name:s.title?s.title:s.description?s.description:"Unnamed item",P=(s,j)=>{console.log(`Changing field ${s} to ${j}`),v(d=>{const C=new Map(d),A=C.get(s);if(A){let k;if(n.conflictDetails&&s.includes(".")){const _=n.conflictDetails.conflicts.find(K=>K.path===s);_?k=j==="local"?_.localValue:_.serverValue:k=D(j==="local"?p:u,s)}else k=j==="local"?p[s]:u[s];const T={...A,value:k,source:j};console.log(`Updated choice for ${s}:`,T),C.set(s,T)}return console.log("New field choices:",Array.from(C.entries())),C})},U=s=>f.get(s),B=()=>{r==="strategy"?c==="manual"?g("merge"):M():r==="merge"&&g("preview")},Y=()=>{r==="preview"?g("merge"):r==="merge"&&g("strategy")},M=()=>{switch(c){case"local":a("local");break;case"server":a("server");break;case"manual":a("manual",x);break}},I=()=>{switch(r){case"strategy":return"Resolve Sync Conflict";case"merge":return"Choose Field Values";case"preview":return"Review Merged Object";default:return"Resolve Sync Conflict"}};return e.jsx(ge,{isOpen:l.isOpen,onClose:o,title:I(),size:"xl",modalBoxClassName:"m-h-xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:`flex items-center space-x-2 ${r==="strategy"?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${r==="strategy"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"1"}),e.jsx("span",{className:"text-sm",children:"Strategy"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:`flex items-center space-x-2 ${r==="merge"?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${r==="merge"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"2"}),e.jsx("span",{className:"text-sm",children:"Merge"})]}),e.jsx("div",{className:"w-8 h-px bg-gray-300"}),e.jsxs("div",{className:`flex items-center space-x-2 ${r==="preview"?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${r==="preview"?"bg-blue-600 text-white":"bg-gray-200"}`,children:"3"}),e.jsx("span",{className:"text-sm",children:"Preview"})]})]}),r==="strategy"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(V,{className:"h-6 w-6 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800",children:"Sync Conflict Detected"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:[L(n.entityType),":"," ",$(p)]})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Changes Overview",n.conflictDetails&&e.jsxs("span",{className:"ml-2 text-sm text-blue-600",children:["(",n.conflictDetails.conflicts.length," field",n.conflictDetails.conflicts.length!==1?"s":""," ","conflicted)"]})]}),e.jsx(Es,{localData:p,serverData:u,expanded:!0,conflict:n,showOnlyConflicts:!1})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Choose how to resolve this conflict:"}),e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"resolution",value:"local",checked:c==="local",onChange:s=>m(s.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-medium",children:"Keep Local Changes"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Use your local version and overwrite the server."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Last modified:"," ",i(p.timestamp||p.updatedAt)]})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"resolution",value:"server",checked:c==="server",onChange:s=>m(s.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium",children:"Use Server Version"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Accept the server version and discard local changes."}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Last modified:"," ",i(u.timestamp||u.updatedAt)]})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 p-4 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"resolution",value:"manual",checked:c==="manual",onChange:s=>m(s.target.value),className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Te,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium",children:"Merge Field by Field"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Choose which value to keep for each conflicting field."}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:"Review and select field values manually"})]})]})]})]}),r==="merge"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Field Selection"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Choose which value to keep for each field. Conflicting fields are highlighted."}),t.length>0&&e.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:[e.jsx("strong",{children:"Note:"})," System-managed timestamp fields (",t.map(s=>s.key).join(", "),") are excluded and will be auto-updated."]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:O.map(s=>{let j,d;if(n.conflictDetails&&s.key.includes(".")){const k=n.conflictDetails.conflicts.find(T=>T.path===s.key);k?(j=k.localValue,d=k.serverValue):(j=D(p,s.key),d=D(u,s.key))}else j=p[s.key],d=u[s.key];const C=JSON.stringify(j)===JSON.stringify(d),A=U(s.key)||s;return e.jsxs("div",{className:`p-4 border rounded-lg ${s.isConflicted?"border-yellow-300 bg-yellow-50":"border-gray-200 bg-gray-50"}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.key}),s.isConflicted&&e.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-200 text-yellow-800 rounded",children:"Conflicted"}),s.key.includes(".")&&e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"Nested"})]})}),C?e.jsxs("div",{className:"p-3 bg-gray-100 border border-gray-200 rounded",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Same value on both sides"}),e.jsx("div",{className:"text-sm text-gray-700 font-mono",children:w(j,s.key)})]}):e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("label",{className:`flex items-start space-x-3 p-3 border rounded cursor-pointer transition-colors ${A.source==="local"?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:`field-${s.key}`,value:"local",checked:A.source==="local",onChange:k=>{k.target.checked&&P(s.key,"local")},className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(me,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Local"})]}),e.jsx("div",{className:"text-sm text-gray-700 font-mono whitespace-pre-line break-all",children:w(j,s.key)})]})]}),e.jsxs("label",{className:`flex items-start space-x-3 p-3 border rounded cursor-pointer transition-colors ${A.source==="server"?"border-green-500 bg-green-50":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("input",{type:"radio",name:`field-${s.key}`,value:"server",checked:A.source==="server",onChange:k=>{k.target.checked&&P(s.key,"server")},className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ne,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Server"})]}),e.jsx("div",{className:"text-sm text-gray-700 font-mono whitespace-pre-line break-all",children:w(d,s.key)})]})]})]})]},s.key)})})]}),r==="preview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-600"}),e.jsx("h4",{className:"font-medium text-green-900",children:"Final Merged Object"})]}),e.jsx("p",{className:"text-sm text-green-700",children:"Review the final merged object. User-selected fields and auto-updated system fields are highlighted."}),y.length>0&&e.jsxs("p",{className:"text-sm text-green-700 mt-1",children:[e.jsx("strong",{children:y.length})," field",y.length!==1?"s":""," will be updated."]})]}),t.length>0&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Note:"})," Timestamp fields (",t.map(s=>s.key).join(", "),") are automatically managed and will be updated to the current time."]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-3",children:"Merged Result"}),e.jsxs("div",{className:"space-y-2",children:[Object.entries(x).filter(([s])=>!N(s)).map(([s,j])=>{const C=U(s)?.source!=="local"||JSON.stringify(j)!==JSON.stringify(p[s]);return e.jsxs("div",{className:`p-2 rounded ${C?"bg-yellow-50 border border-yellow-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s}),C&&e.jsx("span",{className:"px-2 py-1 text-xs bg-yellow-200 text-yellow-800 rounded",children:"Modified"})]}),e.jsx("div",{className:"text-sm text-gray-700 font-mono whitespace-pre-line",children:w(j,s)})]},s)}),Object.entries(x).filter(([s])=>N(s)).map(([s,j])=>e.jsxs("div",{className:"p-2 rounded bg-blue-50 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:s}),e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-200 text-blue-800 rounded",children:"Auto-Updated"})]}),e.jsx("div",{className:"text-sm text-gray-700 font-mono whitespace-pre-line",children:w(j,s)})]},s))]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{children:r!=="strategy"&&e.jsxs("button",{onClick:Y,className:"flex items-center space-x-2 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{children:"Back"})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:o,className:"px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"}),r==="preview"?e.jsxs("button",{onClick:M,className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{children:"Apply Merge"})]}):e.jsx("button",{onClick:B,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:r==="strategy"&&c!=="manual"?"Resolve Conflict":"Next"})]})]})]})})},Os=({conflicts:n,onResolveConflict:a,onResolveAll:o})=>{const l=r=>{switch(r){case"trip":return"Trip";case"person":return"Person";case"item":return"Item";case"rule_override":return"Rule Override";case"default_item_rule":return"Default Rule";case"rule_pack":return"Rule Pack";default:return r}},c=r=>r.name?r.name:r.title?r.title:r.description?r.description:"Unnamed item",m=r=>{const f=Date.now()-r;return f<6e4?"Just now":f<36e5?`${Math.floor(f/6e4)}m ago`:f<864e5?`${Math.floor(f/36e5)}h ago`:`${Math.floor(f/864e5)}d ago`};return n.length===0?e.jsxs("div",{className:"p-6 text-center text-gray-500",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium",children:"No sync conflicts"}),e.jsx("p",{className:"text-sm",children:"All your data is in sync!"})]}):e.jsxs("div",{className:"space-y-4",children:[o&&n.length>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("span",{className:"font-medium text-yellow-800",children:[n.length," conflicts need resolution"]})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>o("server"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700",children:"Use Server (All)"}),e.jsx("button",{onClick:()=>o("local"),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:"Keep Local (All)"})]})]}),e.jsx("div",{className:"space-y-2",children:n.map(r=>{const g=r.localVersion,f=r.serverVersion;return e.jsx("div",{className:"p-4 border border-yellow-200 rounded-lg bg-white hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>a(r),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(V,{className:"h-5 w-5 text-yellow-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:[l(r.entityType)," Conflict"]}),e.jsx("p",{className:"text-sm text-gray-600",children:c(g)})]})]}),e.jsxs("div",{className:"mt-3 flex items-center space-x-6 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsxs("span",{children:["Local:"," ",m(g.timestamp||Date.now())]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(re,{className:"h-3 w-3"}),e.jsxs("span",{children:["Server:"," ",m(f.timestamp||Date.now())]})]})]})]}),e.jsx(Q,{className:"h-5 w-5 text-gray-400"})]})},r.id)})})]})};function Ls({minimal:n=!1}){const[a,o]=S.useState(q()),[l,c]=S.useState(null),[m,r]=S.useState(!1),[g,f]=S.useState(!1);S.useEffect(()=>{Le().then(c);const b=E=>{c(E.detail)};window.addEventListener("versionUpdate",b);const N=setInterval(()=>{o(q())},5e3);return()=>{clearInterval(N),window.removeEventListener("versionUpdate",b)}},[]);const v=async()=>{f(!0);try{const N=!Pe();_e(N),N?(await Re(),R("Service worker enabled and registered")):(await $e(),R("Service worker disabled and unregistered")),o(q())}catch(b){console.error("Failed to toggle service worker:",b),R("Failed to toggle service worker")}finally{f(!1)}},p=async()=>{confirm("Clear all caches? This will force a full reload.")&&(await se.clearAllCaches(),window.location.reload())},u=async()=>{await se.checkForUpdates(),o(q())},D=()=>{se.skipWaiting()},h=async()=>{try{const b=await fetch(X("/packing-list","/service-worker.js"));b.ok?(alert("✅ Service worker is accessible! Check console for details."),console.log("🔧 Service worker test successful:",{status:b.status,headers:Object.fromEntries(b.headers.entries()),url:b.url})):alert(`❌ Service worker not accessible: ${b.status}`)}catch(b){alert(`❌ Service worker test failed: ${b}`),console.error("Service worker test error:",b)}};return n?e.jsxs("div",{className:"fixed bottom-4 right-4 z-50",children:[e.jsx("div",{className:"tooltip tooltip-left","data-tip":"Service Worker Status",children:e.jsx("button",{className:`btn btn-circle btn-sm ${a.isControlling?"btn-success":a.isDevelopment?"btn-info":"btn-warning"}`,onClick:()=>r(!m),children:a.isControlling?"🟢":a.isDevelopment?"🔧":"🟡"})}),m&&e.jsx("div",{className:"absolute bottom-12 right-0 bg-base-100 border rounded-lg p-4 shadow-lg min-w-64",children:e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Service Worker Status"}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer justify-start gap-2 py-1",children:[e.jsx("input",{type:"checkbox",className:"toggle toggle-xs toggle-primary",checked:a.isEnabled,onChange:v,disabled:g}),e.jsx("span",{className:"label-text text-xs",children:a.isEnabled?"Enabled":"Disabled"})]})}),e.jsxs("div",{children:["Mode: ",a.isDevelopment?"Development":"Production"]}),e.jsxs("div",{children:["Online: ",navigator.onLine?"✅":"❌"]}),e.jsxs("div",{children:["Controlling: ",a.isControlling?"✅":"❌"]}),a.updateAvailable&&!a.isDevelopment&&e.jsx("button",{className:"btn btn-sm btn-primary w-full",onClick:D,children:"Update Available - Click to Update"}),a.isDevelopment&&e.jsx("button",{className:"btn btn-sm btn-outline w-full",onClick:h,children:"Test Service Worker"}),l&&e.jsxs("div",{className:"text-xs opacity-70",children:["v",l.version," (",l.buildHash,")"]})]})})]}):e.jsxs("div",{className:"bg-base-200 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"🔧 Service Worker Debug"}),e.jsxs("div",{className:"mb-4 p-3 bg-base-100 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Service Worker"}),e.jsx("p",{className:"text-sm opacity-70",children:a.isDevelopment?"Disabled by default in development mode":"Enable offline support and caching"})]}),e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer gap-2",children:[e.jsx("span",{className:"label-text",children:a.isEnabled?"Enabled":"Disabled"}),e.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:a.isEnabled,onChange:v,disabled:g})]})})]}),!a.isEnabled&&e.jsx("div",{className:"mt-2 text-xs opacity-60",children:"Enable to use offline features and faster loading"})]}),a.isDevelopment&&e.jsx("div",{className:"alert alert-info mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"🚧 Development Mode:"}),"Service worker served by Vite middleware. Version polling disabled."]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-base-100 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Status"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:["Mode: ",a.isDevelopment?"🚧 Development":"🚀 Production"]}),e.jsxs("div",{children:["Supported: ",a.isSupported?"✅":"❌"]}),e.jsxs("div",{children:["Enabled: ",a.isEnabled?"✅":"❌"]}),e.jsxs("div",{children:["Registered: ",a.isRegistered?"✅":"❌"]}),e.jsxs("div",{children:["Controlling: ",a.isControlling?"✅":"❌"]}),e.jsxs("div",{children:["Update Available: ",a.updateAvailable?"✅":"❌"]}),e.jsxs("div",{children:["Online: ",navigator.onLine?"✅":"❌"]})]})]}),e.jsxs("div",{className:"bg-base-100 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Version"}),l?e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Version:"})," ",l.version]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Build:"})," ",l.buildHash]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Time:"})," ",new Date(l.buildTime).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Env:"})," ",l.environment]})]}):e.jsx("div",{className:"text-sm opacity-70",children:"Version info not available"})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[a.isDevelopment?e.jsx("button",{className:"btn btn-sm btn-outline",onClick:h,children:"Test Service Worker Access"}):e.jsx("button",{className:"btn btn-sm btn-outline",onClick:u,children:"Check for Updates"}),a.updateAvailable&&!a.isDevelopment&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:D,children:"Install Update"}),e.jsx("button",{className:"btn btn-sm btn-outline btn-warning",onClick:p,children:"Clear Cache"}),e.jsx("a",{href:X("/packing-list","/version"),className:"btn btn-sm btn-outline",target:"_blank",rel:"noopener noreferrer",children:"View Version Page"}),a.isDevelopment&&e.jsx("a",{href:"/service-worker.js",className:"btn btn-sm btn-outline",target:"_blank",rel:"noopener noreferrer",children:"View Service Worker"})]})]})}function Ps(){const{currentTheme:n,setTheme:a,availableThemes:o}=Ve(),l=c=>{switch(c){case"system":return Fe;case"light":return Ie;case"dark":case"night":case"black":return Ue;default:return G}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Choose Your Theme"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o.map(c=>{const m=l(c.value),r=n===c.value;return e.jsxs("button",{onClick:()=>a(c.value),className:`
                relative p-4 rounded-lg border-2 transition-all duration-200 
                hover:scale-105 hover:shadow-lg
                ${r?"border-primary ring-2 ring-primary/20":"border-base-300 hover:border-primary/50"}
              `,children:[e.jsx("div",{className:"mb-3 relative overflow-hidden rounded-md h-16","data-theme":c.value,children:e.jsxs("div",{className:"h-full w-full bg-base-100 flex items-center justify-center relative",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary"}),e.jsx("div",{className:"absolute top-1 left-1 w-2 h-2 rounded-full bg-base-content"}),e.jsx("div",{className:"absolute bottom-1 right-1 w-3 h-1 rounded bg-accent opacity-60"})]})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-sm",children:c.label})]}),e.jsx("p",{className:"text-xs text-base-content/60",children:c.description})]}),r&&e.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 bg-primary rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-primary-content rounded-full"})})]},c.value)})}),e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"w-4 h-4 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Theme Settings"}),e.jsx("p",{className:"text-sm",children:"Your theme preference is automatically saved and synced across all your devices. The “System” option will follow your device's dark/light mode setting."})]})]})})]})}const _s=[{id:"conflict-1",entityType:"trip",entityId:"trip-123",localVersion:{title:"My Amazing Trip (Local)",description:"Updated locally with new activities",startDate:"2024-12-15",endDate:"2024-12-22",updatedAt:Date.now()-3e5,createdAt:Date.now()-864e5*7,timestamp:Date.now()-3e5},serverVersion:{title:"My Amazing Trip (Server)",description:"Updated on server with budget changes",startDate:"2024-12-15",endDate:"2024-12-22",updatedAt:Date.now()-6e4,createdAt:Date.now()-864e5*7,timestamp:Date.now()-6e4},conflictType:"update_conflict",timestamp:Date.now()},{id:"conflict-2",entityType:"item",entityId:"item-456",localVersion:{name:"Hiking Boots",category:"Footwear",packed:!1,quantity:1,weight:800,lastModified:Date.now()-36e5,updatedAt:Date.now()-36e5},serverVersion:{name:"Hiking Boots",category:"Footwear",packed:!0,quantity:1,weight:850,lastModified:Date.now()-18e5,updatedAt:Date.now()-18e5},conflictType:"update_conflict",timestamp:Date.now()},{id:"conflict-3",entityType:"rule_pack",entityId:"pack-789",localVersion:{name:"Winter Essentials Pack",description:"Essential items for cold weather trips",version:"1.2.0",author:"Local User",createdAt:17031168e5,updated_at:Date.now()-864e5*2,publishedAt:17031168e5},serverVersion:{name:"Winter Essentials Pack v2",description:"Enhanced essential items for cold weather trips with new gear",version:"2.0.0",author:"Community",createdAt:17031168e5,updated_at:Date.now()-864e5,publishedAt:Date.now()-864e5},conflictType:"update_conflict",timestamp:Date.now()}];function Rs(){const{syncState:n,isInitialized:a}=ds(h=>h.sync),o=oe(),[l,c]=S.useState(null),m=h=>{c(h)},r=async(h,b)=>{console.log("🔧 [SYNC DASHBOARD] Resolving conflict:",l?.id,"with strategy:",h),b&&console.log("🔧 [SYNC DASHBOARD] Manual data:",b),l&&await o(ms({conflictId:l.id,strategy:h,manualData:b,conflict:l})),c(null)},g=async h=>{console.log("🔧 [SYNC DASHBOARD] Resolving all conflicts with strategy:",h),o({type:"CLEAR_SYNC_CONFLICTS"})},f=()=>{console.log("🔧 [SYNC DASHBOARD] Toggling sync status:",!n.isSyncing),o({type:"SET_SYNC_SYNCING_STATUS",payload:!n.isSyncing})},v=()=>{console.log("🔧 [SYNC DASHBOARD] Toggling online status:",!n.isOnline),o({type:"SET_SYNC_ONLINE_STATUS",payload:!n.isOnline})},p=()=>{const h={id:`conflict-${Date.now()}`,entityType:"person",entityId:`person-${Date.now()}`,localVersion:{name:"John Doe (Local)",age:25,timestamp:Date.now()-500},serverVersion:{name:"John Doe (Server)",age:26,timestamp:Date.now()},conflictType:"update_conflict",timestamp:Date.now()};console.log("🔧 [SYNC DASHBOARD] Adding mock conflict:",h.id),o({type:"ADD_SYNC_CONFLICT",payload:h})},u=n,D=ve();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"Sync Status"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx("div",{className:"badge badge-success",children:"Initialized"}),e.jsx("div",{className:"badge badge-info",children:"Redux State"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Live Status"}),e.jsx(Be,{syncState:u,onClick:()=>console.log("🔧 [SYNC DASHBOARD] Status indicator clicked")})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Current State"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Online:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[u.isOnline||!D?e.jsx(Ne,{className:"w-4 h-4 text-success"}):e.jsx(we,{className:"w-4 h-4 text-error"}),e.jsx("span",{children:u.isOnline?"Yes":"No"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Syncing:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[u.isSyncing?e.jsx(ie,{className:"w-4 h-4 text-info animate-spin"}):e.jsx(We,{className:"w-4 h-4 text-success"}),e.jsx("span",{children:u.isSyncing?"Yes":"No"})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Pending Changes:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[u.pendingChanges.length>0&&e.jsx(re,{className:"w-4 h-4 text-warning"}),e.jsx("span",{children:u.pendingChanges.length})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Conflicts:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[u.conflicts.length>0&&e.jsx(V,{className:"w-4 h-4 text-error"}),e.jsx("span",{children:u.conflicts.length})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Last Sync:"}),e.jsx("span",{className:"text-xs",children:u.lastSyncTimestamp?new Date(u.lastSyncTimestamp).toLocaleString():"Never"})]})]})]})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Sync Controls"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a&&e.jsxs("button",{onClick:()=>{console.log("NYI")},className:"btn btn-primary btn-sm",children:[e.jsx(ie,{className:"w-4 h-4"}),"Force Sync"]}),e.jsx("button",{onClick:f,className:"btn btn-sm",children:n.isSyncing?"Stop Syncing":"Start Syncing"}),e.jsxs("button",{onClick:v,className:"btn btn-sm",children:["Go ",n.isOnline?"Offline":"Online"]})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Testing & Demo Controls"}),e.jsx("p",{className:"text-base-content/70 mb-4",children:"These controls simulate sync scenarios for testing and demonstration purposes."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:p,className:"btn btn-sm btn-outline",children:"Add Single Conflict"}),e.jsx("button",{className:"btn btn-warning btn-sm",onClick:()=>o({type:"SET_SYNC_CONFLICTS",payload:_s}),disabled:n.conflicts.length>0,children:"Simulate Multiple Conflicts"}),e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>o({type:"CLEAR_SYNC_CONFLICTS"}),disabled:n.conflicts.length===0,children:"Clear All Conflicts"})]})]})}),u.conflicts.length>0&&e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-error"}),"Active Sync Conflicts (",u.conflicts.length,")"]}),e.jsx(Os,{conflicts:u.conflicts,onResolveConflict:m,onResolveAll:g})]})}),l&&e.jsx(Ms,{isOpen:!!l,onClose:()=>c(null),conflict:l,onResolve:r,onCancel:()=>c(null)})]})}const $s=({className:n=""})=>{const a=oe(),[o,l]=S.useState(!1),[c,m]=S.useState(!1),r=async()=>{console.log("🧹 [DATABASE RESET] Starting IndexedDB cleanup...");const f="packing-list";try{await new Promise(v=>{const p=indexedDB.deleteDatabase(f);p.onsuccess=()=>{console.log(`🗑️ [DATABASE RESET] Deleted database: ${f}`),v()},p.onerror=()=>{console.error(`❌ [DATABASE RESET] Failed to delete database: ${f}`),v()},p.onblocked=()=>{console.warn(`⚠️ [DATABASE RESET] Database deletion blocked: ${f}`),v()}})}catch(v){console.error("❌ [DATABASE RESET] Error during IndexedDB cleanup:",v)}},g=async()=>{l(!0);try{console.log("🔄 [DATABASE RESET] Starting complete database reset..."),await r(),console.log("🧹 [DATABASE RESET] Clearing Redux state..."),a({type:"CLEAR_ALL_DATA"}),console.log("🔄 [DATABASE RESET] Resetting sync service..."),hs(),console.log("🔄 [DATABASE RESET] Reloading page for clean state..."),setTimeout(()=>{window.location.reload()},1e3),console.log("✅ [DATABASE RESET] Database reset completed successfully"),R("Database reset completed. Sync will reload data from server.")}catch(f){console.error("❌ [DATABASE RESET] Database reset failed:",f),R("Database reset failed. Check console for details.")}finally{l(!1),m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`card bg-base-100 shadow-xl ${n}`,children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2 text-error",children:[e.jsx(ne,{className:"w-5 h-5"}),"Database Reset Utility"]}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Danger Zone"}),e.jsx("div",{className:"text-xs",children:"This will clear all local data and force sync to reload from server. Use this for debugging sync issues or starting fresh."})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"This action will:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4",children:[e.jsx("li",{children:"Clear all IndexedDB databases"}),e.jsx("li",{children:"Reset Redux state (except authentication)"}),e.jsx("li",{children:"Reinitialize sync service"}),e.jsx("li",{children:"Reload the page for clean state"}),e.jsx("li",{children:"Force sync to pull all data from server"})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{className:"btn btn-error",onClick:()=>m(!0),disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),"Resetting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4"}),"Reset Database"]})})})]})}),e.jsx(ze,{isOpen:c,onClose:()=>m(!1),title:"Reset Database?",message:"Are you sure you want to reset the database? This will clear all local data and reload from the server. This action cannot be undone.",confirmText:"Reset Database",cancelText:"Cancel",confirmVariant:"error",onConfirm:g,"data-testid":"database-reset-confirm-dialog"})]})};function Vs(n=""){const[a,o]=S.useState(()=>typeof window<"u"&&window.location.hash.slice(1)||n),l=S.useCallback(r=>{if(typeof window<"u"){const g=r.startsWith("#")?r.slice(1):r;g?window.history.replaceState(null,"",`#${g}`):window.history.replaceState(null,"",window.location.pathname+window.location.search),o(g)}},[]);S.useEffect(()=>{if(typeof window>"u")return;const r=()=>{const g=window.location.hash.slice(1);o(g||n)};return window.addEventListener("hashchange",r),window.addEventListener("popstate",r),()=>{window.removeEventListener("hashchange",r),window.removeEventListener("popstate",r)}},[n]);const c=S.useCallback(r=>{const g=r.startsWith("#")?r.slice(1):r;return a===g},[a]),m=S.useCallback(()=>a?`#${a}`:"",[a]);return{hash:a,setHash:l,isHashActive:c,getFullHash:m}}function Us(){const n=oe(),{user:a,isAuthenticated:o,offlineAccounts:l,isOfflineMode:c,isOnline:m,forceOfflineMode:r,isConnected:g,authStatus:f,connectivityStatus:v,loading:p,isInitialized:u}=ue(),D=ve(),{hash:h,setHash:b}=Vs("settings"),[N,E]=S.useState("settings");S.useEffect(()=>{h&&E(h)},[h]),S.useEffect(()=>{console.log("🔍 [SETTINGS DEBUG] Auth state on settings page:",{authLoading:p,authIsInitialized:u,isAuthenticated:o,user:a?{id:a.id,email:a.email}:null,authStatus:f,connectivityStatus:v})},[p,u,o,a,f,v]);const O=l||[],t=()=>{localStorage.removeItem(he);for(const i of Object.keys(localStorage))i.startsWith("help-")&&localStorage.removeItem(i);R("Help messages have been reset")},x=()=>{localStorage.setItem(he,"hidden"),R("All help messages have been hidden")},y=()=>{sessionStorage.setItem("session-demo-choice","demo"),n({type:"LOAD_DEMO_DATA"}),R("Demo data has been loaded")};return e.jsxs(gs,{children:[e.jsx(ps,{title:"Settings"}),e.jsxs("div",{className:"tabs tabs-boxed mb-6",children:[e.jsxs("button",{className:`tab ${N==="settings"?"tab-active":""}`,onClick:()=>b("settings"),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Settings"]}),e.jsxs("button",{className:`tab ${N==="account"?"tab-active":""}`,onClick:()=>b("account"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Account"]}),e.jsxs("button",{className:`tab ${N==="sync"?"tab-active":""}`,onClick:()=>b("sync"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Sync Dashboard"]}),e.jsxs("button",{className:`tab ${N==="debug"?"tab-active":""}`,onClick:()=>b("debug"),children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Debug & Status"]})]}),N==="settings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Help & Tutorials"}),e.jsx("p",{className:"text-base-content/70",children:"Manage help messages and tutorials that appear throughout the app."}),e.jsxs("div",{className:"card-actions justify-end gap-2",children:[e.jsxs("button",{className:"btn btn-primary",onClick:t,children:[e.jsx(te,{className:"w-4 h-4"}),"Reset Help Messages"]}),e.jsxs("button",{className:"btn",onClick:x,children:[e.jsx(Ye,{className:"w-4 h-4"}),"Hide All Help"]})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl space-y-4",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Demo Data"}),e.jsx("p",{className:"text-base-content/70",children:"Load the demo trip data to see how the app works with a sample trip."}),e.jsxs("div",{className:"alert alert-warning mb-4",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{children:"Loading demo data will replace your current trip data."})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsxs("button",{className:"btn btn-primary",onClick:y,children:[e.jsx(fe,{className:"w-4 h-4"}),"Load Demo Data"]})})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Appearance & Theme"]}),e.jsx("p",{className:"text-base-content/70 mb-4",children:"Customize the look and feel of your app with different color themes."}),e.jsx(Ps,{})]})})]}),N==="account"&&e.jsx("div",{className:"space-y-4",children:o?e.jsxs(e.Fragment,{children:[e.jsx(Ds,{showToast:R,onAccountDeleted:()=>{Ke("/")}}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5"}),"Offline Accounts"]}),e.jsx("p",{className:"text-base-content/70 mb-4",children:"Manage your offline accounts and their security settings. Offline accounts allow you to use the app without an internet connection."}),O.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold",children:"Available Offline Accounts:"}),e.jsx("div",{className:"grid gap-2",children:O.map(i=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-base-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"avatar",children:e.jsx(Je,{src:i.avatar_url,alt:i.name||i.email,size:32,isOnline:m,showOfflineIndicator:!1})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:i.name||i.email}),e.jsx("div",{className:"text-sm text-base-content/70",children:i.email})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i.passcode_hash?e.jsxs("div",{className:"badge badge-success gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Protected"]}):e.jsxs("div",{className:"badge badge-warning gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Unprotected"]}),i.id===a?.id&&e.jsx("div",{className:"badge badge-primary",children:"Current"})]})]},i.id))})]}):e.jsx("div",{className:"alert alert-info",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsx("span",{children:"No offline accounts found. Sign in online to create an offline account automatically."})]})})]})}),a&&e.jsx(As,{})]}):e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx(z,{className:"w-16 h-16 mx-auto text-base-content/50 mb-4"}),e.jsx("h2",{className:"card-title justify-center",children:"Not Signed In"}),e.jsx("p",{className:"text-base-content/70 mb-4",children:"You need to be signed in to manage your account settings."}),e.jsx("div",{className:"card-actions justify-center",children:e.jsx("a",{href:X("/packing-list","/login"),className:"btn btn-primary",children:"Sign In"})})]})})}),N==="sync"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Rs,{})}),N==="debug"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[m||!D?e.jsx(Ne,{className:"w-5 h-5 text-success"}):e.jsx(we,{className:"w-5 h-5 text-error"}),"Connection Status"]}),e.jsxs("p",{className:"text-base-content/70",children:[m?"Connected to the internet":"Offline mode active",c&&" - Using offline authentication"]})]}),e.jsx("div",{className:`badge badge-lg ${m?"badge-success":"badge-error"}`,children:m?"Online":"Offline"})]}),e.jsxs("div",{className:"mt-4 p-4 bg-base-200 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Auth State Debug"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"isOnline:"})," ",String(m)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"isOfflineMode:"})," ",String(c)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"forceOfflineMode:"})," ",String(r)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"isConnected:"})," ",String(g)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Navigator Online:"})," ",String(typeof navigator<"u"?navigator.onLine:"N/A")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User Type:"})," ",a?.type||"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"User Email:"})," ",a?.email||"None"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Is Shared:"})," ",String(a?.isShared)]})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>{console.log("🔍 Full Auth State:",{isOnline:m,isOfflineMode:c,forceOfflineMode:r,isConnected:g,navigatorOnline:navigator.onLine,user:a,authStatus:f,connectivityStatus:v})},children:"Log Full State to Console"}),r&&e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{console.log("🔧 Clearing force offline mode..."),n({type:"auth/setForceOfflineMode",payload:!1}),n({type:"auth/switchToOnlineMode"}),R("Force offline mode disabled")},children:"Clear Force Offline"})]})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsx("div",{className:"card-body",children:e.jsx(Ls,{})})}),e.jsx($s,{}),e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h2",{className:"card-title flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5"}),"System Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-base-200 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Browser"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"User Agent:"})," ",navigator.userAgent.split(" ")[0]]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Language:"})," ",navigator.language]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Platform:"})," ",navigator.platform]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Cookies Enabled:"})," ",navigator.cookieEnabled?"✅":"❌"]})]})]}),e.jsxs("div",{className:"bg-base-200 p-3 rounded",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Storage"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Local Storage:"})," ",typeof localStorage<"u"?"✅":"❌"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Session Storage:"})," ",typeof sessionStorage<"u"?"✅":"❌"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"IndexedDB:"})," ",typeof indexedDB<"u"?"✅":"❌"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service Workers:"})," ","serviceWorker"in navigator?"✅":"❌"]})]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>{const i={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,online:navigator.onLine,cookiesEnabled:navigator.cookieEnabled,localStorage:typeof localStorage<"u",sessionStorage:typeof sessionStorage<"u",indexedDB:typeof indexedDB<"u",serviceWorker:"serviceWorker"in navigator,timestamp:new Date().toISOString()};navigator.clipboard?.writeText(JSON.stringify(i,null,2)),R("System info copied to clipboard")},children:"Copy System Info"}),e.jsx("a",{href:X("/packing-list","/version"),target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline",children:"View Build Info"})]})]})})]})]})}const Is=Object.freeze(Object.defineProperty({__proto__:null,default:Us},Symbol.toStringTag,{value:"Module"})),Fs="Settings - Packing List",Bs=Object.freeze(Object.defineProperty({__proto__:null,default:Fs},Symbol.toStringTag,{value:"Module"})),Qs={isClientRuntimeLoaded:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:!0}},onBeforeRenderEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},dataEnv:{type:"computed",definedAtData:null,valueSerialized:{type:"js-serialized",value:null}},onRenderClient:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/onRenderClient",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:as}},onHydrationEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onHydrationEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ts}},onPageTransitionStart:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionStart.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:ss}},onPageTransitionEnd:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+onPageTransitionEnd.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:es}},Page:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/settings/+Page.tsx",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Is}},hydrationCanBeAborted:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/+config.ts",fileExportPathToShowToUser:["default","hydrationCanBeAborted"]},valueSerialized:{type:"js-serialized",value:!0}},Layout:{type:"cumulative",definedAtData:[{filePathToShowToUser:"/layouts/LayoutDefault.tsx",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Xe}]},title:{type:"standard",definedAtData:{filePathToShowToUser:"/pages/settings/+title.ts",fileExportPathToShowToUser:[]},valueSerialized:{type:"plus-file",exportValues:Bs}},onBeforeRenderClient:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-redux/__internal/onBeforeRenderClient",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Qe}]},Wrapper:{type:"cumulative",definedAtData:[{filePathToShowToUser:"vike-react-redux/__internal/Wrapper",fileExportPathToShowToUser:[]}],valueSerialized:[{type:"pointer-import",value:Ze}]},Loading:{type:"standard",definedAtData:{filePathToShowToUser:"vike-react/__internal/integration/Loading",fileExportPathToShowToUser:[]},valueSerialized:{type:"pointer-import",value:Ge}}};export{Qs as configValuesSerialized};
